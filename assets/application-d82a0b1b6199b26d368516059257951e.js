!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):"undefined"!=typeof window?window.Promise=e():"undefined"!=typeof global?global.Promise=e():"undefined"!=typeof self&&(self.Promise=e())}(function(){var e,t,o;return function r(e,t,o){function n(s,a){if(!t[s]){if(!e[s]){var g="function"==typeof require&&require;if(!a&&g)return g(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var d=t[s]={exports:{}};e[s][0].call(d.exports,function(t){var o=e[s][1][t];return n(o?o:t)},d,d.exports,r,e,t,o)}return t[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)n(o[s]);return n}({1:[function(e,t){"use strict";t.exports=function(t,o,r){function n(e,t,r){var n=o(e,i,r,t===!0&&e._isBound()?e._boundTo:void 0),s=n.promise();return s.isRejected()?s:(n.setHowMany(1),n.setUnwrap(),n.init(),s)}var i=e("./some_promise_array.js")(r);t.any=function(e){return n(e,!1,t.any)},t.prototype.any=function(){return n(this,!0,this.any)}}},{"./some_promise_array.js":34}],2:[function(e,t){"use strict";function o(){this._isTickUsed=!1,this._length=0,this._lateBuffer=new n,this._functionBuffer=new n(75e3);var e=this;this.consumeFunctionBuffer=function(){e._consumeFunctionBuffer()}}var r=e("./schedule.js"),n=e("./queue.js"),i=e("./util.js").errorObj,s=e("./util.js").tryCatch1,a=e("./global.js").process;o.prototype.haveItemsQueued=function(){return this._length>0},o.prototype.invokeLater=function(e,t,o){void 0===a||null==a.domain||e.domain||(e=a.domain.bind(e)),this._lateBuffer.push(e,t,o),this._queueTick()},o.prototype.invoke=function(e,t,o){void 0===a||null==a.domain||e.domain||(e=a.domain.bind(e));var r=this._functionBuffer;r.push(e,t,o),this._length=r.length(),this._queueTick()},o.prototype._consumeFunctionBuffer=function(){for(var e=this._functionBuffer;e.length()>0;){var t=e.shift(),o=e.shift(),r=e.shift();t.call(o,r)}this._reset(),this._consumeLateBuffer()},o.prototype._consumeLateBuffer=function(){for(var e=this._lateBuffer;e.length()>0;){var t=e.shift(),o=e.shift(),r=e.shift(),n=s(t,o,r);if(n===i){if(this._queueTick(),null==t.domain)throw n.e;t.domain.emit("error",n.e)}}},o.prototype._queueTick=function(){this._isTickUsed||(r(this.consumeFunctionBuffer),this._isTickUsed=!0)},o.prototype._reset=function(){this._isTickUsed=!1,this._length=0},t.exports=new o},{"./global.js":15,"./queue.js":27,"./schedule.js":30,"./util.js":38}],3:[function(e,t){"use strict";var o=e("./promise.js")();t.exports=o},{"./promise.js":19}],4:[function(e,t){"use strict";t.exports=function(e){function t(e){var t="string"==typeof this?this:""+this;return e[t]}e.prototype.call=function(e){for(var t=arguments.length,o=new Array(t-1),r=1;t>r;++r)o[r-1]=arguments[r];return this._then(function(t){return t[e].apply(t,o)},void 0,void 0,void 0,void 0,this.call)},e.prototype.get=function(e){return this._then(t,void 0,void 0,e,void 0,this.get)}}},{}],5:[function(e,t){"use strict";t.exports=function(t,o){var r=e("./errors.js"),n=e("./async.js"),i=r.CancellationError,s={};t.prototype._cancel=function(){if(!this.isCancellable())return this;var e;if(void 0!==(e=this._cancellationParent))return e.cancel(s),void 0;var t=new i;this._attachExtraTrace(t),this._rejectUnchecked(t)},t.prototype.cancel=function(e){return this.isCancellable()?e===s?(this._cancel(),this):(n.invokeLater(this._cancel,this,void 0),this):this},t.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},t.prototype.uncancellable=function(){var e=new t(o);return e._setTrace(this.uncancellable,this),e._follow(this),e._unsetCancellable(),this._isBound()&&e._setBoundTo(this._boundTo),e},t.prototype.fork=function(e,t,o){var r=this._then(e,t,o,void 0,void 0,this.fork);return r._setCancellable(),r._cancellationParent=void 0,r}}},{"./async.js":2,"./errors.js":9}],6:[function(e,t){"use strict";t.exports=function(){function t(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{t=e.toString();var r=/\[object [a-zA-Z0-9$_]+\]/;if(r.test(t))try{var n=JSON.stringify(e);t=n}catch(i){}0===t.length&&(t="(empty array)")}return"(<"+o(t)+">, no stack trace)"}function o(e){var t=41;return e.length<t?e:e.substr(0,t-3)+"..."}function r(e,t){this.captureStackTrace(e,t)}var n=e("./util.js").inherits,i=e("./es5.js").defineProperty,s=new RegExp("\\b(?:[\\w.]*Promise(?:Array|Spawn)?\\$_\\w+|tryCatch(?:1|2|Apply)|new \\w*PromiseArray|\\w*PromiseArray\\.\\w*PromiseArray|setTimeout|CatchFilter\\$_\\w+|makeNodePromisified|processImmediate|process._tickCallback|nextTick|Async\\$\\w+)\\b"),a=null,g=null,d=!1;n(r,Error),r.prototype.captureStackTrace=function(e,t){u(this,e,t)},r.possiblyUnhandledRejection=function(e){if("object"==typeof console){var t;if("object"==typeof e||"function"==typeof e){var o=e.stack;t="Possibly unhandled "+g(o,e)}else t="Possibly unhandled "+String(e);"function"==typeof console.error||"object"==typeof console.error?console.error(t):("function"==typeof console.log||"object"==typeof console.error)&&console.log(t)}},d="CapturedTrace$captureStackTrace"!==r.prototype.captureStackTrace.name,r.combine=function(e,t){for(var o=e.length-1,r=t.length-1;r>=0;--r){var n=t[r];if(e[o]!==n)break;e.pop(),o--}e.push("From previous event:");for(var i=e.concat(t),g=[],r=0,d=i.length;d>r;++r)s.test(i[r])||r>0&&!a.test(i[r])&&"From previous event:"!==i[r]||g.push(i[r]);return g},r.isSupported=function(){return"function"==typeof u};var u=function l(){if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){a=/^\s*at\s*/,g=function(e,o){return"string"==typeof e?e:void 0!==o.name&&void 0!==o.message?o.name+". "+o.message:t(o)};var e=Error.captureStackTrace;return function(t,o){e(t,o)}}var o=new Error;if(!d&&"string"==typeof o.stack&&"function"==typeof"".startsWith&&o.stack.startsWith("stackDetection@")&&"stackDetection"===l.name){i(Error,"stackTraceLimit",{writable:!0,enumerable:!1,configurable:!1,value:25}),a=/@/;var r=/[@\n]/;return g=function(e,o){return"string"==typeof e?o.name+". "+o.message+"\n"+e:void 0!==o.name&&void 0!==o.message?o.name+". "+o.message:t(o)},function(e,t){var o,n=t.name,i=(new Error).stack,s=i.split(r),a=s.length;for(o=0;a>o&&s[o]!==n;o+=2);s=s.slice(o+2),a=s.length-2;var g="";for(o=0;a>o;o+=2)g+=s[o],g+="@",g+=s[o+1],g+="\n";e.stack=g}}return g=function(e,o){return"string"==typeof e?e:"object"!=typeof o&&"function"!=typeof o||void 0===o.name||void 0===o.message?t(o):o.name+". "+o.message},null}();return r}},{"./es5.js":11,"./util.js":38}],7:[function(e,t){"use strict";t.exports=function(t){function o(e,t,o){this._instances=e,this._callback=t,this._promise=o}function r(e,t){var o={},r=s(e,o,t);if(r===a)return r;var n=g(o);return n.length?(a.e=new TypeError("Catch filter must inherit from Error or be a simple predicate function"),a):r}var n=e("./util.js"),i=e("./errors.js"),s=n.tryCatch1,a=n.errorObj,g=e("./es5.js").keys;return o.prototype.doFilter=function(e){for(var o=this._callback,n=this._promise,g=n._isBound()?n._boundTo:void 0,d=0,u=this._instances.length;u>d;++d){var l=this._instances[d],c=l===Error||null!=l&&l.prototype instanceof Error;if(c&&e instanceof l){var h=s(o,g,e);return h===a?(t.e=h.e,t):h}if("function"==typeof l&&!c){var p=r(l,e);if(p===a){var f=i.canAttach(a.e)?a.e:new Error(a.e+"");this._promise._attachExtraTrace(f),e=a.e;break}if(p){var h=s(o,g,e);return h===a?(t.e=h.e,t):h}}}return t.e=e,t},o}},{"./errors.js":9,"./es5.js":11,"./util.js":38}],8:[function(e,t){"use strict";var o=e("./util.js"),r=o.isPrimitive,n=o.wrapsPrimitiveReceiver;t.exports=function(e){var t=function(){return this},o=function(){throw this},i=function(e,t){return 1===t?function(){throw e}:2===t?function(){return e}:void 0};e.prototype["return"]=e.prototype.thenReturn=function(e){return n&&r(e)?this._then(i(e,2),void 0,void 0,void 0,void 0,this.thenReturn):this._then(t,void 0,void 0,e,void 0,this.thenReturn)},e.prototype["throw"]=e.prototype.thenThrow=function(e){return n&&r(e)?this._then(i(e,1),void 0,void 0,void 0,void 0,this.thenThrow):this._then(o,void 0,void 0,e,void 0,this.thenThrow)}}},{"./util.js":38}],9:[function(e,t){"use strict";function o(e){try{c(e,"isAsync",!0)}catch(t){}}function r(e){return null==e?!1:e instanceof a||e.isAsync===!0}function n(e){return e instanceof h}function i(e){return n(e)}function s(e,t){function o(r){return this instanceof o?(this.message="string"==typeof r?r:t,this.name=e,h.captureStackTrace&&h.captureStackTrace(this,this.constructor),void 0):new o(r)}return l(o,h),o}function a(e){this.name="RejectionError",this.message=e,this.cause=e,this.isAsync=!0,e instanceof h?(this.message=e.message,this.stack=e.stack):h.captureStackTrace&&h.captureStackTrace(this,this.constructor)}var g=e("./global.js"),d=e("./es5.js").freeze,u=e("./util.js"),l=u.inherits,c=u.notEnumerableProp,h=g.Error,p=g.TypeError;"function"!=typeof p&&(p=s("TypeError","type error"));var f=g.RangeError;"function"!=typeof f&&(f=s("RangeError","range error"));var y=s("CancellationError","cancellation error"),b=s("TimeoutError","timeout error");l(a,h);var m="__BluebirdErrorTypes__",v=g[m];v||(v=d({CancellationError:y,TimeoutError:b,RejectionError:a}),c(g,m,v)),t.exports={Error:h,TypeError:p,RangeError:f,CancellationError:v.CancellationError,RejectionError:v.RejectionError,TimeoutError:v.TimeoutError,originatesFromRejection:r,markAsOriginatingFromRejection:o,canAttach:i}},{"./es5.js":11,"./global.js":15,"./util.js":38}],10:[function(e,t){"use strict";t.exports=function(t){function o(e){var o=new r(e),n=t.rejected(o),i=n._peekContext();return null!=i&&i._attachExtraTrace(o),n}var r=e("./errors.js").TypeError;return o}},{"./errors.js":9}],11:[function(e,t){function o(e){var t=[];for(var o in e)g.call(e,o)&&t.push(o);return t}function r(e,t,o){return e[t]=o.value,e}function n(e){return e}function i(e){try{return Object(e).constructor.prototype}catch(t){return u}}function s(e){try{return"[object Array]"===d.call(e)}catch(t){return!1}}var a=function(){"use strict";return void 0===this}();if(a)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:a};else{var g={}.hasOwnProperty,d={}.toString,u={}.constructor.prototype;t.exports={isArray:s,keys:o,defineProperty:r,freeze:n,getPrototypeOf:i,isES5:a}}},{}],12:[function(e,t){"use strict";t.exports=function(t){function o(e){for(var t=this._settledValue,o=t.length,r=new Array(o),n=0,i=0;o>i;++i)e[i]&&(r[n++]=t[i]);return r.length=n,r}var r=(e("./util.js").isArray,{ref:null});t.filter=function(e,n){return t.map(e,n,r)._then(o,void 0,void 0,r.ref,void 0,t.filter)},t.prototype.filter=function(e){return this.map(e,r)._then(o,void 0,void 0,r.ref,void 0,this.filter)}}},{"./util.js":38}],13:[function(e,t){"use strict";t.exports=function(t,o){function r(){return this}function n(){throw this}function i(e){return function(){return e}}function s(e){return function(){throw e}}function a(e,t,o){var g=l&&c(t);return o?e._then(g?r:i(t),h,void 0,t,void 0,a):e._then(g?n:s(t),h,void 0,t,void 0,a)}function g(e){var r=this.promise,n=this.handler,i=r._isBound()?n.call(r._boundTo):n();if(void 0!==i){var s=t._cast(i,g,void 0);if(s instanceof t)return a(s,e,r.isFulfilled())}return r.isRejected()?(o.e=e,o):e}function d(e){var o=this.promise,r=this.handler,n=o._isBound()?r.call(o._boundTo,e):r(e);if(void 0!==n){var i=t._cast(n,d,void 0);if(i instanceof t)return a(i,e,!0)}return e}var u=e("./util.js"),l=u.wrapsPrimitiveReceiver,c=u.isPrimitive,h=u.thrower;t.prototype._passThroughHandler=function(e,t,o){if("function"!=typeof e)return this.then();var r={promise:this,handler:e};return this._then(t?g:d,t?g:void 0,void 0,r,void 0,o)},t.prototype.lastly=t.prototype["finally"]=function(e){return this._passThroughHandler(e,!0,this.lastly)},t.prototype.tap=function(e){return this._passThroughHandler(e,!1,this.tap)}}},{"./util.js":38}],14:[function(e,t){"use strict";t.exports=function(t,o,r){var n=e("./promise_spawn.js")(t,r),i=e("./errors.js"),s=i.TypeError,a=e("./util.js").deprecated;t.coroutine=function(e){if("function"!=typeof e)throw new s("generatorFunction must be a function");var t=n;return function o(){var r=e.apply(this,arguments),n=new t(void 0,void 0,o);return n._generator=r,n._next(void 0),n.promise()}},t.coroutine.addYieldHandler=n.addYieldHandler,t.spawn=function(e){if(a("Promise.spawn is deprecated. Use Promise.coroutine instead."),"function"!=typeof e)return o("generatorFunction must be a function");var r=new n(e,this,t.spawn),i=r.promise();return r._run(t.spawn),i}}},{"./errors.js":9,"./promise_spawn.js":23,"./util.js":38}],15:[function(e,t){"use strict";t.exports=function(){return"undefined"!=typeof this?this:"undefined"!=typeof process&&"undefined"!=typeof global&&"string"==typeof process.execPath?global:"undefined"!=typeof window&&"undefined"!=typeof document&&"undefined"!=typeof navigator&&null!==navigator&&"string"==typeof navigator.appName?void 0!==window.wrappedJSObject?window.wrappedJSObject:window:void 0}()},{}],16:[function(e,t){"use strict";t.exports=function(e,t,o,r){function n(r){var i=this,s=void 0;"function"!=typeof i&&(s=i.receiver,i=i.fn);var a=!1,g=new Array(r.length);if(void 0===s)for(var d=0,u=r.length;u>d;++d){var l=i(r[d],d,u);if(!a){var c=e._cast(l,n,void 0);if(c instanceof e){if(c.isFulfilled()){g[d]=c._settledValue;continue}a=!0,l=c}}g[d]=l}else for(var d=0,u=r.length;u>d;++d){var l=i.call(s,r[d],d,u);if(!a){var c=e._cast(l,n,void 0);if(c instanceof e){if(c.isFulfilled()){g[d]=c._settledValue;continue}a=!0,l=c}}g[d]=l}return a?t(g,o,n,void 0).promise():g}function i(e,i,s,a,g){if("function"!=typeof i)return r("fn must be a function");s===!0&&e._isBound()&&(i={fn:i,receiver:e._boundTo});var d=t(e,o,a,s===!0&&e._isBound()?e._boundTo:void 0).promise();return void 0!==g&&(g.ref=d),d._then(n,void 0,void 0,i,void 0,a)}e.prototype.map=function(e,t){return i(this,e,!0,this.map,t)},e.map=function(t,o,r){return i(t,o,!1,e.map,r)}}},{}],17:[function(e,t){"use strict";t.exports=function(t){function o(e){throw e}function r(e,t){var r=this,n=a(r,t,null,e);n===d&&s.invokeLater(o,void 0,n.e)}function n(e,t){var r=this,n=g(r,t,e);n===d&&s.invokeLater(o,void 0,n.e)}var i=e("./util.js"),s=e("./async.js"),a=i.tryCatch2,g=i.tryCatch1,d=i.errorObj;t.prototype.nodeify=function(e){return"function"==typeof e?(this._then(r,n,void 0,e,this._isBound()?this._boundTo:null,this.nodeify),void 0):this}}},{"./async.js":2,"./util.js":38}],18:[function(e,t){"use strict";t.exports=function(t,o){var r=e("./util.js"),n=e("./async.js"),i=e("./errors.js"),s=r.tryCatch1,a=r.errorObj;t.prototype.progressed=function(e){return this._then(void 0,void 0,e,void 0,void 0,this.progressed)},t.prototype._progress=function(e){this._isFollowingOrFulfilledOrRejected()||this._progressUnchecked(e)},t.prototype._progressHandlerAt=function(e){return 0===e?this._progressHandler0:this[e+2-5]},t.prototype._doProgressWith=function(e){var o=e.value,r=e.handler,n=e.promise,g=e.receiver;this._pushContext();var d=s(r,g,o);if(this._popContext(),d===a){if(null!=d.e&&"StopProgressPropagation"!==d.e.name){var u=i.canAttach(d.e)?d.e:new Error(d.e+"");n._attachExtraTrace(u),n._progress(d.e)}}else t.is(d)?d._then(n._progress,null,null,n,void 0,this._progress):n._progress(d)},t.prototype._progressUnchecked=function(e){if(this.isPending())for(var r=this._length(),i=0;r>i;i+=5){var s=this._progressHandlerAt(i),a=this._promiseAt(i);if(t.is(a))"function"==typeof s?n.invoke(this._doProgressWith,this,{handler:s,promise:a,receiver:this._receiverAt(i),value:e}):n.invoke(a._progress,a,e);else{var g=this._receiverAt(i);"function"==typeof s?s.call(g,e,a):t.is(g)&&g._isProxied()?g._progressUnchecked(e):o(g,a)&&g._promiseProgressed(e,a)}}}}},{"./async.js":2,"./errors.js":9,"./util.js":38}],19:[function(e,t){"use strict";t.exports=function(){function t(e){return void 0===e?!1:e instanceof r}function o(e,t){return e instanceof h?t>=0:!1}function r(e){if("function"!=typeof e)throw new x("the promise constructor requires a resolver function");if(this.constructor!==r)throw new x("the promise constructor cannot be invoked directly");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,e!==u&&this._resolveFromResolver(e)}function n(e,t,o){return i(e,h,o,t===!0&&e._isBound()?e._boundTo:void 0).promise()}function i(e,o,n,s){var a=null;return b(e)?a=e:(a=r._cast(e,n,void 0),a!==e?a._setBoundTo(s):t(a)||(a=null)),null!==a?new o(a,"function"==typeof n?n:i,s):{promise:function(){return C("expecting an array, a promise or a thenable")}}}var s=e("./global.js"),a=e("./util.js"),g=e("./async.js"),d=e("./errors.js"),u=function(){},l={},c={e:null},h=e("./promise_array.js")(r,u),p=e("./captured_trace.js")(),f=e("./catch_filter.js")(c),y=e("./promise_resolver.js"),b=a.isArray,m=a.errorObj,v=a.tryCatch1,_=a.tryCatch2,E=a.tryCatchApply,S=d.RangeError,x=d.TypeError,w=d.CancellationError,T=d.TimeoutError,A=d.RejectionError,N=d.originatesFromRejection,D=d.markAsOriginatingFromRejection,I=d.canAttach,q=a.thrower,C=e("./errors_api_rejection")(r),R=function(){return new x("circular promise resolution chain")};r.prototype.bind=function(e){var t=new r(u);return L&&t._setTrace(this.bind,this),t._follow(this),t._setBoundTo(e),this._cancellable()&&(t._setCancellable(),t._cancellationParent=this),t},r.prototype.toString=function(){return"[object Promise]"},r.prototype.caught=r.prototype["catch"]=function(e){var t=arguments.length;if(t>1){var o,r=new Array(t-1),n=0;for(o=0;t-1>o;++o){var i=arguments[o];if("function"!=typeof i){var s=new x("A catch filter must be an error constructor or a filter function");return this._attachExtraTrace(s),g.invoke(this._reject,this,s),void 0}r[n++]=i}r.length=n,e=arguments[o],this._resetTrace(this.caught);var a=new f(r,e,this);return this._then(void 0,a.doFilter,void 0,a,void 0,this.caught)}return this._then(void 0,e,void 0,void 0,void 0,this.caught)},r.prototype.then=function(e,t,o){return this._then(e,t,o,void 0,void 0,this.then)},r.prototype.done=function(e,t,o){var r=this._then(e,t,o,void 0,void 0,this.done);r._setIsFinal()},r.prototype.spread=function(e,t){return this._then(e,t,void 0,l,void 0,this.spread)},r.prototype.isFulfilled=function(){return(268435456&this._bitField)>0},r.prototype.isRejected=function(){return(134217728&this._bitField)>0},r.prototype.isPending=function(){return!this.isResolved()},r.prototype.isResolved=function(){return(402653184&this._bitField)>0},r.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},r.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this._settledValue,e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this._settledValue,e.isRejected=!0),e},r.prototype.all=function(){return n(this,!0,this.all)},r.is=t,r.all=function(e){return n(e,!1,r.all)},r.join=function(){for(var e=arguments.length,t=new Array(e),o=0;e>o;++o)t[o]=arguments[o];return i(t,h,r.join,void 0).promise()},r.resolve=r.fulfilled=function(e,t){var o=new r(u);return L&&o._setTrace("function"==typeof t?t:r.resolve,void 0),o._tryFollow(e)?o:(o._cleanValues(),o._setFulfilled(),o._settledValue=e,o)},r.reject=r.rejected=function(e){var t=new r(u);if(L&&t._setTrace(r.reject,void 0),D(e),t._cleanValues(),t._setRejected(),t._settledValue=e,!I(e)){var o=new Error(e+"");t._setCarriedStackTrace(o)}return t._ensurePossibleRejectionHandled(),t},r.prototype.error=function(e){return this.caught(N,e)},r.prototype._resolveFromSyncValue=function(e,t){if(e===m)this._cleanValues(),this._setRejected(),this._settledValue=e.e,this._ensurePossibleRejectionHandled();else{var o=r._cast(e,t,void 0);o instanceof r?this._follow(o):(this._cleanValues(),this._setFulfilled(),this._settledValue=e)}},r.method=function(e){if("function"!=typeof e)throw new x("fn must be a function");return function t(){var o;switch(arguments.length){case 0:o=v(e,this,void 0);break;case 1:o=v(e,this,arguments[0]);break;case 2:o=_(e,this,arguments[0],arguments[1]);break;default:for(var n=arguments.length,i=new Array(n),s=0;n>s;++s)i[s]=arguments[s];o=E(e,i,this)}var a=new r(u);return L&&a._setTrace(t,void 0),a._resolveFromSyncValue(o,t),a}},r.attempt=r["try"]=function(e,t,o){if("function"!=typeof e)return C("fn must be a function");var n=b(t)?E(e,t,o):v(e,o,t),i=new r(u);return L&&i._setTrace(r.attempt,void 0),i._resolveFromSyncValue(n,r.attempt),i},r.defer=r.pending=function(e){var t=new r(u);return L&&t._setTrace("function"==typeof e?e:r.defer,void 0),new y(t)},r.bind=function(e){var t=new r(u);return L&&t._setTrace(r.bind,void 0),t._setFulfilled(),t._setBoundTo(e),t},r.cast=function(e,t){"function"!=typeof t&&(t=r.cast);var o=r._cast(e,t,void 0);return o instanceof r?o:r.resolve(o,t)},r.onPossiblyUnhandledRejection=function(e){p.possiblyUnhandledRejection="function"==typeof e?e:void 0};var L=!1||!("undefined"==typeof process||"string"!=typeof process.execPath||"object"!=typeof process.env||!process.env.BLUEBIRD_DEBUG&&"development"!==process.env.NODE_ENV);r.longStackTraces=function(){if(g.haveItemsQueued()&&L===!1)throw new Error("cannot enable long stack traces after promises have been created");L=p.isSupported()},r.hasLongStackTraces=function(){return L&&p.isSupported()},r.prototype._setProxyHandlers=function(e,t){var o=this._length();if(o>=1048570&&(o=0,this._setLength(0)),0===o)this._promise0=t,this._receiver0=e;else{var r=o-5;this[r+3]=t,this[r+4]=e,this[r+0]=this[r+1]=this[r+2]=void 0}this._setLength(o+5)},r.prototype._proxyPromiseArray=function(e,t){this._setProxyHandlers(e,t)},r.prototype._proxyPromise=function(e){e._setProxied(),this._setProxyHandlers(e,-1)},r.prototype._then=function(e,t,o,n,i,s){var a=void 0!==i,d=a?i:new r(u);if(L&&!a){var l=this._peekContext()===this._traceParent;d._traceParent=l?this._traceParent:this,d._setTrace("function"==typeof s?s:this._then,this)}!a&&this._isBound()&&d._setBoundTo(this._boundTo);var c=this._addCallbacks(e,t,o,d,n);return!a&&this._cancellable()&&(d._setCancellable(),d._cancellationParent=this),this.isResolved()&&g.invoke(this._queueSettleAt,this,c),d},r.prototype._length=function(){return 1048575&this._bitField},r.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},r.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},r.prototype._setLength=function(e){this._bitField=-1048576&this._bitField|1048575&e},r.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},r.prototype._setRejected=function(){this._bitField=134217728|this._bitField},r.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},r.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},r.prototype._isFinal=function(){return(33554432&this._bitField)>0},r.prototype._cancellable=function(){return(67108864&this._bitField)>0},r.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},r.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},r.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},r.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField},r.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},r.prototype._setCarriedStackTrace=function(e){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=e},r.prototype._unsetCarriedStackTrace=function(){this._bitField=-1048577&this._bitField,this._fulfillmentHandler0=void 0},r.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},r.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},r.prototype._receiverAt=function(e){var t;return t=0===e?this._receiver0:this[e+4-5],this._isBound()&&void 0===t?this._boundTo:t},r.prototype._promiseAt=function(e){return 0===e?this._promise0:this[e+3-5]},r.prototype._fulfillmentHandlerAt=function(e){return 0===e?this._fulfillmentHandler0:this[e+0-5]},r.prototype._rejectionHandlerAt=function(e){return 0===e?this._rejectionHandler0:this[e+1-5]},r.prototype._unsetAt=function(e){0===e?(this._rejectionHandler0=this._progressHandler0=this._promise0=this._receiver0=void 0,this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0)):this[e-5+0]=this[e-5+1]=this[e-5+2]=this[e-5+3]=this[e-5+4]=void 0},r.prototype._resolveFromResolver=function(e){function t(e){r._tryFollow(e)||r._fulfill(e)}function o(e){var t=I(e)?e:new Error(e+"");r._attachExtraTrace(t),D(e),r._reject(e,t===e?void 0:t)}var r=this,n=L;n&&(this._setTrace(this._resolveFromResolver,void 0),this._pushContext());var i=_(e,void 0,t,o);if(n&&this._popContext(),void 0!==i&&i===m){var s=i.e,a=I(s)?s:new Error(s+"");r._reject(s,a)}},r.prototype._addCallbacks=function(e,t,o,r,n){var i=this._length();if(i>=1048570&&(i=0,this._setLength(0)),0===i)this._promise0=r,void 0!==n&&(this._receiver0=n),"function"!=typeof e||this._isCarryingStackTrace()||(this._fulfillmentHandler0=e),"function"==typeof t&&(this._rejectionHandler0=t),"function"==typeof o&&(this._progressHandler0=o);else{var s=i-5;this[s+3]=r,this[s+4]=n,this[s+0]="function"==typeof e?e:void 0,this[s+1]="function"==typeof t?t:void 0,this[s+2]="function"==typeof o?o:void 0}return this._setLength(i+5),i},r.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=8388608|this._bitField,this._boundTo=e):this._bitField=-8388609&this._bitField},r.prototype._isBound=function(){return 8388608===(8388608&this._bitField)},r.prototype._spreadSlowCase=function(e,t,o,r){var n=i(o,h,this._spreadSlowCase,r).promise()._then(function(){return e.apply(r,arguments)},void 0,void 0,l,void 0,this._spreadSlowCase);t._follow(n)},r.prototype._callSpread=function(e,o,n,i){var s=this._isBound()?this._boundTo:void 0;if(b(n))for(var a=this._settlePromiseFromHandler,g=0,d=n.length;d>g;++g)if(t(r._cast(n[g],a,void 0)))return this._spreadSlowCase(e,o,n,s),void 0;return i&&o._pushContext(),E(e,n,s)},r.prototype._callHandler=function(e,t,o,r,n){var i;return t!==l||this.isRejected()?(n&&o._pushContext(),i=v(e,t,r)):i=this._callSpread(e,o,r,n),n&&o._popContext(),i},r.prototype._settlePromiseFromHandler=function(e,o,n,i){if(!t(i))return e.call(o,n,i),void 0;var s=L,a=this._callHandler(e,o,i,n,s);if(!i._isFollowing())if(a===m||a===i||a===c){var g=a===i?R():a.e,d=I(g)?g:new Error(g+"");a!==c&&i._attachExtraTrace(d),i._rejectUnchecked(g,d)}else{var u=r._cast(a,s?this._settlePromiseFromHandler:void 0,i);if(t(u)){if(u.isRejected()&&!u._isCarryingStackTrace()&&!I(u._settledValue)){var d=new Error(u._settledValue+"");i._attachExtraTrace(d),u._setCarriedStackTrace(d)}i._follow(u),u._cancellable()&&(i._cancellationParent=u,i._setCancellable())}else i._fulfillUnchecked(a)}},r.prototype._follow=function(e){this._setFollowing(),e.isPending()?(e._cancellable()&&(this._cancellationParent=e,this._setCancellable()),e._proxyPromise(this)):e.isFulfilled()?this._fulfillUnchecked(e._settledValue):this._rejectUnchecked(e._settledValue,e._getCarriedStackTrace()),e._isRejectionUnhandled()&&e._unsetRejectionIsUnhandled(),L&&null==e._traceParent&&(e._traceParent=this)},r.prototype._tryFollow=function(e){if(this._isFollowingOrFulfilledOrRejected()||e===this)return!1;var o=r._cast(e,this._tryFollow,void 0);return t(o)?(this._follow(o),!0):!1},r.prototype._resetTrace=function(e){if(L){var t=this._peekContext(),o=void 0===t;this._trace=new p("function"==typeof e?e:this._resetTrace,o)}},r.prototype._setTrace=function(e,t){if(L){var o=this._peekContext();this._traceParent=o;var r=void 0===o;this._trace=void 0!==t&&t._traceParent===o?t._trace:new p("function"==typeof e?e:this._setTrace,r)}return this},r.prototype._attachExtraTrace=function(e){if(L){var t=this,o=e.stack;o="string"==typeof o?o.split("\n"):[];for(var r=1;null!=t&&null!=t._trace;)o=p.combine(o,t._trace.stack.split("\n")),t=t._traceParent;var n=Error.stackTraceLimit+r,i=o.length;i>n&&(o.length=n),e.stack=o.length<=r?"(No stack trace)":o.join("\n")}},r.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},r.prototype._fulfill=function(e){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(e)},r.prototype._reject=function(e,t){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(e,t)},r.prototype._settlePromiseAt=function(e){var t=this.isFulfilled()?this._fulfillmentHandlerAt(e):this._rejectionHandlerAt(e),n=this._settledValue,i=this._receiverAt(e),s=this._promiseAt(e);if("function"==typeof t)this._settlePromiseFromHandler(t,i,n,s);else{var a=!1,g=this.isFulfilled();void 0!==i&&(i instanceof r&&i._isProxied()?(i._unsetProxied(),g?i._fulfillUnchecked(n):i._rejectUnchecked(n,this._getCarriedStackTrace()),a=!0):o(i,s)&&(g?i._promiseFulfilled(n,s):i._promiseRejected(n,s),a=!0)),a||(g?s._fulfill(n):s._reject(n,this._getCarriedStackTrace()))}e>=256&&this._queueGC()},r.prototype._isProxied=function(){return 4194304===(4194304&this._bitField)},r.prototype._setProxied=function(){this._bitField=4194304|this._bitField},r.prototype._unsetProxied=function(){this._bitField=-4194305&this._bitField},r.prototype._isGcQueued=function(){return-1073741824===(-1073741824&this._bitField)},r.prototype._setGcQueued=function(){this._bitField=-1073741824|this._bitField},r.prototype._unsetGcQueued=function(){this._bitField=1073741823&this._bitField},r.prototype._queueGC=function(){this._isGcQueued()||(this._setGcQueued(),g.invokeLater(this._gc,this,void 0))},r.prototype._gc=function(){var e=this._length();this._unsetAt(0);for(var t=0;e>t;t++)delete this[t];this._setLength(0),this._unsetGcQueued()},r.prototype._queueSettleAt=function(e){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),g.invoke(this._settlePromiseAt,this,e)},r.prototype._fulfillUnchecked=function(e){if(this.isPending()){if(e===this){var t=R();return this._attachExtraTrace(t),this._rejectUnchecked(t,void 0)}this._cleanValues(),this._setFulfilled(),this._settledValue=e;var o=this._length();o>0&&g.invoke(this._fulfillPromises,this,o)}},r.prototype._rejectUncheckedCheckError=function(e){var t=I(e)?e:new Error(e+"");this._rejectUnchecked(e,t===e?void 0:t)},r.prototype._rejectUnchecked=function(e,t){if(this.isPending()){if(e===this){var o=R();return this._attachExtraTrace(o),this._rejectUnchecked(o)}if(this._cleanValues(),this._setRejected(),this._settledValue=e,this._isFinal())return g.invokeLater(q,void 0,void 0===t?e:t),void 0;var r=this._length();void 0!==t&&this._setCarriedStackTrace(t),r>0?g.invoke(this._rejectPromises,this,null):this._ensurePossibleRejectionHandled()}},r.prototype._rejectPromises=function(){for(var e=this._length(),t=0;e>t;t+=5)this._settlePromiseAt(t);this._unsetCarriedStackTrace()},r.prototype._fulfillPromises=function(e){e=this._length();for(var t=0;e>t;t+=5)this._settlePromiseAt(t)},r.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),void 0!==p.possiblyUnhandledRejection&&g.invokeLater(this._notifyUnhandledRejection,this,void 0)},r.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue,t=this._getCarriedStackTrace();this._unsetRejectionIsUnhandled(),void 0!==t&&(this._unsetCarriedStackTrace(),e=t),"function"==typeof p.possiblyUnhandledRejection&&p.possiblyUnhandledRejection(e,this)}};var O=[];r.prototype._peekContext=function(){var e=O.length-1;return e>=0?O[e]:void 0},r.prototype._pushContext=function(){L&&O.push(this)},r.prototype._popContext=function(){L&&O.pop()};var k=s.Promise;return r.noConflict=function(){return s.Promise===r&&(s.Promise=k),r},p.isSupported()||(r.longStackTraces=function(){},L=!1),r._makeSelfResolutionError=R,e("./finally.js")(r,c),e("./direct_resolve.js")(r),e("./thenables.js")(r,u),r.RangeError=S,r.CancellationError=w,r.TimeoutError=T,r.TypeError=x,r.RejectionError=A,a.toFastProperties(r),a.toFastProperties(r.prototype),e("./timers.js")(r,u),e("./synchronous_inspection.js")(r),e("./any.js")(r,i,h),e("./race.js")(r,u),e("./call_get.js")(r),e("./filter.js")(r,i,h,C),e("./generators.js")(r,C,u),e("./map.js")(r,i,h,C),e("./nodeify.js")(r),e("./promisify.js")(r,u),e("./props.js")(r,h),e("./reduce.js")(r,i,h,C,u),e("./settle.js")(r,i,h),e("./some.js")(r,i,h,C),e("./progress.js")(r,o),e("./cancel.js")(r,u),r.prototype=r.prototype,r}},{"./any.js":1,"./async.js":2,"./call_get.js":4,"./cancel.js":5,"./captured_trace.js":6,"./catch_filter.js":7,"./direct_resolve.js":8,"./errors.js":9,"./errors_api_rejection":10,"./filter.js":12,"./finally.js":13,"./generators.js":14,"./global.js":15,"./map.js":16,"./nodeify.js":17,"./progress.js":18,"./promise_array.js":20,"./promise_resolver.js":22,"./promisify.js":24,"./props.js":26,"./race.js":28,"./reduce.js":29,"./settle.js":31,"./some.js":33,"./synchronous_inspection.js":35,"./thenables.js":36,"./timers.js":37,"./util.js":38}],20:[function(e,t){"use strict";
t.exports=function(t,o){function r(e){switch(e){case-1:return void 0;case-2:return[];case-3:return{}}}function n(e,r,n){var i=this._promise=new t(o),s=void 0;t.is(e)&&(s=e,e._cancellable()&&(i._setCancellable(),i._cancellationParent=e),e._isBound()&&i._setBoundTo(n)),i._setTrace(r,s),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var i=e("./errors.js").canAttach,s=e("./util.js"),a=e("./async.js"),g={}.hasOwnProperty,d=s.isArray;return n.PropertiesPromiseArray=function(){},n.prototype.length=function(){return this._length},n.prototype.promise=function(){return this._promise},n.prototype._init=function(e,o){var i=this._values;if(t.is(i)){if(!i.isFulfilled())return i.isPending()?(i._then(this._init,this._reject,void 0,this,o,this.constructor),void 0):(this._reject(i._settledValue),void 0);if(i=i._settledValue,!d(i)){var s=new t.TypeError("expecting an array, a promise or a thenable");return this.__hardReject__(s),void 0}this._values=i}if(0===i.length)return this._resolve(r(o)),void 0;var u,l=i.length,c=l;u=this instanceof n.PropertiesPromiseArray?this._values:new Array(l);for(var h=!1,p=0;l>p;++p){var f=i[p];if(void 0!==f||g.call(i,p)){var y=t._cast(f,void 0,void 0);y instanceof t?y.isPending()?y._proxyPromiseArray(this,p):(y._unsetRejectionIsUnhandled(),h=!0):h=!0,u[p]=y}else c--}if(0===c)return-2===o?this._resolve(u):this._resolve(r(o)),void 0;if(this._values=u,this._length=c,h){var b=c===l?this._scanDirectValues:this._scanDirectValuesHoled;a.invoke(b,this,l)}},n.prototype._settlePromiseAt=function(e){var o=this._values[e];t.is(o)?o.isFulfilled()?this._promiseFulfilled(o._settledValue,e):o.isRejected()&&this._promiseRejected(o._settledValue,e):this._promiseFulfilled(o,e)},n.prototype._scanDirectValuesHoled=function(e){for(var t=0;e>t&&!this._isResolved();++t)g.call(this._values,t)&&this._settlePromiseAt(t)},n.prototype._scanDirectValues=function(e){for(var t=0;e>t&&!this._isResolved();++t)this._settlePromiseAt(t)},n.prototype._isResolved=function(){return null===this._values},n.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},n.prototype.__hardReject__=n.prototype._reject=function(e){this._values=null;var t=i(e)?e:new Error(e+"");this._promise._attachExtraTrace(t),this._promise._reject(e,t)},n.prototype._promiseProgressed=function(e,t){this._isResolved()||this._promise._progress({index:t,value:e})},n.prototype._promiseFulfilled=function(e,t){if(!this._isResolved()){this._values[t]=e;var o=++this._totalResolved;o>=this._length&&this._resolve(this._values)}},n.prototype._promiseRejected=function(e){this._isResolved()||(this._totalResolved++,this._reject(e))},n}},{"./async.js":2,"./errors.js":9,"./util.js":38}],21:[function(e,t){"use strict";function o(e){void 0!==e?(this._bitField=e._bitField,this._settledValue=e.isResolved()?e._settledValue:void 0):(this._bitField=0,this._settledValue=void 0)}var r=e("./errors.js").TypeError;o.prototype.isFulfilled=function(){return(268435456&this._bitField)>0},o.prototype.isRejected=function(){return(134217728&this._bitField)>0},o.prototype.isPending=function(){return 0===(402653184&this._bitField)},o.prototype.value=function(){if(!this.isFulfilled())throw new r("cannot get fulfillment value of a non-fulfilled promise");return this._settledValue},o.prototype.error=function(){if(!this.isRejected())throw new r("cannot get rejection reason of a non-rejected promise");return this._settledValue},t.exports=o},{"./errors.js":9}],22:[function(e,t){"use strict";function o(e){return e instanceof Error&&h.getPrototypeOf(e)===Error.prototype}function r(e){var t;return t=o(e)?new u(e):e,g.markAsOriginatingFromRejection(t),t}function n(e){function t(t,o){if(null!==e){if(t){var n=r(a(t));e._attachExtraTrace(n),e._reject(n)}else if(arguments.length>2){for(var i=arguments.length,s=new Array(i-1),g=1;i>g;++g)s[g-1]=arguments[g];e._fulfill(s)}else e._fulfill(o);e=null}}return t}var i,s=e("./util.js"),a=s.maybeWrapAsError,g=e("./errors.js"),d=g.TimeoutError,u=g.RejectionError,l=e("./async.js"),c=s.haveGetters,h=e("./es5.js");if(i=c?function(e){this.promise=e}:function(e){this.promise=e,this.asCallback=n(e),this.callback=this.asCallback},c){var p={get:function(){return n(this.promise)}};h.defineProperty(i.prototype,"asCallback",p),h.defineProperty(i.prototype,"callback",p)}i._nodebackForPromise=n,i.prototype.toString=function(){return"[object PromiseResolver]"},i.prototype.resolve=i.prototype.fulfill=function(e){var t=this.promise;t._tryFollow(e)||l.invoke(t._fulfill,t,e)},i.prototype.reject=function(e){var t=this.promise;g.markAsOriginatingFromRejection(e);var o=g.canAttach(e)?e:new Error(e+"");t._attachExtraTrace(o),l.invoke(t._reject,t,e),o!==e&&l.invoke(this._setCarriedStackTrace,this,o)},i.prototype.progress=function(e){l.invoke(this.promise._progress,this.promise,e)},i.prototype.cancel=function(){l.invoke(this.promise.cancel,this.promise,void 0)},i.prototype.timeout=function(){this.reject(new d("timeout"))},i.prototype.isResolved=function(){return this.promise.isResolved()},i.prototype.toJSON=function(){return this.promise.toJSON()},i.prototype._setCarriedStackTrace=function(e){this.promise.isRejected()&&this.promise._setCarriedStackTrace(e)},t.exports=i},{"./async.js":2,"./errors.js":9,"./es5.js":11,"./util.js":38}],23:[function(e,t){"use strict";t.exports=function(t,o){function r(e){for(var o=l,n=d,i=t,s=o.length,a=0;s>a;++a){var g=u(o[a],void 0,e);if(g===n)return i.reject(n.e);var c=i._cast(g,r,void 0);if(c instanceof i)return c}return null}function n(e,r,n){var i=this._promise=new t(o);i._setTrace(n,void 0),this._generatorFunction=e,this._receiver=r,this._generator=void 0}var i=e("./errors.js"),s=i.TypeError,a=e("./util.js"),g=a.isArray,d=a.errorObj,u=a.tryCatch1,l=[];return n.prototype.promise=function(){return this._promise},n.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},n.prototype._continue=function c(e){if(e===d){this._generator=void 0;var o=i.canAttach(e.e)?e.e:new Error(e.e+"");return this._promise._attachExtraTrace(o),this._promise._reject(e.e,o),void 0}var n=e.value;if(e.done===!0)this._generator=void 0,this._promise._tryFollow(n)||this._promise._fulfill(n);else{var a=t._cast(n,c,void 0);if(!(a instanceof t)&&(a=g(a)?t.all(a):r(a),null===a))return this._throw(new s("A value was yielded that could not be treated as a promise")),void 0;a._then(this._next,this._throw,void 0,this,null,void 0)}},n.prototype._throw=function(e){i.canAttach(e)&&this._promise._attachExtraTrace(e),this._continue(u(this._generator["throw"],this._generator,e))},n.prototype._next=function(e){this._continue(u(this._generator.next,this._generator,e))},n.addYieldHandler=function(e){if("function"!=typeof e)throw new s("fn must be a function");l.push(e)},n}},{"./errors.js":9,"./util.js":38}],24:[function(e,t){"use strict";t.exports=function(t,o){function r(e){return e.__isPromisified__===!0}function n(e){for(var t=[e],o=Math.max(0,e-1-5),r=e-1;r>=o;--r)r!==e&&t.push(r);for(var r=e+1;5>=r;++r)t.push(r);return t}function i(e){for(var t=new Array(e),o=0;o<t.length;++o)t[o]="_arg"+o;return t.join(", ")}function s(e){return"number"==typeof e.length?Math.max(Math.min(e.length,1024),0):0}function a(e){var t=/^[a-z$_][a-z$_0-9]*$/i;return t.test(e)?"."+e:"['"+e.replace(/(['\\])/g,"\\$1")+"']"}function g(e,r,g,d){function u(t){for(var o=new Array(t),n=0,i=o.length;i>n;++n)o[n]="arguments["+n+"]";var s=t>0?",":"";return"string"==typeof e&&r===l?"this"+a(e)+"("+o.join(",")+s+" fn);break;":(void 0===r?"callback("+o.join(",")+s+" fn);":"callback.call("+(r===l?"this":"receiver")+", "+o.join(",")+s+" fn);")+"break;"}function c(){for(var t="",o=0;o<b.length;++o)t+="case "+b[o]+":"+u(b[o]);return t+="default: var args = new Array(len + 1);var i = 0;for (var i = 0; i < len; ++i) {    args[i] = arguments[i];}args[i] = fn;"+("string"==typeof e?"this"+a(e)+".apply(":"callback.apply(")+(r===l?"this":"receiver")+", args); break;"}var h=Math.max(0,s(d)-1),b=n(h),m="string"==typeof g?g+"Async":"promisified";return new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","var ret = function "+m+"("+i(h)+') {"use strict";var len = arguments.length;var promise = new Promise(INTERNAL);promise._setTrace('+m+", void 0);var fn = nodebackForPromise(promise);try {switch(len) {"+c()+"}}catch(e){ var wrapped = maybeWrapAsError(e);promise._attachExtraTrace(wrapped);promise._reject(wrapped);}return promise;}; ret.__isPromisified__ = true; return ret;")(t,e,r,f,y,p,o)}function d(e,r){function n(){var i=r;r===l&&(i=this),"string"==typeof e&&(e=i[e]);var s=new t(o);s._setTrace(n,void 0);var a=p(s);try{e.apply(i,f(arguments,a))}catch(g){var d=y(g);s._attachExtraTrace(d),s._reject(d)}return s}return n.__isPromisified__=!0,n}function u(e,t,o){if(o){for(var r=S(e),n=0,i=r.length;i>n;n+=2){var s=r[n],a=r[n+1],g=s+"__beforePromisified__",d=s+"Async";m(e,g,a),e[d]=x(g,l,s,a)}return c.toFastProperties(e),e}return x(e,t,void 0,e)}var l={},c=e("./util.js"),h=e("./es5.js"),p=e("./promise_resolver.js")._nodebackForPromise,f=c.withAppended,y=c.maybeWrapAsError,b=c.canEvaluate,m=c.notEnumerableProp,v=c.deprecated,_=new RegExp("__beforePromisified__$"),E={}.hasOwnProperty,S=function(){if(h.isES5){var e=Object.create,t=Object.getOwnPropertyDescriptor;return function(o){for(var n=o,i=[],s=e(null);null!==o;){for(var a=h.keys(o),g=0,d=a.length;d>g;++g){var u=a[g];if(!(s[u]||_.test(u)||E.call(n,u+"__beforePromisified__"))){s[u]=!0;var l=t(o,u);null==l||"function"!=typeof l.value||r(l.value)||i.push(u,l.value)}}o=h.getPrototypeOf(o)}return i}}return function(e){var t=[];for(var o in e)if(!_.test(o)&&!E.call(e,o+"__beforePromisified__")){var n=e[o];"function"!=typeof n||r(n)||t.push(o,n)}return t}}(),x=b?g:d;t.promisify=function(e,t){if("object"==typeof e&&null!==e)return v("Promise.promisify for promisifying entire objects is deprecated. Use Promise.promisifyAll instead."),u(e,t,!0);if("function"!=typeof e)throw new TypeError("fn must be a function");return r(e)?e:u(e,arguments.length<2?l:t,!1)},t.promisifyAll=function(e){if("function"!=typeof e&&"object"!=typeof e)throw new TypeError("the target of promisifyAll must be an object or a function");return u(e,void 0,!0)}}},{"./es5.js":11,"./promise_resolver.js":22,"./util.js":38}],25:[function(e,t){"use strict";t.exports=function(t,o){function r(e,t,o){for(var r=s.keys(e),n=new Array(r.length),i=0,a=n.length;a>i;++i)n[i]=e[r[i]];if(this.constructor$(n,t,o),!this._isResolved())for(var i=0,a=r.length;a>i;++i)n.push(r[i])}var n=e("./util.js"),i=n.inherits,s=e("./es5.js");return i(r,o),r.prototype._init=function(){this._init$(void 0,-3)},r.prototype._promiseFulfilled=function(e,t){if(!this._isResolved()){this._values[t]=e;var o=++this._totalResolved;if(o>=this._length){for(var r={},n=this.length(),i=0,s=this.length();s>i;++i)r[this._values[i+n]]=this._values[i];this._resolve(r)}}},r.prototype._promiseProgressed=function(e,t){this._isResolved()||this._promise._progress({key:this._values[t+this.length()],value:e})},o.PropertiesPromiseArray=r,r}},{"./es5.js":11,"./util.js":38}],26:[function(e,t){"use strict";t.exports=function(t,o){function r(e,o,r){var i,g=t._cast(e,r,void 0);return a(g)?(t.is(g)?i=g._then(t.props,void 0,void 0,void 0,void 0,r):(i=new n(g,r,o===!0&&g._isBound()?g._boundTo:void 0).promise(),o=!1),o===!0&&g._isBound()&&i._setBoundTo(g._boundTo),i):s("cannot await properties of a non-object")}var n=e("./properties_promise_array.js")(t,o),i=e("./util.js"),s=e("./errors_api_rejection")(t),a=i.isObject;t.prototype.props=function(){return r(this,!0,this.props)},t.props=function(e){return r(e,!1,t.props)}}},{"./errors_api_rejection":10,"./properties_promise_array.js":25,"./util.js":38}],27:[function(e,t){"use strict";function o(e,t,o,r,n){for(var i=0;n>i;++i)o[i+r]=e[i+t]}function r(e){return e>>>=0,e-=1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e+1}function n(e){return"number"!=typeof e?16:r(Math.min(Math.max(16,e),1073741824))}function i(e){this._capacity=n(e),this._length=0,this._front=0,this._makeCapacity()}i.prototype._willBeOverCapacity=function(e){return this._capacity<e},i.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1);var o=this._front+t&this._capacity-1;this[o]=e,this._length=t+1},i.prototype.push=function(e,t,o){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),this._pushOne(o),void 0;var n=this._front+r-3;this._checkCapacity(r);var i=this._capacity-1;this[n+0&i]=e,this[n+1&i]=t,this[n+2&i]=o,this._length=r},i.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},i.prototype.length=function(){return this._length},i.prototype._makeCapacity=function(){for(var e=this._capacity,t=0;e>t;++t)this[t]=void 0},i.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<3)},i.prototype._resizeTo=function(e){var t=this._front,r=this._capacity,n=new Array(r),i=this.length();if(o(this,0,n,0,r),this._capacity=e,this._makeCapacity(),this._front=0,r>=t+i)o(n,t,this,0,i);else{var s=i-(t+i&r-1);o(n,t,this,0,s),o(n,0,this,s,i-s)}},t.exports=i},{}],28:[function(e,t){"use strict";t.exports=function(t,o){function r(e,r,g){var d=t._cast(e,r,void 0);if(t.is(d))return s(d);if(!i(e))return n("expecting an array, a promise or a thenable");var u=new t(o);u._setTrace(r,g),void 0!==g&&(g._isBound()&&u._setBoundTo(g._boundTo),g._cancellable()&&(u._setCancellable(),u._cancellationParent=g));for(var l=u._fulfill,c=u._reject,h=0,p=e.length;p>h;++h){var f=e[h];(void 0!==f||a.call(e,h))&&t.cast(f)._then(l,c,void 0,u,null,r)}return u}var n=e("./errors_api_rejection.js")(t),i=e("./util.js").isArray,s=function(e){return e.then(function t(o){return r(o,t,e)})},a={}.hasOwnProperty;t.race=function(e){return r(e,t.race,void 0)},t.prototype.race=function(){return r(this,this.race,void 0)}}},{"./errors_api_rejection.js":10,"./util.js":38}],29:[function(e,t){"use strict";t.exports=function(e,t,o,r,n){function i(t,o,r,i,s){this.promise=new e(n),this.index=o,this.length=i.length,this.items=i,this.callback=t,this.receiver=s,this.accum=r}function s(e,t){var o=this,r=void 0;"function"!=typeof o&&(r=o.receiver,o=o.fn);var n=e.length,s=void 0,a=0;void 0!==t?(s=t,a=0):(a=1,n>0&&(s=e[0]));var g=a;if(g>=n)return s;var d=new i(o,g,s,e,r);return d.iterate(),d.promise}function a(e){var t=this.fn,o=this.initialValue;return s.call(t,e,o)}function g(e,t,o,r,n){return o._then(function i(o){return d(e,t,o,r,i)},void 0,void 0,void 0,void 0,n)}function d(n,i,d,u,l){if("function"!=typeof i)return r("fn must be a function");if(u===!0&&n._isBound()&&(i={fn:i,receiver:n._boundTo}),void 0!==d){if(e.is(d)){if(!d.isFulfilled())return g(n,i,d,u,l);d=d._settledValue}return t(n,o,l,u===!0&&n._isBound()?n._boundTo:void 0).promise()._then(a,void 0,void 0,{fn:i,initialValue:d},void 0,e.reduce)}return t(n,o,l,u===!0&&n._isBound()?n._boundTo:void 0).promise()._then(s,void 0,void 0,i,void 0,l)}i.prototype.reject=function(e){this.promise._reject(e)},i.prototype.fulfill=function(e,t){this.accum=e,this.index=t+1,this.iterate()},i.prototype.iterate=function(){for(var t=this.index,o=this.length,r=this.items,n=this.accum,i=this.receiver,s=this.callback,a=this.iterate;o>t;++t)if(n=e._cast(s.call(i,n,r[t],t,o),a,void 0),n instanceof e)return n._then(this.fulfill,this.reject,void 0,this,t,a),void 0;this.promise._fulfill(n)},e.reduce=function(t,o,r){return d(t,o,r,!1,e.reduce)},e.prototype.reduce=function(e,t){return d(this,e,t,!0,this.reduce)}}},{}],30:[function(e,t){"use strict";var o,r=e("./global.js");if("undefined"!=typeof process&&null!==process&&"function"==typeof process.cwd&&"function"==typeof process.nextTick&&"string"==typeof process.version)o=function(e){process.nextTick(e)};else if("function"!=typeof r.MutationObserver&&"function"!=typeof r.WebkitMutationObserver&&"function"!=typeof r.WebKitMutationObserver||"undefined"==typeof document||"function"!=typeof document.createElement)if("function"==typeof r.postMessage&&"function"!=typeof r.importScripts&&"function"==typeof r.addEventListener&&"function"==typeof r.removeEventListener){var n="bluebird_message_key_"+Math.random();o=function(){function e(e){if(e.source===r&&e.data===n){var o=t;t=void 0,o()}}var t=void 0;return r.addEventListener("message",e,!1),function(e){t=e,r.postMessage(n,"*")}}()}else o="function"==typeof r.MessageChannel?function(){var e=void 0,t=new r.MessageChannel;return t.port1.onmessage=function(){var t=e;e=void 0,t()},function(o){e=o,t.port2.postMessage(null)}}():r.setTimeout?function(e){setTimeout(e,4)}:function(e){e()};else o=function(){var e=r.MutationObserver||r.WebkitMutationObserver||r.WebKitMutationObserver,t=document.createElement("div"),o=void 0,n=new e(function(){var e=o;o=void 0,e()});return n.observe(t,{attributes:!0}),function(e){o=e,t.setAttribute("class","foo")}}();t.exports=o},{"./global.js":15}],31:[function(e,t){"use strict";t.exports=function(t,o,r){function n(e,t,r){return o(e,i,r,t===!0&&e._isBound()?e._boundTo:void 0).promise()}var i=e("./settled_promise_array.js")(t,r);t.settle=function(e){return n(e,!1,t.settle)},t.prototype.settle=function(){return n(this,!0,this.settle)}}},{"./settled_promise_array.js":32}],32:[function(e,t){"use strict";t.exports=function(t,o){function r(e,t,o){this.constructor$(e,t,o)}var n=e("./promise_inspection.js"),i=e("./util.js"),s=i.inherits;return s(r,o),r.prototype._promiseResolved=function(e,t){this._values[e]=t;var o=++this._totalResolved;o>=this._length&&this._resolve(this._values)},r.prototype._promiseFulfilled=function(e,t){if(!this._isResolved()){var o=new n;o._bitField=268435456,o._settledValue=e,this._promiseResolved(t,o)}},r.prototype._promiseRejected=function(e,t){if(!this._isResolved()){var o=new n;o._bitField=134217728,o._settledValue=e,this._promiseResolved(t,o)}},r}},{"./promise_inspection.js":21,"./util.js":38}],33:[function(e,t){"use strict";t.exports=function(t,o,r,n){function i(e,t,r,i){if((0|t)!==t||0>t)return n("expecting a positive integer");var a=o(e,s,i,r===!0&&e._isBound()?e._boundTo:void 0),g=a.promise();return g.isRejected()?g:(a.setHowMany(t),a.init(),g)}var s=e("./some_promise_array.js")(r);t.some=function(e,o){return i(e,o,!1,t.some)},t.prototype.some=function(e){return i(this,e,!0,this.some)}}},{"./some_promise_array.js":34}],34:[function(e,t){"use strict";t.exports=function(t){function o(e,t,o){this.constructor$(e,t,o),this._howMany=0,this._unwrap=!1,this._initialized=!1}var r=e("./util.js"),n=e("./errors.js").RangeError,i=r.inherits,s=r.isArray;return i(o,t),o.prototype._init=function(){if(this._initialized){if(0===this._howMany)return this._resolve([]),void 0;this._init$(void 0,-2);var e=s(this._values);if(this._holes=e?this._values.length-this.length():0,!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()){var t="(Promise.some) input array contains less than "+this._howMany+" promises";this._reject(new n(t))}}},o.prototype.init=function(){this._initialized=!0,this._init()},o.prototype.setUnwrap=function(){this._unwrap=!0},o.prototype.howMany=function(){return this._howMany},o.prototype.setHowMany=function(e){this._isResolved()||(this._howMany=e)},o.prototype._promiseFulfilled=function(e){this._isResolved()||(this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values)))},o.prototype._promiseRejected=function(e){this._isResolved()||(this._addRejected(e),this.howMany()>this._canPossiblyFulfill()&&(this._values.length===this.length()?this._reject([]):this._reject(this._values.slice(this.length()+this._holes))))},o.prototype._fulfilled=function(){return this._totalResolved},o.prototype._rejected=function(){return this._values.length-this.length()-this._holes},o.prototype._addRejected=function(e){this._values.push(e)},o.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},o.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},o}},{"./errors.js":9,"./util.js":38}],35:[function(e,t){"use strict";t.exports=function(t){var o=e("./promise_inspection.js");t.prototype.inspect=function(){return new o(this)}}},{"./promise_inspection.js":21}],36:[function(e,t){"use strict";t.exports=function(t,o){function r(e){try{return e.then}catch(t){return d.e=t,d}}function n(e,a,l){if(u(e)){if(e instanceof t)return e;if(i(e)){var c=new t(o);return c._setTrace(a,void 0),e._then(c._fulfillUnchecked,c._rejectUncheckedCheckError,c._progressUnchecked,c,null,void 0),c._setFollowing(),c}var h=r(e);if(h===d)return a="function"==typeof a?a:n,void 0!==l&&g(h.e)&&l._attachExtraTrace(h.e),t.reject(h.e,a);if("function"==typeof h)return a="function"==typeof a?a:n,s(e,h,a,l)}return e}function i(e){return l.call(e,"_promise0")}function s(e,o,r,n){function i(o){if(!u){if(u=!0,e===o){var r=t._makeSelfResolutionError();return void 0!==n&&n._attachExtraTrace(r),d.promise._reject(r,void 0),void 0}d.resolve(o)}}function s(e){if(!u){u=!0;var t=g(e)?e:new Error(e+"");void 0!==n&&n._attachExtraTrace(t),d.promise._reject(e,t)}}function a(e){if(!u){var t=d.promise;"function"==typeof t._progress&&t._progress(e)}}var d=t.defer(r),u=!1;try{o.call(e,i,s,a)}catch(l){if(!u){u=!0;var c=g(l)?l:new Error(l+"");void 0!==n&&n._attachExtraTrace(c),d.promise._reject(l,c)}}return d.promise}var a=e("./util.js"),g=e("./errors.js").canAttach,d=a.errorObj,u=a.isObject,l={}.hasOwnProperty;t._cast=n}},{"./errors.js":9,"./util.js":38}],37:[function(e,t){"use strict";var o=e("./global.js"),r=function(e,t){for(var r=arguments.length,n=new Array(r-2),i=2;r>i;++i)n[i-2]=arguments[i];o.setTimeout(function(){e.apply(void 0,n)},t)},n={};o.setTimeout(function(e){e===n&&(r=o.setTimeout)},1,n),t.exports=function(t,o){var n=(e("./util.js"),e("./errors.js")),i=(e("./errors_api_rejection")(t),t.TimeoutError),s=function(e,t,o){if(e.isPending()){"string"!=typeof t&&(t="operation timed out after "+o+" ms");var r=new i(t);n.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._rejectUnchecked(r)}},a=function(e,t){t._fulfill(e)};t.delay=function(e,n,i){void 0===n&&(n=e,e=void 0),n=+n,"function"!=typeof i&&(i=t.delay);var s=t._cast(e,i,void 0),g=new t(o);return t.is(s)?(s._isBound()&&g._setBoundTo(s._boundTo),s._cancellable()&&(g._setCancellable(),g._cancellationParent=s),g._setTrace(i,s),g._follow(s),g.then(function(e){return t.delay(e,n)})):(g._setTrace(i,void 0),r(a,n,e,g),g)},t.prototype.delay=function(e){return t.delay(this,e,this.delay)},t.prototype.timeout=function(e,n){e=+e;var i=new t(o);return i._setTrace(this.timeout,this),this._isBound()&&i._setBoundTo(this._boundTo),this._cancellable()&&(i._setCancellable(),i._cancellationParent=this),i._follow(this),r(s,e,i,n,e),i}}},{"./errors.js":9,"./errors_api_rejection":10,"./global.js":15,"./util.js":38}],38:[function(e,t,o){"use strict";function r(e){"undefined"!=typeof console&&null!==console&&"function"==typeof console.warn&&console.warn("Bluebird: "+e)}function n(e,t,o){try{return e.call(t,o)}catch(r){return v.e=r,v}}function i(e,t,o,r){try{return e.call(t,o,r)}catch(n){return v.e=n,v}}function s(e,t,o){try{return e.apply(o,t)}catch(r){return v.e=r,v}}function a(e){return"string"==typeof e?e:""+e}function g(e){return null==e||e===!0||e===!1||"string"==typeof e||"number"==typeof e}function d(e){return!g(e)}function u(e){return g(e)?new Error(a(e)):e}function l(e,t){var o,r=e.length,n=new Array(r+1);for(o=0;r>o;++o)n[o]=e[o];return n[o]=t,n}function c(e,t,o){if(g(e))return e;var r={value:o,configurable:!0,enumerable:!1,writable:!0};return y.defineProperty(e,t,r),e}function h(e){throw e}function p(e){function t(){}return t.prototype=e,t}var f=e("./global.js"),y=e("./es5.js"),b=function(){try{var e={};return y.defineProperty(e,"f",{get:function(){return 3}}),3===e.f}catch(t){return!1}}(),m=function(){return"undefined"!=typeof window&&null!==window&&"undefined"!=typeof window.document&&"undefined"!=typeof navigator&&null!==navigator&&"string"==typeof navigator.appName&&window===f?!1:!0}(),v={e:{}},_=function(e,t){function o(){this.constructor=e,this.constructor$=t;for(var o in t.prototype)r.call(t.prototype,o)&&"$"!==o.charAt(o.length-1)&&(this[o+"$"]=t.prototype[o])}var r={}.hasOwnProperty;return o.prototype=t.prototype,e.prototype=new o,e.prototype},E=function(){return"string"!==this}.call("string"),S={thrower:h,isArray:y.isArray,haveGetters:b,notEnumerableProp:c,isPrimitive:g,isObject:d,canEvaluate:m,deprecated:r,errorObj:v,tryCatch1:n,tryCatch2:i,tryCatchApply:s,inherits:_,withAppended:l,asString:a,maybeWrapAsError:u,wrapsPrimitiveReceiver:E,toFastProperties:p};t.exports=S},{"./es5.js":11,"./global.js":15}]},{},[3])(3)}),("function"==typeof define?function(e){define("msgpack-js",e)}:"object"==typeof exports?function(e){module.exports=e()}:function(e){this.msgpack=e()})(function(){"use strict";function e(e){if(void 0===e)return"undefined";var t,o;if(e instanceof ArrayBuffer?(o="ArrayBuffer",t=new DataView(e)):e instanceof DataView&&(o="DataView",t=e),!t)return JSON.stringify(e);for(var r=[],n=0;n<e.byteLength;n++){if(n>20){r.push("...");break}var i=t.getUint8(n).toString(16);1===i.length&&(i="0"+i),r.push(i)}return"<"+o+" "+r.join(" ")+">"}function t(e,t,o){for(var r=(e.byteLength,0),n=o.length;n>r;r++){var i=o.charCodeAt(r);if(128>i)e.setUint8(t++,i>>>0&127|0);else if(2048>i)e.setUint8(t++,i>>>6&31|192),e.setUint8(t++,i>>>0&63|128);else if(65536>i)e.setUint8(t++,i>>>12&15|224),e.setUint8(t++,i>>>6&63|128),e.setUint8(t++,i>>>0&63|128);else{if(!(1114112>i))throw new Error("bad codepoint "+i);e.setUint8(t++,i>>>18&7|240),e.setUint8(t++,i>>>12&63|128),e.setUint8(t++,i>>>6&63|128),e.setUint8(t++,i>>>0&63|128)}}}function o(e,t,o){for(var r="",n=t,i=t+o;i>n;n++){var s=e.getUint8(n);if(0!==(128&s))if(192!==(224&s))if(224!==(240&s)){if(240!==(248&s))throw new Error("Invalid byte "+s.toString(16));r+=String.fromCharCode((7&s)<<18|(63&e.getUint8(++n))<<12|(63&e.getUint8(++n))<<6|(63&e.getUint8(++n))<<0)}else r+=String.fromCharCode((15&s)<<12|(63&e.getUint8(++n))<<6|(63&e.getUint8(++n))<<0);else r+=String.fromCharCode((15&s)<<6|63&e.getUint8(++n));else r+=String.fromCharCode(s)}return r}function r(e){for(var t=0,o=0,r=e.length;r>o;o++){var n=e.charCodeAt(o);if(128>n)t+=1;else if(2048>n)t+=2;else if(65536>n)t+=3;else{if(!(1114112>n))throw new Error("bad codepoint "+n);t+=4}}return t}function n(e,t){this.offset=t||0,this.view=e}function i(e){var t=new DataView(e),o=new n(t),r=o.parse();if(o.offset!==e.byteLength)throw new Error(e.byteLength-o.offset+" trailing bytes");return r}function s(e,o,n){var i=typeof e;if("string"===i){var a=r(e);if(32>a)return o.setUint8(n,160|a),t(o,n+1,e),1+a;if(65536>a)return o.setUint8(n,218),o.setUint16(n+1,a),t(o,n+3,e),3+a;if(4294967296>a)return o.setUint8(n,219),o.setUint32(n+1,a),t(o,n+5,e),5+a}if(e instanceof ArrayBuffer){var a=e.byteLength;if(65536>a)return o.setUint8(n,216),o.setUint16(n+1,a),new Uint8Array(o.buffer).set(new Uint8Array(e),n+3),3+a;if(4294967296>a)return o.setUint8(n,217),o.setUint32(n+1,a),new Uint8Array(o.buffer).set(new Uint8Array(e),n+5),5+a}if("number"===i){if(e<<0!==e)return o.setUint8(n,203),o.setFloat64(n+1,e),9;if(e>=0){if(128>e)return o.setUint8(n,e),1;if(256>e)return o.setUint8(n,204),o.setUint8(n+1,e),2;if(65536>e)return o.setUint8(n,205),o.setUint16(n+1,e),3;if(4294967296>e)return o.setUint8(n,206),o.setUint32(n+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return o.setInt8(n,e),1;if(e>=-128)return o.setUint8(n,208),o.setInt8(n+1,e),2;if(e>=-32768)return o.setUint8(n,209),o.setInt16(n+1,e),3;if(e>=-2147483648)return o.setUint8(n,210),o.setInt32(n+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if("undefined"===i)return o.setUint8(n,196),1;if(null===e)return o.setUint8(n,192),1;if("boolean"===i)return o.setUint8(n,e?195:194),1;if("object"===i){var a,g=0,d=Array.isArray(e);if(d)a=e.length;else{var u=Object.keys(e);a=u.length}var g;if(16>a?(o.setUint8(n,a|(d?144:128)),g=1):65536>a?(o.setUint8(n,d?220:222),o.setUint16(n+1,a),g=3):4294967296>a&&(o.setUint8(n,d?221:223),o.setUint32(n+1,a),g=5),d)for(var l=0;a>l;l++)g+=s(e[l],o,n+g);else for(var l=0;a>l;l++){var c=u[l];g+=s(c,o,n+g),g+=s(e[c],o,n+g)}return g}throw new Error("Unknown type "+i)}function a(e){var t=typeof e;if("string"===t){var o=r(e);if(32>o)return 1+o;if(65536>o)return 3+o;if(4294967296>o)return 5+o}if(e instanceof ArrayBuffer){var o=e.byteLength;if(65536>o)return 3+o;if(4294967296>o)return 5+o}if("number"===t){if(e<<0!==e)return 9;if(e>=0){if(128>e)return 1;if(256>e)return 2;if(65536>e)return 3;if(4294967296>e)return 5;if(0x10000000000000000>e)return 9;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;if(e>=-0x8000000000000000)return 9;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if("boolean"===t||"undefined"===t||null===e)return 1;if("object"===t){var o,n=0;if(Array.isArray(e)){o=e.length;for(var i=0;o>i;i++)n+=a(e[i])}else{var s=Object.keys(e);o=s.length;for(var i=0;o>i;i++){var g=s[i];n+=a(g)+a(e[g])}}if(16>o)return 1+n;if(65536>o)return 3+n;if(4294967296>o)return 5+n;throw new Error("Array or object too long 0x"+o.toString(16))}throw new Error("Unknown type "+t)}var g={};return g.inspect=e,g.utf8Write=t,g.utf8Read=o,g.utf8ByteCount=r,g.encode=function(e){var t=new ArrayBuffer(a(e)),o=new DataView(t);return s(e,o,0),t},g.decode=i,n.prototype.map=function(e){for(var t={},o=0;e>o;o++){var r=this.parse();t[r]=this.parse()}return t},n.prototype.buf=function(e){var t=new ArrayBuffer(e);return new Uint8Array(t).set(new Uint8Array(this.view.buffer,this.offset,e),0),this.offset+=e,t},n.prototype.raw=function(e){var t=o(this.view,this.offset,e);return this.offset+=e,t},n.prototype.array=function(e){for(var t=new Array(e),o=0;e>o;o++)t[o]=this.parse();return t},n.prototype.parse=function(){var e,t,o=this.view.getUint8(this.offset);if(160===(224&o))return t=31&o,this.offset++,this.raw(t);if(128===(240&o))return t=15&o,this.offset++,this.map(t);if(144===(240&o))return t=15&o,this.offset++,this.array(t);if(0===(128&o))return this.offset++,o;if(224===(224&o))return e=this.view.getInt8(this.offset),this.offset++,e;switch(o){case 218:return t=this.view.getUint16(this.offset+1),this.offset+=3,this.raw(t);case 219:return t=this.view.getUint32(this.offset+1),this.offset+=5,this.raw(t);case 192:return this.offset++,null;case 194:return this.offset++,!1;case 195:return this.offset++,!0;case 196:return this.offset++,void 0;case 204:return e=this.view.getUint8(this.offset+1),this.offset+=2,e;case 205:return e=this.view.getUint16(this.offset+1),this.offset+=3,e;case 206:return e=this.view.getUint32(this.offset+1),this.offset+=5,e;case 208:return e=this.view.getInt8(this.offset+1),this.offset+=2,e;case 209:return e=this.view.getInt16(this.offset+1),this.offset+=3,e;case 210:return e=this.view.getInt32(this.offset+1),this.offset+=5,e;case 222:return t=this.view.getUint16(this.offset+1),this.offset+=3,this.map(t);case 223:return t=this.view.getUint32(this.offset+1),this.offset+=5,this.map(t);case 220:return t=this.view.getUint16(this.offset+1),this.offset+=3,this.array(t);case 221:return t=this.view.getUint32(this.offset+1),this.offset+=5,this.array(t);case 216:return t=this.view.getUint16(this.offset+1),this.offset+=3,this.buf(t);case 217:return t=this.view.getUint32(this.offset+1),this.offset+=5,this.buf(t);case 202:return e=this.view.getFloat32(this.offset+1),this.offset+=5,e;case 203:return e=this.view.getFloat64(this.offset+1),this.offset+=9,e}throw new Error("Unknown type 0x"+o.toString(16))},g}),function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function o(e){var t=e.length,o=it.type(e);return"function"===o||it.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===o||0===t||"number"==typeof t&&t>0&&t-1 in e}function r(e,t,o){if(it.isFunction(t))return it.grep(e,function(e,r){return!!t.call(e,r,e)!==o});if(t.nodeType)return it.grep(e,function(e){return e===t!==o});if("string"==typeof t){if(ht.test(t))return it.filter(t,e,o);t=it.filter(t,e)}return it.grep(e,function(e){return it.inArray(e,t)>=0!==o})}function n(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function i(e){var t=Et[e]={};return it.each(e.match(_t)||[],function(e,o){t[o]=!0}),t}function s(){ft.addEventListener?(ft.removeEventListener("DOMContentLoaded",a,!1),e.removeEventListener("load",a,!1)):(ft.detachEvent("onreadystatechange",a),e.detachEvent("onload",a))
}function a(){(ft.addEventListener||"load"===event.type||"complete"===ft.readyState)&&(s(),it.ready())}function g(e,t,o){if(void 0===o&&1===e.nodeType){var r="data-"+t.replace(At,"-$1").toLowerCase();if(o=e.getAttribute(r),"string"==typeof o){try{o="true"===o?!0:"false"===o?!1:"null"===o?null:+o+""===o?+o:Tt.test(o)?it.parseJSON(o):o}catch(n){}it.data(e,t,o)}else o=void 0}return o}function d(e){var t;for(t in e)if(("data"!==t||!it.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function u(e,t,o,r){if(it.acceptData(e)){var n,i,s=it.expando,a=e.nodeType,g=a?it.cache:e,d=a?e[s]:e[s]&&s;if(d&&g[d]&&(r||g[d].data)||void 0!==o||"string"!=typeof t)return d||(d=a?e[s]=$.pop()||it.guid++:s),g[d]||(g[d]=a?{}:{toJSON:it.noop}),("object"==typeof t||"function"==typeof t)&&(r?g[d]=it.extend(g[d],t):g[d].data=it.extend(g[d].data,t)),i=g[d],r||(i.data||(i.data={}),i=i.data),void 0!==o&&(i[it.camelCase(t)]=o),"string"==typeof t?(n=i[t],null==n&&(n=i[it.camelCase(t)])):n=i,n}}function l(e,t,o){if(it.acceptData(e)){var r,n,i=e.nodeType,s=i?it.cache:e,a=i?e[it.expando]:it.expando;if(s[a]){if(t&&(r=o?s[a]:s[a].data)){it.isArray(t)?t=t.concat(it.map(t,it.camelCase)):t in r?t=[t]:(t=it.camelCase(t),t=t in r?[t]:t.split(" ")),n=t.length;for(;n--;)delete r[t[n]];if(o?!d(r):!it.isEmptyObject(r))return}(o||(delete s[a].data,d(s[a])))&&(i?it.cleanData([e],!0):rt.deleteExpando||s!=s.window?delete s[a]:s[a]=null)}}}function c(){return!0}function h(){return!1}function p(){try{return ft.activeElement}catch(e){}}function f(e){var t=Mt.split("|"),o=e.createDocumentFragment();if(o.createElement)for(;t.length;)o.createElement(t.pop());return o}function y(e,t){var o,r,n=0,i=typeof e.getElementsByTagName!==wt?e.getElementsByTagName(t||"*"):typeof e.querySelectorAll!==wt?e.querySelectorAll(t||"*"):void 0;if(!i)for(i=[],o=e.childNodes||e;null!=(r=o[n]);n++)!t||it.nodeName(r,t)?i.push(r):it.merge(i,y(r,t));return void 0===t||t&&it.nodeName(e,t)?it.merge([e],i):i}function b(e){Ct.test(e.type)&&(e.defaultChecked=e.checked)}function m(e,t){return it.nodeName(e,"table")&&it.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function v(e){return e.type=(null!==it.find.attr(e,"type"))+"/"+e.type,e}function _(e){var t=$t.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function E(e,t){for(var o,r=0;null!=(o=e[r]);r++)it._data(o,"globalEval",!t||it._data(t[r],"globalEval"))}function S(e,t){if(1===t.nodeType&&it.hasData(e)){var o,r,n,i=it._data(e),s=it._data(t,i),a=i.events;if(a){delete s.handle,s.events={};for(o in a)for(r=0,n=a[o].length;n>r;r++)it.event.add(t,o,a[o][r])}s.data&&(s.data=it.extend({},s.data))}}function x(e,t){var o,r,n;if(1===t.nodeType){if(o=t.nodeName.toLowerCase(),!rt.noCloneEvent&&t[it.expando]){n=it._data(t);for(r in n.events)it.removeEvent(t,r,n.handle);t.removeAttribute(it.expando)}"script"===o&&t.text!==e.text?(v(t).text=e.text,_(t)):"object"===o?(t.parentNode&&(t.outerHTML=e.outerHTML),rt.html5Clone&&e.innerHTML&&!it.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===o&&Ct.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===o?t.defaultSelected=t.selected=e.defaultSelected:("input"===o||"textarea"===o)&&(t.defaultValue=e.defaultValue)}}function w(t,o){var r=it(o.createElement(t)).appendTo(o.body),n=e.getDefaultComputedStyle?e.getDefaultComputedStyle(r[0]).display:it.css(r[0],"display");return r.detach(),n}function T(e){var t=ft,o=eo[e];return o||(o=w(e,t),"none"!==o&&o||(Zt=(Zt||it("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=(Zt[0].contentWindow||Zt[0].contentDocument).document,t.write(),t.close(),o=w(e,t),Zt.detach()),eo[e]=o),o}function A(e,t){return{get:function(){var o=e();if(null!=o)return o?(delete this.get,void 0):(this.get=t).apply(this,arguments)}}}function N(e,t){if(t in e)return t;for(var o=t.charAt(0).toUpperCase()+t.slice(1),r=t,n=po.length;n--;)if(t=po[n]+o,t in e)return t;return r}function D(e,t){for(var o,r,n,i=[],s=0,a=e.length;a>s;s++)r=e[s],r.style&&(i[s]=it._data(r,"olddisplay"),o=r.style.display,t?(i[s]||"none"!==o||(r.style.display=""),""===r.style.display&&It(r)&&(i[s]=it._data(r,"olddisplay",T(r.nodeName)))):i[s]||(n=It(r),(o&&"none"!==o||!n)&&it._data(r,"olddisplay",n?o:it.css(r,"display"))));for(s=0;a>s;s++)r=e[s],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?i[s]||"":"none"));return e}function I(e,t,o){var r=uo.exec(t);return r?Math.max(0,r[1]-(o||0))+(r[2]||"px"):t}function q(e,t,o,r,n){for(var i=o===(r?"border":"content")?4:"width"===t?1:0,s=0;4>i;i+=2)"margin"===o&&(s+=it.css(e,o+Dt[i],!0,n)),r?("content"===o&&(s-=it.css(e,"padding"+Dt[i],!0,n)),"margin"!==o&&(s-=it.css(e,"border"+Dt[i]+"Width",!0,n))):(s+=it.css(e,"padding"+Dt[i],!0,n),"padding"!==o&&(s+=it.css(e,"border"+Dt[i]+"Width",!0,n)));return s}function C(e,t,o){var r=!0,n="width"===t?e.offsetWidth:e.offsetHeight,i=to(e),s=rt.boxSizing()&&"border-box"===it.css(e,"boxSizing",!1,i);if(0>=n||null==n){if(n=oo(e,t,i),(0>n||null==n)&&(n=e.style[t]),no.test(n))return n;r=s&&(rt.boxSizingReliable()||n===e.style[t]),n=parseFloat(n)||0}return n+q(e,t,o||(s?"border":"content"),r,i)+"px"}function R(e,t,o,r,n){return new R.prototype.init(e,t,o,r,n)}function L(){return setTimeout(function(){fo=void 0}),fo=it.now()}function O(e,t){var o,r={height:e},n=0;for(t=t?1:0;4>n;n+=2-t)o=Dt[n],r["margin"+o]=r["padding"+o]=e;return t&&(r.opacity=r.width=e),r}function k(e,t,o){for(var r,n=(Eo[t]||[]).concat(Eo["*"]),i=0,s=n.length;s>i;i++)if(r=n[i].call(o,t,e))return r}function P(e,t,o){var r,n,i,s,a,g,d,u,l=this,c={},h=e.style,p=e.nodeType&&It(e),f=it._data(e,"fxshow");o.queue||(a=it._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,g=a.empty.fire,a.empty.fire=function(){a.unqueued||g()}),a.unqueued++,l.always(function(){l.always(function(){a.unqueued--,it.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(o.overflow=[h.overflow,h.overflowX,h.overflowY],d=it.css(e,"display"),u=T(e.nodeName),"none"===d&&(d=u),"inline"===d&&"none"===it.css(e,"float")&&(rt.inlineBlockNeedsLayout&&"inline"!==u?h.zoom=1:h.display="inline-block")),o.overflow&&(h.overflow="hidden",rt.shrinkWrapBlocks()||l.always(function(){h.overflow=o.overflow[0],h.overflowX=o.overflow[1],h.overflowY=o.overflow[2]}));for(r in t)if(n=t[r],bo.exec(n)){if(delete t[r],i=i||"toggle"===n,n===(p?"hide":"show")){if("show"!==n||!f||void 0===f[r])continue;p=!0}c[r]=f&&f[r]||it.style(e,r)}if(!it.isEmptyObject(c)){f?"hidden"in f&&(p=f.hidden):f=it._data(e,"fxshow",{}),i&&(f.hidden=!p),p?it(e).show():l.done(function(){it(e).hide()}),l.done(function(){var t;it._removeData(e,"fxshow");for(t in c)it.style(e,t,c[t])});for(r in c)s=k(p?f[r]:0,r,l),r in f||(f[r]=s.start,p&&(s.end=s.start,s.start="width"===r||"height"===r?1:0))}}function M(e,t){var o,r,n,i,s;for(o in e)if(r=it.camelCase(o),n=t[r],i=e[o],it.isArray(i)&&(n=i[1],i=e[o]=i[0]),o!==r&&(e[r]=i,delete e[o]),s=it.cssHooks[r],s&&"expand"in s){i=s.expand(i),delete e[r];for(o in i)o in e||(e[o]=i[o],t[o]=n)}else t[r]=n}function B(e,t,o){var r,n,i=0,s=_o.length,a=it.Deferred().always(function(){delete g.elem}),g=function(){if(n)return!1;for(var t=fo||L(),o=Math.max(0,d.startTime+d.duration-t),r=o/d.duration||0,i=1-r,s=0,g=d.tweens.length;g>s;s++)d.tweens[s].run(i);return a.notifyWith(e,[d,i,o]),1>i&&g?o:(a.resolveWith(e,[d]),!1)},d=a.promise({elem:e,props:it.extend({},t),opts:it.extend(!0,{specialEasing:{}},o),originalProperties:t,originalOptions:o,startTime:fo||L(),duration:o.duration,tweens:[],createTween:function(t,o){var r=it.Tween(e,d.opts,t,o,d.opts.specialEasing[t]||d.opts.easing);return d.tweens.push(r),r},stop:function(t){var o=0,r=t?d.tweens.length:0;if(n)return this;for(n=!0;r>o;o++)d.tweens[o].run(1);return t?a.resolveWith(e,[d,t]):a.rejectWith(e,[d,t]),this}}),u=d.props;for(M(u,d.opts.specialEasing);s>i;i++)if(r=_o[i].call(d,e,u,d.opts))return r;return it.map(u,k,d),it.isFunction(d.opts.start)&&d.opts.start.call(e,d),it.fx.timer(it.extend(g,{elem:e,anim:d,queue:d.opts.queue})),d.progress(d.opts.progress).done(d.opts.done,d.opts.complete).fail(d.opts.fail).always(d.opts.always)}function j(e){return function(t,o){"string"!=typeof t&&(o=t,t="*");var r,n=0,i=t.toLowerCase().match(_t)||[];if(it.isFunction(o))for(;r=i[n++];)"+"===r.charAt(0)?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(o)):(e[r]=e[r]||[]).push(o)}}function U(e,t,o,r){function n(a){var g;return i[a]=!0,it.each(e[a]||[],function(e,a){var d=a(t,o,r);return"string"!=typeof d||s||i[d]?s?!(g=d):void 0:(t.dataTypes.unshift(d),n(d),!1)}),g}var i={},s=e===Wo;return n(t.dataTypes[0])||!i["*"]&&n("*")}function F(e,t){var o,r,n=it.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((n[r]?e:o||(o={}))[r]=t[r]);return o&&it.extend(!0,e,o),e}function K(e,t,o){for(var r,n,i,s,a=e.contents,g=e.dataTypes;"*"===g[0];)g.shift(),void 0===n&&(n=e.mimeType||t.getResponseHeader("Content-Type"));if(n)for(s in a)if(a[s]&&a[s].test(n)){g.unshift(s);break}if(g[0]in o)i=g[0];else{for(s in o){if(!g[0]||e.converters[s+" "+g[0]]){i=s;break}r||(r=s)}i=i||r}return i?(i!==g[0]&&g.unshift(i),o[i]):void 0}function V(e,t,o,r){var n,i,s,a,g,d={},u=e.dataTypes.slice();if(u[1])for(s in e.converters)d[s.toLowerCase()]=e.converters[s];for(i=u.shift();i;)if(e.responseFields[i]&&(o[e.responseFields[i]]=t),!g&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),g=i,i=u.shift())if("*"===i)i=g;else if("*"!==g&&g!==i){if(s=d[g+" "+i]||d["* "+i],!s)for(n in d)if(a=n.split(" "),a[1]===i&&(s=d[g+" "+a[0]]||d["* "+a[0]])){s===!0?s=d[n]:d[n]!==!0&&(i=a[0],u.unshift(a[1]));break}if(s!==!0)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(l){return{state:"parsererror",error:s?l:"No conversion from "+g+" to "+i}}}return{state:"success",data:t}}function G(e,t,o,r){var n;if(it.isArray(t))it.each(t,function(t,n){o||Yo.test(e)?r(e,n):G(e+"["+("object"==typeof n?t:"")+"]",n,o,r)});else if(o||"object"!==it.type(t))r(e,t);else for(n in t)G(e+"["+n+"]",t[n],o,r)}function W(){try{return new e.XMLHttpRequest}catch(t){}}function H(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function Q(e){return it.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var $=[],Y=$.slice,z=$.concat,X=$.push,J=$.indexOf,Z={},et=Z.toString,tt=Z.hasOwnProperty,ot="".trim,rt={},nt="1.11.0",it=function(e,t){return new it.fn.init(e,t)},st=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,at=/^-ms-/,gt=/-([\da-z])/gi,dt=function(e,t){return t.toUpperCase()};it.fn=it.prototype={jquery:nt,constructor:it,selector:"",length:0,toArray:function(){return Y.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:Y.call(this)},pushStack:function(e){var t=it.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return it.each(this,e,t)},map:function(e){return this.pushStack(it.map(this,function(t,o){return e.call(t,o,t)}))},slice:function(){return this.pushStack(Y.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,o=+e+(0>e?t:0);return this.pushStack(o>=0&&t>o?[this[o]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:X,sort:$.sort,splice:$.splice},it.extend=it.fn.extend=function(){var e,t,o,r,n,i,s=arguments[0]||{},a=1,g=arguments.length,d=!1;for("boolean"==typeof s&&(d=s,s=arguments[a]||{},a++),"object"==typeof s||it.isFunction(s)||(s={}),a===g&&(s=this,a--);g>a;a++)if(null!=(n=arguments[a]))for(r in n)e=s[r],o=n[r],s!==o&&(d&&o&&(it.isPlainObject(o)||(t=it.isArray(o)))?(t?(t=!1,i=e&&it.isArray(e)?e:[]):i=e&&it.isPlainObject(e)?e:{},s[r]=it.extend(d,i,o)):void 0!==o&&(s[r]=o));return s},it.extend({expando:"jQuery"+(nt+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===it.type(e)},isArray:Array.isArray||function(e){return"array"===it.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return e-parseFloat(e)>=0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isPlainObject:function(e){var t;if(!e||"object"!==it.type(e)||e.nodeType||it.isWindow(e))return!1;try{if(e.constructor&&!tt.call(e,"constructor")&&!tt.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(o){return!1}if(rt.ownLast)for(t in e)return tt.call(e,t);for(t in e);return void 0===t||tt.call(e,t)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?Z[et.call(e)]||"object":typeof e},globalEval:function(t){t&&it.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(at,"ms-").replace(gt,dt)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,r){var n,i=0,s=e.length,a=o(e);if(r){if(a)for(;s>i&&(n=t.apply(e[i],r),n!==!1);i++);else for(i in e)if(n=t.apply(e[i],r),n===!1)break}else if(a)for(;s>i&&(n=t.call(e[i],i,e[i]),n!==!1);i++);else for(i in e)if(n=t.call(e[i],i,e[i]),n===!1)break;return e},trim:ot&&!ot.call("")?function(e){return null==e?"":ot.call(e)}:function(e){return null==e?"":(e+"").replace(st,"")},makeArray:function(e,t){var r=t||[];return null!=e&&(o(Object(e))?it.merge(r,"string"==typeof e?[e]:e):X.call(r,e)),r},inArray:function(e,t,o){var r;if(t){if(J)return J.call(t,e,o);for(r=t.length,o=o?0>o?Math.max(0,r+o):o:0;r>o;o++)if(o in t&&t[o]===e)return o}return-1},merge:function(e,t){for(var o=+t.length,r=0,n=e.length;o>r;)e[n++]=t[r++];if(o!==o)for(;void 0!==t[r];)e[n++]=t[r++];return e.length=n,e},grep:function(e,t,o){for(var r,n=[],i=0,s=e.length,a=!o;s>i;i++)r=!t(e[i],i),r!==a&&n.push(e[i]);return n},map:function(e,t,r){var n,i=0,s=e.length,a=o(e),g=[];if(a)for(;s>i;i++)n=t(e[i],i,r),null!=n&&g.push(n);else for(i in e)n=t(e[i],i,r),null!=n&&g.push(n);return z.apply([],g)},guid:1,proxy:function(e,t){var o,r,n;return"string"==typeof t&&(n=e[t],t=e,e=n),it.isFunction(e)?(o=Y.call(arguments,2),r=function(){return e.apply(t||this,o.concat(Y.call(arguments)))},r.guid=e.guid=e.guid||it.guid++,r):void 0},now:function(){return+new Date},support:rt}),it.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){Z["[object "+t+"]"]=t.toLowerCase()});var ut=function(e){function t(e,t,o,r){var n,i,s,a,g,d,l,p,f,y;if((t?t.ownerDocument||t:U)!==R&&C(t),t=t||R,o=o||[],!e||"string"!=typeof e)return o;if(1!==(a=t.nodeType)&&9!==a)return[];if(O&&!r){if(n=mt.exec(e))if(s=n[1]){if(9===a){if(i=t.getElementById(s),!i||!i.parentNode)return o;if(i.id===s)return o.push(i),o}else if(t.ownerDocument&&(i=t.ownerDocument.getElementById(s))&&B(t,i)&&i.id===s)return o.push(i),o}else{if(n[2])return Z.apply(o,t.getElementsByTagName(e)),o;if((s=n[3])&&x.getElementsByClassName&&t.getElementsByClassName)return Z.apply(o,t.getElementsByClassName(s)),o}if(x.qsa&&(!k||!k.test(e))){if(p=l=j,f=t,y=9===a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){for(d=c(e),(l=t.getAttribute("id"))?p=l.replace(_t,"\\$&"):t.setAttribute("id",p),p="[id='"+p+"'] ",g=d.length;g--;)d[g]=p+h(d[g]);f=vt.test(e)&&u(t.parentNode)||t,y=d.join(",")}if(y)try{return Z.apply(o,f.querySelectorAll(y)),o}catch(b){}finally{l||t.removeAttribute("id")}}}return E(e.replace(gt,"$1"),t,o,r)}function o(){function e(o,r){return t.push(o+" ")>w.cacheLength&&delete e[t.shift()],e[o+" "]=r}var t=[];return e}function r(e){return e[j]=!0,e}function n(e){var t=R.createElement("div");try{return!!e(t)}catch(o){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function i(e,t){for(var o=e.split("|"),r=e.length;r--;)w.attrHandle[o[r]]=t}function s(e,t){var o=t&&e,r=o&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||$)-(~e.sourceIndex||$);if(r)return r;if(o)for(;o=o.nextSibling;)if(o===t)return-1;return e?1:-1}function a(e){return function(t){var o=t.nodeName.toLowerCase();return"input"===o&&t.type===e}}function g(e){return function(t){var o=t.nodeName.toLowerCase();return("input"===o||"button"===o)&&t.type===e}}function d(e){return r(function(t){return t=+t,r(function(o,r){for(var n,i=e([],o.length,t),s=i.length;s--;)o[n=i[s]]&&(o[n]=!(r[n]=o[n]))})})}function u(e){return e&&typeof e.getElementsByTagName!==Q&&e}function l(){}function c(e,o){var r,n,i,s,a,g,d,u=G[e+" "];if(u)return o?0:u.slice(0);for(a=e,g=[],d=w.preFilter;a;){(!r||(n=dt.exec(a)))&&(n&&(a=a.slice(n[0].length)||a),g.push(i=[])),r=!1,(n=ut.exec(a))&&(r=n.shift(),i.push({value:r,type:n[0].replace(gt," ")}),a=a.slice(r.length));for(s in w.filter)!(n=pt[s].exec(a))||d[s]&&!(n=d[s](n))||(r=n.shift(),i.push({value:r,type:s,matches:n}),a=a.slice(r.length));if(!r)break}return o?a.length:a?t.error(e):G(e,g).slice(0)}function h(e){for(var t=0,o=e.length,r="";o>t;t++)r+=e[t].value;return r}function p(e,t,o){var r=t.dir,n=o&&"parentNode"===r,i=K++;return t.first?function(t,o,i){for(;t=t[r];)if(1===t.nodeType||n)return e(t,o,i)}:function(t,o,s){var a,g,d=[F,i];if(s){for(;t=t[r];)if((1===t.nodeType||n)&&e(t,o,s))return!0}else for(;t=t[r];)if(1===t.nodeType||n){if(g=t[j]||(t[j]={}),(a=g[r])&&a[0]===F&&a[1]===i)return d[2]=a[2];if(g[r]=d,d[2]=e(t,o,s))return!0}}}function f(e){return e.length>1?function(t,o,r){for(var n=e.length;n--;)if(!e[n](t,o,r))return!1;return!0}:e[0]}function y(e,t,o,r,n){for(var i,s=[],a=0,g=e.length,d=null!=t;g>a;a++)(i=e[a])&&(!o||o(i,r,n))&&(s.push(i),d&&t.push(a));return s}function b(e,t,o,n,i,s){return n&&!n[j]&&(n=b(n)),i&&!i[j]&&(i=b(i,s)),r(function(r,s,a,g){var d,u,l,c=[],h=[],p=s.length,f=r||_(t||"*",a.nodeType?[a]:a,[]),b=!e||!r&&t?f:y(f,c,e,a,g),m=o?i||(r?e:p||n)?[]:s:b;if(o&&o(b,m,a,g),n)for(d=y(m,h),n(d,[],a,g),u=d.length;u--;)(l=d[u])&&(m[h[u]]=!(b[h[u]]=l));if(r){if(i||e){if(i){for(d=[],u=m.length;u--;)(l=m[u])&&d.push(b[u]=l);i(null,m=[],d,g)}for(u=m.length;u--;)(l=m[u])&&(d=i?tt.call(r,l):c[u])>-1&&(r[d]=!(s[d]=l))}}else m=y(m===s?m.splice(p,m.length):m),i?i(null,s,m,g):Z.apply(s,m)})}function m(e){for(var t,o,r,n=e.length,i=w.relative[e[0].type],s=i||w.relative[" "],a=i?1:0,g=p(function(e){return e===t},s,!0),d=p(function(e){return tt.call(t,e)>-1},s,!0),u=[function(e,o,r){return!i&&(r||o!==D)||((t=o).nodeType?g(e,o,r):d(e,o,r))}];n>a;a++)if(o=w.relative[e[a].type])u=[p(f(u),o)];else{if(o=w.filter[e[a].type].apply(null,e[a].matches),o[j]){for(r=++a;n>r&&!w.relative[e[r].type];r++);return b(a>1&&f(u),a>1&&h(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(gt,"$1"),o,r>a&&m(e.slice(a,r)),n>r&&m(e=e.slice(r)),n>r&&h(e))}u.push(o)}return f(u)}function v(e,o){var n=o.length>0,i=e.length>0,s=function(r,s,a,g,d){var u,l,c,h=0,p="0",f=r&&[],b=[],m=D,v=r||i&&w.find.TAG("*",d),_=F+=null==m?1:Math.random()||.1,E=v.length;for(d&&(D=s!==R&&s);p!==E&&null!=(u=v[p]);p++){if(i&&u){for(l=0;c=e[l++];)if(c(u,s,a)){g.push(u);break}d&&(F=_)}n&&((u=!c&&u)&&h--,r&&f.push(u))}if(h+=p,n&&p!==h){for(l=0;c=o[l++];)c(f,b,s,a);if(r){if(h>0)for(;p--;)f[p]||b[p]||(b[p]=X.call(g));b=y(b)}Z.apply(g,b),d&&!r&&b.length>0&&h+o.length>1&&t.uniqueSort(g)}return d&&(F=_,D=m),f};return n?r(s):s}function _(e,o,r){for(var n=0,i=o.length;i>n;n++)t(e,o[n],r);return r}function E(e,t,o,r){var n,i,s,a,g,d=c(e);if(!r&&1===d.length){if(i=d[0]=d[0].slice(0),i.length>2&&"ID"===(s=i[0]).type&&x.getById&&9===t.nodeType&&O&&w.relative[i[1].type]){if(t=(w.find.ID(s.matches[0].replace(Et,St),t)||[])[0],!t)return o;e=e.slice(i.shift().value.length)}for(n=pt.needsContext.test(e)?0:i.length;n--&&(s=i[n],!w.relative[a=s.type]);)if((g=w.find[a])&&(r=g(s.matches[0].replace(Et,St),vt.test(i[0].type)&&u(t.parentNode)||t))){if(i.splice(n,1),e=r.length&&h(i),!e)return Z.apply(o,r),o;break}}return N(e,d)(r,t,!O,o,vt.test(e)&&u(t.parentNode)||t),o}var S,x,w,T,A,N,D,I,q,C,R,L,O,k,P,M,B,j="sizzle"+-new Date,U=e.document,F=0,K=0,V=o(),G=o(),W=o(),H=function(e,t){return e===t&&(q=!0),0},Q="undefined",$=1<<31,Y={}.hasOwnProperty,z=[],X=z.pop,J=z.push,Z=z.push,et=z.slice,tt=z.indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(this[t]===e)return t;return-1},ot="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",rt="[\\x20\\t\\r\\n\\f]",nt="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",it=nt.replace("w","w#"),st="\\["+rt+"*("+nt+")"+rt+"*(?:([*^$|!~]?=)"+rt+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+it+")|)|)"+rt+"*\\]",at=":("+nt+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+st.replace(3,8)+")*)|.*)\\)|)",gt=new RegExp("^"+rt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+rt+"+$","g"),dt=new RegExp("^"+rt+"*,"+rt+"*"),ut=new RegExp("^"+rt+"*([>+~]|"+rt+")"+rt+"*"),lt=new RegExp("="+rt+"*([^\\]'\"]*?)"+rt+"*\\]","g"),ct=new RegExp(at),ht=new RegExp("^"+it+"$"),pt={ID:new RegExp("^#("+nt+")"),CLASS:new RegExp("^\\.("+nt+")"),TAG:new RegExp("^("+nt.replace("w","w*")+")"),ATTR:new RegExp("^"+st),PSEUDO:new RegExp("^"+at),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+rt+"*(even|odd|(([+-]|)(\\d*)n|)"+rt+"*(?:([+-]|)"+rt+"*(\\d+)|))"+rt+"*\\)|)","i"),bool:new RegExp("^(?:"+ot+")$","i"),needsContext:new RegExp("^"+rt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+rt+"*((?:-\\d)?\\d*)"+rt+"*\\)|)(?=[^-]|$)","i")},ft=/^(?:input|select|textarea|button)$/i,yt=/^h\d$/i,bt=/^[^{]+\{\s*\[native \w/,mt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,vt=/[+~]/,_t=/'|\\/g,Et=new RegExp("\\\\([\\da-f]{1,6}"+rt+"?|("+rt+")|.)","ig"),St=function(e,t,o){var r="0x"+t-65536;return r!==r||o?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)};try{Z.apply(z=et.call(U.childNodes),U.childNodes),z[U.childNodes.length].nodeType}catch(xt){Z={apply:z.length?function(e,t){J.apply(e,et.call(t))}:function(e,t){for(var o=e.length,r=0;e[o++]=t[r++];);e.length=o-1}}}x=t.support={},A=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},C=t.setDocument=function(e){var t,o=e?e.ownerDocument||e:U,r=o.defaultView;return o!==R&&9===o.nodeType&&o.documentElement?(R=o,L=o.documentElement,O=!A(o),r&&r!==r.top&&(r.addEventListener?r.addEventListener("unload",function(){C()},!1):r.attachEvent&&r.attachEvent("onunload",function(){C()})),x.attributes=n(function(e){return e.className="i",!e.getAttribute("className")}),x.getElementsByTagName=n(function(e){return e.appendChild(o.createComment("")),!e.getElementsByTagName("*").length}),x.getElementsByClassName=bt.test(o.getElementsByClassName)&&n(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),x.getById=n(function(e){return L.appendChild(e).id=j,!o.getElementsByName||!o.getElementsByName(j).length}),x.getById?(w.find.ID=function(e,t){if(typeof t.getElementById!==Q&&O){var o=t.getElementById(e);return o&&o.parentNode?[o]:[]}},w.filter.ID=function(e){var t=e.replace(Et,St);return function(e){return e.getAttribute("id")===t}}):(delete w.find.ID,w.filter.ID=function(e){var t=e.replace(Et,St);return function(e){var o=typeof e.getAttributeNode!==Q&&e.getAttributeNode("id");return o&&o.value===t}}),w.find.TAG=x.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==Q?t.getElementsByTagName(e):void 0}:function(e,t){var o,r=[],n=0,i=t.getElementsByTagName(e);if("*"===e){for(;o=i[n++];)1===o.nodeType&&r.push(o);return r}return i},w.find.CLASS=x.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==Q&&O?t.getElementsByClassName(e):void 0},P=[],k=[],(x.qsa=bt.test(o.querySelectorAll))&&(n(function(e){e.innerHTML="<select t=''><option selected=''></option></select>",e.querySelectorAll("[t^='']").length&&k.push("[*^$]="+rt+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||k.push("\\["+rt+"*(?:value|"+ot+")"),e.querySelectorAll(":checked").length||k.push(":checked")}),n(function(e){var t=o.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&k.push("name"+rt+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||k.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),k.push(",.*:")})),(x.matchesSelector=bt.test(M=L.webkitMatchesSelector||L.mozMatchesSelector||L.oMatchesSelector||L.msMatchesSelector))&&n(function(e){x.disconnectedMatch=M.call(e,"div"),M.call(e,"[s!='']:x"),P.push("!=",at)}),k=k.length&&new RegExp(k.join("|")),P=P.length&&new RegExp(P.join("|")),t=bt.test(L.compareDocumentPosition),B=t||bt.test(L.contains)?function(e,t){var o=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(o.contains?o.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},H=t?function(e,t){if(e===t)return q=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&r||!x.sortDetached&&t.compareDocumentPosition(e)===r?e===o||e.ownerDocument===U&&B(U,e)?-1:t===o||t.ownerDocument===U&&B(U,t)?1:I?tt.call(I,e)-tt.call(I,t):0:4&r?-1:1)}:function(e,t){if(e===t)return q=!0,0;var r,n=0,i=e.parentNode,a=t.parentNode,g=[e],d=[t];if(!i||!a)return e===o?-1:t===o?1:i?-1:a?1:I?tt.call(I,e)-tt.call(I,t):0;if(i===a)return s(e,t);for(r=e;r=r.parentNode;)g.unshift(r);for(r=t;r=r.parentNode;)d.unshift(r);for(;g[n]===d[n];)n++;return n?s(g[n],d[n]):g[n]===U?-1:d[n]===U?1:0},o):R},t.matches=function(e,o){return t(e,null,null,o)},t.matchesSelector=function(e,o){if((e.ownerDocument||e)!==R&&C(e),o=o.replace(lt,"='$1']"),!(!x.matchesSelector||!O||P&&P.test(o)||k&&k.test(o)))try{var r=M.call(e,o);if(r||x.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(n){}return t(o,R,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==R&&C(e),B(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==R&&C(e);var o=w.attrHandle[t.toLowerCase()],r=o&&Y.call(w.attrHandle,t.toLowerCase())?o(e,t,!O):void 0;return void 0!==r?r:x.attributes||!O?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,o=[],r=0,n=0;if(q=!x.detectDuplicates,I=!x.sortStable&&e.slice(0),e.sort(H),q){for(;t=e[n++];)t===e[n]&&(r=o.push(n));for(;r--;)e.splice(o[r],1)}return I=null,e},T=t.getText=function(e){var t,o="",r=0,n=e.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)o+=T(e)}else if(3===n||4===n)return e.nodeValue}else for(;t=e[r++];)o+=T(t);return o},w=t.selectors={cacheLength:50,createPseudo:r,match:pt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Et,St),e[3]=(e[4]||e[5]||"").replace(Et,St),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,o=!e[5]&&e[2];return pt.CHILD.test(e[0])?null:(e[3]&&void 0!==e[4]?e[2]=e[4]:o&&ct.test(o)&&(t=c(o,!0))&&(t=o.indexOf(")",o.length-t)-o.length)&&(e[0]=e[0].slice(0,t),e[2]=o.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Et,St).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=V[e+" "];return t||(t=new RegExp("(^|"+rt+")"+e+"("+rt+"|$)"))&&V(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==Q&&e.getAttribute("class")||"")})},ATTR:function(e,o,r){return function(n){var i=t.attr(n,e);return null==i?"!="===o:o?(i+="","="===o?i===r:"!="===o?i!==r:"^="===o?r&&0===i.indexOf(r):"*="===o?r&&i.indexOf(r)>-1:"$="===o?r&&i.slice(-r.length)===r:"~="===o?(" "+i+" ").indexOf(r)>-1:"|="===o?i===r||i.slice(0,r.length+1)===r+"-":!1):!0}},CHILD:function(e,t,o,r,n){var i="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===n?function(e){return!!e.parentNode}:function(t,o,g){var d,u,l,c,h,p,f=i!==s?"nextSibling":"previousSibling",y=t.parentNode,b=a&&t.nodeName.toLowerCase(),m=!g&&!a;if(y){if(i){for(;f;){for(l=t;l=l[f];)if(a?l.nodeName.toLowerCase()===b:1===l.nodeType)return!1;p=f="only"===e&&!p&&"nextSibling"}return!0}if(p=[s?y.firstChild:y.lastChild],s&&m){for(u=y[j]||(y[j]={}),d=u[e]||[],h=d[0]===F&&d[1],c=d[0]===F&&d[2],l=h&&y.childNodes[h];l=++h&&l&&l[f]||(c=h=0)||p.pop();)if(1===l.nodeType&&++c&&l===t){u[e]=[F,h,c];break}}else if(m&&(d=(t[j]||(t[j]={}))[e])&&d[0]===F)c=d[1];else for(;(l=++h&&l&&l[f]||(c=h=0)||p.pop())&&((a?l.nodeName.toLowerCase()!==b:1!==l.nodeType)||!++c||(m&&((l[j]||(l[j]={}))[e]=[F,c]),l!==t)););return c-=n,c===r||c%r===0&&c/r>=0}}},PSEUDO:function(e,o){var n,i=w.pseudos[e]||w.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return i[j]?i(o):i.length>1?(n=[e,e,"",o],w.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,t){for(var r,n=i(e,o),s=n.length;s--;)r=tt.call(e,n[s]),e[r]=!(t[r]=n[s])}):function(e){return i(e,0,n)}):i}},pseudos:{not:r(function(e){var t=[],o=[],n=N(e.replace(gt,"$1"));return n[j]?r(function(e,t,o,r){for(var i,s=n(e,null,r,[]),a=e.length;a--;)(i=s[a])&&(e[a]=!(t[a]=i))}):function(e,r,i){return t[0]=e,n(t,null,i,o),!o.pop()}}),has:r(function(e){return function(o){return t(e,o).length>0}}),contains:r(function(e){return function(t){return(t.textContent||t.innerText||T(t)).indexOf(e)>-1}}),lang:r(function(e){return ht.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(Et,St).toLowerCase(),function(t){var o;do if(o=O?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return o=o.toLowerCase(),o===e||0===o.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var o=e.location&&e.location.hash;return o&&o.slice(1)===t.id},root:function(e){return e===L},focus:function(e){return e===R.activeElement&&(!R.hasFocus||R.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!w.pseudos.empty(e)},header:function(e){return yt.test(e.nodeName)},input:function(e){return ft.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:d(function(){return[0]}),last:d(function(e,t){return[t-1]}),eq:d(function(e,t,o){return[0>o?o+t:o]}),even:d(function(e,t){for(var o=0;t>o;o+=2)e.push(o);return e}),odd:d(function(e,t){for(var o=1;t>o;o+=2)e.push(o);return e}),lt:d(function(e,t,o){for(var r=0>o?o+t:o;--r>=0;)e.push(r);return e}),gt:d(function(e,t,o){for(var r=0>o?o+t:o;++r<t;)e.push(r);return e})}},w.pseudos.nth=w.pseudos.eq;for(S in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})w.pseudos[S]=a(S);for(S in{submit:!0,reset:!0})w.pseudos[S]=g(S);return l.prototype=w.filters=w.pseudos,w.setFilters=new l,N=t.compile=function(e,t){var o,r=[],n=[],i=W[e+" "];if(!i){for(t||(t=c(e)),o=t.length;o--;)i=m(t[o]),i[j]?r.push(i):n.push(i);i=W(e,v(n,r))}return i},x.sortStable=j.split("").sort(H).join("")===j,x.detectDuplicates=!!q,C(),x.sortDetached=n(function(e){return 1&e.compareDocumentPosition(R.createElement("div"))}),n(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||i("type|href|height|width",function(e,t,o){return o?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),x.attributes&&n(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||i("value",function(e,t,o){return o||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),n(function(e){return null==e.getAttribute("disabled")})||i(ot,function(e,t,o){var r;return o?void 0:e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),t}(e);it.find=ut,it.expr=ut.selectors,it.expr[":"]=it.expr.pseudos,it.unique=ut.uniqueSort,it.text=ut.getText,it.isXMLDoc=ut.isXML,it.contains=ut.contains;var lt=it.expr.match.needsContext,ct=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ht=/^.[^:#\[\.,]*$/;it.filter=function(e,t,o){var r=t[0];return o&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?it.find.matchesSelector(r,e)?[r]:[]:it.find.matches(e,it.grep(t,function(e){return 1===e.nodeType
}))},it.fn.extend({find:function(e){var t,o=[],r=this,n=r.length;if("string"!=typeof e)return this.pushStack(it(e).filter(function(){for(t=0;n>t;t++)if(it.contains(r[t],this))return!0}));for(t=0;n>t;t++)it.find(e,r[t],o);return o=this.pushStack(n>1?it.unique(o):o),o.selector=this.selector?this.selector+" "+e:e,o},filter:function(e){return this.pushStack(r(this,e||[],!1))},not:function(e){return this.pushStack(r(this,e||[],!0))},is:function(e){return!!r(this,"string"==typeof e&&lt.test(e)?it(e):e||[],!1).length}});var pt,ft=e.document,yt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,bt=it.fn.init=function(e,t){var o,r;if(!e)return this;if("string"==typeof e){if(o="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:yt.exec(e),!o||!o[1]&&t)return!t||t.jquery?(t||pt).find(e):this.constructor(t).find(e);if(o[1]){if(t=t instanceof it?t[0]:t,it.merge(this,it.parseHTML(o[1],t&&t.nodeType?t.ownerDocument||t:ft,!0)),ct.test(o[1])&&it.isPlainObject(t))for(o in t)it.isFunction(this[o])?this[o](t[o]):this.attr(o,t[o]);return this}if(r=ft.getElementById(o[2]),r&&r.parentNode){if(r.id!==o[2])return pt.find(e);this.length=1,this[0]=r}return this.context=ft,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):it.isFunction(e)?"undefined"!=typeof pt.ready?pt.ready(e):e(it):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),it.makeArray(e,this))};bt.prototype=it.fn,pt=it(ft);var mt=/^(?:parents|prev(?:Until|All))/,vt={children:!0,contents:!0,next:!0,prev:!0};it.extend({dir:function(e,t,o){for(var r=[],n=e[t];n&&9!==n.nodeType&&(void 0===o||1!==n.nodeType||!it(n).is(o));)1===n.nodeType&&r.push(n),n=n[t];return r},sibling:function(e,t){for(var o=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&o.push(e);return o}}),it.fn.extend({has:function(e){var t,o=it(e,this),r=o.length;return this.filter(function(){for(t=0;r>t;t++)if(it.contains(this,o[t]))return!0})},closest:function(e,t){for(var o,r=0,n=this.length,i=[],s=lt.test(e)||"string"!=typeof e?it(e,t||this.context):0;n>r;r++)for(o=this[r];o&&o!==t;o=o.parentNode)if(o.nodeType<11&&(s?s.index(o)>-1:1===o.nodeType&&it.find.matchesSelector(o,e))){i.push(o);break}return this.pushStack(i.length>1?it.unique(i):i)},index:function(e){return e?"string"==typeof e?it.inArray(this[0],it(e)):it.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(it.unique(it.merge(this.get(),it(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),it.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return it.dir(e,"parentNode")},parentsUntil:function(e,t,o){return it.dir(e,"parentNode",o)},next:function(e){return n(e,"nextSibling")},prev:function(e){return n(e,"previousSibling")},nextAll:function(e){return it.dir(e,"nextSibling")},prevAll:function(e){return it.dir(e,"previousSibling")},nextUntil:function(e,t,o){return it.dir(e,"nextSibling",o)},prevUntil:function(e,t,o){return it.dir(e,"previousSibling",o)},siblings:function(e){return it.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return it.sibling(e.firstChild)},contents:function(e){return it.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:it.merge([],e.childNodes)}},function(e,t){it.fn[e]=function(o,r){var n=it.map(this,t,o);return"Until"!==e.slice(-5)&&(r=o),r&&"string"==typeof r&&(n=it.filter(r,n)),this.length>1&&(vt[e]||(n=it.unique(n)),mt.test(e)&&(n=n.reverse())),this.pushStack(n)}});var _t=/\S+/g,Et={};it.Callbacks=function(e){e="string"==typeof e?Et[e]||i(e):it.extend({},e);var t,o,r,n,s,a,g=[],d=!e.once&&[],u=function(i){for(o=e.memory&&i,r=!0,s=a||0,a=0,n=g.length,t=!0;g&&n>s;s++)if(g[s].apply(i[0],i[1])===!1&&e.stopOnFalse){o=!1;break}t=!1,g&&(d?d.length&&u(d.shift()):o?g=[]:l.disable())},l={add:function(){if(g){var r=g.length;!function i(t){it.each(t,function(t,o){var r=it.type(o);"function"===r?e.unique&&l.has(o)||g.push(o):o&&o.length&&"string"!==r&&i(o)})}(arguments),t?n=g.length:o&&(a=r,u(o))}return this},remove:function(){return g&&it.each(arguments,function(e,o){for(var r;(r=it.inArray(o,g,r))>-1;)g.splice(r,1),t&&(n>=r&&n--,s>=r&&s--)}),this},has:function(e){return e?it.inArray(e,g)>-1:!(!g||!g.length)},empty:function(){return g=[],n=0,this},disable:function(){return g=d=o=void 0,this},disabled:function(){return!g},lock:function(){return d=void 0,o||l.disable(),this},locked:function(){return!d},fireWith:function(e,o){return!g||r&&!d||(o=o||[],o=[e,o.slice?o.slice():o],t?d.push(o):u(o)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},it.extend({Deferred:function(e){var t=[["resolve","done",it.Callbacks("once memory"),"resolved"],["reject","fail",it.Callbacks("once memory"),"rejected"],["notify","progress",it.Callbacks("memory")]],o="pending",r={state:function(){return o},always:function(){return n.done(arguments).fail(arguments),this},then:function(){var e=arguments;return it.Deferred(function(o){it.each(t,function(t,i){var s=it.isFunction(e[t])&&e[t];n[i[1]](function(){var e=s&&s.apply(this,arguments);e&&it.isFunction(e.promise)?e.promise().done(o.resolve).fail(o.reject).progress(o.notify):o[i[0]+"With"](this===r?o.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?it.extend(e,r):r}},n={};return r.pipe=r.then,it.each(t,function(e,i){var s=i[2],a=i[3];r[i[1]]=s.add,a&&s.add(function(){o=a},t[1^e][2].disable,t[2][2].lock),n[i[0]]=function(){return n[i[0]+"With"](this===n?r:this,arguments),this},n[i[0]+"With"]=s.fireWith}),r.promise(n),e&&e.call(n,n),n},when:function(e){var t,o,r,n=0,i=Y.call(arguments),s=i.length,a=1!==s||e&&it.isFunction(e.promise)?s:0,g=1===a?e:it.Deferred(),d=function(e,o,r){return function(n){o[e]=this,r[e]=arguments.length>1?Y.call(arguments):n,r===t?g.notifyWith(o,r):--a||g.resolveWith(o,r)}};if(s>1)for(t=new Array(s),o=new Array(s),r=new Array(s);s>n;n++)i[n]&&it.isFunction(i[n].promise)?i[n].promise().done(d(n,r,i)).fail(g.reject).progress(d(n,o,t)):--a;return a||g.resolveWith(r,i),g.promise()}});var St;it.fn.ready=function(e){return it.ready.promise().done(e),this},it.extend({isReady:!1,readyWait:1,holdReady:function(e){e?it.readyWait++:it.ready(!0)},ready:function(e){if(e===!0?!--it.readyWait:!it.isReady){if(!ft.body)return setTimeout(it.ready);it.isReady=!0,e!==!0&&--it.readyWait>0||(St.resolveWith(ft,[it]),it.fn.trigger&&it(ft).trigger("ready").off("ready"))}}}),it.ready.promise=function(t){if(!St)if(St=it.Deferred(),"complete"===ft.readyState)setTimeout(it.ready);else if(ft.addEventListener)ft.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1);else{ft.attachEvent("onreadystatechange",a),e.attachEvent("onload",a);var o=!1;try{o=null==e.frameElement&&ft.documentElement}catch(r){}o&&o.doScroll&&!function n(){if(!it.isReady){try{o.doScroll("left")}catch(e){return setTimeout(n,50)}s(),it.ready()}}()}return St.promise(t)};var xt,wt="undefined";for(xt in it(rt))break;rt.ownLast="0"!==xt,rt.inlineBlockNeedsLayout=!1,it(function(){var e,t,o=ft.getElementsByTagName("body")[0];o&&(e=ft.createElement("div"),e.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",t=ft.createElement("div"),o.appendChild(e).appendChild(t),typeof t.style.zoom!==wt&&(t.style.cssText="border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1",(rt.inlineBlockNeedsLayout=3===t.offsetWidth)&&(o.style.zoom=1)),o.removeChild(e),e=t=null)}),function(){var e=ft.createElement("div");if(null==rt.deleteExpando){rt.deleteExpando=!0;try{delete e.test}catch(t){rt.deleteExpando=!1}}e=null}(),it.acceptData=function(e){var t=it.noData[(e.nodeName+" ").toLowerCase()],o=+e.nodeType||1;return 1!==o&&9!==o?!1:!t||t!==!0&&e.getAttribute("classid")===t};var Tt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,At=/([A-Z])/g;it.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?it.cache[e[it.expando]]:e[it.expando],!!e&&!d(e)},data:function(e,t,o){return u(e,t,o)},removeData:function(e,t){return l(e,t)},_data:function(e,t,o){return u(e,t,o,!0)},_removeData:function(e,t){return l(e,t,!0)}}),it.fn.extend({data:function(e,t){var o,r,n,i=this[0],s=i&&i.attributes;if(void 0===e){if(this.length&&(n=it.data(i),1===i.nodeType&&!it._data(i,"parsedAttrs"))){for(o=s.length;o--;)r=s[o].name,0===r.indexOf("data-")&&(r=it.camelCase(r.slice(5)),g(i,r,n[r]));it._data(i,"parsedAttrs",!0)}return n}return"object"==typeof e?this.each(function(){it.data(this,e)}):arguments.length>1?this.each(function(){it.data(this,e,t)}):i?g(i,e,it.data(i,e)):void 0},removeData:function(e){return this.each(function(){it.removeData(this,e)})}}),it.extend({queue:function(e,t,o){var r;return e?(t=(t||"fx")+"queue",r=it._data(e,t),o&&(!r||it.isArray(o)?r=it._data(e,t,it.makeArray(o)):r.push(o)),r||[]):void 0},dequeue:function(e,t){t=t||"fx";var o=it.queue(e,t),r=o.length,n=o.shift(),i=it._queueHooks(e,t),s=function(){it.dequeue(e,t)};"inprogress"===n&&(n=o.shift(),r--),n&&("fx"===t&&o.unshift("inprogress"),delete i.stop,n.call(e,s,i)),!r&&i&&i.empty.fire()},_queueHooks:function(e,t){var o=t+"queueHooks";return it._data(e,o)||it._data(e,o,{empty:it.Callbacks("once memory").add(function(){it._removeData(e,t+"queue"),it._removeData(e,o)})})}}),it.fn.extend({queue:function(e,t){var o=2;return"string"!=typeof e&&(t=e,e="fx",o--),arguments.length<o?it.queue(this[0],e):void 0===t?this:this.each(function(){var o=it.queue(this,e,t);it._queueHooks(this,e),"fx"===e&&"inprogress"!==o[0]&&it.dequeue(this,e)})},dequeue:function(e){return this.each(function(){it.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var o,r=1,n=it.Deferred(),i=this,s=this.length,a=function(){--r||n.resolveWith(i,[i])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)o=it._data(i[s],e+"queueHooks"),o&&o.empty&&(r++,o.empty.add(a));return a(),n.promise(t)}});var Nt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Dt=["Top","Right","Bottom","Left"],It=function(e,t){return e=t||e,"none"===it.css(e,"display")||!it.contains(e.ownerDocument,e)},qt=it.access=function(e,t,o,r,n,i,s){var a=0,g=e.length,d=null==o;if("object"===it.type(o)){n=!0;for(a in o)it.access(e,t,a,o[a],!0,i,s)}else if(void 0!==r&&(n=!0,it.isFunction(r)||(s=!0),d&&(s?(t.call(e,r),t=null):(d=t,t=function(e,t,o){return d.call(it(e),o)})),t))for(;g>a;a++)t(e[a],o,s?r:r.call(e[a],a,t(e[a],o)));return n?e:d?t.call(e):g?t(e[0],o):i},Ct=/^(?:checkbox|radio)$/i;!function(){var e=ft.createDocumentFragment(),t=ft.createElement("div"),o=ft.createElement("input");if(t.setAttribute("className","t"),t.innerHTML="  <link/><table></table><a href='/a'>a</a>",rt.leadingWhitespace=3===t.firstChild.nodeType,rt.tbody=!t.getElementsByTagName("tbody").length,rt.htmlSerialize=!!t.getElementsByTagName("link").length,rt.html5Clone="<:nav></:nav>"!==ft.createElement("nav").cloneNode(!0).outerHTML,o.type="checkbox",o.checked=!0,e.appendChild(o),rt.appendChecked=o.checked,t.innerHTML="<textarea>x</textarea>",rt.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue,e.appendChild(t),t.innerHTML="<input type='radio' checked='checked' name='t'/>",rt.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,rt.noCloneEvent=!0,t.attachEvent&&(t.attachEvent("onclick",function(){rt.noCloneEvent=!1}),t.cloneNode(!0).click()),null==rt.deleteExpando){rt.deleteExpando=!0;try{delete t.test}catch(r){rt.deleteExpando=!1}}e=t=o=null}(),function(){var t,o,r=ft.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})o="on"+t,(rt[t+"Bubbles"]=o in e)||(r.setAttribute(o,"t"),rt[t+"Bubbles"]=r.attributes[o].expando===!1);r=null}();var Rt=/^(?:input|select|textarea)$/i,Lt=/^key/,Ot=/^(?:mouse|contextmenu)|click/,kt=/^(?:focusinfocus|focusoutblur)$/,Pt=/^([^.]*)(?:\.(.+)|)$/;it.event={global:{},add:function(e,t,o,r,n){var i,s,a,g,d,u,l,c,h,p,f,y=it._data(e);if(y){for(o.handler&&(g=o,o=g.handler,n=g.selector),o.guid||(o.guid=it.guid++),(s=y.events)||(s=y.events={}),(u=y.handle)||(u=y.handle=function(e){return typeof it===wt||e&&it.event.triggered===e.type?void 0:it.event.dispatch.apply(u.elem,arguments)},u.elem=e),t=(t||"").match(_t)||[""],a=t.length;a--;)i=Pt.exec(t[a])||[],h=f=i[1],p=(i[2]||"").split(".").sort(),h&&(d=it.event.special[h]||{},h=(n?d.delegateType:d.bindType)||h,d=it.event.special[h]||{},l=it.extend({type:h,origType:f,data:r,handler:o,guid:o.guid,selector:n,needsContext:n&&it.expr.match.needsContext.test(n),namespace:p.join(".")},g),(c=s[h])||(c=s[h]=[],c.delegateCount=0,d.setup&&d.setup.call(e,r,p,u)!==!1||(e.addEventListener?e.addEventListener(h,u,!1):e.attachEvent&&e.attachEvent("on"+h,u))),d.add&&(d.add.call(e,l),l.handler.guid||(l.handler.guid=o.guid)),n?c.splice(c.delegateCount++,0,l):c.push(l),it.event.global[h]=!0);e=null}},remove:function(e,t,o,r,n){var i,s,a,g,d,u,l,c,h,p,f,y=it.hasData(e)&&it._data(e);if(y&&(u=y.events)){for(t=(t||"").match(_t)||[""],d=t.length;d--;)if(a=Pt.exec(t[d])||[],h=f=a[1],p=(a[2]||"").split(".").sort(),h){for(l=it.event.special[h]||{},h=(r?l.delegateType:l.bindType)||h,c=u[h]||[],a=a[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=i=c.length;i--;)s=c[i],!n&&f!==s.origType||o&&o.guid!==s.guid||a&&!a.test(s.namespace)||r&&r!==s.selector&&("**"!==r||!s.selector)||(c.splice(i,1),s.selector&&c.delegateCount--,l.remove&&l.remove.call(e,s));g&&!c.length&&(l.teardown&&l.teardown.call(e,p,y.handle)!==!1||it.removeEvent(e,h,y.handle),delete u[h])}else for(h in u)it.event.remove(e,h+t[d],o,r,!0);it.isEmptyObject(u)&&(delete y.handle,it._removeData(e,"events"))}},trigger:function(t,o,r,n){var i,s,a,g,d,u,l,c=[r||ft],h=tt.call(t,"type")?t.type:t,p=tt.call(t,"namespace")?t.namespace.split("."):[];if(a=u=r=r||ft,3!==r.nodeType&&8!==r.nodeType&&!kt.test(h+it.event.triggered)&&(h.indexOf(".")>=0&&(p=h.split("."),h=p.shift(),p.sort()),s=h.indexOf(":")<0&&"on"+h,t=t[it.expando]?t:new it.Event(h,"object"==typeof t&&t),t.isTrigger=n?2:3,t.namespace=p.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),o=null==o?[t]:it.makeArray(o,[t]),d=it.event.special[h]||{},n||!d.trigger||d.trigger.apply(r,o)!==!1)){if(!n&&!d.noBubble&&!it.isWindow(r)){for(g=d.delegateType||h,kt.test(g+h)||(a=a.parentNode);a;a=a.parentNode)c.push(a),u=a;u===(r.ownerDocument||ft)&&c.push(u.defaultView||u.parentWindow||e)}for(l=0;(a=c[l++])&&!t.isPropagationStopped();)t.type=l>1?g:d.bindType||h,i=(it._data(a,"events")||{})[t.type]&&it._data(a,"handle"),i&&i.apply(a,o),i=s&&a[s],i&&i.apply&&it.acceptData(a)&&(t.result=i.apply(a,o),t.result===!1&&t.preventDefault());if(t.type=h,!n&&!t.isDefaultPrevented()&&(!d._default||d._default.apply(c.pop(),o)===!1)&&it.acceptData(r)&&s&&r[h]&&!it.isWindow(r)){u=r[s],u&&(r[s]=null),it.event.triggered=h;try{r[h]()}catch(f){}it.event.triggered=void 0,u&&(r[s]=u)}return t.result}},dispatch:function(e){e=it.event.fix(e);var t,o,r,n,i,s=[],a=Y.call(arguments),g=(it._data(this,"events")||{})[e.type]||[],d=it.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!d.preDispatch||d.preDispatch.call(this,e)!==!1){for(s=it.event.handlers.call(this,e,g),t=0;(n=s[t++])&&!e.isPropagationStopped();)for(e.currentTarget=n.elem,i=0;(r=n.handlers[i++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(r.namespace))&&(e.handleObj=r,e.data=r.data,o=((it.event.special[r.origType]||{}).handle||r.handler).apply(n.elem,a),void 0!==o&&(e.result=o)===!1&&(e.preventDefault(),e.stopPropagation()));return d.postDispatch&&d.postDispatch.call(this,e),e.result}},handlers:function(e,t){var o,r,n,i,s=[],a=t.delegateCount,g=e.target;if(a&&g.nodeType&&(!e.button||"click"!==e.type))for(;g!=this;g=g.parentNode||this)if(1===g.nodeType&&(g.disabled!==!0||"click"!==e.type)){for(n=[],i=0;a>i;i++)r=t[i],o=r.selector+" ",void 0===n[o]&&(n[o]=r.needsContext?it(o,this).index(g)>=0:it.find(o,this,null,[g]).length),n[o]&&n.push(r);n.length&&s.push({elem:g,handlers:n})}return a<t.length&&s.push({elem:this,handlers:t.slice(a)}),s},fix:function(e){if(e[it.expando])return e;var t,o,r,n=e.type,i=e,s=this.fixHooks[n];for(s||(this.fixHooks[n]=s=Ot.test(n)?this.mouseHooks:Lt.test(n)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new it.Event(i),t=r.length;t--;)o=r[t],e[o]=i[o];return e.target||(e.target=i.srcElement||ft),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,i):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var o,r,n,i=t.button,s=t.fromElement;return null==e.pageX&&null!=t.clientX&&(r=e.target.ownerDocument||ft,n=r.documentElement,o=r.body,e.pageX=t.clientX+(n&&n.scrollLeft||o&&o.scrollLeft||0)-(n&&n.clientLeft||o&&o.clientLeft||0),e.pageY=t.clientY+(n&&n.scrollTop||o&&o.scrollTop||0)-(n&&n.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?t.toElement:s),e.which||void 0===i||(e.which=1&i?1:2&i?3:4&i?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==p()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===p()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return it.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(e){return it.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,o,r){var n=it.extend(new it.Event,o,{type:e,isSimulated:!0,originalEvent:{}});r?it.event.trigger(n,null,t):it.event.dispatch.call(t,n),n.isDefaultPrevented()&&o.preventDefault()}},it.removeEvent=ft.removeEventListener?function(e,t,o){e.removeEventListener&&e.removeEventListener(t,o,!1)}:function(e,t,o){var r="on"+t;e.detachEvent&&(typeof e[r]===wt&&(e[r]=null),e.detachEvent(r,o))},it.Event=function(e,t){return this instanceof it.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&(e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault())?c:h):this.type=e,t&&it.extend(this,t),this.timeStamp=e&&e.timeStamp||it.now(),this[it.expando]=!0,void 0):new it.Event(e,t)},it.Event.prototype={isDefaultPrevented:h,isPropagationStopped:h,isImmediatePropagationStopped:h,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=c,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=c,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=c,this.stopPropagation()}},it.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){it.event.special[e]={delegateType:t,bindType:t,handle:function(e){var o,r=this,n=e.relatedTarget,i=e.handleObj;return(!n||n!==r&&!it.contains(r,n))&&(e.type=i.origType,o=i.handler.apply(this,arguments),e.type=t),o}}}),rt.submitBubbles||(it.event.special.submit={setup:function(){return it.nodeName(this,"form")?!1:(it.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,o=it.nodeName(t,"input")||it.nodeName(t,"button")?t.form:void 0;o&&!it._data(o,"submitBubbles")&&(it.event.add(o,"submit._submit",function(e){e._submit_bubble=!0}),it._data(o,"submitBubbles",!0))}),void 0)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&it.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return it.nodeName(this,"form")?!1:(it.event.remove(this,"._submit"),void 0)}}),rt.changeBubbles||(it.event.special.change={setup:function(){return Rt.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(it.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),it.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),it.event.simulate("change",this,e,!0)})),!1):(it.event.add(this,"beforeactivate._change",function(e){var t=e.target;Rt.test(t.nodeName)&&!it._data(t,"changeBubbles")&&(it.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||it.event.simulate("change",this.parentNode,e,!0)}),it._data(t,"changeBubbles",!0))}),void 0)},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return it.event.remove(this,"._change"),!Rt.test(this.nodeName)}}),rt.focusinBubbles||it.each({focus:"focusin",blur:"focusout"},function(e,t){var o=function(e){it.event.simulate(t,e.target,it.event.fix(e),!0)};it.event.special[t]={setup:function(){var r=this.ownerDocument||this,n=it._data(r,t);n||r.addEventListener(e,o,!0),it._data(r,t,(n||0)+1)},teardown:function(){var r=this.ownerDocument||this,n=it._data(r,t)-1;n?it._data(r,t,n):(r.removeEventListener(e,o,!0),it._removeData(r,t))}}}),it.fn.extend({on:function(e,t,o,r,n){var i,s;if("object"==typeof e){"string"!=typeof t&&(o=o||t,t=void 0);for(i in e)this.on(i,t,o,e[i],n);return this}if(null==o&&null==r?(r=t,o=t=void 0):null==r&&("string"==typeof t?(r=o,o=void 0):(r=o,o=t,t=void 0)),r===!1)r=h;else if(!r)return this;return 1===n&&(s=r,r=function(e){return it().off(e),s.apply(this,arguments)},r.guid=s.guid||(s.guid=it.guid++)),this.each(function(){it.event.add(this,e,r,o,t)})},one:function(e,t,o,r){return this.on(e,t,o,r,1)},off:function(e,t,o){var r,n;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,it(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(n in e)this.off(n,t,e[n]);return this}return(t===!1||"function"==typeof t)&&(o=t,t=void 0),o===!1&&(o=h),this.each(function(){it.event.remove(this,e,o,t)})},trigger:function(e,t){return this.each(function(){it.event.trigger(e,t,this)})},triggerHandler:function(e,t){var o=this[0];return o?it.event.trigger(e,t,o,!0):void 0}});var Mt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Bt=/ jQuery\d+="(?:null|\d+)"/g,jt=new RegExp("<(?:"+Mt+")[\\s/>]","i"),Ut=/^\s+/,Ft=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Kt=/<([\w:]+)/,Vt=/<tbody/i,Gt=/<|&#?\w+;/,Wt=/<(?:script|style|link)/i,Ht=/checked\s*(?:[^=]|=\s*.checked.)/i,Qt=/^$|\/(?:java|ecma)script/i,$t=/^true\/(.*)/,Yt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,zt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:rt.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Xt=f(ft),Jt=Xt.appendChild(ft.createElement("div"));zt.optgroup=zt.option,zt.tbody=zt.tfoot=zt.colgroup=zt.caption=zt.thead,zt.th=zt.td,it.extend({clone:function(e,t,o){var r,n,i,s,a,g=it.contains(e.ownerDocument,e);if(rt.html5Clone||it.isXMLDoc(e)||!jt.test("<"+e.nodeName+">")?i=e.cloneNode(!0):(Jt.innerHTML=e.outerHTML,Jt.removeChild(i=Jt.firstChild)),!(rt.noCloneEvent&&rt.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||it.isXMLDoc(e)))for(r=y(i),a=y(e),s=0;null!=(n=a[s]);++s)r[s]&&x(n,r[s]);if(t)if(o)for(a=a||y(e),r=r||y(i),s=0;null!=(n=a[s]);s++)S(n,r[s]);else S(e,i);return r=y(i,"script"),r.length>0&&E(r,!g&&y(e,"script")),r=a=n=null,i},buildFragment:function(e,t,o,r){for(var n,i,s,a,g,d,u,l=e.length,c=f(t),h=[],p=0;l>p;p++)if(i=e[p],i||0===i)if("object"===it.type(i))it.merge(h,i.nodeType?[i]:i);else if(Gt.test(i)){for(a=a||c.appendChild(t.createElement("div")),g=(Kt.exec(i)||["",""])[1].toLowerCase(),u=zt[g]||zt._default,a.innerHTML=u[1]+i.replace(Ft,"<$1></$2>")+u[2],n=u[0];n--;)a=a.lastChild;if(!rt.leadingWhitespace&&Ut.test(i)&&h.push(t.createTextNode(Ut.exec(i)[0])),!rt.tbody)for(i="table"!==g||Vt.test(i)?"<table>"!==u[1]||Vt.test(i)?0:a:a.firstChild,n=i&&i.childNodes.length;n--;)it.nodeName(d=i.childNodes[n],"tbody")&&!d.childNodes.length&&i.removeChild(d);for(it.merge(h,a.childNodes),a.textContent="";a.firstChild;)a.removeChild(a.firstChild);a=c.lastChild}else h.push(t.createTextNode(i));for(a&&c.removeChild(a),rt.appendChecked||it.grep(y(h,"input"),b),p=0;i=h[p++];)if((!r||-1===it.inArray(i,r))&&(s=it.contains(i.ownerDocument,i),a=y(c.appendChild(i),"script"),s&&E(a),o))for(n=0;i=a[n++];)Qt.test(i.type||"")&&o.push(i);return a=null,c},cleanData:function(e,t){for(var o,r,n,i,s=0,a=it.expando,g=it.cache,d=rt.deleteExpando,u=it.event.special;null!=(o=e[s]);s++)if((t||it.acceptData(o))&&(n=o[a],i=n&&g[n])){if(i.events)for(r in i.events)u[r]?it.event.remove(o,r):it.removeEvent(o,r,i.handle);g[n]&&(delete g[n],d?delete o[a]:typeof o.removeAttribute!==wt?o.removeAttribute(a):o[a]=null,$.push(n))}}}),it.fn.extend({text:function(e){return qt(this,function(e){return void 0===e?it.text(this):this.empty().append((this[0]&&this[0].ownerDocument||ft).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=m(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=m(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var o,r=e?it.filter(e,this):this,n=0;null!=(o=r[n]);n++)t||1!==o.nodeType||it.cleanData(y(o)),o.parentNode&&(t&&it.contains(o.ownerDocument,o)&&E(y(o,"script")),o.parentNode.removeChild(o));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&it.cleanData(y(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&it.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return it.clone(this,e,t)})},html:function(e){return qt(this,function(e){var t=this[0]||{},o=0,r=this.length;if(void 0===e)return 1===t.nodeType?t.innerHTML.replace(Bt,""):void 0;if(!("string"!=typeof e||Wt.test(e)||!rt.htmlSerialize&&jt.test(e)||!rt.leadingWhitespace&&Ut.test(e)||zt[(Kt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(Ft,"<$1></$2>");try{for(;r>o;o++)t=this[o]||{},1===t.nodeType&&(it.cleanData(y(t,!1)),t.innerHTML=e);t=0}catch(n){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,it.cleanData(y(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=z.apply([],e);var o,r,n,i,s,a,g=0,d=this.length,u=this,l=d-1,c=e[0],h=it.isFunction(c);if(h||d>1&&"string"==typeof c&&!rt.checkClone&&Ht.test(c))return this.each(function(o){var r=u.eq(o);h&&(e[0]=c.call(this,o,r.html())),r.domManip(e,t)});if(d&&(a=it.buildFragment(e,this[0].ownerDocument,!1,this),o=a.firstChild,1===a.childNodes.length&&(a=o),o)){for(i=it.map(y(a,"script"),v),n=i.length;d>g;g++)r=a,g!==l&&(r=it.clone(r,!0,!0),n&&it.merge(i,y(r,"script"))),t.call(this[g],r,g);if(n)for(s=i[i.length-1].ownerDocument,it.map(i,_),g=0;n>g;g++)r=i[g],Qt.test(r.type||"")&&!it._data(r,"globalEval")&&it.contains(s,r)&&(r.src?it._evalUrl&&it._evalUrl(r.src):it.globalEval((r.text||r.textContent||r.innerHTML||"").replace(Yt,"")));a=o=null}return this}}),it.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){it.fn[e]=function(e){for(var o,r=0,n=[],i=it(e),s=i.length-1;s>=r;r++)o=r===s?this:this.clone(!0),it(i[r])[t](o),X.apply(n,o.get());return this.pushStack(n)}});var Zt,eo={};!function(){var e,t,o=ft.createElement("div"),r="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";o.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=o.getElementsByTagName("a")[0],e.style.cssText="float:left;opacity:.5",rt.opacity=/^0.5/.test(e.style.opacity),rt.cssFloat=!!e.style.cssFloat,o.style.backgroundClip="content-box",o.cloneNode(!0).style.backgroundClip="",rt.clearCloneStyle="content-box"===o.style.backgroundClip,e=o=null,rt.shrinkWrapBlocks=function(){var e,o,n,i;if(null==t){if(e=ft.getElementsByTagName("body")[0],!e)return;i="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",o=ft.createElement("div"),n=ft.createElement("div"),e.appendChild(o).appendChild(n),t=!1,typeof n.style.zoom!==wt&&(n.style.cssText=r+";width:1px;padding:1px;zoom:1",n.innerHTML="<div></div>",n.firstChild.style.width="5px",t=3!==n.offsetWidth),e.removeChild(o),e=o=n=null}return t}}();var to,oo,ro=/^margin/,no=new RegExp("^("+Nt+")(?!px)[a-z%]+$","i"),io=/^(top|right|bottom|left)$/;e.getComputedStyle?(to=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)},oo=function(e,t,o){var r,n,i,s,a=e.style;return o=o||to(e),s=o?o.getPropertyValue(t)||o[t]:void 0,o&&(""!==s||it.contains(e.ownerDocument,e)||(s=it.style(e,t)),no.test(s)&&ro.test(t)&&(r=a.width,n=a.minWidth,i=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=o.width,a.width=r,a.minWidth=n,a.maxWidth=i)),void 0===s?s:s+""}):ft.documentElement.currentStyle&&(to=function(e){return e.currentStyle},oo=function(e,t,o){var r,n,i,s,a=e.style;return o=o||to(e),s=o?o[t]:void 0,null==s&&a&&a[t]&&(s=a[t]),no.test(s)&&!io.test(t)&&(r=a.left,n=e.runtimeStyle,i=n&&n.left,i&&(n.left=e.currentStyle.left),a.left="fontSize"===t?"1em":s,s=a.pixelLeft+"px",a.left=r,i&&(n.left=i)),void 0===s?s:s+""||"auto"}),function(){function t(){var t,o,r=ft.getElementsByTagName("body")[0];r&&(t=ft.createElement("div"),o=ft.createElement("div"),t.style.cssText=d,r.appendChild(t).appendChild(o),o.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;display:block;padding:1px;border:1px;width:4px;margin-top:1%;top:1%",it.swap(r,null!=r.style.zoom?{zoom:1}:{},function(){n=4===o.offsetWidth}),i=!0,s=!1,a=!0,e.getComputedStyle&&(s="1%"!==(e.getComputedStyle(o,null)||{}).top,i="4px"===(e.getComputedStyle(o,null)||{width:"4px"}).width),r.removeChild(t),o=r=null)}var o,r,n,i,s,a,g=ft.createElement("div"),d="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",u="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";g.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",o=g.getElementsByTagName("a")[0],o.style.cssText="float:left;opacity:.5",rt.opacity=/^0.5/.test(o.style.opacity),rt.cssFloat=!!o.style.cssFloat,g.style.backgroundClip="content-box",g.cloneNode(!0).style.backgroundClip="",rt.clearCloneStyle="content-box"===g.style.backgroundClip,o=g=null,it.extend(rt,{reliableHiddenOffsets:function(){if(null!=r)return r;var e,t,o,n=ft.createElement("div"),i=ft.getElementsByTagName("body")[0];if(i)return n.setAttribute("className","t"),n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=ft.createElement("div"),e.style.cssText=d,i.appendChild(e).appendChild(n),n.innerHTML="<table><tr><td></td><td>t</td></tr></table>",t=n.getElementsByTagName("td"),t[0].style.cssText="padding:0;margin:0;border:0;display:none",o=0===t[0].offsetHeight,t[0].style.display="",t[1].style.display="none",r=o&&0===t[0].offsetHeight,i.removeChild(e),n=i=null,r},boxSizing:function(){return null==n&&t(),n},boxSizingReliable:function(){return null==i&&t(),i},pixelPosition:function(){return null==s&&t(),s},reliableMarginRight:function(){var t,o,r,n;if(null==a&&e.getComputedStyle){if(t=ft.getElementsByTagName("body")[0],!t)return;o=ft.createElement("div"),r=ft.createElement("div"),o.style.cssText=d,t.appendChild(o).appendChild(r),n=r.appendChild(ft.createElement("div")),n.style.cssText=r.style.cssText=u,n.style.marginRight=n.style.width="0",r.style.width="1px",a=!parseFloat((e.getComputedStyle(n,null)||{}).marginRight),t.removeChild(o)
}return a}})}(),it.swap=function(e,t,o,r){var n,i,s={};for(i in t)s[i]=e.style[i],e.style[i]=t[i];n=o.apply(e,r||[]);for(i in t)e.style[i]=s[i];return n};var so=/alpha\([^)]*\)/i,ao=/opacity\s*=\s*([^)]*)/,go=/^(none|table(?!-c[ea]).+)/,uo=new RegExp("^("+Nt+")(.*)$","i"),lo=new RegExp("^([+-])=("+Nt+")","i"),co={position:"absolute",visibility:"hidden",display:"block"},ho={letterSpacing:0,fontWeight:400},po=["Webkit","O","Moz","ms"];it.extend({cssHooks:{opacity:{get:function(e,t){if(t){var o=oo(e,"opacity");return""===o?"1":o}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":rt.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,o,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n,i,s,a=it.camelCase(t),g=e.style;if(t=it.cssProps[a]||(it.cssProps[a]=N(g,a)),s=it.cssHooks[t]||it.cssHooks[a],void 0===o)return s&&"get"in s&&void 0!==(n=s.get(e,!1,r))?n:g[t];if(i=typeof o,"string"===i&&(n=lo.exec(o))&&(o=(n[1]+1)*n[2]+parseFloat(it.css(e,t)),i="number"),null!=o&&o===o&&("number"!==i||it.cssNumber[a]||(o+="px"),rt.clearCloneStyle||""!==o||0!==t.indexOf("background")||(g[t]="inherit"),!(s&&"set"in s&&void 0===(o=s.set(e,o,r)))))try{g[t]="",g[t]=o}catch(d){}}},css:function(e,t,o,r){var n,i,s,a=it.camelCase(t);return t=it.cssProps[a]||(it.cssProps[a]=N(e.style,a)),s=it.cssHooks[t]||it.cssHooks[a],s&&"get"in s&&(i=s.get(e,!0,o)),void 0===i&&(i=oo(e,t,r)),"normal"===i&&t in ho&&(i=ho[t]),""===o||o?(n=parseFloat(i),o===!0||it.isNumeric(n)?n||0:i):i}}),it.each(["height","width"],function(e,t){it.cssHooks[t]={get:function(e,o,r){return o?0===e.offsetWidth&&go.test(it.css(e,"display"))?it.swap(e,co,function(){return C(e,t,r)}):C(e,t,r):void 0},set:function(e,o,r){var n=r&&to(e);return I(e,o,r?q(e,t,r,rt.boxSizing()&&"border-box"===it.css(e,"boxSizing",!1,n),n):0)}}}),rt.opacity||(it.cssHooks.opacity={get:function(e,t){return ao.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var o=e.style,r=e.currentStyle,n=it.isNumeric(t)?"alpha(opacity="+100*t+")":"",i=r&&r.filter||o.filter||"";o.zoom=1,(t>=1||""===t)&&""===it.trim(i.replace(so,""))&&o.removeAttribute&&(o.removeAttribute("filter"),""===t||r&&!r.filter)||(o.filter=so.test(i)?i.replace(so,n):i+" "+n)}}),it.cssHooks.marginRight=A(rt.reliableMarginRight,function(e,t){return t?it.swap(e,{display:"inline-block"},oo,[e,"marginRight"]):void 0}),it.each({margin:"",padding:"",border:"Width"},function(e,t){it.cssHooks[e+t]={expand:function(o){for(var r=0,n={},i="string"==typeof o?o.split(" "):[o];4>r;r++)n[e+Dt[r]+t]=i[r]||i[r-2]||i[0];return n}},ro.test(e)||(it.cssHooks[e+t].set=I)}),it.fn.extend({css:function(e,t){return qt(this,function(e,t,o){var r,n,i={},s=0;if(it.isArray(t)){for(r=to(e),n=t.length;n>s;s++)i[t[s]]=it.css(e,t[s],!1,r);return i}return void 0!==o?it.style(e,t,o):it.css(e,t)},e,t,arguments.length>1)},show:function(){return D(this,!0)},hide:function(){return D(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){It(this)?it(this).show():it(this).hide()})}}),it.Tween=R,R.prototype={constructor:R,init:function(e,t,o,r,n,i){this.elem=e,this.prop=o,this.easing=n||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=i||(it.cssNumber[o]?"":"px")},cur:function(){var e=R.propHooks[this.prop];return e&&e.get?e.get(this):R.propHooks._default.get(this)},run:function(e){var t,o=R.propHooks[this.prop];return this.pos=t=this.options.duration?it.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),o&&o.set?o.set(this):R.propHooks._default.set(this),this}},R.prototype.init.prototype=R.prototype,R.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=it.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){it.fx.step[e.prop]?it.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[it.cssProps[e.prop]]||it.cssHooks[e.prop])?it.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},R.propHooks.scrollTop=R.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},it.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},it.fx=R.prototype.init,it.fx.step={};var fo,yo,bo=/^(?:toggle|show|hide)$/,mo=new RegExp("^(?:([+-])=|)("+Nt+")([a-z%]*)$","i"),vo=/queueHooks$/,_o=[P],Eo={"*":[function(e,t){var o=this.createTween(e,t),r=o.cur(),n=mo.exec(t),i=n&&n[3]||(it.cssNumber[e]?"":"px"),s=(it.cssNumber[e]||"px"!==i&&+r)&&mo.exec(it.css(o.elem,e)),a=1,g=20;if(s&&s[3]!==i){i=i||s[3],n=n||[],s=+r||1;do a=a||".5",s/=a,it.style(o.elem,e,s+i);while(a!==(a=o.cur()/r)&&1!==a&&--g)}return n&&(s=o.start=+s||+r||0,o.unit=i,o.end=n[1]?s+(n[1]+1)*n[2]:+n[2]),o}]};it.Animation=it.extend(B,{tweener:function(e,t){it.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var o,r=0,n=e.length;n>r;r++)o=e[r],Eo[o]=Eo[o]||[],Eo[o].unshift(t)},prefilter:function(e,t){t?_o.unshift(e):_o.push(e)}}),it.speed=function(e,t,o){var r=e&&"object"==typeof e?it.extend({},e):{complete:o||!o&&t||it.isFunction(e)&&e,duration:e,easing:o&&t||t&&!it.isFunction(t)&&t};return r.duration=it.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in it.fx.speeds?it.fx.speeds[r.duration]:it.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){it.isFunction(r.old)&&r.old.call(this),r.queue&&it.dequeue(this,r.queue)},r},it.fn.extend({fadeTo:function(e,t,o,r){return this.filter(It).css("opacity",0).show().end().animate({opacity:t},e,o,r)},animate:function(e,t,o,r){var n=it.isEmptyObject(e),i=it.speed(t,o,r),s=function(){var t=B(this,it.extend({},e),i);(n||it._data(this,"finish"))&&t.stop(!0)};return s.finish=s,n||i.queue===!1?this.each(s):this.queue(i.queue,s)},stop:function(e,t,o){var r=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof e&&(o=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",i=it.timers,s=it._data(this);if(n)s[n]&&s[n].stop&&r(s[n]);else for(n in s)s[n]&&s[n].stop&&vo.test(n)&&r(s[n]);for(n=i.length;n--;)i[n].elem!==this||null!=e&&i[n].queue!==e||(i[n].anim.stop(o),t=!1,i.splice(n,1));(t||!o)&&it.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,o=it._data(this),r=o[e+"queue"],n=o[e+"queueHooks"],i=it.timers,s=r?r.length:0;for(o.finish=!0,it.queue(this,e,[]),n&&n.stop&&n.stop.call(this,!0),t=i.length;t--;)i[t].elem===this&&i[t].queue===e&&(i[t].anim.stop(!0),i.splice(t,1));for(t=0;s>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete o.finish})}}),it.each(["toggle","show","hide"],function(e,t){var o=it.fn[t];it.fn[t]=function(e,r,n){return null==e||"boolean"==typeof e?o.apply(this,arguments):this.animate(O(t,!0),e,r,n)}}),it.each({slideDown:O("show"),slideUp:O("hide"),slideToggle:O("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){it.fn[e]=function(e,o,r){return this.animate(t,e,o,r)}}),it.timers=[],it.fx.tick=function(){var e,t=it.timers,o=0;for(fo=it.now();o<t.length;o++)e=t[o],e()||t[o]!==e||t.splice(o--,1);t.length||it.fx.stop(),fo=void 0},it.fx.timer=function(e){it.timers.push(e),e()?it.fx.start():it.timers.pop()},it.fx.interval=13,it.fx.start=function(){yo||(yo=setInterval(it.fx.tick,it.fx.interval))},it.fx.stop=function(){clearInterval(yo),yo=null},it.fx.speeds={slow:600,fast:200,_default:400},it.fn.delay=function(e,t){return e=it.fx?it.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,o){var r=setTimeout(t,e);o.stop=function(){clearTimeout(r)}})},function(){var e,t,o,r,n=ft.createElement("div");n.setAttribute("className","t"),n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=n.getElementsByTagName("a")[0],o=ft.createElement("select"),r=o.appendChild(ft.createElement("option")),t=n.getElementsByTagName("input")[0],e.style.cssText="top:1px",rt.getSetAttribute="t"!==n.className,rt.style=/top/.test(e.getAttribute("style")),rt.hrefNormalized="/a"===e.getAttribute("href"),rt.checkOn=!!t.value,rt.optSelected=r.selected,rt.enctype=!!ft.createElement("form").enctype,o.disabled=!0,rt.optDisabled=!r.disabled,t=ft.createElement("input"),t.setAttribute("value",""),rt.input=""===t.getAttribute("value"),t.value="t",t.setAttribute("type","radio"),rt.radioValue="t"===t.value,e=t=o=r=n=null}();var So=/\r/g;it.fn.extend({val:function(e){var t,o,r,n=this[0];{if(arguments.length)return r=it.isFunction(e),this.each(function(o){var n;1===this.nodeType&&(n=r?e.call(this,o,it(this).val()):e,null==n?n="":"number"==typeof n?n+="":it.isArray(n)&&(n=it.map(n,function(e){return null==e?"":e+""})),t=it.valHooks[this.type]||it.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,n,"value")||(this.value=n))});if(n)return t=it.valHooks[n.type]||it.valHooks[n.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(o=t.get(n,"value"))?o:(o=n.value,"string"==typeof o?o.replace(So,""):null==o?"":o)}}}),it.extend({valHooks:{option:{get:function(e){var t=it.find.attr(e,"value");return null!=t?t:it.text(e)}},select:{get:function(e){for(var t,o,r=e.options,n=e.selectedIndex,i="select-one"===e.type||0>n,s=i?null:[],a=i?n+1:r.length,g=0>n?a:i?n:0;a>g;g++)if(o=r[g],!(!o.selected&&g!==n||(rt.optDisabled?o.disabled:null!==o.getAttribute("disabled"))||o.parentNode.disabled&&it.nodeName(o.parentNode,"optgroup"))){if(t=it(o).val(),i)return t;s.push(t)}return s},set:function(e,t){for(var o,r,n=e.options,i=it.makeArray(t),s=n.length;s--;)if(r=n[s],it.inArray(it.valHooks.option.get(r),i)>=0)try{r.selected=o=!0}catch(a){r.scrollHeight}else r.selected=!1;return o||(e.selectedIndex=-1),n}}}}),it.each(["radio","checkbox"],function(){it.valHooks[this]={set:function(e,t){return it.isArray(t)?e.checked=it.inArray(it(e).val(),t)>=0:void 0}},rt.checkOn||(it.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var xo,wo,To=it.expr.attrHandle,Ao=/^(?:checked|selected)$/i,No=rt.getSetAttribute,Do=rt.input;it.fn.extend({attr:function(e,t){return qt(this,it.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){it.removeAttr(this,e)})}}),it.extend({attr:function(e,t,o){var r,n,i=e.nodeType;if(e&&3!==i&&8!==i&&2!==i)return typeof e.getAttribute===wt?it.prop(e,t,o):(1===i&&it.isXMLDoc(e)||(t=t.toLowerCase(),r=it.attrHooks[t]||(it.expr.match.bool.test(t)?wo:xo)),void 0===o?r&&"get"in r&&null!==(n=r.get(e,t))?n:(n=it.find.attr(e,t),null==n?void 0:n):null!==o?r&&"set"in r&&void 0!==(n=r.set(e,o,t))?n:(e.setAttribute(t,o+""),o):(it.removeAttr(e,t),void 0))},removeAttr:function(e,t){var o,r,n=0,i=t&&t.match(_t);if(i&&1===e.nodeType)for(;o=i[n++];)r=it.propFix[o]||o,it.expr.match.bool.test(o)?Do&&No||!Ao.test(o)?e[r]=!1:e[it.camelCase("default-"+o)]=e[r]=!1:it.attr(e,o,""),e.removeAttribute(No?o:r)},attrHooks:{type:{set:function(e,t){if(!rt.radioValue&&"radio"===t&&it.nodeName(e,"input")){var o=e.value;return e.setAttribute("type",t),o&&(e.value=o),t}}}}}),wo={set:function(e,t,o){return t===!1?it.removeAttr(e,o):Do&&No||!Ao.test(o)?e.setAttribute(!No&&it.propFix[o]||o,o):e[it.camelCase("default-"+o)]=e[o]=!0,o}},it.each(it.expr.match.bool.source.match(/\w+/g),function(e,t){var o=To[t]||it.find.attr;To[t]=Do&&No||!Ao.test(t)?function(e,t,r){var n,i;return r||(i=To[t],To[t]=n,n=null!=o(e,t,r)?t.toLowerCase():null,To[t]=i),n}:function(e,t,o){return o?void 0:e[it.camelCase("default-"+t)]?t.toLowerCase():null}}),Do&&No||(it.attrHooks.value={set:function(e,t,o){return it.nodeName(e,"input")?(e.defaultValue=t,void 0):xo&&xo.set(e,t,o)}}),No||(xo={set:function(e,t,o){var r=e.getAttributeNode(o);return r||e.setAttributeNode(r=e.ownerDocument.createAttribute(o)),r.value=t+="","value"===o||t===e.getAttribute(o)?t:void 0}},To.id=To.name=To.coords=function(e,t,o){var r;return o?void 0:(r=e.getAttributeNode(t))&&""!==r.value?r.value:null},it.valHooks.button={get:function(e,t){var o=e.getAttributeNode(t);return o&&o.specified?o.value:void 0},set:xo.set},it.attrHooks.contenteditable={set:function(e,t,o){xo.set(e,""===t?!1:t,o)}},it.each(["width","height"],function(e,t){it.attrHooks[t]={set:function(e,o){return""===o?(e.setAttribute(t,"auto"),o):void 0}}})),rt.style||(it.attrHooks.style={get:function(e){return e.style.cssText||void 0},set:function(e,t){return e.style.cssText=t+""}});var Io=/^(?:input|select|textarea|button|object)$/i,qo=/^(?:a|area)$/i;it.fn.extend({prop:function(e,t){return qt(this,it.prop,e,t,arguments.length>1)},removeProp:function(e){return e=it.propFix[e]||e,this.each(function(){try{this[e]=void 0,delete this[e]}catch(t){}})}}),it.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,o){var r,n,i,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return i=1!==s||!it.isXMLDoc(e),i&&(t=it.propFix[t]||t,n=it.propHooks[t]),void 0!==o?n&&"set"in n&&void 0!==(r=n.set(e,o,t))?r:e[t]=o:n&&"get"in n&&null!==(r=n.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=it.find.attr(e,"tabindex");return t?parseInt(t,10):Io.test(e.nodeName)||qo.test(e.nodeName)&&e.href?0:-1}}}}),rt.hrefNormalized||it.each(["href","src"],function(e,t){it.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),rt.optSelected||(it.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),it.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){it.propFix[this.toLowerCase()]=this}),rt.enctype||(it.propFix.enctype="encoding");var Co=/[\t\r\n\f]/g;it.fn.extend({addClass:function(e){var t,o,r,n,i,s,a=0,g=this.length,d="string"==typeof e&&e;if(it.isFunction(e))return this.each(function(t){it(this).addClass(e.call(this,t,this.className))});if(d)for(t=(e||"").match(_t)||[];g>a;a++)if(o=this[a],r=1===o.nodeType&&(o.className?(" "+o.className+" ").replace(Co," "):" ")){for(i=0;n=t[i++];)r.indexOf(" "+n+" ")<0&&(r+=n+" ");s=it.trim(r),o.className!==s&&(o.className=s)}return this},removeClass:function(e){var t,o,r,n,i,s,a=0,g=this.length,d=0===arguments.length||"string"==typeof e&&e;if(it.isFunction(e))return this.each(function(t){it(this).removeClass(e.call(this,t,this.className))});if(d)for(t=(e||"").match(_t)||[];g>a;a++)if(o=this[a],r=1===o.nodeType&&(o.className?(" "+o.className+" ").replace(Co," "):"")){for(i=0;n=t[i++];)for(;r.indexOf(" "+n+" ")>=0;)r=r.replace(" "+n+" "," ");s=e?it.trim(r):"",o.className!==s&&(o.className=s)}return this},toggleClass:function(e,t){var o=typeof e;return"boolean"==typeof t&&"string"===o?t?this.addClass(e):this.removeClass(e):it.isFunction(e)?this.each(function(o){it(this).toggleClass(e.call(this,o,this.className,t),t)}):this.each(function(){if("string"===o)for(var t,r=0,n=it(this),i=e.match(_t)||[];t=i[r++];)n.hasClass(t)?n.removeClass(t):n.addClass(t);else(o===wt||"boolean"===o)&&(this.className&&it._data(this,"__className__",this.className),this.className=this.className||e===!1?"":it._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",o=0,r=this.length;r>o;o++)if(1===this[o].nodeType&&(" "+this[o].className+" ").replace(Co," ").indexOf(t)>=0)return!0;return!1}}),it.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){it.fn[t]=function(e,o){return arguments.length>0?this.on(t,null,e,o):this.trigger(t)}}),it.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,o){return this.on(e,null,t,o)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,o,r){return this.on(t,e,o,r)},undelegate:function(e,t,o){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",o)}});var Ro=it.now(),Lo=/\?/,Oo=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;it.parseJSON=function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t+"");var o,r=null,n=it.trim(t+"");return n&&!it.trim(n.replace(Oo,function(e,t,n,i){return o&&t&&(r=0),0===r?e:(o=n||t,r+=!i-!n,"")}))?Function("return "+n)():it.error("Invalid JSON: "+t)},it.parseXML=function(t){var o,r;if(!t||"string"!=typeof t)return null;try{e.DOMParser?(r=new DOMParser,o=r.parseFromString(t,"text/xml")):(o=new ActiveXObject("Microsoft.XMLDOM"),o.async="false",o.loadXML(t))}catch(n){o=void 0}return o&&o.documentElement&&!o.getElementsByTagName("parsererror").length||it.error("Invalid XML: "+t),o};var ko,Po,Mo=/#.*$/,Bo=/([?&])_=[^&]*/,jo=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Uo=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Fo=/^(?:GET|HEAD)$/,Ko=/^\/\//,Vo=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Go={},Wo={},Ho="*/".concat("*");try{Po=location.href}catch(Qo){Po=ft.createElement("a"),Po.href="",Po=Po.href}ko=Vo.exec(Po.toLowerCase())||[],it.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Po,type:"GET",isLocal:Uo.test(ko[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ho,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":it.parseJSON,"text xml":it.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?F(F(e,it.ajaxSettings),t):F(it.ajaxSettings,e)},ajaxPrefilter:j(Go),ajaxTransport:j(Wo),ajax:function(e,t){function o(e,t,o,r){var n,u,b,m,_,S=t;2!==v&&(v=2,a&&clearTimeout(a),d=void 0,s=r||"",E.readyState=e>0?4:0,n=e>=200&&300>e||304===e,o&&(m=K(l,E,o)),m=V(l,m,E,n),n?(l.ifModified&&(_=E.getResponseHeader("Last-Modified"),_&&(it.lastModified[i]=_),_=E.getResponseHeader("etag"),_&&(it.etag[i]=_)),204===e||"HEAD"===l.type?S="nocontent":304===e?S="notmodified":(S=m.state,u=m.data,b=m.error,n=!b)):(b=S,(e||!S)&&(S="error",0>e&&(e=0))),E.status=e,E.statusText=(t||S)+"",n?p.resolveWith(c,[u,S,E]):p.rejectWith(c,[E,S,b]),E.statusCode(y),y=void 0,g&&h.trigger(n?"ajaxSuccess":"ajaxError",[E,l,n?u:b]),f.fireWith(c,[E,S]),g&&(h.trigger("ajaxComplete",[E,l]),--it.active||it.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,n,i,s,a,g,d,u,l=it.ajaxSetup({},t),c=l.context||l,h=l.context&&(c.nodeType||c.jquery)?it(c):it.event,p=it.Deferred(),f=it.Callbacks("once memory"),y=l.statusCode||{},b={},m={},v=0,_="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(2===v){if(!u)for(u={};t=jo.exec(s);)u[t[1].toLowerCase()]=t[2];t=u[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===v?s:null},setRequestHeader:function(e,t){var o=e.toLowerCase();return v||(e=m[o]=m[o]||e,b[e]=t),this},overrideMimeType:function(e){return v||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>v)for(t in e)y[t]=[y[t],e[t]];else E.always(e[E.status]);return this},abort:function(e){var t=e||_;return d&&d.abort(t),o(0,t),this}};if(p.promise(E).complete=f.add,E.success=E.done,E.error=E.fail,l.url=((e||l.url||Po)+"").replace(Mo,"").replace(Ko,ko[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=it.trim(l.dataType||"*").toLowerCase().match(_t)||[""],null==l.crossDomain&&(r=Vo.exec(l.url.toLowerCase()),l.crossDomain=!(!r||r[1]===ko[1]&&r[2]===ko[2]&&(r[3]||("http:"===r[1]?"80":"443"))===(ko[3]||("http:"===ko[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=it.param(l.data,l.traditional)),U(Go,l,t,E),2===v)return E;g=l.global,g&&0===it.active++&&it.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!Fo.test(l.type),i=l.url,l.hasContent||(l.data&&(i=l.url+=(Lo.test(i)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=Bo.test(i)?i.replace(Bo,"$1_="+Ro++):i+(Lo.test(i)?"&":"?")+"_="+Ro++)),l.ifModified&&(it.lastModified[i]&&E.setRequestHeader("If-Modified-Since",it.lastModified[i]),it.etag[i]&&E.setRequestHeader("If-None-Match",it.etag[i])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&E.setRequestHeader("Content-Type",l.contentType),E.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+Ho+"; q=0.01":""):l.accepts["*"]);for(n in l.headers)E.setRequestHeader(n,l.headers[n]);if(l.beforeSend&&(l.beforeSend.call(c,E,l)===!1||2===v))return E.abort();_="abort";for(n in{success:1,error:1,complete:1})E[n](l[n]);if(d=U(Wo,l,t,E)){E.readyState=1,g&&h.trigger("ajaxSend",[E,l]),l.async&&l.timeout>0&&(a=setTimeout(function(){E.abort("timeout")},l.timeout));try{v=1,d.send(b,o)}catch(S){if(!(2>v))throw S;o(-1,S)}}else o(-1,"No Transport");return E},getJSON:function(e,t,o){return it.get(e,t,o,"json")},getScript:function(e,t){return it.get(e,void 0,t,"script")}}),it.each(["get","post"],function(e,t){it[t]=function(e,o,r,n){return it.isFunction(o)&&(n=n||r,r=o,o=void 0),it.ajax({url:e,type:t,dataType:n,data:o,success:r})}}),it.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){it.fn[t]=function(e){return this.on(t,e)}}),it._evalUrl=function(e){return it.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},it.fn.extend({wrapAll:function(e){if(it.isFunction(e))return this.each(function(t){it(this).wrapAll(e.call(this,t))});if(this[0]){var t=it(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return it.isFunction(e)?this.each(function(t){it(this).wrapInner(e.call(this,t))}):this.each(function(){var t=it(this),o=t.contents();o.length?o.wrapAll(e):t.append(e)})},wrap:function(e){var t=it.isFunction(e);return this.each(function(o){it(this).wrapAll(t?e.call(this,o):e)})},unwrap:function(){return this.parent().each(function(){it.nodeName(this,"body")||it(this).replaceWith(this.childNodes)}).end()}}),it.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!rt.reliableHiddenOffsets()&&"none"===(e.style&&e.style.display||it.css(e,"display"))},it.expr.filters.visible=function(e){return!it.expr.filters.hidden(e)};var $o=/%20/g,Yo=/\[\]$/,zo=/\r?\n/g,Xo=/^(?:submit|button|image|reset|file)$/i,Jo=/^(?:input|select|textarea|keygen)/i;it.param=function(e,t){var o,r=[],n=function(e,t){t=it.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=it.ajaxSettings&&it.ajaxSettings.traditional),it.isArray(e)||e.jquery&&!it.isPlainObject(e))it.each(e,function(){n(this.name,this.value)});else for(o in e)G(o,e[o],t,n);return r.join("&").replace($o,"+")},it.fn.extend({serialize:function(){return it.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=it.prop(this,"elements");return e?it.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!it(this).is(":disabled")&&Jo.test(this.nodeName)&&!Xo.test(e)&&(this.checked||!Ct.test(e))}).map(function(e,t){var o=it(this).val();return null==o?null:it.isArray(o)?it.map(o,function(e){return{name:t.name,value:e.replace(zo,"\r\n")}}):{name:t.name,value:o.replace(zo,"\r\n")}}).get()}}),it.ajaxSettings.xhr=void 0!==e.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&W()||H()}:W;var Zo=0,er={},tr=it.ajaxSettings.xhr();e.ActiveXObject&&it(e).on("unload",function(){for(var e in er)er[e](void 0,!0)}),rt.cors=!!tr&&"withCredentials"in tr,tr=rt.ajax=!!tr,tr&&it.ajaxTransport(function(e){if(!e.crossDomain||rt.cors){var t;return{send:function(o,r){var n,i=e.xhr(),s=++Zo;if(i.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(n in e.xhrFields)i[n]=e.xhrFields[n];e.mimeType&&i.overrideMimeType&&i.overrideMimeType(e.mimeType),e.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest");for(n in o)void 0!==o[n]&&i.setRequestHeader(n,o[n]+"");i.send(e.hasContent&&e.data||null),t=function(o,n){var a,g,d;if(t&&(n||4===i.readyState))if(delete er[s],t=void 0,i.onreadystatechange=it.noop,n)4!==i.readyState&&i.abort();else{d={},a=i.status,"string"==typeof i.responseText&&(d.text=i.responseText);try{g=i.statusText}catch(u){g=""}a||!e.isLocal||e.crossDomain?1223===a&&(a=204):a=d.text?200:404}d&&r(a,g,d,i.getAllResponseHeaders())},e.async?4===i.readyState?setTimeout(t):i.onreadystatechange=er[s]=t:t()},abort:function(){t&&t(void 0,!0)}}}}),it.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return it.globalEval(e),e}}}),it.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),it.ajaxTransport("script",function(e){if(e.crossDomain){var t,o=ft.head||it("head")[0]||ft.documentElement;return{send:function(r,n){t=ft.createElement("script"),t.async=!0,e.scriptCharset&&(t.charset=e.scriptCharset),t.src=e.url,t.onload=t.onreadystatechange=function(e,o){(o||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,o||n(200,"success"))},o.insertBefore(t,o.firstChild)},abort:function(){t&&t.onload(void 0,!0)}}}});var or=[],rr=/(=)\?(?=&|$)|\?\?/;it.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=or.pop()||it.expando+"_"+Ro++;return this[e]=!0,e}}),it.ajaxPrefilter("json jsonp",function(t,o,r){var n,i,s,a=t.jsonp!==!1&&(rr.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&rr.test(t.data)&&"data");return a||"jsonp"===t.dataTypes[0]?(n=t.jsonpCallback=it.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(rr,"$1"+n):t.jsonp!==!1&&(t.url+=(Lo.test(t.url)?"&":"?")+t.jsonp+"="+n),t.converters["script json"]=function(){return s||it.error(n+" was not called"),s[0]},t.dataTypes[0]="json",i=e[n],e[n]=function(){s=arguments},r.always(function(){e[n]=i,t[n]&&(t.jsonpCallback=o.jsonpCallback,or.push(n)),s&&it.isFunction(i)&&i(s[0]),s=i=void 0}),"script"):void 0}),it.parseHTML=function(e,t,o){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(o=t,t=!1),t=t||ft;var r=ct.exec(e),n=!o&&[];return r?[t.createElement(r[1])]:(r=it.buildFragment([e],t,n),n&&n.length&&it(n).remove(),it.merge([],r.childNodes))};var nr=it.fn.load;it.fn.load=function(e,t,o){if("string"!=typeof e&&nr)return nr.apply(this,arguments);var r,n,i,s=this,a=e.indexOf(" ");return a>=0&&(r=e.slice(a,e.length),e=e.slice(0,a)),it.isFunction(t)?(o=t,t=void 0):t&&"object"==typeof t&&(i="POST"),s.length>0&&it.ajax({url:e,type:i,dataType:"html",data:t}).done(function(e){n=arguments,s.html(r?it("<div>").append(it.parseHTML(e)).find(r):e)}).complete(o&&function(e,t){s.each(o,n||[e.responseText,t,e])}),this},it.expr.filters.animated=function(e){return it.grep(it.timers,function(t){return e===t.elem}).length};var ir=e.document.documentElement;it.offset={setOffset:function(e,t,o){var r,n,i,s,a,g,d,u=it.css(e,"position"),l=it(e),c={};"static"===u&&(e.style.position="relative"),a=l.offset(),i=it.css(e,"top"),g=it.css(e,"left"),d=("absolute"===u||"fixed"===u)&&it.inArray("auto",[i,g])>-1,d?(r=l.position(),s=r.top,n=r.left):(s=parseFloat(i)||0,n=parseFloat(g)||0),it.isFunction(t)&&(t=t.call(e,o,a)),null!=t.top&&(c.top=t.top-a.top+s),null!=t.left&&(c.left=t.left-a.left+n),"using"in t?t.using.call(e,c):l.css(c)}},it.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){it.offset.setOffset(this,e,t)});var t,o,r={top:0,left:0},n=this[0],i=n&&n.ownerDocument;if(i)return t=i.documentElement,it.contains(t,n)?(typeof n.getBoundingClientRect!==wt&&(r=n.getBoundingClientRect()),o=Q(i),{top:r.top+(o.pageYOffset||t.scrollTop)-(t.clientTop||0),left:r.left+(o.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):r},position:function(){if(this[0]){var e,t,o={top:0,left:0},r=this[0];return"fixed"===it.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),it.nodeName(e[0],"html")||(o=e.offset()),o.top+=it.css(e[0],"borderTopWidth",!0),o.left+=it.css(e[0],"borderLeftWidth",!0)),{top:t.top-o.top-it.css(r,"marginTop",!0),left:t.left-o.left-it.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||ir;e&&!it.nodeName(e,"html")&&"static"===it.css(e,"position");)e=e.offsetParent;return e||ir})}}),it.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var o=/Y/.test(t);it.fn[e]=function(r){return qt(this,function(e,r,n){var i=Q(e);return void 0===n?i?t in i?i[t]:i.document.documentElement[r]:e[r]:(i?i.scrollTo(o?it(i).scrollLeft():n,o?n:it(i).scrollTop()):e[r]=n,void 0)},e,r,arguments.length,null)}}),it.each(["top","left"],function(e,t){it.cssHooks[t]=A(rt.pixelPosition,function(e,o){return o?(o=oo(e,t),no.test(o)?it(e).position()[t]+"px":o):void 0})}),it.each({Height:"height",Width:"width"},function(e,t){it.each({padding:"inner"+e,content:t,"":"outer"+e},function(o,r){it.fn[r]=function(r,n){var i=arguments.length&&(o||"boolean"!=typeof r),s=o||(r===!0||n===!0?"margin":"border");return qt(this,function(t,o,r){var n;return it.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(n=t.documentElement,Math.max(t.body["scroll"+e],n["scroll"+e],t.body["offset"+e],n["offset"+e],n["client"+e])):void 0===r?it.css(t,o,s):it.style(t,o,r,s)},t,i?r:void 0,i,null)}})}),it.fn.size=function(){return this.length},it.fn.andSelf=it.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return it});var sr=e.jQuery,ar=e.$;return it.noConflict=function(t){return e.$===it&&(e.$=ar),t&&e.jQuery===it&&(e.jQuery=sr),it},typeof t===wt&&(e.jQuery=e.$=it),it}),+function(e){"use strict";var t=function(o,r){this.options=e.extend({},t.DEFAULTS,r),this.$window=e(window).on("scroll.bs.affix.data-api",e.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",e.proxy(this.checkPositionWithEventLoop,this)),this.$element=e(o),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};t.RESET="affix affix-top affix-bottom",t.DEFAULTS={offset:0},t.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(t.RESET).addClass("affix");var e=this.$window.scrollTop(),o=this.$element.offset();return this.pinnedOffset=o.top-e},t.prototype.checkPositionWithEventLoop=function(){setTimeout(e.proxy(this.checkPosition,this),1)},t.prototype.checkPosition=function(){if(this.$element.is(":visible")){var o=e(document).height(),r=this.$window.scrollTop(),n=this.$element.offset(),i=this.options.offset,s=i.top,a=i.bottom;"top"==this.affixed&&(n.top+=r),"object"!=typeof i&&(a=s=i),"function"==typeof s&&(s=i.top(this.$element)),"function"==typeof a&&(a=i.bottom(this.$element));var g=null!=this.unpin&&r+this.unpin<=n.top?!1:null!=a&&n.top+this.$element.height()>=o-a?"bottom":null!=s&&s>=r?"top":!1;if(this.affixed!==g){this.unpin&&this.$element.css("top","");var d="affix"+(g?"-"+g:""),u=e.Event(d+".bs.affix");this.$element.trigger(u),u.isDefaultPrevented()||(this.affixed=g,this.unpin="bottom"==g?this.getPinnedOffset():null,this.$element.removeClass(t.RESET).addClass(d).trigger(e.Event(d.replace("affix","affixed"))),"bottom"==g&&this.$element.offset({top:o-a-this.$element.height()}))}}};var o=e.fn.affix;e.fn.affix=function(o){return this.each(function(){var r=e(this),n=r.data("bs.affix"),i="object"==typeof o&&o;n||r.data("bs.affix",n=new t(this,i)),"string"==typeof o&&n[o]()})},e.fn.affix.Constructor=t,e.fn.affix.noConflict=function(){return e.fn.affix=o,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),o=t.data();o.offset=o.offset||{},o.offsetBottom&&(o.offset.bottom=o.offsetBottom),o.offsetTop&&(o.offset.top=o.offsetTop),t.affix(o)})})}(jQuery),+function(e){"use strict";var t='[data-dismiss="alert"]',o=function(o){e(o).on("click",t,this.close)};o.prototype.close=function(t){function o(){i.trigger("closed.bs.alert").remove()}var r=e(this),n=r.attr("data-target");n||(n=r.attr("href"),n=n&&n.replace(/.*(?=#[^\s]*$)/,""));var i=e(n);t&&t.preventDefault(),i.length||(i=r.hasClass("alert")?r:r.parent()),i.trigger(t=e.Event("close.bs.alert")),t.isDefaultPrevented()||(i.removeClass("in"),e.support.transition&&i.hasClass("fade")?i.one(e.support.transition.end,o).emulateTransitionEnd(150):o())
};var r=e.fn.alert;e.fn.alert=function(t){return this.each(function(){var r=e(this),n=r.data("bs.alert");n||r.data("bs.alert",n=new o(this)),"string"==typeof t&&n[t].call(r)})},e.fn.alert.Constructor=o,e.fn.alert.noConflict=function(){return e.fn.alert=r,this},e(document).on("click.bs.alert.data-api",t,o.prototype.close)}(jQuery),+function(e){"use strict";var t=function(o,r){this.$element=e(o),this.options=e.extend({},t.DEFAULTS,r),this.isLoading=!1};t.DEFAULTS={loadingText:"loading..."},t.prototype.setState=function(t){var o="disabled",r=this.$element,n=r.is("input")?"val":"html",i=r.data();t+="Text",i.resetText||r.data("resetText",r[n]()),r[n](i[t]||this.options[t]),setTimeout(e.proxy(function(){"loadingText"==t?(this.isLoading=!0,r.addClass(o).attr(o,o)):this.isLoading&&(this.isLoading=!1,r.removeClass(o).removeAttr(o))},this),0)},t.prototype.toggle=function(){var e=!0,t=this.$element.closest('[data-toggle="buttons"]');if(t.length){var o=this.$element.find("input");"radio"==o.prop("type")&&(o.prop("checked")&&this.$element.hasClass("active")?e=!1:t.find(".active").removeClass("active")),e&&o.prop("checked",!this.$element.hasClass("active")).trigger("change")}e&&this.$element.toggleClass("active")};var o=e.fn.button;e.fn.button=function(o){return this.each(function(){var r=e(this),n=r.data("bs.button"),i="object"==typeof o&&o;n||r.data("bs.button",n=new t(this,i)),"toggle"==o?n.toggle():o&&n.setState(o)})},e.fn.button.Constructor=t,e.fn.button.noConflict=function(){return e.fn.button=o,this},e(document).on("click.bs.button.data-api","[data-toggle^=button]",function(t){var o=e(t.target);o.hasClass("btn")||(o=o.closest(".btn")),o.button("toggle"),t.preventDefault()})}(jQuery),+function(e){"use strict";var t=function(t,o){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=o,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},t.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},t.prototype.getActiveIndex=function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},t.prototype.to=function(t){var o=this,r=this.getActiveIndex();return t>this.$items.length-1||0>t?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){o.to(t)}):r==t?this.pause().cycle():this.slide(t>r?"next":"prev",e(this.$items[t]))},t.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},t.prototype.next=function(){return this.sliding?void 0:this.slide("next")},t.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},t.prototype.slide=function(t,o){var r=this.$element.find(".item.active"),n=o||r[t](),i=this.interval,s="next"==t?"left":"right",a="next"==t?"first":"last",g=this;if(!n.length){if(!this.options.wrap)return;n=this.$element.find(".item")[a]()}if(n.hasClass("active"))return this.sliding=!1;var d=e.Event("slide.bs.carousel",{relatedTarget:n[0],direction:s});return this.$element.trigger(d),d.isDefaultPrevented()?void 0:(this.sliding=!0,i&&this.pause(),this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid.bs.carousel",function(){var t=e(g.$indicators.children()[g.getActiveIndex()]);t&&t.addClass("active")})),e.support.transition&&this.$element.hasClass("slide")?(n.addClass(t),n[0].offsetWidth,r.addClass(s),n.addClass(s),r.one(e.support.transition.end,function(){n.removeClass([t,s].join(" ")).addClass("active"),r.removeClass(["active",s].join(" ")),g.sliding=!1,setTimeout(function(){g.$element.trigger("slid.bs.carousel")},0)}).emulateTransitionEnd(1e3*r.css("transition-duration").slice(0,-1))):(r.removeClass("active"),n.addClass("active"),this.sliding=!1,this.$element.trigger("slid.bs.carousel")),i&&this.cycle(),this)};var o=e.fn.carousel;e.fn.carousel=function(o){return this.each(function(){var r=e(this),n=r.data("bs.carousel"),i=e.extend({},t.DEFAULTS,r.data(),"object"==typeof o&&o),s="string"==typeof o?o:i.slide;n||r.data("bs.carousel",n=new t(this,i)),"number"==typeof o?n.to(o):s?n[s]():i.interval&&n.pause().cycle()})},e.fn.carousel.Constructor=t,e.fn.carousel.noConflict=function(){return e.fn.carousel=o,this},e(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(t){var o,r=e(this),n=e(r.attr("data-target")||(o=r.attr("href"))&&o.replace(/.*(?=#[^\s]+$)/,"")),i=e.extend({},n.data(),r.data()),s=r.attr("data-slide-to");s&&(i.interval=!1),n.carousel(i),(s=r.attr("data-slide-to"))&&n.data("bs.carousel").to(s),t.preventDefault()}),e(window).on("load",function(){e('[data-ride="carousel"]').each(function(){var t=e(this);t.carousel(t.data())})})}(jQuery),+function(e){"use strict";var t=function(o,r){this.$element=e(o),this.options=e.extend({},t.DEFAULTS,r),this.transitioning=null,this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.DEFAULTS={toggle:!0},t.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},t.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var t=e.Event("show.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var o=this.$parent&&this.$parent.find("> .panel > .in");if(o&&o.length){var r=o.data("bs.collapse");if(r&&r.transitioning)return;o.collapse("hide"),r||o.data("bs.collapse",null)}var n=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[n](0),this.transitioning=1;var i=function(){this.$element.removeClass("collapsing").addClass("collapse in")[n]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return i.call(this);var s=e.camelCase(["scroll",n].join("-"));this.$element.one(e.support.transition.end,e.proxy(i,this)).emulateTransitionEnd(350)[n](this.$element[0][s])}}},t.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=e.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var o=this.dimension();this.$element[o](this.$element[o]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var r=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return e.support.transition?(this.$element[o](0).one(e.support.transition.end,e.proxy(r,this)).emulateTransitionEnd(350),void 0):r.call(this)}}},t.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var o=e.fn.collapse;e.fn.collapse=function(o){return this.each(function(){var r=e(this),n=r.data("bs.collapse"),i=e.extend({},t.DEFAULTS,r.data(),"object"==typeof o&&o);!n&&i.toggle&&"show"==o&&(o=!o),n||r.data("bs.collapse",n=new t(this,i)),"string"==typeof o&&n[o]()})},e.fn.collapse.Constructor=t,e.fn.collapse.noConflict=function(){return e.fn.collapse=o,this},e(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(t){var o,r=e(this),n=r.attr("data-target")||t.preventDefault()||(o=r.attr("href"))&&o.replace(/.*(?=#[^\s]+$)/,""),i=e(n),s=i.data("bs.collapse"),a=s?"toggle":r.data(),g=r.attr("data-parent"),d=g&&e(g);s&&s.transitioning||(d&&d.find('[data-toggle=collapse][data-parent="'+g+'"]').not(r).addClass("collapsed"),r[i.hasClass("in")?"addClass":"removeClass"]("collapsed")),i.collapse(a)})}(jQuery),+function(e){"use strict";function t(t){e(r).remove(),e(n).each(function(){var r=o(e(this)),n={relatedTarget:this};r.hasClass("open")&&(r.trigger(t=e.Event("hide.bs.dropdown",n)),t.isDefaultPrevented()||r.removeClass("open").trigger("hidden.bs.dropdown",n))})}function o(t){var o=t.attr("data-target");o||(o=t.attr("href"),o=o&&/#[A-Za-z]/.test(o)&&o.replace(/.*(?=#[^\s]*$)/,""));var r=o&&e(o);return r&&r.length?r:t.parent()}var r=".dropdown-backdrop",n="[data-toggle=dropdown]",i=function(t){e(t).on("click.bs.dropdown",this.toggle)};i.prototype.toggle=function(r){var n=e(this);if(!n.is(".disabled, :disabled")){var i=o(n),s=i.hasClass("open");if(t(),!s){"ontouchstart"in document.documentElement&&!i.closest(".navbar-nav").length&&e('<div class="dropdown-backdrop"/>').insertAfter(e(this)).on("click",t);var a={relatedTarget:this};if(i.trigger(r=e.Event("show.bs.dropdown",a)),r.isDefaultPrevented())return;i.toggleClass("open").trigger("shown.bs.dropdown",a),n.focus()}return!1}},i.prototype.keydown=function(t){if(/(38|40|27)/.test(t.keyCode)){var r=e(this);if(t.preventDefault(),t.stopPropagation(),!r.is(".disabled, :disabled")){var i=o(r),s=i.hasClass("open");if(!s||s&&27==t.keyCode)return 27==t.which&&i.find(n).focus(),r.click();var a=" li:not(.divider):visible a",g=i.find("[role=menu]"+a+", [role=listbox]"+a);if(g.length){var d=g.index(g.filter(":focus"));38==t.keyCode&&d>0&&d--,40==t.keyCode&&d<g.length-1&&d++,~d||(d=0),g.eq(d).focus()}}}};var s=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var o=e(this),r=o.data("bs.dropdown");r||o.data("bs.dropdown",r=new i(this)),"string"==typeof t&&r[t].call(o)})},e.fn.dropdown.Constructor=i,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=s,this},e(document).on("click.bs.dropdown.data-api",t).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",n,i.prototype.toggle).on("keydown.bs.dropdown.data-api",n+", [role=menu], [role=listbox]",i.prototype.keydown)}(jQuery),+function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype.show=function(){var t=this.element,o=t.closest("ul:not(.dropdown-menu)"),r=t.data("target");if(r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var n=o.find(".active:last a")[0],i=e.Event("show.bs.tab",{relatedTarget:n});if(t.trigger(i),!i.isDefaultPrevented()){var s=e(r);this.activate(t.parent("li"),o),this.activate(s,s.parent(),function(){t.trigger({type:"shown.bs.tab",relatedTarget:n})})}}},t.prototype.activate=function(t,o,r){function n(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var i=o.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,n).emulateTransitionEnd(150):n(),i.removeClass("in")};var o=e.fn.tab;e.fn.tab=function(o){return this.each(function(){var r=e(this),n=r.data("bs.tab");n||r.data("bs.tab",n=new t(this)),"string"==typeof o&&n[o]()})},e.fn.tab.Constructor=t,e.fn.tab.noConflict=function(){return e.fn.tab=o,this},e(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})}(jQuery),+function(e){"use strict";function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var o in t)if(void 0!==e.style[o])return{end:t[o]};return!1}e.fn.emulateTransitionEnd=function(t){var o=!1,r=this;e(this).one(e.support.transition.end,function(){o=!0});var n=function(){o||e(r).trigger(e.support.transition.end)};return setTimeout(n,t),this},e(function(){e.support.transition=t()})}(jQuery),+function(e){"use strict";function t(o,r){var n,i=e.proxy(this.process,this);this.$element=e(o).is("body")?e(window):e(o),this.$body=e("body"),this.$scrollElement=this.$element.on("scroll.bs.scroll-spy.data-api",i),this.options=e.extend({},t.DEFAULTS,r),this.selector=(this.options.target||(n=e(o).attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.offsets=e([]),this.targets=e([]),this.activeTarget=null,this.refresh(),this.process()}t.DEFAULTS={offset:10},t.prototype.refresh=function(){var t=this.$element[0]==window?"offset":"position";this.offsets=e([]),this.targets=e([]);{var o=this;this.$body.find(this.selector).map(function(){var r=e(this),n=r.data("target")||r.attr("href"),i=/^#./.test(n)&&e(n);return i&&i.length&&i.is(":visible")&&[[i[t]().top+(!e.isWindow(o.$scrollElement.get(0))&&o.$scrollElement.scrollTop()),n]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){o.offsets.push(this[0]),o.targets.push(this[1])})}},t.prototype.process=function(){var e,t=this.$scrollElement.scrollTop()+this.options.offset,o=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,r=o-this.$scrollElement.height(),n=this.offsets,i=this.targets,s=this.activeTarget;if(t>=r)return s!=(e=i.last()[0])&&this.activate(e);if(s&&t<=n[0])return s!=(e=i[0])&&this.activate(e);for(e=n.length;e--;)s!=i[e]&&t>=n[e]&&(!n[e+1]||t<=n[e+1])&&this.activate(i[e])},t.prototype.activate=function(t){this.activeTarget=t,e(this.selector).parentsUntil(this.options.target,".active").removeClass("active");var o=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',r=e(o).parents("li").addClass("active");r.parent(".dropdown-menu").length&&(r=r.closest("li.dropdown").addClass("active")),r.trigger("activate.bs.scrollspy")};var o=e.fn.scrollspy;e.fn.scrollspy=function(o){return this.each(function(){var r=e(this),n=r.data("bs.scrollspy"),i="object"==typeof o&&o;n||r.data("bs.scrollspy",n=new t(this,i)),"string"==typeof o&&n[o]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=o,this},e(window).on("load",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(jQuery),+function(e){"use strict";var t=function(t,o){this.options=o,this.$element=e(t),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,e.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};t.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},t.prototype.toggle=function(e){return this[this.isShown?"hide":"show"](e)},t.prototype.show=function(t){var o=this,r=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(r),this.isShown||r.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.backdrop(function(){var r=e.support.transition&&o.$element.hasClass("fade");o.$element.parent().length||o.$element.appendTo(document.body),o.$element.show().scrollTop(0),r&&o.$element[0].offsetWidth,o.$element.addClass("in").attr("aria-hidden",!1),o.enforceFocus();var n=e.Event("shown.bs.modal",{relatedTarget:t});r?o.$element.find(".modal-dialog").one(e.support.transition.end,function(){o.$element.focus().trigger(n)}).emulateTransitionEnd(300):o.$element.focus().trigger(n)}))},t.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one(e.support.transition.end,e.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},t.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.focus()},this))},t.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",e.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},t.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.removeBackdrop(),e.$element.trigger("hidden.bs.modal")})},t.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},t.prototype.backdrop=function(t){var o=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var r=e.support.transition&&o;if(this.$backdrop=e('<div class="modal-backdrop '+o+'" />').appendTo(document.body),this.$element.on("click.dismiss.bs.modal",e.proxy(function(e){e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),r&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;r?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()):t&&t()};var o=e.fn.modal;e.fn.modal=function(o,r){return this.each(function(){var n=e(this),i=n.data("bs.modal"),s=e.extend({},t.DEFAULTS,n.data(),"object"==typeof o&&o);i||n.data("bs.modal",i=new t(this,s)),"string"==typeof o?i[o](r):s.show&&i.show(r)})},e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=o,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(t){var o=e(this),r=o.attr("href"),n=e(o.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),i=n.data("bs.modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},n.data(),o.data());o.is("a")&&t.preventDefault(),n.modal(i,this).one("hide",function(){o.is(":visible")&&o.focus()})}),e(document).on("show.bs.modal",".modal",function(){e(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){e(document.body).removeClass("modal-open")})}(jQuery),+function(e){"use strict";var t=function(e,t){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",e,t)};t.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},t.prototype.init=function(t,o,r){this.enabled=!0,this.type=t,this.$element=e(o),this.options=this.getOptions(r);for(var n=this.options.trigger.split(" "),i=n.length;i--;){var s=n[i];if("click"==s)this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if("manual"!=s){var a="hover"==s?"mouseenter":"focusin",g="hover"==s?"mouseleave":"focusout";this.$element.on(a+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(g+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},t.prototype.getDelegateOptions=function(){var t={},o=this.getDefaults();return this._options&&e.each(this._options,function(e,r){o[e]!=r&&(t[e]=r)}),t},t.prototype.enter=function(t){var o=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(o.timeout),o.hoverState="in",o.options.delay&&o.options.delay.show?(o.timeout=setTimeout(function(){"in"==o.hoverState&&o.show()},o.options.delay.show),void 0):o.show()},t.prototype.leave=function(t){var o=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(o.timeout),o.hoverState="out",o.options.delay&&o.options.delay.hide?(o.timeout=setTimeout(function(){"out"==o.hoverState&&o.hide()},o.options.delay.hide),void 0):o.hide()},t.prototype.show=function(){var t=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){if(this.$element.trigger(t),t.isDefaultPrevented())return;var o=this,r=this.tip();this.setContent(),this.options.animation&&r.addClass("fade");var n="function"==typeof this.options.placement?this.options.placement.call(this,r[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,s=i.test(n);s&&(n=n.replace(i,"")||"top"),r.detach().css({top:0,left:0,display:"block"}).addClass(n),this.options.container?r.appendTo(this.options.container):r.insertAfter(this.$element);var a=this.getPosition(),g=r[0].offsetWidth,d=r[0].offsetHeight;if(s){var u=this.$element.parent(),l=n,c=document.documentElement.scrollTop||document.body.scrollTop,h="body"==this.options.container?window.innerWidth:u.outerWidth(),p="body"==this.options.container?window.innerHeight:u.outerHeight(),f="body"==this.options.container?0:u.offset().left;n="bottom"==n&&a.top+a.height+d-c>p?"top":"top"==n&&a.top-c-d<0?"bottom":"right"==n&&a.right+g>h?"left":"left"==n&&a.left-g<f?"right":n,r.removeClass(l).addClass(n)}var y=this.getCalculatedOffset(n,a,g,d);this.applyPlacement(y,n),this.hoverState=null;var b=function(){o.$element.trigger("shown.bs."+o.type)};e.support.transition&&this.$tip.hasClass("fade")?r.one(e.support.transition.end,b).emulateTransitionEnd(150):b()}},t.prototype.applyPlacement=function(t,o){var r,n=this.tip(),i=n[0].offsetWidth,s=n[0].offsetHeight,a=parseInt(n.css("margin-top"),10),g=parseInt(n.css("margin-left"),10);isNaN(a)&&(a=0),isNaN(g)&&(g=0),t.top=t.top+a,t.left=t.left+g,e.offset.setOffset(n[0],e.extend({using:function(e){n.css({top:Math.round(e.top),left:Math.round(e.left)})}},t),0),n.addClass("in");var d=n[0].offsetWidth,u=n[0].offsetHeight;if("top"==o&&u!=s&&(r=!0,t.top=t.top+s-u),/bottom|top/.test(o)){var l=0;t.left<0&&(l=-2*t.left,t.left=0,n.offset(t),d=n[0].offsetWidth,u=n[0].offsetHeight),this.replaceArrow(l-i+d,d,"left")}else this.replaceArrow(u-s,u,"top");r&&n.offset(t)},t.prototype.replaceArrow=function(e,t,o){this.arrow().css(o,e?50*(1-e/t)+"%":"")},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},t.prototype.hide=function(){function t(){"in"!=o.hoverState&&r.detach(),o.$element.trigger("hidden.bs."+o.type)}var o=this,r=this.tip(),n=e.Event("hide.bs."+this.type);return this.$element.trigger(n),n.isDefaultPrevented()?void 0:(r.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?r.one(e.support.transition.end,t).emulateTransitionEnd(150):t(),this.hoverState=null,this)},t.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},t.prototype.hasContent=function(){return this.getTitle()},t.prototype.getPosition=function(){var t=this.$element[0];return e.extend({},"function"==typeof t.getBoundingClientRect?t.getBoundingClientRect():{width:t.offsetWidth,height:t.offsetHeight},this.$element.offset())},t.prototype.getCalculatedOffset=function(e,t,o,r){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-o/2}:"top"==e?{top:t.top-r,left:t.left+t.width/2-o/2}:"left"==e?{top:t.top+t.height/2-r/2,left:t.left-o}:{top:t.top+t.height/2-r/2,left:t.left+t.width}},t.prototype.getTitle=function(){var e,t=this.$element,o=this.options;return e=t.attr("data-original-title")||("function"==typeof o.title?o.title.call(t[0]):o.title)},t.prototype.tip=function(){return this.$tip=this.$tip||e(this.options.template)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},t.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},t.prototype.enable=function(){this.enabled=!0},t.prototype.disable=function(){this.enabled=!1},t.prototype.toggleEnabled=function(){this.enabled=!this.enabled},t.prototype.toggle=function(t){var o=t?e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;o.tip().hasClass("in")?o.leave(o):o.enter(o)},t.prototype.destroy=function(){clearTimeout(this.timeout),this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var o=e.fn.tooltip;e.fn.tooltip=function(o){return this.each(function(){var r=e(this),n=r.data("bs.tooltip"),i="object"==typeof o&&o;(n||"destroy"!=o)&&(n||r.data("bs.tooltip",n=new t(this,i)),"string"==typeof o&&n[o]())})},e.fn.tooltip.Constructor=t,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=o,this}}(jQuery),+function(e){"use strict";var t=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");t.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),t.prototype.constructor=t,t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),o=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content")[this.options.html?"string"==typeof o?"html":"append":"text"](o),e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},t.prototype.hasContent=function(){return this.getTitle()||this.getContent()},t.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||("function"==typeof t.content?t.content.call(e[0]):t.content)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},t.prototype.tip=function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip};var o=e.fn.popover;e.fn.popover=function(o){return this.each(function(){var r=e(this),n=r.data("bs.popover"),i="object"==typeof o&&o;(n||"destroy"!=o)&&(n||r.data("bs.popover",n=new t(this,i)),"string"==typeof o&&n[o]())})},e.fn.popover.Constructor=t,e.fn.popover.noConflict=function(){return e.fn.popover=o,this}}(jQuery),function(){var e=this,t=e._,o={},r=Array.prototype,n=Object.prototype,i=Function.prototype,s=r.push,a=r.slice,g=r.concat,d=n.toString,u=n.hasOwnProperty,l=r.forEach,c=r.map,h=r.reduce,p=r.reduceRight,f=r.filter,y=r.every,b=r.some,m=r.indexOf,v=r.lastIndexOf,_=Array.isArray,E=Object.keys,S=i.bind,x=function(e){return e instanceof x?e:this instanceof x?(this._wrapped=e,void 0):new x(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.6.0";var w=x.each=x.forEach=function(e,t,r){if(null==e)return e;if(l&&e.forEach===l)e.forEach(t,r);else if(e.length===+e.length){for(var n=0,i=e.length;i>n;n++)if(t.call(r,e[n],n,e)===o)return}else for(var s=x.keys(e),n=0,i=s.length;i>n;n++)if(t.call(r,e[s[n]],s[n],e)===o)return;return e};x.map=x.collect=function(e,t,o){var r=[];return null==e?r:c&&e.map===c?e.map(t,o):(w(e,function(e,n,i){r.push(t.call(o,e,n,i))}),r)};var T="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,o,r){var n=arguments.length>2;if(null==e&&(e=[]),h&&e.reduce===h)return r&&(t=x.bind(t,r)),n?e.reduce(t,o):e.reduce(t);if(w(e,function(e,i,s){n?o=t.call(r,o,e,i,s):(o=e,n=!0)}),!n)throw new TypeError(T);return o},x.reduceRight=x.foldr=function(e,t,o,r){var n=arguments.length>2;if(null==e&&(e=[]),p&&e.reduceRight===p)return r&&(t=x.bind(t,r)),n?e.reduceRight(t,o):e.reduceRight(t);var i=e.length;if(i!==+i){var s=x.keys(e);i=s.length}if(w(e,function(a,g,d){g=s?s[--i]:--i,n?o=t.call(r,o,e[g],g,d):(o=e[g],n=!0)}),!n)throw new TypeError(T);return o},x.find=x.detect=function(e,t,o){var r;return A(e,function(e,n,i){return t.call(o,e,n,i)?(r=e,!0):void 0}),r},x.filter=x.select=function(e,t,o){var r=[];return null==e?r:f&&e.filter===f?e.filter(t,o):(w(e,function(e,n,i){t.call(o,e,n,i)&&r.push(e)}),r)},x.reject=function(e,t,o){return x.filter(e,function(e,r,n){return!t.call(o,e,r,n)},o)},x.every=x.all=function(e,t,r){t||(t=x.identity);var n=!0;return null==e?n:y&&e.every===y?e.every(t,r):(w(e,function(e,i,s){return(n=n&&t.call(r,e,i,s))?void 0:o}),!!n)};var A=x.some=x.any=function(e,t,r){t||(t=x.identity);var n=!1;return null==e?n:b&&e.some===b?e.some(t,r):(w(e,function(e,i,s){return n||(n=t.call(r,e,i,s))?o:void 0}),!!n)};x.contains=x.include=function(e,t){return null==e?!1:m&&e.indexOf===m?-1!=e.indexOf(t):A(e,function(e){return e===t})},x.invoke=function(e,t){var o=a.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,o)})},x.pluck=function(e,t){return x.map(e,x.property(t))},x.where=function(e,t){return x.filter(e,x.matches(t))},x.findWhere=function(e,t){return x.find(e,x.matches(t))},x.max=function(e,t,o){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var r=-1/0,n=-1/0;return w(e,function(e,i,s){var a=t?t.call(o,e,i,s):e;a>n&&(r=e,n=a)}),r},x.min=function(e,t,o){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var r=1/0,n=1/0;return w(e,function(e,i,s){var a=t?t.call(o,e,i,s):e;n>a&&(r=e,n=a)}),r},x.shuffle=function(e){var t,o=0,r=[];return w(e,function(e){t=x.random(o++),r[o-1]=r[t],r[t]=e}),r},x.sample=function(e,t,o){return null==t||o?(e.length!==+e.length&&(e=x.values(e)),e[x.random(e.length-1)]):x.shuffle(e).slice(0,Math.max(0,t))};var N=function(e){return null==e?x.identity:x.isFunction(e)?e:x.property(e)};x.sortBy=function(e,t,o){return t=N(t),x.pluck(x.map(e,function(e,r,n){return{value:e,index:r,criteria:t.call(o,e,r,n)}}).sort(function(e,t){var o=e.criteria,r=t.criteria;if(o!==r){if(o>r||void 0===o)return 1;if(r>o||void 0===r)return-1}return e.index-t.index}),"value")};var D=function(e){return function(t,o,r){var n={};return o=N(o),w(t,function(i,s){var a=o.call(r,i,s,t);e(n,a,i)}),n}};x.groupBy=D(function(e,t,o){x.has(e,t)?e[t].push(o):e[t]=[o]}),x.indexBy=D(function(e,t,o){e[t]=o}),x.countBy=D(function(e,t){x.has(e,t)?e[t]++:e[t]=1}),x.sortedIndex=function(e,t,o,r){o=N(o);for(var n=o.call(r,t),i=0,s=e.length;s>i;){var a=i+s>>>1;o.call(r,e[a])<n?i=a+1:s=a}return i},x.toArray=function(e){return e?x.isArray(e)?a.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,o){return null==e?void 0:null==t||o?e[0]:0>t?[]:a.call(e,0,t)},x.initial=function(e,t,o){return a.call(e,0,e.length-(null==t||o?1:t))},x.last=function(e,t,o){return null==e?void 0:null==t||o?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,o){return a.call(e,null==t||o?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var I=function(e,t,o){return t&&x.every(e,x.isArray)?g.apply(o,e):(w(e,function(e){x.isArray(e)||x.isArguments(e)?t?s.apply(o,e):I(e,t,o):o.push(e)}),o)};x.flatten=function(e,t){return I(e,t,[])},x.without=function(e){return x.difference(e,a.call(arguments,1))},x.partition=function(e,t,o){t=N(t);var r=[],n=[];return w(e,function(e){(t.call(o,e)?r:n).push(e)}),[r,n]},x.uniq=x.unique=function(e,t,o,r){x.isFunction(t)&&(r=o,o=t,t=!1);var n=o?x.map(e,o,r):e,i=[],s=[];return w(n,function(o,r){(t?r&&s[s.length-1]===o:x.contains(s,o))||(s.push(o),i.push(e[r]))}),i},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(e){var t=a.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.contains(t,e)})})},x.difference=function(e){var t=g.apply(r,a.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=x.max(x.pluck(arguments,"length").concat(0)),t=new Array(e),o=0;e>o;o++)t[o]=x.pluck(arguments,""+o);return t},x.object=function(e,t){if(null==e)return{};for(var o={},r=0,n=e.length;n>r;r++)t?o[e[r]]=t[r]:o[e[r][0]]=e[r][1];return o},x.indexOf=function(e,t,o){if(null==e)return-1;var r=0,n=e.length;if(o){if("number"!=typeof o)return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=0>o?Math.max(0,n+o):o}if(m&&e.indexOf===m)return e.indexOf(t,o);for(;n>r;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,o){if(null==e)return-1;var r=null!=o;if(v&&e.lastIndexOf===v)return r?e.lastIndexOf(t,o):e.lastIndexOf(t);for(var n=r?o:e.length;n--;)if(e[n]===t)return n;return-1},x.range=function(e,t,o){arguments.length<=1&&(t=e||0,e=0),o=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/o),0),n=0,i=new Array(r);r>n;)i[n++]=e,e+=o;return i};var q=function(){};x.bind=function(e,t){var o,r;if(S&&e.bind===S)return S.apply(e,a.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return o=a.call(arguments,2),r=function(){if(!(this instanceof r))return e.apply(t,o.concat(a.call(arguments)));
q.prototype=e.prototype;var n=new q;q.prototype=null;var i=e.apply(n,o.concat(a.call(arguments)));return Object(i)===i?i:n}},x.partial=function(e){var t=a.call(arguments,1);return function(){for(var o=0,r=t.slice(),n=0,i=r.length;i>n;n++)r[n]===x&&(r[n]=arguments[o++]);for(;o<arguments.length;)r.push(arguments[o++]);return e.apply(this,r)}},x.bindAll=function(e){var t=a.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return w(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var o={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(o,r)?o[r]:o[r]=e.apply(this,arguments)}},x.delay=function(e,t){var o=a.call(arguments,2);return setTimeout(function(){return e.apply(null,o)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(a.call(arguments,1)))},x.throttle=function(e,t,o){var r,n,i,s=null,a=0;o||(o={});var g=function(){a=o.leading===!1?0:x.now(),s=null,i=e.apply(r,n),r=n=null};return function(){var d=x.now();a||o.leading!==!1||(a=d);var u=t-(d-a);return r=this,n=arguments,0>=u?(clearTimeout(s),s=null,a=d,i=e.apply(r,n),r=n=null):s||o.trailing===!1||(s=setTimeout(g,u)),i}},x.debounce=function(e,t,o){var r,n,i,s,a,g=function(){var d=x.now()-s;t>d?r=setTimeout(g,t-d):(r=null,o||(a=e.apply(i,n),i=n=null))};return function(){i=this,n=arguments,s=x.now();var d=o&&!r;return r||(r=setTimeout(g,t)),d&&(a=e.apply(i,n),i=n=null),a}},x.once=function(e){var t,o=!1;return function(){return o?t:(o=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return x.partial(t,e)},x.compose=function(){var e=arguments;return function(){for(var t=arguments,o=e.length-1;o>=0;o--)t=[e[o].apply(this,t)];return t[0]}},x.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},x.keys=function(e){if(!x.isObject(e))return[];if(E)return E(e);var t=[];for(var o in e)x.has(e,o)&&t.push(o);return t},x.values=function(e){for(var t=x.keys(e),o=t.length,r=new Array(o),n=0;o>n;n++)r[n]=e[t[n]];return r},x.pairs=function(e){for(var t=x.keys(e),o=t.length,r=new Array(o),n=0;o>n;n++)r[n]=[t[n],e[t[n]]];return r},x.invert=function(e){for(var t={},o=x.keys(e),r=0,n=o.length;n>r;r++)t[e[o[r]]]=o[r];return t},x.functions=x.methods=function(e){var t=[];for(var o in e)x.isFunction(e[o])&&t.push(o);return t.sort()},x.extend=function(e){return w(a.call(arguments,1),function(t){if(t)for(var o in t)e[o]=t[o]}),e},x.pick=function(e){var t={},o=g.apply(r,a.call(arguments,1));return w(o,function(o){o in e&&(t[o]=e[o])}),t},x.omit=function(e){var t={},o=g.apply(r,a.call(arguments,1));for(var n in e)x.contains(o,n)||(t[n]=e[n]);return t},x.defaults=function(e){return w(a.call(arguments,1),function(t){if(t)for(var o in t)void 0===e[o]&&(e[o]=t[o])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var C=function(e,t,o,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var n=d.call(e);if(n!=d.call(t))return!1;switch(n){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var i=o.length;i--;)if(o[i]==e)return r[i]==t;var s=e.constructor,a=t.constructor;if(s!==a&&!(x.isFunction(s)&&s instanceof s&&x.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1;o.push(e),r.push(t);var g=0,u=!0;if("[object Array]"==n){if(g=e.length,u=g==t.length)for(;g--&&(u=C(e[g],t[g],o,r)););}else{for(var l in e)if(x.has(e,l)&&(g++,!(u=x.has(t,l)&&C(e[l],t[l],o,r))))break;if(u){for(l in t)if(x.has(t,l)&&!g--)break;u=!g}}return o.pop(),r.pop(),u};x.isEqual=function(e,t){return C(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!(!e||1!==e.nodeType)},x.isArray=_||function(e){return"[object Array]"==d.call(e)},x.isObject=function(e){return e===Object(e)},w(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return d.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!(!e||!x.has(e,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(e){return"function"==typeof e}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==d.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return void 0===e},x.has=function(e,t){return u.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.constant=function(e){return function(){return e}},x.property=function(e){return function(t){return t[e]}},x.matches=function(e){return function(t){if(t===e)return!0;for(var o in e)if(e[o]!==t[o])return!1;return!0}},x.times=function(e,t,o){for(var r=Array(Math.max(0,e)),n=0;e>n;n++)r[n]=t.call(o,n);return r},x.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},x.now=Date.now||function(){return(new Date).getTime()};var R={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};R.unescape=x.invert(R.escape);var L={escape:new RegExp("["+x.keys(R.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(R.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(L[e],function(t){return R[e][t]})}}),x.result=function(e,t){if(null==e)return void 0;var o=e[t];return x.isFunction(o)?o.call(e):o},x.mixin=function(e){w(x.functions(e),function(t){var o=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),B.call(this,o.apply(x,e))}})};var O=0;x.uniqueId=function(e){var t=++O+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var k=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},M=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,o){var r;o=x.defaults({},o,x.templateSettings);var n=new RegExp([(o.escape||k).source,(o.interpolate||k).source,(o.evaluate||k).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(n,function(t,o,r,n,a){return s+=e.slice(i,a).replace(M,function(e){return"\\"+P[e]}),o&&(s+="'+\n((__t=("+o+"))==null?'':_.escape(__t))+\n'"),r&&(s+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),n&&(s+="';\n"+n+"\n__p+='"),i=a+t.length,t}),s+="';\n",o.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{r=new Function(o.variable||"obj","_",s)}catch(a){throw a.source=s,a}if(t)return r(t,x);var g=function(e){return r.call(this,e,x)};return g.source="function("+(o.variable||"obj")+"){\n"+s+"}",g},x.chain=function(e){return x(e).chain()};var B=function(e){return this._chain?x(e).chain():e};x.mixin(x),w(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var o=this._wrapped;return t.apply(o,arguments),"shift"!=e&&"splice"!=e||0!==o.length||delete o[0],B.call(this,o)}}),w(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return B.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}.call(this),function(e,t){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(o,r,n){e.Backbone=t(e,n,o,r)});else if("undefined"!=typeof exports){var o=require("underscore");t(e,exports,o)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,o,r){{var n=e.Backbone,i=[],s=(i.push,i.slice);i.splice}t.VERSION="1.1.2",t.$=r,t.noConflict=function(){return e.Backbone=n,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a=t.Events={on:function(e,t,o){if(!d(this,"on",e,[t,o])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:o,ctx:o||this}),this},once:function(e,t,r){if(!d(this,"once",e,[t,r])||!t)return this;var n=this,i=o.once(function(){n.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,r)},off:function(e,t,r){var n,i,s,a,g,u,l,c;if(!this._events||!d(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events=void 0,this;for(a=e?[e]:o.keys(this._events),g=0,u=a.length;u>g;g++)if(e=a[g],s=this._events[e]){if(this._events[e]=n=[],t||r)for(l=0,c=s.length;c>l;l++)i=s[l],(t&&t!==i.callback&&t!==i.callback._callback||r&&r!==i.context)&&n.push(i);n.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=s.call(arguments,1);if(!d(this,"trigger",e,t))return this;var o=this._events[e],r=this._events.all;return o&&u(o,t),r&&u(r,arguments),this},stopListening:function(e,t,r){var n=this._listeningTo;if(!n)return this;var i=!t&&!r;r||"object"!=typeof t||(r=this),e&&((n={})[e._listenId]=e);for(var s in n)e=n[s],e.off(t,r,this),(i||o.isEmpty(e._events))&&delete this._listeningTo[s];return this}},g=/\s+/,d=function(e,t,o,r){if(!o)return!0;if("object"==typeof o){for(var n in o)e[t].apply(e,[n,o[n]].concat(r));return!1}if(g.test(o)){for(var i=o.split(g),s=0,a=i.length;a>s;s++)e[t].apply(e,[i[s]].concat(r));return!1}return!0},u=function(e,t){var o,r=-1,n=e.length,i=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++r<n;)(o=e[r]).callback.call(o.ctx);return;case 1:for(;++r<n;)(o=e[r]).callback.call(o.ctx,i);return;case 2:for(;++r<n;)(o=e[r]).callback.call(o.ctx,i,s);return;case 3:for(;++r<n;)(o=e[r]).callback.call(o.ctx,i,s,a);return;default:for(;++r<n;)(o=e[r]).callback.apply(o.ctx,t);return}},l={listenTo:"on",listenToOnce:"once"};o.each(l,function(e,t){a[t]=function(t,r,n){var i=this._listeningTo||(this._listeningTo={}),s=t._listenId||(t._listenId=o.uniqueId("l"));return i[s]=t,n||"object"!=typeof r||(n=this),t[e](r,n,this),this}}),a.bind=a.on,a.unbind=a.off,o.extend(t,a);var c=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=o.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=o.defaults({},r,o.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};o.extend(c.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return o.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return o.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,r){var n,i,s,a,g,d,u,l;if(null==e)return this;if("object"==typeof e?(i=e,r=t):(i={})[e]=t,r||(r={}),!this._validate(i,r))return!1;s=r.unset,g=r.silent,a=[],d=this._changing,this._changing=!0,d||(this._previousAttributes=o.clone(this.attributes),this.changed={}),l=this.attributes,u=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(n in i)t=i[n],o.isEqual(l[n],t)||a.push(n),o.isEqual(u[n],t)?delete this.changed[n]:this.changed[n]=t,s?delete l[n]:l[n]=t;if(!g){a.length&&(this._pending=r);for(var c=0,h=a.length;h>c;c++)this.trigger("change:"+a[c],this,l[a[c]],r)}if(d)return this;if(!g)for(;this._pending;)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,o.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,o.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!o.isEmpty(this.changed):o.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?o.clone(this.changed):!1;var t,r=!1,n=this._changing?this._previousAttributes:this.attributes;for(var i in e)o.isEqual(n[i],t=e[i])||((r||(r={}))[i]=t);return r},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return o.clone(this._previousAttributes)},fetch:function(e){e=e?o.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,r=e.success;return e.success=function(o){return t.set(t.parse(o,e),e)?(r&&r(t,o,e),t.trigger("sync",t,o,e),void 0):!1},M(this,e),this.sync("read",this,e)},save:function(e,t,r){var n,i,s,a=this.attributes;if(null==e||"object"==typeof e?(n=e,r=t):(n={})[e]=t,r=o.extend({validate:!0},r),n&&!r.wait){if(!this.set(n,r))return!1}else if(!this._validate(n,r))return!1;n&&r.wait&&(this.attributes=o.extend({},a,n)),void 0===r.parse&&(r.parse=!0);var g=this,d=r.success;return r.success=function(e){g.attributes=a;var t=g.parse(e,r);return r.wait&&(t=o.extend(n||{},t)),o.isObject(t)&&!g.set(t,r)?!1:(d&&d(g,e,r),g.trigger("sync",g,e,r),void 0)},M(this,r),i=this.isNew()?"create":r.patch?"patch":"update","patch"===i&&(r.attrs=n),s=this.sync(i,this,r),n&&r.wait&&(this.attributes=a),s},destroy:function(e){e=e?o.clone(e):{};var t=this,r=e.success,n=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(o){(e.wait||t.isNew())&&n(),r&&r(t,o,e),t.isNew()||t.trigger("sync",t,o,e)},this.isNew())return e.success(),!1;M(this,e);var i=this.sync("delete",this,e);return e.wait||n(),i},url:function(){var e=o.result(this,"urlRoot")||o.result(this.collection,"url")||P();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},o.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=o.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,o.extend(t,{validationError:r})),!1):!0}});var h=["keys","values","pairs","invert","pick","omit"];o.each(h,function(e){c.prototype[e]=function(){var t=s.call(arguments);return t.unshift(this.attributes),o[e].apply(o,t)}});var p=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,o.extend({silent:!0},t))},f={add:!0,remove:!0,merge:!0},y={add:!0,remove:!1};o.extend(p.prototype,a,{model:c,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,o.extend({merge:!1},t,y))},remove:function(e,t){var r=!o.isArray(e);e=r?[e]:o.clone(e),t||(t={});var n,i,s,a;for(n=0,i=e.length;i>n;n++)a=e[n]=this.get(e[n]),a&&(delete this._byId[a.id],delete this._byId[a.cid],s=this.indexOf(a),this.models.splice(s,1),this.length--,t.silent||(t.index=s,a.trigger("remove",a,this,t)),this._removeReference(a,t));return r?e[0]:e},set:function(e,t){t=o.defaults({},t,f),t.parse&&(e=this.parse(e,t));var r=!o.isArray(e);e=r?e?[e]:[]:o.clone(e);var n,i,s,a,g,d,u,l=t.at,h=this.model,p=this.comparator&&null==l&&t.sort!==!1,y=o.isString(this.comparator)?this.comparator:null,b=[],m=[],v={},_=t.add,E=t.merge,S=t.remove,x=!p&&_&&S?[]:!1;for(n=0,i=e.length;i>n;n++){if(g=e[n]||{},s=g instanceof c?a=g:g[h.prototype.idAttribute||"id"],d=this.get(s))S&&(v[d.cid]=!0),E&&(g=g===a?a.attributes:g,t.parse&&(g=d.parse(g,t)),d.set(g,t),p&&!u&&d.hasChanged(y)&&(u=!0)),e[n]=d;else if(_){if(a=e[n]=this._prepareModel(g,t),!a)continue;b.push(a),this._addReference(a,t)}a=d||a,!x||!a.isNew()&&v[a.id]||x.push(a),v[a.id]=!0}if(S){for(n=0,i=this.length;i>n;++n)v[(a=this.models[n]).cid]||m.push(a);m.length&&this.remove(m,t)}if(b.length||x&&x.length)if(p&&(u=!0),this.length+=b.length,null!=l)for(n=0,i=b.length;i>n;n++)this.models.splice(l+n,0,b[n]);else{x&&(this.models.length=0);var w=x||b;for(n=0,i=w.length;i>n;n++)this.models.push(w[n])}if(u&&this.sort({silent:!0}),!t.silent){for(n=0,i=b.length;i>n;n++)(a=b[n]).trigger("add",a,this,t);(u||x&&x.length)&&this.trigger("sort",this,t)}return r?e[0]:e},reset:function(e,t){t||(t={});for(var r=0,n=this.models.length;n>r;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),e=this.add(e,o.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,o.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,o.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return s.apply(this.models,arguments)},get:function(e){return null==e?void 0:this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return o.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var o in e)if(e[o]!==t.get(o))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),o.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(o.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return o.invoke(this.models,"get",e)},fetch:function(e){e=e?o.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,r=this;return e.success=function(o){var n=e.reset?"reset":"set";r[n](o,e),t&&t(r,o,e),r.trigger("sync",r,o,e)},M(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?o.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,n=t.success;return t.success=function(e,o){t.wait&&r.add(e,t),n&&n(e,o,t)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof c)return e;t=t?o.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_addReference:function(e){this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,o,r){("add"!==e&&"remove"!==e||o===this)&&("destroy"===e&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];o.each(b,function(e){p.prototype[e]=function(){var t=s.call(arguments);return t.unshift(this.models),o[e].apply(o,t)}});var m=["groupBy","countBy","sortBy","indexBy"];o.each(m,function(e){p.prototype[e]=function(t,r){var n=o.isFunction(t)?t:function(e){return e.get(t)};return o[e](this.models,n,r)}});var v=t.View=function(e){this.cid=o.uniqueId("view"),e||(e={}),o.extend(this,o.pick(e,E)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},_=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName","events"];o.extend(v.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,o){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],o!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=o.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];if(o.isFunction(r)||(r=this[e[t]]),r){var n=t.match(_),i=n[1],s=n[2];r=o.bind(r,this),i+=".delegateEvents"+this.cid,""===s?this.$el.on(i,r):this.$el.on(i,s,r)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(o.result(this,"el"),!1);else{var e=o.extend({},o.result(this,"attributes"));this.id&&(e.id=o.result(this,"id")),this.className&&(e["class"]=o.result(this,"className"));var r=t.$("<"+o.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}}}),t.sync=function(e,r,n){var i=x[e];o.defaults(n||(n={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var s={type:i,dataType:"json"};if(n.url||(s.url=o.result(r,"url")||P()),null!=n.data||!r||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(n.attrs||r.toJSON(n))),n.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),n.emulateHTTP&&("PUT"===i||"DELETE"===i||"PATCH"===i)){s.type="POST",n.emulateJSON&&(s.data._method=i);var a=n.beforeSend;n.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",i),a?a.apply(this,arguments):void 0}}"GET"===s.type||n.emulateJSON||(s.processData=!1),"PATCH"===s.type&&S&&(s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var g=n.xhr=t.ajax(o.extend(s,n));return r.trigger("request",r,g,n),g};var S=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var w=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},T=/\((.*?)\)/g,A=/(\(\?)?:\w+/g,N=/\*\w+/g,D=/[\-{}\[\]+?.,\\\^$|#\s]/g;o.extend(w.prototype,a,{initialize:function(){},route:function(e,r,n){o.isRegExp(e)||(e=this._routeToRegExp(e)),o.isFunction(r)&&(n=r,r=""),n||(n=this[r]);var i=this;return t.history.route(e,function(o){var s=i._extractParameters(e,o);i.execute(n,s),i.trigger.apply(i,["route:"+r].concat(s)),i.trigger("route",r,s),t.history.trigger("route",i,r,s)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,o){return t.history.navigate(e,o),this},_bindRoutes:function(){if(this.routes){this.routes=o.result(this,"routes");for(var e,t=o.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(D,"\\$&").replace(T,"(?:$1)?").replace(A,function(e,t){return t?e:"([^/?]+)"}).replace(N,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return o.map(r,function(e,t){return t===r.length-1?e||null:e?decodeURIComponent(e):null})}});var I=t.History=function(){this.handlers=[],o.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},q=/^[#\/]|\s+$/g,C=/^\/+|\/+$/g,R=/msie [\w.]+/,L=/\/$/,O=/#.*$/;I.started=!1,o.extend(I.prototype,a,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var o=this.root.replace(L,"");e.indexOf(o)||(e=e.slice(o.length))}else e=this.getHash();return e.replace(q,"")},start:function(e){if(I.started)throw new Error("Backbone.history has already been started");I.started=!0,this.options=o.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),n=document.documentMode,i=R.exec(navigator.userAgent.toLowerCase())&&(!n||7>=n);if(this.root=("/"+this.root+"/").replace(C,"/"),i&&this._wantsHashChange){var s=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=s.hide().appendTo("body")[0].contentWindow,this.navigate(r)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!i?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var a=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&a.hash&&(this.fragment=this.getHash().replace(q,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),I.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),this.loadUrl(),void 0)},loadUrl:function(e){return e=this.fragment=this.getFragment(e),o.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(e,t){if(!I.started)return!1;t&&t!==!0||(t={trigger:!!t});var o=this.root+(e=this.getFragment(e||""));if(e=e.replace(O,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==o&&(o=o.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,o);else{if(!this._wantsHashChange)return this.location.assign(o);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,o){if(o){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new I;var k=function(e,t){var r,n=this;r=e&&o.has(e,"constructor")?e.constructor:function(){return n.apply(this,arguments)},o.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&o.extend(r.prototype,e),r.__super__=n.prototype,r};c.extend=p.extend=w.extend=v.extend=I.extend=k;var P=function(){throw new Error('A "url" property or function must be specified')},M=function(e,t){var o=t.error;t.error=function(r){o&&o(e,r,t),e.trigger("error",e,r,t)}};return t}),!function(){"use strict";function e(e,t){e.s=null!==t&&void 0!==t?"string"==typeof t?t:t.toString():t,e.orig=t,null!==t&&void 0!==t?e.__defineGetter__?e.__defineGetter__("length",function(){return e.s.length}):e.length=t.length:e.length=-1}function t(t){e(this,t)}function o(){for(var e in l)!function(e){var t=l[e];u.hasOwnProperty(e)||(c.push(e),u[e]=function(){return String.prototype.s=this,t.apply(this,arguments)})}(e)}function r(){for(var e=0;e<c.length;++e)delete String.prototype[c[e]];c.length=0}function n(){for(var e=i(),t={},o=0;o<e.length;++o){var r=e[o],n=u[r];try{var s=typeof n.apply("teststring",[]);t[r]=s}catch(a){}}return t}function i(){var e=[];if(Object.getOwnPropertyNames)return e=Object.getOwnPropertyNames(u),e.splice(e.indexOf("valueOf"),1),e.splice(e.indexOf("toString"),1),e;var t={};for(var o in String.prototype)t[o]=o;for(var o in Object.prototype)delete t[o];for(var o in t)e.push(o);return e}function s(e){return new t(e)}function a(e,t){var o,r=[];for(o=0;o<e.length;o++)r.push(e[o]),t&&t.call(e,e[o],o);return r}var g="1.8.0",d={},u=String.prototype,l=t.prototype={between:function(e,t){var o=this.s,r=o.indexOf(e),n=o.indexOf(t,r+e.length);return-1==n&&null!=t?new this.constructor(""):-1==n&&null==t?new this.constructor(o.substring(r+e.length)):new this.constructor(o.slice(r+e.length,n))},camelize:function(){var e=this.trim().s.replace(/(\-|_|\s)+(.)?/g,function(e,t,o){return o?o.toUpperCase():""});return new this.constructor(e)},capitalize:function(){return new this.constructor(this.s.substr(0,1).toUpperCase()+this.s.substring(1).toLowerCase())},charAt:function(e){return this.s.charAt(e)},chompLeft:function(e){var t=this.s;return 0===t.indexOf(e)?(t=t.slice(e.length),new this.constructor(t)):this},chompRight:function(e){if(this.endsWith(e)){var t=this.s;return t=t.slice(0,t.length-e.length),new this.constructor(t)}return this},collapseWhitespace:function(){var e=this.s.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"");return new this.constructor(e)},contains:function(e){return this.s.indexOf(e)>=0},count:function(e){for(var t=0,o=this.s.indexOf(e);o>=0;)t+=1,o=this.s.indexOf(e,o+1);return t},dasherize:function(){var e=this.trim().s.replace(/[_\s]+/g,"-").replace(/([A-Z])/g,"-$1").replace(/-+/g,"-").toLowerCase();return new this.constructor(e)},decodeHtmlEntities:function(){var e=this.s;return e=e.replace(/&#(\d+);?/g,function(e,t){return String.fromCharCode(t)}).replace(/&#[xX]([A-Fa-f0-9]+);?/g,function(e,t){return String.fromCharCode(parseInt(t,16))}).replace(/&([^;\W]+;?)/g,function(e,t){var o=t.replace(/;$/,""),r=d[t]||t.match(/;$/)&&d[o];return"number"==typeof r?String.fromCharCode(r):"string"==typeof r?r:e}),new this.constructor(e)},endsWith:function(e){var t=this.s.length-e.length;return t>=0&&this.s.indexOf(e,t)===t},escapeHTML:function(){return new this.constructor(this.s.replace(/[&<>"']/g,function(e){return"&"+y[e]+";"}))},ensureLeft:function(e){var t=this.s;return 0===t.indexOf(e)?this:new this.constructor(e+t)},ensureRight:function(e){var t=this.s;return this.endsWith(e)?this:new this.constructor(t+e)},humanize:function(){if(null===this.s||void 0===this.s)return new this.constructor("");var e=this.underscore().replace(/_id$/,"").replace(/_/g," ").trim().capitalize();return new this.constructor(e)},isAlpha:function(){return!/[^a-z\xC0-\xFF]/.test(this.s.toLowerCase())},isAlphaNumeric:function(){return!/[^0-9a-z\xC0-\xFF]/.test(this.s.toLowerCase())},isEmpty:function(){return null===this.s||void 0===this.s?!0:/^[\s\xa0]*$/.test(this.s)},isLower:function(){return this.isAlpha()&&this.s.toLowerCase()===this.s},isNumeric:function(){return!/[^0-9]/.test(this.s)},isUpper:function(){return this.isAlpha()&&this.s.toUpperCase()===this.s},left:function(e){if(e>=0){var t=this.s.substr(0,e);return new this.constructor(t)}return this.right(-e)},lines:function(){return this.replaceAll("\r\n","\n").s.split("\n")},pad:function(e,t){if(null==t&&(t=" "),this.s.length>=e)return new this.constructor(this.s);e-=this.s.length;var o=Array(Math.ceil(e/2)+1).join(t),r=Array(Math.floor(e/2)+1).join(t);return new this.constructor(o+this.s+r)},padLeft:function(e,t){return null==t&&(t=" "),this.s.length>=e?new this.constructor(this.s):new this.constructor(Array(e-this.s.length+1).join(t)+this.s)},padRight:function(e,t){return null==t&&(t=" "),this.s.length>=e?new this.constructor(this.s):new this.constructor(this.s+Array(e-this.s.length+1).join(t))},parseCSV:function(e,t,o,r){e=e||",",o=o||"\\","undefined"==typeof t&&(t='"');var n=0,i=[],s=[],a=this.s.length,g=!1,d=this,u=function(e){return d.s.charAt(e)};if("undefined"!=typeof r)var l=[];for(t||(g=!0);a>n;){var c=u(n);switch(c){case o:if(g&&(o!==t||u(n+1)===t)){n+=1,i.push(u(n));break}if(o!==t)break;case t:g=!g;break;case e:g&&t?i.push(c):(s.push(i.join("")),i.length=0);break;case r:g?i.push(c):l&&(s.push(i.join("")),l.push(s),s=[],i.length=0);break;default:g&&i.push(c)}n+=1}return s.push(i.join("")),l?(l.push(s),l):s},replaceAll:function(e,t){var o=this.s.split(e).join(t);return new this.constructor(o)},right:function(e){if(e>=0){var t=this.s.substr(this.s.length-e,e);return new this.constructor(t)}return this.left(-e)},setValue:function(t){return e(this,t),this},slugify:function(){var e=new t(this.s.replace(/[^\w\s-]/g,"").toLowerCase()).dasherize().s;return"-"===e.charAt(0)&&(e=e.substr(1)),new this.constructor(e)},startsWith:function(e){return 0===this.s.lastIndexOf(e,0)},stripPunctuation:function(){return new this.constructor(this.s.replace(/[^\w\s]|_/g,"").replace(/\s+/g," "))},stripTags:function(){var e=this.s,t=arguments.length>0?arguments:[""];return a(t,function(t){e=e.replace(RegExp("</?"+t+"[^<>]*>","gi"),"")}),new this.constructor(e)},template:function(e,t,o){var r=this.s,t=t||s.TMPL_OPEN,o=o||s.TMPL_CLOSE,n=t.replace(/[-[\]()*\s]/g,"\\$&").replace(/\$/g,"\\$"),i=o.replace(/[-[\]()*\s]/g,"\\$&").replace(/\$/g,"\\$"),a=new RegExp(n+"(.+?)"+i,"g"),g=r.match(a)||[];
return g.forEach(function(n){var i=n.substring(t.length,n.length-o.length);"undefined"!=typeof e[i]&&(r=r.replace(n,e[i]))}),new this.constructor(r)},times:function(e){return new this.constructor(new Array(e+1).join(this.s))},toBoolean:function(){if("string"==typeof this.orig){var e=this.s.toLowerCase();return"true"===e||"yes"===e||"on"===e}return this.orig===!0||1===this.orig},toFloat:function(e){var t=parseFloat(this.s);return e?parseFloat(t.toFixed(e)):t},toInt:function(){return/^\s*-?0x/i.test(this.s)?parseInt(this.s,16):parseInt(this.s,10)},trim:function(){var e;return e="undefined"==typeof u.trim?this.s.replace(/(^\s*|\s*$)/g,""):this.s.trim(),new this.constructor(e)},trimLeft:function(){var e;return e=u.trimLeft?this.s.trimLeft():this.s.replace(/(^\s*)/g,""),new this.constructor(e)},trimRight:function(){var e;return e=u.trimRight?this.s.trimRight():this.s.replace(/\s+$/,""),new this.constructor(e)},truncate:function(e,o){var r=this.s;if(e=~~e,o=o||"...",r.length<=e)return new this.constructor(r);var n=function(e){return e.toUpperCase()!==e.toLowerCase()?"A":" "},i=r.slice(0,e+1).replace(/.(?=\W*\w*$)/g,n);return i=i.slice(i.length-2).match(/\w\w/)?i.replace(/\s*\S+$/,""):new t(i.slice(0,i.length-1)).trimRight().s,(i+o).length>r.length?new t(r):new t(r.slice(0,i.length)+o)},toCSV:function(){function e(e){return null!==e&&""!==e}var o=",",r='"',n="\\",i=!0,s=!1,a=[];if("object"==typeof arguments[0]?(o=arguments[0].delimiter||o,o=arguments[0].separator||o,r=arguments[0].qualifier||r,i=!!arguments[0].encloseNumbers,n=arguments[0].escape||n,s=!!arguments[0].keys):"string"==typeof arguments[0]&&(o=arguments[0]),"string"==typeof arguments[1]&&(r=arguments[1]),null===arguments[1]&&(r=null),this.orig instanceof Array)a=this.orig;else for(var g in this.orig)this.orig.hasOwnProperty(g)&&(s?a.push(g):a.push(this.orig[g]));for(var d=n+r,u=[],l=0;l<a.length;++l){var c=e(r);if("number"==typeof a[l]&&(c&=i),c&&u.push(r),null!==a[l]&&void 0!==a[l]){var h=new t(a[l]).replaceAll(r,d).s;u.push(h)}else u.push("");c&&u.push(r),o&&u.push(o)}return u.length=u.length-1,new this.constructor(u.join(""))},toString:function(){return this.s},underscore:function(){var e=this.trim().s.replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase();return new t(this.s.charAt(0)).isUpper()&&(e="_"+e),new this.constructor(e)},unescapeHTML:function(){return new this.constructor(this.s.replace(/\&([^;]+);/g,function(e,t){var o;return t in f?f[t]:(o=t.match(/^#x([\da-fA-F]+)$/))?String.fromCharCode(parseInt(o[1],16)):(o=t.match(/^#(\d+)$/))?String.fromCharCode(~~o[1]):e}))},valueOf:function(){return this.s.valueOf()}},c=[],h=n();for(var p in h)!function(e){var t=u[e];"function"==typeof t&&(l[e]||(l[e]="string"===h[e]?function(){return new this.constructor(t.apply(this,arguments))}:t))}(p);l.repeat=l.times,l.include=l.contains,l.toInteger=l.toInt,l.toBool=l.toBoolean,l.decodeHTMLEntities=l.decodeHtmlEntities,l.constructor=t,s.extendPrototype=o,s.restorePrototype=r,s.VERSION=g,s.TMPL_OPEN="{{",s.TMPL_CLOSE="}}",s.ENTITIES=d,"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=s:"function"==typeof define&&define.amd?define([],function(){return s}):window.S=s;var f={lt:"<",gt:">",quot:'"',apos:"'",amp:"&"},y={};for(var b in f)y[f[b]]=b;d={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,"OElig;":338,"oelig;":339,"Scaron;":352,"scaron;":353,"Yuml;":376,"fnof;":402,"circ;":710,"tilde;":732,"Alpha;":913,"Beta;":914,"Gamma;":915,"Delta;":916,"Epsilon;":917,"Zeta;":918,"Eta;":919,"Theta;":920,"Iota;":921,"Kappa;":922,"Lambda;":923,"Mu;":924,"Nu;":925,"Xi;":926,"Omicron;":927,"Pi;":928,"Rho;":929,"Sigma;":931,"Tau;":932,"Upsilon;":933,"Phi;":934,"Chi;":935,"Psi;":936,"Omega;":937,"alpha;":945,"beta;":946,"gamma;":947,"delta;":948,"epsilon;":949,"zeta;":950,"eta;":951,"theta;":952,"iota;":953,"kappa;":954,"lambda;":955,"mu;":956,"nu;":957,"xi;":958,"omicron;":959,"pi;":960,"rho;":961,"sigmaf;":962,"sigma;":963,"tau;":964,"upsilon;":965,"phi;":966,"chi;":967,"psi;":968,"omega;":969,"thetasym;":977,"upsih;":978,"piv;":982,"ensp;":8194,"emsp;":8195,"thinsp;":8201,"zwnj;":8204,"zwj;":8205,"lrm;":8206,"rlm;":8207,"ndash;":8211,"mdash;":8212,"lsquo;":8216,"rsquo;":8217,"sbquo;":8218,"ldquo;":8220,"rdquo;":8221,"bdquo;":8222,"dagger;":8224,"Dagger;":8225,"bull;":8226,"hellip;":8230,"permil;":8240,"prime;":8242,"Prime;":8243,"lsaquo;":8249,"rsaquo;":8250,"oline;":8254,"frasl;":8260,"euro;":8364,"image;":8465,"weierp;":8472,"real;":8476,"trade;":8482,"alefsym;":8501,"larr;":8592,"uarr;":8593,"rarr;":8594,"darr;":8595,"harr;":8596,"crarr;":8629,"lArr;":8656,"uArr;":8657,"rArr;":8658,"dArr;":8659,"hArr;":8660,"forall;":8704,"part;":8706,"exist;":8707,"empty;":8709,"nabla;":8711,"isin;":8712,"notin;":8713,"ni;":8715,"prod;":8719,"sum;":8721,"minus;":8722,"lowast;":8727,"radic;":8730,"prop;":8733,"infin;":8734,"ang;":8736,"and;":8743,"or;":8744,"cap;":8745,"cup;":8746,"int;":8747,"there4;":8756,"sim;":8764,"cong;":8773,"asymp;":8776,"ne;":8800,"equiv;":8801,"le;":8804,"ge;":8805,"sub;":8834,"sup;":8835,"nsub;":8836,"sube;":8838,"supe;":8839,"oplus;":8853,"otimes;":8855,"perp;":8869,"sdot;":8901,"lceil;":8968,"rceil;":8969,"lfloor;":8970,"rfloor;":8971,"lang;":9001,"rang;":9002,"loz;":9674,"spades;":9824,"clubs;":9827,"hearts;":9829,"diams;":9830}}.call(this),function(){this.Category=Backbone.Model.extend({displayName:function(){var e;return e=new I18n,e.category(this.get("name"))}})}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/about"]=function(){return this.Skim={access:function(e){var t;return t=this[e],"function"==typeof t&&(t=t.call(this)),t===!0?[this]:t===!1||null==t?!1:"[object Array]"!==Object.prototype.toString.call(t)?[t]:0===t.length?!1:t},withContext:function(e,t){var o,r;return o=function(e){var t;return t=function(){},t.prototype=e,new t},e=o(e),e.safe||(e.safe=this.safe||function(e){var t;return(null!=e?e.skimSafe:void 0)?e:(t=new String(null!=e?e:""),t.skimSafe=!0,t)}),e.isArray=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},e.flatten=r=function(e){var t,o,n,i;for(o=[],n=0,i=e.length;i>n;n++)t=e[n],t instanceof Array?o=o.concat(r(t)):o.push(t);return o},e.escape||(e.escape=this.escape||function(e){return null==e?"":e.skimSafe||!/[&<>\"]/.test(e)?e:this.safe(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),t.call(e)}},function(e){return null==e&&(e={}),Skim.withContext.call({},e,function(){var e;return e="",e+='<div class="about"><div class="container"><div class="row"><div class="col-md-5 col-lg-4"><div class="logo"></div></div><div class="col-md-7 col-lg-8"><h1>About</h1><p>The CocoaTree is a catalog of open source Objective-C projects.</p><p>It is based on <a href="http://cocoapods.org">CocoaPods</a> and was inspired by <a href="https://www.ruby-toolbox.com">The Ruby Toolbox</a>.</p><p>Created by <a href="http://github.com/bsingr">Jens Bissinger</a>.</p><p>Logo made with <span class="glyphicon glyphicon-heart"></span> by <a href="http://fabric8.de">fabric8</a>.</p></div></div></div></div>'})}}.call(this)}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/categories"]=function(){return this.Skim={access:function(e){var t;return t=this[e],"function"==typeof t&&(t=t.call(this)),t===!0?[this]:t===!1||null==t?!1:"[object Array]"!==Object.prototype.toString.call(t)?[t]:0===t.length?!1:t},withContext:function(e,t){var o,r;return o=function(e){var t;return t=function(){},t.prototype=e,new t},e=o(e),e.safe||(e.safe=this.safe||function(e){var t;return(null!=e?e.skimSafe:void 0)?e:(t=new String(null!=e?e:""),t.skimSafe=!0,t)}),e.isArray=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},e.flatten=r=function(e){var t,o,n,i;for(o=[],n=0,i=e.length;i>n;n++)t=e[n],t instanceof Array?o=o.concat(r(t)):o.push(t);return o},e.escape||(e.escape=this.escape||function(e){return null==e?"":e.skimSafe||!/[&<>\"]/.test(e)?e:this.safe(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),t.call(e)}},function(e){return null==e&&(e={}),Skim.withContext.call({},e,function(){var e,t,o,r,n,i;for(i="",i+='<div class="categories-header-container"><div class="container"><div class="categories-header-row"><div class="categories-header-col"><div class="col-md-5 col-lg-4"><div class="logo"></div></div><div class="col-md-7 col-lg-8"><p class="alert alert-warning">We need your help to add missing categories. Just send us your <a href="https://github.com/cocoa-tree/categories/edit/master/cocoa_pods_categories.json">pull-request</a>.</p><h1>CocoaTree</h1><p>The CocoaTree is a comprehensive catalog of open source Objective-C projects. In essence, it is based on the popular <a href="http://cocoapods.org">CocoaPods repository</a>. Additionally, popularity and activity ratings are calculated using data provided by <a href="https://github.com">GitHub</a>.</p></div></div></div></div></div><div class="categories-container"><div class="container"><div class="categories-row">',r=3,e=parseInt(this.categories.length/r),e*r<this.categories.length&&e++,o=0;r>o;){for(i+='<div class="categories-col">',n=e*o;e*(o+1)>n&&n<this.categories.length;)t=this.categories[n],i+='<li><a class="list-group-item" href="#pods/',i+=this.escape(t.get("name")),i+='"><span>',i+=this.escape(t.displayName()),i+='</span> <span class="badge badge-yellow">',i+=this.escape(t.get("cocoa_pods_count")),i+="</span></a></li>",n++;i+="</div>",o++}return i+='</div><div class="row"><div class="col-xs-12"><h1>',i+=this.escape(this.categories.length),i+=" Categories. ",i+=this.escape(this.totalPodsCount),i+=" CocoaPods.</h1></div></div></div></div>"})}}.call(this)}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/contribute"]=function(){return this.Skim={access:function(e){var t;return t=this[e],"function"==typeof t&&(t=t.call(this)),t===!0?[this]:t===!1||null==t?!1:"[object Array]"!==Object.prototype.toString.call(t)?[t]:0===t.length?!1:t},withContext:function(e,t){var o,r;return o=function(e){var t;return t=function(){},t.prototype=e,new t},e=o(e),e.safe||(e.safe=this.safe||function(e){var t;return(null!=e?e.skimSafe:void 0)?e:(t=new String(null!=e?e:""),t.skimSafe=!0,t)}),e.isArray=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},e.flatten=r=function(e){var t,o,n,i;for(o=[],n=0,i=e.length;i>n;n++)t=e[n],t instanceof Array?o=o.concat(r(t)):o.push(t);return o},e.escape||(e.escape=this.escape||function(e){return null==e?"":e.skimSafe||!/[&<>\"]/.test(e)?e:this.safe(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),t.call(e)}},function(e){return null==e&&(e={}),Skim.withContext.call({},e,function(){var e;return e="",e+='<div class="contribute"><div class="container"><div class="row"><div class="col-xs-12"><h1>Contribute</h1><p class="alert alert-warning">Please help us to add missing categories. Just send us your <strong><a href="https://github.com/cocoa-tree/categories/edit/master/cocoa_pods_categories.json">pull-request</a></strong>.</p></div><div class="col-md-6"><h2>Categorization</h2><p>Categories are created specifically for CocoaTree. </p><p>Each CocoaPod is mapped to a category in a JSON object in <a href="https://github.com/cocoa-tree/categories/blob/master/cocoa_pods_categories.json">cocoa_pods_categories.json</a>.</p><table class="table table-condensed"><tr><th>Scheme</th><th>Key: CocoaPod</th><th>Value: Category</th></tr><tr><th>Example</th><td>"500px-iOS-api"</td><td>"proprietary_api"</td></tr></table><p>Changes within the categories file are automatically detected and are deployed within 24 hours.</p></div><div class="col-md-6"><h2>Report an Issue</h2><p>Please file bugs, proposals or questions on  <a href="https://github.com/bsingr/cocoa-tree/issues">this GitHub Issues page</a>.</p><h2>Site and data sources</h2><p>This site is is built via <a href="https://github.com/bsingr/cocoa-tree">github.com/bsingr/cocoa-tree</a>. Basically, it is just a static site with a development environment based on <a href="https://github.com/bsingr/rails-zero#readme">RailsZero</a>.</p><p>The data is fetched from <a href="https://github.com/cocoapods/Specs">CocoaPods Specs</a> and <a href="https://developer.github.com/v3/">GitHub API</a>. Synchronization and preprocessing is done via <a href="https://github.com/bsingr/cocoa-tree-seeds">github.com/bsingr/cocoa-tree-seeds</a>.</p></div></div></div></div>'})}}.call(this)}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/empty"]=function(){return this.Skim={access:function(e){var t;return t=this[e],"function"==typeof t&&(t=t.call(this)),t===!0?[this]:t===!1||null==t?!1:"[object Array]"!==Object.prototype.toString.call(t)?[t]:0===t.length?!1:t},withContext:function(e,t){var o,r;return o=function(e){var t;return t=function(){},t.prototype=e,new t},e=o(e),e.safe||(e.safe=this.safe||function(e){var t;return(null!=e?e.skimSafe:void 0)?e:(t=new String(null!=e?e:""),t.skimSafe=!0,t)}),e.isArray=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},e.flatten=r=function(e){var t,o,n,i;for(o=[],n=0,i=e.length;i>n;n++)t=e[n],t instanceof Array?o=o.concat(r(t)):o.push(t);return o},e.escape||(e.escape=this.escape||function(e){return null==e?"":e.skimSafe||!/[&<>\"]/.test(e)?e:this.safe(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),t.call(e)}},function(e){return null==e&&(e={}),Skim.withContext.call({},e,function(){var e;return e="",e+='<div class="empty"><h1>Fetching Data...</h1><p>Synchronizing with the <a href="https://github.com/cocoa-tree/seeds">Seeds repository</a> and calculating category system.</p></div>'})}}.call(this)}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/navigation"]=function(){return this.Skim={access:function(e){var t;return t=this[e],"function"==typeof t&&(t=t.call(this)),t===!0?[this]:t===!1||null==t?!1:"[object Array]"!==Object.prototype.toString.call(t)?[t]:0===t.length?!1:t},withContext:function(e,t){var o,r;return o=function(e){var t;return t=function(){},t.prototype=e,new t},e=o(e),e.safe||(e.safe=this.safe||function(e){var t;return(null!=e?e.skimSafe:void 0)?e:(t=new String(null!=e?e:""),t.skimSafe=!0,t)}),e.isArray=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},e.flatten=r=function(e){var t,o,n,i;for(o=[],n=0,i=e.length;i>n;n++)t=e[n],t instanceof Array?o=o.concat(r(t)):o.push(t);return o},e.escape||(e.escape=this.escape||function(e){return null==e?"":e.skimSafe||!/[&<>\"]/.test(e)?e:this.safe(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),t.call(e)}},function(e){return null==e&&(e={}),Skim.withContext.call({},e,function(){var e;return e="",e+='<div class="navbar-container"><div class="navbar navbar-inverse" data-offset-top="50" data-spy="affix"><div class="container"><div class="navbar-header"><button class="navbar-toggle" data-target="#main-nav" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand">CocoaTree</a></div><div class="collapse navbar-collapse" id="main-nav"><ul class="nav navbar-nav"><li><a href="#">Categories</a></li><li><a href="#pods/all">All</a></li></ul><ul class="nav navbar-nav navbar-right"><li><a href="#about">About</a></li><li><a href="#contribute">Contribute</a></li></ul></div></div></div></div>'})}}.call(this)}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/pods"]=function(){return this.Skim={access:function(e){var t;return t=this[e],"function"==typeof t&&(t=t.call(this)),t===!0?[this]:t===!1||null==t?!1:"[object Array]"!==Object.prototype.toString.call(t)?[t]:0===t.length?!1:t},withContext:function(e,t){var o,r;return o=function(e){var t;return t=function(){},t.prototype=e,new t},e=o(e),e.safe||(e.safe=this.safe||function(e){var t;return(null!=e?e.skimSafe:void 0)?e:(t=new String(null!=e?e:""),t.skimSafe=!0,t)}),e.isArray=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},e.flatten=r=function(e){var t,o,n,i;for(o=[],n=0,i=e.length;i>n;n++)t=e[n],t instanceof Array?o=o.concat(r(t)):o.push(t);return o},e.escape||(e.escape=this.escape||function(e){return null==e?"":e.skimSafe||!/[&<>\"]/.test(e)?e:this.safe(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),t.call(e)}},function(e){return null==e&&(e={}),Skim.withContext.call({},e,function(){var e,t,o,r,n,i,s,a,g,d,u,l,c,h,p,f,y,b;for(r="",r+='<div class="pods-container"><div class="pods">',u=this.podsList.pods(),n=0,a=u.length;a>n;n++){switch(o=u[n],r+='<div class="row pod" data-target="#pod-',r+=this.escape(o.id),r+='" data-toggle="collapse"><div class="col-xs-12 col-md-6 meta part"><div class="title"><a',h=o.id){case!0:r+=' name="name"';break;case!1:case null:break;default:r+=' name="',r+=this.escape(h),r+='"'}switch(r+=">",r+=this.escape(o.name),r+='</a></div><div class="summary">',r+=this.escape(o.summary),r+='</div><a class="category" href="#pods/',r+=this.escape(o.category),r+='">',r+=this.escape(this.i18n.category(o.category)),r+='</a><span class="dependencies">',r+=this.escape(o.dependencies.length),r+=this.escape(" Dependencies"),r+='</span></div><div class="col-xs-4 col-md-2 version part"><div class="row"><span class="glyphicon glyphicon-flag"></span></div><div class="row">',r+=this.escape(o.version),r+='</div></div><div class="col-xs-4 col-md-2 stars part"><div class="row"><span class="glyphicon glyphicon-heart"></span></div><div class="row">',o.stars>-1&&(r+=this.escape(o.stars)),r+='</div></div><div class="col-xs-4 col-md-2 activity part"><div class="row"><span class="glyphicon glyphicon-time"></span></div><div class="row"><time class="timeago"',p=o.pushed_at){case!0:r+=' datetime="datetime"';break;case!1:case null:break;default:r+=' datetime="',r+=this.escape(p),r+='"'}switch(r+=">",r+=this.escape(o.pushed_at),r+='</time></div></div></div><div class="row collapse pod-details" id="pod-',r+=this.escape(o.id),r+='"><div class="col-xs-12 links"><a class="col-xs-4"',f=o.website_url){case!0:r+=' href="href"';break;case!1:case null:break;default:r+=' href="',r+=this.escape(f),r+='"'}switch(r+='><span class="glyphicon glyphicon-home"></span> <span>Website</span></a><a class="col-xs-4"',y=o.doc_url){case!0:r+=' href="href"';break;case!1:case null:break;default:r+=' href="',r+=this.escape(y),r+='"'}switch(r+='><span class="glyphicon glyphicon-book"></span> <span>Doc</span></a><a class="col-xs-4"',b=o.source_url){case!0:r+=' href="href"';break;case!1:case null:break;default:r+=' href="',r+=this.escape(b),r+='"'}if(r+='><span class="glyphicon glyphicon-inbox"></span> <span>Source</span></a></div><div class="col-xs-12 dependencies">',o.dependencies.length)for(r+="<h1>This library depends on the following CocoaPods:</h1>",l=o.dependencies,i=0,g=l.length;g>i;i++)e=l[i],r+='<div class="dependency"><div class="col-xs-6 name"><a href="#pod/',r+=this.escape(e.name),r+='">',r+=this.escape(e.name),r+='</a></div><div class="col-xs-6 version">',r+=this.escape(e.requirement),r+="</div></div>";else r+="<h1>This library depends on no other CocoaPod.</h1>";if(r+='</div><div class="col-xs-12 dependents">',o.dependents.length)for(r+="<h1>Other CocoaPods that depend on this library:</h1>",c=o.dependents,s=0,d=c.length;d>s;s++)t=c[s],r+='<div class="col-xs-4 name"><a href="#pod/',r+=this.escape(t.name),r+='">',r+=this.escape(t.name),r+="</a></div>";else r+="<h1>No other CocoaPods depends on this library.</h1>";r+="</div></div>"}return r+="</div></div>"})}}.call(this)}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/pods_navigation"]=function(){return this.Skim={access:function(e){var t;return t=this[e],"function"==typeof t&&(t=t.call(this)),t===!0?[this]:t===!1||null==t?!1:"[object Array]"!==Object.prototype.toString.call(t)?[t]:0===t.length?!1:t},withContext:function(e,t){var o,r;return o=function(e){var t;return t=function(){},t.prototype=e,new t},e=o(e),e.safe||(e.safe=this.safe||function(e){var t;return(null!=e?e.skimSafe:void 0)?e:(t=new String(null!=e?e:""),t.skimSafe=!0,t)}),e.isArray=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},e.flatten=r=function(e){var t,o,n,i;for(o=[],n=0,i=e.length;i>n;n++)t=e[n],t instanceof Array?o=o.concat(r(t)):o.push(t);return o},e.escape||(e.escape=this.escape||function(e){return null==e?"":e.skimSafe||!/[&<>\"]/.test(e)?e:this.safe(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),t.call(e)}},function(e){return null==e&&(e={}),Skim.withContext.call({},e,function(){var e,t,o,r,n,i,s,a;for(n="",n+='<div class="pods-container"><div class="pods-container-head"><div class="row"><div class="col-md-4"><ol class="breadcrumb"><li><a href="#pods/all">All</a>',"all"===this.filterBy&&(n+=' <div class="badge">',n+=this.escape(this.podsList.totalCount),n+="</div>"),n+="</li>","all"!==this.filterBy&&(n+='<li><a href="#pods/',n+=this.escape(this.filterBy),n+='">',n+=this.escape((new I18n).category(this.filterBy)),n+='</a> <div class="badge">',n+=this.escape(this.podsList.totalCount),n+="</div></li>"),n+='</ol></div><div class="col-md-8"><ul class="pagination pagination-sm">',this.podsList.has_prev()?(n+='<li><a href="#pods/',n+=this.escape(this.filterBy),n+="/",n+=this.escape(this.sortBy),n+="/",n+=this.escape(this.podsList.previous_offset()),n+='">&laquo;</a></li>'):n+='<li class="disabled"><a>&laquo;</a></li>',e=0,t=0;t<this.podsList.totalCount;)o=this.podsList.paginationPosition(t),"current"===o?(n+='<li class="active"><a>',n+=this.escape(e+1),n+='<span class="sr-only" current="current"></span></a></li>'):"within"===o?(n+='<li><a href="#pods/',n+=this.escape(this.filterBy),n+="/",n+=this.escape(this.sortBy),n+="/",n+=this.escape(t),n+='">',n+=this.escape(e+1),n+="</a></li>"):"barrier"===o&&(n+="<li><a>",n+=this.escape("..."),n+="</a></li>"),e++,t=e*this.podsList.maxPerPage;for(this.podsList.has_next()?(n+='<li><a href="#pods/',n+=this.escape(this.filterBy),n+="/",n+=this.escape(this.sortBy),n+="/",n+=this.escape(this.podsList.next_offset()),n+='">&raquo;</a></li>'):n+='<li class="disabled"><a>&raquo;</a></li>',n+='</ul><div class="btn-group sort-ctrl">',a=this.sortByList,i=0,s=a.length;s>i;i++)r=a[i],r.name===this.sortBy?(n+='<a class="btn btn-default active" href="#pods/',n+=this.escape(this.filterBy),n+="/",n+=this.escape(r.name),n+='">',n+=this.escape(r.displayName),n+="</a>"):(n+='<a class="btn btn-default" href="#pods/',n+=this.escape(this.filterBy),n+="/",n+=this.escape(r.name),n+='">',n+=this.escape(r.displayName),n+="</a>");return n+="</div></div></div></div></div>"})}}.call(this)}.call(this),function(){this.AboutView=Backbone.View.extend({template:JST["templates/about"],el:"#main-view",render:function(){var e;return e=this.template(),this.$el.html(e),this}})}.call(this),function(){this.CategoriesView=Backbone.View.extend({template:JST["templates/categories"],el:"#main-view",render:function(e,t){var o;return o=this.template({categories:e,totalPodsCount:t}),this.$el.html(o),this}})}.call(this),function(){this.ContributeView=Backbone.View.extend({template:JST["templates/contribute"],el:"#main-view",render:function(){var e;return e=this.template(),this.$el.html(e),this}})}.call(this),function(){this.EmptyView=Backbone.View.extend({template:JST["templates/empty"],el:"#main-view",render:function(){return this.$el.html(this.template()),this}})}.call(this),function(){this.Navigation=Backbone.View.extend({template:JST["templates/navigation"],el:".navbar-container",render:function(){return this.$el.html(this.template())}})}.call(this),function(){this.PodsNavigationView=Backbone.View.extend({template:JST["templates/pods_navigation"],el:"#main-view",render:function(e,t,o){var r,n,i;return i=[{name:"stars",displayName:"Popularity"},{name:"pushed_at",displayName:"Activity"},{name:"name",displayName:"Name"}],n={podsList:e,sortBy:t,sortByList:i,filterBy:o},r=n,this.$el.append(this.template(n)),this}})}.call(this),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){function t(){var t=o(this),s=i.settings;return isNaN(t.datetime)||(0==s.cutoff||n(t.datetime)<s.cutoff)&&e(this).text(r(t.datetime)),this}function o(t){if(t=e(t),!t.data("timeago")){t.data("timeago",{datetime:i.datetime(t)});var o=e.trim(t.text());i.settings.localeTitle?t.attr("title",t.data("timeago").datetime.toLocaleString()):!(o.length>0)||i.isTime(t)&&t.attr("title")||t.attr("title",o)}return t.data("timeago")}function r(e){return i.inWords(n(e))}function n(e){return(new Date).getTime()-e.getTime()}e.timeago=function(t){return t instanceof Date?r(t):"string"==typeof t?r(e.timeago.parse(t)):"number"==typeof t?r(new Date(t)):r(e.timeago.datetime(t))};var i=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(t){function o(o,n){var i=e.isFunction(o)?o(n,t):o,s=r.numbers&&r.numbers[n]||n;return i.replace(/%d/i,s)}var r=this.settings.strings,n=r.prefixAgo,i=r.suffixAgo;this.settings.allowFuture&&0>t&&(n=r.prefixFromNow,i=r.suffixFromNow);var s=Math.abs(t)/1e3,a=s/60,g=a/60,d=g/24,u=d/365,l=45>s&&o(r.seconds,Math.round(s))||90>s&&o(r.minute,1)||45>a&&o(r.minutes,Math.round(a))||90>a&&o(r.hour,1)||24>g&&o(r.hours,Math.round(g))||42>g&&o(r.day,1)||30>d&&o(r.days,Math.round(d))||45>d&&o(r.month,1)||365>d&&o(r.months,Math.round(d/30))||1.5>u&&o(r.year,1)||o(r.years,Math.round(u)),c=r.wordSeparator||"";return void 0===r.wordSeparator&&(c=" "),e.trim([n,l,i].join(c))},parse:function(t){var o=e.trim(t);return o=o.replace(/\.\d+/,""),o=o.replace(/-/,"/").replace(/-/,"/"),o=o.replace(/T/," ").replace(/Z/," UTC"),o=o.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),o=o.replace(/([\+\-]\d\d)$/," $100"),new Date(o)},datetime:function(t){var o=i.isTime(t)?e(t).attr("datetime"):e(t).attr("title");return i.parse(o)},isTime:function(t){return"time"===e(t).get(0).tagName.toLowerCase()}});var s={init:function(){var o=e.proxy(t,this);o();var r=i.settings;r.refreshMillis>0&&(this._timeagoInterval=setInterval(o,r.refreshMillis))},update:function(o){var r=i.parse(o);e(this).data("timeago",{datetime:r}),i.settings.localeTitle&&e(this).attr("title",r.toLocaleString()),t.apply(this)},updateFromDOM:function(){e(this).data("timeago",{datetime:i.parse(i.isTime(this)?e(this).attr("datetime"):e(this).attr("title"))}),t.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};e.fn.timeago=function(e,t){var o=e?s[e]:s.init;if(!o)throw new Error("Unknown function name '"+e+"' for timeago");return this.each(function(){o.call(this,t)}),this},document.createElement("abbr"),document.createElement("time")}),function(){this.PodsView=Backbone.View.extend({template:JST["templates/pods"],el:"#main-view",render:function(e){var t;return t=this.template({podsList:e,i18n:new I18n}),this.$el.append(t),this.$el.find(".timeago").timeago(),this}})}.call(this),function(){var e=[].slice;this.Logger=function(){function t(e,t){this.level=t,this.env=e;try{this.console=console}catch(o){}}return t.prototype.levels={error:0,warn:1,info:2,verbose:3},t.prototype.error=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],this.log.apply(this,["error"].concat(e.call(t)))},t.prototype.warn=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],this.log.apply(this,["warn"].concat(e.call(t)))},t.prototype.info=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],this.log.apply(this,["info"].concat(e.call(t)))},t.prototype.verbose=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],this.log.apply(this,["verbose"].concat(e.call(t)))},t.prototype.log=function(){var t,o,r;return t=arguments[0],r=2<=arguments.length?e.call(arguments,1):[],this.levels[t]<=this.levels[this.level]&&this.console&&this.console.log?(o=[new Date,this.env].concat(r),this.console.log(o.join(" "))):void 0},t}()}.call(this),function(){this.PodsLoader=function(){function e(e,t){this.seedsURL=e,this.chunk_index=t}return e.prototype.delegate=null,e.prototype.requests=[],e.prototype.running=0,e.prototype.finished=0,e.prototype.progress=function(){return this.finished/(this.finished+this.running)},e.prototype.cancel=function(){var e,t,o,r;for(r=this.requests,t=0,o=r.length;o>t;t++)e=r[t],e.abort();return this.requests=[],this.running=0,this.finished=0},e.prototype.loadPods=function(){var e,t,o,r,n;for(this.cancel(),r=this.chunk_index,n=[],t=0,o=r.length;o>t;t++)e=r[t],n.push(this.loadPodsChunk(e[0]));return n},e.prototype.loadPodsChunk=function(e){var t,o;return t=this,o=new XMLHttpRequest,o.open("GET",this.seedsURL+"/"+e+".json",!0),o.onload=function(){var o;return o=JSON.parse(this.response),t.podsChunkDidLoad(e,o)},o.send(),this.requests.push(o),this.running+=1},e.prototype.podsChunkDidLoad=function(e,t){return this.running-=1,this.finished+=1,this.delegate&&(this.delegate.didLoad&&this.delegate.didLoad(e,t),this.delegate.didLoadAll&&1===this.progress())?this.delegate.didLoadAll():void 0},e}()}.call(this),function(){this.SeedsIndex=function(){function e(e){this.seedsURL=e}return e.prototype.load=function(e){var t,o;return t=this,o=new XMLHttpRequest,o.open("GET",this.seedsURL+".json",!0),o.onload=function(){return t.index=JSON.parse(this.response),e(t)},o.send()},e}()}.call(this),function(e,t,o,r,n,i,s){e.GoogleAnalyticsObject=n,e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},e[n].l=1*new Date,i=t.createElement(o),s=t.getElementsByTagName(o)[0],i.async=1,i.src=r,s.parentNode.insertBefore(i,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-50070521-1","cocoa-tree.github.io");var lunr=function(e){var t=new lunr.Index;return t.pipeline.add(lunr.stopWordFilter,lunr.stemmer),e&&e.call(t,t),t};lunr.version="0.4.5","undefined"!=typeof module&&(module.exports=lunr),lunr.utils={},lunr.utils.warn=function(e){return function(t){e.console&&console.warn&&console.warn(t)}}(this),lunr.utils.zeroFillArray=function(){var e=[0];return function(t){for(;e.length<t;)e=e.concat(e);return e.slice(0,t)}}(),lunr.EventEmitter=function(){this.events={}},lunr.EventEmitter.prototype.addListener=function(){var e=Array.prototype.slice.call(arguments),t=e.pop(),o=e;if("function"!=typeof t)throw new TypeError("last argument must be a function");o.forEach(function(e){this.hasHandler(e)||(this.events[e]=[]),this.events[e].push(t)},this)},lunr.EventEmitter.prototype.removeListener=function(e,t){if(this.hasHandler(e)){var o=this.events[e].indexOf(t);this.events[e].splice(o,1),this.events[e].length||delete this.events[e]}},lunr.EventEmitter.prototype.emit=function(e){if(this.hasHandler(e)){var t=Array.prototype.slice.call(arguments,1);this.events[e].forEach(function(e){e.apply(void 0,t)})}},lunr.EventEmitter.prototype.hasHandler=function(e){return e in this.events},lunr.tokenizer=function(e){if(!arguments.length||null==e||void 0==e)return[];if(Array.isArray(e))return e.map(function(e){return e.toLowerCase()});for(var t=e.toString().replace(/^\s+/,""),o=t.length-1;o>=0;o--)if(/\S/.test(t.charAt(o))){t=t.substring(0,o+1);break}return t.split(/\s+/).map(function(e){return e.replace(/^\W+/,"").replace(/\W+$/,"").toLowerCase()})},lunr.Pipeline=function(){this._stack=[]},lunr.Pipeline.registeredFunctions={},lunr.Pipeline.registerFunction=function(e,t){t in this.registeredFunctions&&lunr.utils.warn("Overwriting existing registered function: "+t),e.label=t,lunr.Pipeline.registeredFunctions[e.label]=e
},lunr.Pipeline.warnIfFunctionNotRegistered=function(e){var t=e.label&&e.label in this.registeredFunctions;t||lunr.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",e)},lunr.Pipeline.load=function(e){var t=new lunr.Pipeline;return e.forEach(function(e){var o=lunr.Pipeline.registeredFunctions[e];if(!o)throw new Error("Cannot load un-registered function: "+e);t.add(o)}),t},lunr.Pipeline.prototype.add=function(){var e=Array.prototype.slice.call(arguments);e.forEach(function(e){lunr.Pipeline.warnIfFunctionNotRegistered(e),this._stack.push(e)},this)},lunr.Pipeline.prototype.after=function(e,t){lunr.Pipeline.warnIfFunctionNotRegistered(t);var o=this._stack.indexOf(e)+1;this._stack.splice(o,0,t)},lunr.Pipeline.prototype.before=function(e,t){lunr.Pipeline.warnIfFunctionNotRegistered(t);var o=this._stack.indexOf(e);this._stack.splice(o,0,t)},lunr.Pipeline.prototype.remove=function(e){var t=this._stack.indexOf(e);this._stack.splice(t,1)},lunr.Pipeline.prototype.run=function(e){for(var t=[],o=e.length,r=this._stack.length,n=0;o>n;n++){for(var i=e[n],s=0;r>s&&(i=this._stack[s](i,n,e),void 0!==i);s++);void 0!==i&&t.push(i)}return t},lunr.Pipeline.prototype.toJSON=function(){return this._stack.map(function(e){return lunr.Pipeline.warnIfFunctionNotRegistered(e),e.label})},lunr.Vector=function(e){this.elements=e},lunr.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;for(var e,t=0,o=this.elements,r=o.length,n=0;r>n;n++)e=o[n],t+=e*e;return this._magnitude=Math.sqrt(t)},lunr.Vector.prototype.dot=function(e){for(var t=this.elements,o=e.elements,r=t.length,n=0,i=0;r>i;i++)n+=t[i]*o[i];return n},lunr.Vector.prototype.similarity=function(e){return this.dot(e)/(this.magnitude()*e.magnitude())},lunr.Vector.prototype.toArray=function(){return this.elements},lunr.SortedSet=function(){this.length=0,this.elements=[]},lunr.SortedSet.load=function(e){var t=new this;return t.elements=e,t.length=e.length,t},lunr.SortedSet.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(e){~this.indexOf(e)||this.elements.splice(this.locationFor(e),0,e)},this),this.length=this.elements.length},lunr.SortedSet.prototype.toArray=function(){return this.elements.slice()},lunr.SortedSet.prototype.map=function(e,t){return this.elements.map(e,t)},lunr.SortedSet.prototype.forEach=function(e,t){return this.elements.forEach(e,t)},lunr.SortedSet.prototype.indexOf=function(e,t,o){var t=t||0,o=o||this.elements.length,r=o-t,n=t+Math.floor(r/2),i=this.elements[n];return 1>=r?i===e?n:-1:e>i?this.indexOf(e,n,o):i>e?this.indexOf(e,t,n):i===e?n:void 0},lunr.SortedSet.prototype.locationFor=function(e,t,o){var t=t||0,o=o||this.elements.length,r=o-t,n=t+Math.floor(r/2),i=this.elements[n];if(1>=r){if(i>e)return n;if(e>i)return n+1}return e>i?this.locationFor(e,n,o):i>e?this.locationFor(e,t,n):void 0},lunr.SortedSet.prototype.intersect=function(e){for(var t=new lunr.SortedSet,o=0,r=0,n=this.length,i=e.length,s=this.elements,a=e.elements;;){if(o>n-1||r>i-1)break;s[o]!==a[r]?s[o]<a[r]?o++:s[o]>a[r]&&r++:(t.add(s[o]),o++,r++)}return t},lunr.SortedSet.prototype.clone=function(){var e=new lunr.SortedSet;return e.elements=this.toArray(),e.length=e.elements.length,e},lunr.SortedSet.prototype.union=function(e){var t,o,r;return this.length>=e.length?(t=this,o=e):(t=e,o=this),r=t.clone(),r.add.apply(r,o.toArray()),r},lunr.SortedSet.prototype.toJSON=function(){return this.toArray()},lunr.Index=function(){this._fields=[],this._ref="id",this.pipeline=new lunr.Pipeline,this.documentStore=new lunr.Store,this.tokenStore=new lunr.TokenStore,this.corpusTokens=new lunr.SortedSet,this.eventEmitter=new lunr.EventEmitter,this._idfCache={},this.on("add","remove","update",function(){this._idfCache={}}.bind(this))},lunr.Index.prototype.on=function(){var e=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,e)},lunr.Index.prototype.off=function(e,t){return this.eventEmitter.removeListener(e,t)},lunr.Index.load=function(e){e.version!==lunr.version&&lunr.utils.warn("version mismatch: current "+lunr.version+" importing "+e.version);var t=new this;return t._fields=e.fields,t._ref=e.ref,t.documentStore=lunr.Store.load(e.documentStore),t.tokenStore=lunr.TokenStore.load(e.tokenStore),t.corpusTokens=lunr.SortedSet.load(e.corpusTokens),t.pipeline=lunr.Pipeline.load(e.pipeline),t},lunr.Index.prototype.field=function(e,t){var t=t||{},o={name:e,boost:t.boost||1};return this._fields.push(o),this},lunr.Index.prototype.ref=function(e){return this._ref=e,this},lunr.Index.prototype.add=function(e,t){var o={},r=new lunr.SortedSet,n=e[this._ref],t=void 0===t?!0:t;this._fields.forEach(function(t){var n=this.pipeline.run(lunr.tokenizer(e[t.name]));o[t.name]=n,lunr.SortedSet.prototype.add.apply(r,n)},this),this.documentStore.set(n,r),lunr.SortedSet.prototype.add.apply(this.corpusTokens,r.toArray());for(var i=0;i<r.length;i++){var s=r.elements[i],a=this._fields.reduce(function(e,t){var r=o[t.name].length;if(!r)return e;var n=o[t.name].filter(function(e){return e===s}).length;return e+n/r*t.boost},0);this.tokenStore.add(s,{ref:n,tf:a})}t&&this.eventEmitter.emit("add",e,this)},lunr.Index.prototype.remove=function(e,t){var o=e[this._ref],t=void 0===t?!0:t;if(this.documentStore.has(o)){var r=this.documentStore.get(o);this.documentStore.remove(o),r.forEach(function(e){this.tokenStore.remove(e,o)},this),t&&this.eventEmitter.emit("remove",e,this)}},lunr.Index.prototype.update=function(e,t){var t=void 0===t?!0:t;this.remove(e,!1),this.add(e,!1),t&&this.eventEmitter.emit("update",e,this)},lunr.Index.prototype.idf=function(e){var t="@"+e;if(Object.prototype.hasOwnProperty.call(this._idfCache,t))return this._idfCache[t];var o=this.tokenStore.count(e),r=1;return o>0&&(r=1+Math.log(this.tokenStore.length/o)),this._idfCache[t]=r},lunr.Index.prototype.search=function(e){var t=this.pipeline.run(lunr.tokenizer(e)),o=lunr.utils.zeroFillArray(this.corpusTokens.length),r=[],n=this._fields.reduce(function(e,t){return e+t.boost},0),i=t.some(function(e){return this.tokenStore.has(e)},this);if(!i)return[];t.forEach(function(e,t,i){var s=1/i.length*this._fields.length*n,a=this,g=this.tokenStore.expand(e).reduce(function(t,r){var n=a.corpusTokens.indexOf(r),i=a.idf(r),g=1,d=new lunr.SortedSet;if(r!==e){var u=Math.max(3,r.length-e.length);g=1/Math.log(u)}return n>-1&&(o[n]=s*i*g),Object.keys(a.tokenStore.get(r)).forEach(function(e){d.add(e)}),t.union(d)},new lunr.SortedSet);r.push(g)},this);var s=r.reduce(function(e,t){return e.intersect(t)}),a=new lunr.Vector(o);return s.map(function(e){return{ref:e,score:a.similarity(this.documentVector(e))}},this).sort(function(e,t){return t.score-e.score})},lunr.Index.prototype.documentVector=function(e){for(var t=this.documentStore.get(e),o=t.length,r=lunr.utils.zeroFillArray(this.corpusTokens.length),n=0;o>n;n++){var i=t.elements[n],s=this.tokenStore.get(i)[e].tf,a=this.idf(i);r[this.corpusTokens.indexOf(i)]=s*a}return new lunr.Vector(r)},lunr.Index.prototype.toJSON=function(){return{version:lunr.version,fields:this._fields,ref:this._ref,documentStore:this.documentStore.toJSON(),tokenStore:this.tokenStore.toJSON(),corpusTokens:this.corpusTokens.toJSON(),pipeline:this.pipeline.toJSON()}},lunr.Store=function(){this.store={},this.length=0},lunr.Store.load=function(e){var t=new this;return t.length=e.length,t.store=Object.keys(e.store).reduce(function(t,o){return t[o]=lunr.SortedSet.load(e.store[o]),t},{}),t},lunr.Store.prototype.set=function(e,t){this.store[e]=t,this.length=Object.keys(this.store).length},lunr.Store.prototype.get=function(e){return this.store[e]},lunr.Store.prototype.has=function(e){return e in this.store},lunr.Store.prototype.remove=function(e){this.has(e)&&(delete this.store[e],this.length--)},lunr.Store.prototype.toJSON=function(){return{store:this.store,length:this.length}},lunr.stemmer=function(){var e={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},t={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},o="[^aeiou]",r="[aeiouy]",n=o+"[^aeiouy]*",i=r+"[aeiou]*",s="^("+n+")?"+i+n,a="^("+n+")?"+i+n+"("+i+")?$",g="^("+n+")?"+i+n+i+n,d="^("+n+")?"+r;return function(o){var i,u,l,c,h,p,f;if(o.length<3)return o;if(l=o.substr(0,1),"y"==l&&(o=l.toUpperCase()+o.substr(1)),c=/^(.+?)(ss|i)es$/,h=/^(.+?)([^s])s$/,c.test(o)?o=o.replace(c,"$1$2"):h.test(o)&&(o=o.replace(h,"$1$2")),c=/^(.+?)eed$/,h=/^(.+?)(ed|ing)$/,c.test(o)){var y=c.exec(o);c=new RegExp(s),c.test(y[1])&&(c=/.$/,o=o.replace(c,""))}else if(h.test(o)){var y=h.exec(o);i=y[1],h=new RegExp(d),h.test(i)&&(o=i,h=/(at|bl|iz)$/,p=new RegExp("([^aeiouylsz])\\1$"),f=new RegExp("^"+n+r+"[^aeiouwxy]$"),h.test(o)?o+="e":p.test(o)?(c=/.$/,o=o.replace(c,"")):f.test(o)&&(o+="e"))}if(c=/^(.+?)y$/,c.test(o)){var y=c.exec(o);i=y[1],c=new RegExp(d),c.test(i)&&(o=i+"i")}if(c=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,c.test(o)){var y=c.exec(o);i=y[1],u=y[2],c=new RegExp(s),c.test(i)&&(o=i+e[u])}if(c=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,c.test(o)){var y=c.exec(o);i=y[1],u=y[2],c=new RegExp(s),c.test(i)&&(o=i+t[u])}if(c=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,h=/^(.+?)(s|t)(ion)$/,c.test(o)){var y=c.exec(o);i=y[1],c=new RegExp(g),c.test(i)&&(o=i)}else if(h.test(o)){var y=h.exec(o);i=y[1]+y[2],h=new RegExp(g),h.test(i)&&(o=i)}if(c=/^(.+?)e$/,c.test(o)){var y=c.exec(o);i=y[1],c=new RegExp(g),h=new RegExp(a),p=new RegExp("^"+n+r+"[^aeiouwxy]$"),(c.test(i)||h.test(i)&&!p.test(i))&&(o=i)}return c=/ll$/,h=new RegExp(g),c.test(o)&&h.test(o)&&(c=/.$/,o=o.replace(c,"")),"y"==l&&(o=l.toLowerCase()+o.substr(1)),o}}(),lunr.Pipeline.registerFunction(lunr.stemmer,"stemmer"),lunr.stopWordFilter=function(e){return-1===lunr.stopWordFilter.stopWords.indexOf(e)?e:void 0},lunr.stopWordFilter.stopWords=new lunr.SortedSet,lunr.stopWordFilter.stopWords.length=119,lunr.stopWordFilter.stopWords.elements=["","a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"],lunr.Pipeline.registerFunction(lunr.stopWordFilter,"stopWordFilter"),lunr.TokenStore=function(){this.root={docs:{}},this.length=0},lunr.TokenStore.load=function(e){var t=new this;return t.root=e.root,t.length=e.length,t},lunr.TokenStore.prototype.add=function(e,t,o){var o=o||this.root,r=e[0],n=e.slice(1);return r in o||(o[r]={docs:{}}),0===n.length?(o[r].docs[t.ref]=t,this.length+=1,void 0):this.add(n,t,o[r])},lunr.TokenStore.prototype.has=function(e){if(!e)return!1;for(var t=this.root,o=0;o<e.length;o++){if(!t[e[o]])return!1;t=t[e[o]]}return!0},lunr.TokenStore.prototype.getNode=function(e){if(!e)return{};for(var t=this.root,o=0;o<e.length;o++){if(!t[e[o]])return{};t=t[e[o]]}return t},lunr.TokenStore.prototype.get=function(e,t){return this.getNode(e,t).docs||{}},lunr.TokenStore.prototype.count=function(e,t){return Object.keys(this.get(e,t)).length},lunr.TokenStore.prototype.remove=function(e,t){if(e){for(var o=this.root,r=0;r<e.length;r++){if(!(e[r]in o))return;o=o[e[r]]}delete o.docs[t]}},lunr.TokenStore.prototype.expand=function(e,t){var o=this.getNode(e),r=o.docs||{},t=t||[];return Object.keys(r).length&&t.push(e),Object.keys(o).forEach(function(o){"docs"!==o&&t.concat(this.expand(e+o,t))},this),t},lunr.TokenStore.prototype.toJSON=function(){return{root:this.root,length:this.length}},function(){this.AppController=function(){function e(e,t){var o;this.store=t,this.store.delegates.push(this),this.podsController=new PodsController(this.store),this.categoriesController=new CategoriesController(this.store),this.seedsSyncController=new SeedsSyncController(this.store,e),this.seedsSyncController.delegate=this,o=new Navigation,o.render(),this.renderEmptyView()}return e.prototype.current=null,e.prototype.loadPods=function(){return this.seedsSyncController.sync()},e.prototype.seedsSyncControllerDidSyncCategories=function(){return this.update()},e.prototype.seedsSyncControllerDidSyncPods=function(){return this.update()},e.prototype.update=function(){return logger.verbose("AppController#update current=",this.current),"categories"===this.current?this.displayCategories():"pods"===this.current?this.displayPods():"about"===this.current?this.displayAbout():"contribute"===this.current?this.displayContribute():void 0},e.prototype.displayPodsAndUpdateScope=function(e,t,o){return this.podsController.updateScope(t,o,e),this.displayPods()},e.prototype.displayPod=function(e){return logger.verbose("AppController#displayPod",e),this.store.findPod(e).then(function(e){var t;return e.length?($("#main-view").empty(),t=new PodsList(1,e,0,1),(new PodsView).render(t)):renderEmptyView()})},e.prototype.displayPods=function(){return logger.verbose("AppController#displayPods"),this.current="pods",this.podsController.load().then(function(e){return function(t){return t.pods.length?e.podsController.render(t.count,t.pods):e.renderEmptyView()}}(this))},e.prototype.displayCategories=function(){return this.current="categories",this.categoriesController.load().then(function(e){return function(t){return t.length?e.categoriesController.render(t):e.renderEmptyView()}}(this))},e.prototype.displayAbout=function(){return this.current="about",(new AboutView).render()},e.prototype.displayContribute=function(){return this.current="contribute",(new ContributeView).render()},e.prototype.renderEmptyView=function(){return(new EmptyView).render()},e}()}.call(this),function(){this.AppRouter=Backbone.Router.extend({routes:{reload:"reload","":"categories",about:"about",contribute:"contribute","pods/:filter":"pods","pods/:filter/:sort_by":"pods","pods/:filter/:sort_by/:idx":"pods","pod/:id":"pod"},contribute:function(){return this.pageview("/contribute"),this.appController.displayContribute()},about:function(){return this.pageview("/about"),this.appController.displayAbout()},categories:function(){return this.pageview("/categories"),this.appController.displayCategories()},pods:function(e,t,o){return e||(e="all"),t||(t="stars"),o||(o=0),this.pageview("/pods/"+e+"/"+t+"/"+o),this.appController.displayPodsAndUpdateScope(parseInt(o),e,t)},pod:function(e){return this.pageview("/pod/"+e),this.appController.displayPod(e)},reload:function(){return this.appController.loadPods(),this.navigate("/",!0)},pageview:function(e){return window.ga?window.ga("send","pageview",e):void 0}})}.call(this),function(){this.CategoriesController=function(){function e(e){this.store=e}return e.prototype.totalPodsCount=0,e.prototype.load=function(){return this.store.countPods().then(function(e){return function(t){return e.totalPodsCount=t}}(this)),this.store.findCategories()},e.prototype.render=function(e){var t,o,r,n;for(o=[],r=0,n=e.length;n>r;r++)t=e[r],o.push(new Category(t));return(new CategoriesView).render(o,this.totalPodsCount)},e}()}.call(this),function(){this.I18n=function(){function e(){}return e.prototype.category=function(e){var t;return t=this.locales[e],t?t:S(e).humanize().s},e.prototype.locales={ab_test:"AB Test",accessibility:"Accessibility",address:"Address",amazon_api:"Amazon API",analytics:"Analytics",api:"API",app_kit:"AppKit",app_store:"AppStore",app_updates:"Application Updates",apple_api:"Apple API",appnet_api:"App.net API",async:"Asynchronous",audio:"Audio",authentication:"Authentication",auto_layout:"AutoLayout",barcode:"Barcodes",battery:"Battery",bindings:"Bindings",bitmask:"Bitmasks",bluetooth:"Bluetooth",caching:"Caching",camera:"Camera",charts:"Charts",colors:"Colors",compression:"Compression",concurrency:"Concurreny",configuration:"Configuration",contacts:"Contacts",core_data:"CoreData",crypto:"Crypto",csv:"CSV",dates:"Dates",debugging:"Debugging",delegates:"Delegation",dependency_injection:"Dependency Injection",dropbox_api:"Dropbox API",email:"Email",enums:"Enums",events:"Events",extensions:"Extensions",facebook_api:"Facebook API",feeds:"Feeds",file:"File",file_download:"File Downloads",file_watch:"FileWatch",flash:"Flash",flickr_api:"Flickr API",fonts:"Fonts",foundation_extension:"Foundation Extensions",framework:"Framework",ftp:"FTP",functional_programming:"Functional Programming",game_center:"GameCenter",gaming:"Gaming",geo_location:"Geo Location",git:"Git",google_ads_api:"Google Ads API",google_api:"Google API",google_maps_api:"Google Maps API",grand_central_dispatch:"Grand Central Dispatch",graphing:"Graphing",gravatar:"Gravatar API",gui:"GUI",gui_alert:"Alert (GUI)",gui_animation:"Animations (GUI)",gui_autocomplete:"AutoComplete (GUI)",gui_badge:"Badge (GUI)",gui_button:"Button (GUI)",gui_calculator:"Calculator (GUI)",gui_calendar:"Calendar (GUI)",gui_carousel:"Carousel (GUI)",gui_controls:"Controls (GUI)",gui_dialog:"Dialog (GUI)",gui_dragging:"Drag'n'Drop (GUI)",gui_form:"Form (GUI)",gui_grid:"Grid (GUI)",gui_label:"Label (GUI)",gui_layout:"Layout (GUI)",gui_list:"List (GUI)",gui_menus:"Menu (GUI)",gui_numbers:"Numbers (GUI)",gui_overlay:"Overlay (GUI)",gui_popover:"Popover (GUI)",gui_popup:"Popup (GUI)",gui_progress:"Progress (GUI)",gui_rating:"Rating (GUI)",gui_scroll:"Scrolling (GUI)",gui_search:"Search (GUI)",gui_segmented:"SegmentedControl (GUI)",gui_sheet:"Sheets (GUI)",gui_sidebar:"Sidebar (GUI)",gui_slider:"Slider (GUI)",gui_switch:"Switch (GUI)",gui_tableview:"TableView (GUI)",gui_tags:"Tags (GUI)",gui_textfield:"TextField (GUI)",gui_textview:"TextView (GUI)",gui_tokenfield:"TokenField (GUI)",gui_toolbar:"Toolbar (GUI)",gui_transitions:"Transitions (GUI)",gui_web_view:"WebView (GUI)",gui_window:"Window (GUI)",haiku:"Haiku",hashing:"Hashing",html:"HTML",http:"HTTP",http_client:"HTTP Client",http_server:"HTTP Server",i18n:"I18n",icloud:"iCloud",icmp:"ICMP",image_processing:"Image Processing",images:"Images",imap:"IMAP",inflections:"Inflections",instagram_api:"Instagram API",intents:"Intents",json:"JSON",keyboard:"Keyboard",keychain:"Keychain",kvo:"KVO",language_extensions:"Language Extensions",layouts:"Layouts",leveldb:"LevelDB",links:"Links",logging:"Logging",lorem_ipsum:"Lorem Ipsum",lua:"Lua",machine_learning:"Machine Learning",mail:"Mail",mapkit:"MapKit",markdown:"Markdown",message_pack:"MessagePack",message_queue:"Message Queues",mocking:"Mocking",models:"Models",mongodb:"MongoDB",mvc_framework:"MVC Framework",navigation:"Navigation",networking:"Networking",notifications:"Notifications",nsoperation:"NSOperation",nsstring_extensions:"NSString Extensions",ntp:"NTP",oauth:"OAuth",object_mapping:"Object Mapping",ocr:"OCR",option_parser:"Option Parser",payment:"Payment",phone_numbers:"Phone Numbers",photo_browser:"Photo Browser",plist:"Plist",prettyfier:"Prettyfier",promises:"Promises",proprietary_api:"Proprietary API",pull_to_refresh:"Pull to Refresh",qr_code:"QR Code",queue:"Queue",reactive_programming:"Reactive Programming",regular_expressions:"Regular Expressions",rich_text:"Rich Text",ruby:"Ruby",screenshots:"Screenthos",scrolling:"Scrolling",search:"Search",segues:"Seques",serialization:"Serialization",smtp:"SMTP",sprite_kit:"SpriteKit",sql:"SQL",sqlite:"SQLite",state_machine:"State Machine",status_bar:"Status Bar",storage:"Storage",store_kit:"StoreKit",storyboard:"Storyboard",strings:"Strings",syntax_highlighting:"Syntax Highlighting",syntax_shugar:"Syntax Sugar",tabs:"Tabs",testing:"Testing",threading:"Threads",timing:"Timing",touch:"Touch",twitter_api:"Twitter API",uikit_extensions:"UIKit Extensions",uncategorized:"Uncategorized",units:"Units",url_routing:"URL Routes",urls:"URL",usb:"USB",user_defaults:"UserDefaults",user_feedback:"User Feedback",utilities:"Utilities",uuid:"UUID",validation:"Validations",validations:"Validations",varargs:"Varargs",versioning:"Versioning",video:"Video",web_browser:"Web Browser",web_sockets:"WebSockets",webdav:"WebDAV",webp:"WebP",xcode:"Xcode",xml:"XML",yaml:"YAML",zero_mq:"ZeroMQ",zip:"ZIP"},e}()}.call(this),function(){this.ObjectSorter=function(){function e(){}return e.prototype.sort=function(e){var t,o;return this.sortBy?(t=this.sortBy,o=this,e.sort(function(e,r){var n,i;return n=e[t],i=r[t],o._sort(n,i)})):e.sort(this._sort)},e.prototype._sort=function(e,t){return"string"==typeof e&&"string"==typeof t?e.toLowerCase()>t.toLowerCase()?-1:1:"number"==typeof e&&"number"==typeof t?t-e:"number"==typeof e&&"string"==typeof t?-1:"string"==typeof e&&"number"==typeof t?1:"object"==typeof e&&"object"==typeof t?-1:"object"==typeof e?1:-1},e}()}.call(this),function(){this.PodsController=function(){function e(e){this.store=e,this.store.delegates.push(this)}return e.prototype.index=null,e.prototype.filterBy="all",e.prototype.sortBy="stars",e.prototype.sortAsc=!1,e.prototype.maxPerPage=50,e.prototype.count=0,e.prototype.updateScope=function(e,t,o){return this.index=o,this.filterBy=e,this.sortBy=t,this.sortAsc="stars"===t?!1:"pushed_at"===t?!1:!0},e.prototype.load=function(){var e,t;return e=null,t=null,"all"===this.filterBy?(e=this.store.countPods(),t=this.store.findPods(this.sortBy,this.sortAsc,this.index,this.maxPerPage)):(e=this.store.findCategory(this.filterBy).then(function(e){return e.length?e[0].cocoa_pods_count:void 0}),t=this.store.findPodsByCategory(this.filterBy,this.sortBy,this.sortAsc,this.index,this.maxPerPage)),e.then(function(e){return function(t){return e.count=t}}(this)),t.then(function(e){return function(t){return{count:e.count,pods:t}}}(this))},e.prototype.render=function(e,t){var o;return $("#main-view").empty(),o=new PodsList(e,t,this.index,this.maxPerPage),(new PodsNavigationView).render(o,this.sortBy,this.filterBy),(new PodsView).render(o)},e}()}.call(this),function(){this.PodsList=function(){function e(e,t,o,r){this.totalCount=e,this.currentPods=t,this.maxPerPage=r,this.index=o}return e.prototype.pods=function(){return this.currentPods},e.prototype.has_next=function(){return this.next_offset()<this.totalCount},e.prototype.has_prev=function(){return this.index>0},e.prototype.next_offset=function(){return this.index+this.maxPerPage},e.prototype.previous_offset=function(){return this.index-this.maxPerPage},e.prototype.paginationPosition=function(e){var t,o,r;return o=2,r=1,e===this.index?"current":e>this.index?(t=this.index+o*this.maxPerPage,t>e||e>this.totalCount-r*this.maxPerPage?"within":e===t?"barrier":"without"):e<this.index?(t=this.index-o*this.maxPerPage,e>t||e<r*this.maxPerPage?"within":e===t?"barrier":"without"):void 0},e}()}.call(this);var Nanobar=function(){"use strict";var e,t,o,r,n,i=".nanobar{float:left;width:100%;height:4px;z-index:9999;}.nanobarbar{width:0;height:100%;float:left;transition:all .3s;}",s=document.head||document.getElementsByTagName("head")[0];return e=function(){var e=document.getElementById("nanobar-style");null===e&&(e=document.createElement("style"),e.type="text/css",e.id="nanobar-style",s.insertBefore(e,s.firstChild),e.styleSheet?e.styleSheet.cssText=i:e.appendChild(document.createTextNode(i)))},t=function(){var e,t=document.createElement("fakeelement"),o={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in o)if(void 0!==t.style[e])return o[e]},o=t(),r=function(e){var t=document.createElement("div");return t.setAttribute("class","nanobarbar"),t.style.background=e.opts.bg,t.setAttribute("on","1"),e.cont.appendChild(t),o&&t.addEventListener(o,function(){"100%"===t.style.width&&"1"===t.getAttribute("on")&&(t.setAttribute("on",0),e.bars.pop(),t.style.height=0,setTimeout(function(){e.cont.removeChild(t)},300))}),t},n=function(t){var o,r=this.opts=t||{};return r.bg=r.bg||"#000",this.bars=[],e(),o=this.cont=document.createElement("div"),o.setAttribute("class","nanobar"),r.id&&(o.id=r.id),r.target?o.style.position="relative":(o.style.position="fixed",o.style.top="0"),r.target?r.target.insertBefore(o,r.target.firstChild):document.getElementsByTagName("body")[0].appendChild(o),this.init()},n.prototype.init=function(){var e=r(this);this.bars.unshift(e)},n.prototype.go=function(e){this.bars[0].style.width=e+"%",100==e&&this.init()},n}();(function(){this.PodsProgressBar=function(){function e(){}return e.prototype.update=function(e){var t;return t=100*e,this.nanobar?this.nanobar.go(t):void 0},e.prototype.start=function(){var e;return e=$(".progress-container").empty(),this.nanobar=new Nanobar({target:e.get(0),id:"pods-progress"})},e}()}).call(this),function(){this.SeedsSyncController=function(){function e(e,t){this.progressBar=new PodsProgressBar,this.store=e,this.store.delegates.push(this),this.seedsWorkerClient=t,this.seedsWorkerClient.delegate=this}return e.prototype.delegate=null,e.prototype.sync=function(){return logger.verbose("SeedsController#sync"),this.seedsWorkerClient.loadPods(),this.progressBar.start()},e.prototype.didLoadCategories=function(e){return logger.verbose("SeedsController#didLoadCategories",e),this.store.updateCategories(e),this.delegate&&this.delegate.seedsSyncControllerDidSyncCategories?this.delegate.seedsSyncControllerDidSyncCategories():void 0},e.prototype.didLoad=function(e,t){return logger.verbose("SeedsController#didLoad",e),this.progressBar.update(this.seedsWorkerClient.progress),this.store.updatePods(t)},e.prototype.didLoadAll=function(){return logger.verbose("SeedsController#didLoadAll"),this.delegate?this.delegate.seedsSyncControllerDidSyncPods():void 0},e}()}.call(this);var CLOSURE_DEFINES={"goog.ENABLE_DEBUG_LOADER":!1},COMPILED=!1,goog=goog||{};goog.global=this,goog.global.CLOSURE_DEFINES,goog.exportPath_=function(e,t,o){var r=e.split("."),n=o||goog.global;r[0]in n||!n.execScript||n.execScript("var "+r[0]);for(var i;r.length&&(i=r.shift());)r.length||void 0===t?n=n[i]?n[i]:n[i]={}:n[i]=t},goog.define=function(e,t){var o=t;COMPILED||goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,e)&&(o=goog.global.CLOSURE_DEFINES[e]),goog.exportPath_(e,o)},goog.DEBUG=!0,goog.define("goog.LOCALE","en"),goog.define("goog.TRUSTED_SITE",!0),goog.provide=function(e){if(!COMPILED){if(goog.isProvided_(e))throw Error('Namespace "'+e+'" already declared.');delete goog.implicitNamespaces_[e];for(var t=e;(t=t.substring(0,t.lastIndexOf(".")))&&!goog.getObjectByName(t);)goog.implicitNamespaces_[t]=!0}goog.exportPath_(e)},goog.setTestOnly=function(e){if(COMPILED&&!goog.DEBUG)throw e=e||"",Error(": "+e)},COMPILED||(goog.isProvided_=function(e){return!goog.implicitNamespaces_[e]&&!!goog.getObjectByName(e)},goog.implicitNamespaces_={}),goog.getObjectByName=function(e,t){for(var o,r=e.split("."),n=t||goog.global;o=r.shift();){if(!goog.isDefAndNotNull(n[o]))return null;n=n[o]}return n},goog.globalize=function(e,t){var o=t||goog.global;for(var r in e)o[r]=e[r]},goog.addDependency=function(e,t,o){if(goog.DEPENDENCIES_ENABLED){for(var r,n,i=e.replace(/\\/g,"/"),s=goog.dependencies_,a=0;r=t[a];a++)s.nameToPath[r]=i,i in s.pathToNames||(s.pathToNames[i]={}),s.pathToNames[i][r]=!0;for(var g=0;n=o[g];g++)i in s.requires||(s.requires[i]={}),s.requires[i][n]=!0}},goog.define("goog.ENABLE_DEBUG_LOADER",!0),goog.require=function(e){if(!COMPILED){if(goog.isProvided_(e))return;if(goog.ENABLE_DEBUG_LOADER){var t=goog.getPathFromDeps_(e);if(t)return goog.included_[t]=!0,goog.writeScripts_(),void 0}var o="goog.require could not find: "+e;throw goog.global.console&&goog.global.console.error(o),Error(o)}},goog.basePath="",goog.global.CLOSURE_BASE_PATH,goog.global.CLOSURE_NO_DEPS,goog.global.CLOSURE_IMPORT_SCRIPT,goog.nullFunction=function(){},goog.identityFunction=function(e){return e},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(e){e.getInstance=function(){return e.instance_?e.instance_:(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=e),e.instance_=new e)}},goog.instantiatedSingletons_=[],goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER,goog.DEPENDENCIES_ENABLED&&(goog.included_={},goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var e=goog.global.document;return"undefined"!=typeof e&&"write"in e},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)return goog.basePath=goog.global.CLOSURE_BASE_PATH,void 0;if(goog.inHtmlDocument_())for(var e=goog.global.document,t=e.getElementsByTagName("script"),o=t.length-1;o>=0;--o){var r=t[o].src,n=r.lastIndexOf("?"),i=-1==n?r.length:n;if("base.js"==r.substr(i-7,7))return goog.basePath=r.substr(0,i-7),void 0}},goog.importScript_=function(e){var t=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;!goog.dependencies_.written[e]&&t(e)&&(goog.dependencies_.written[e]=!0)},goog.writeScriptTag_=function(e){if(goog.inHtmlDocument_()){var t=goog.global.document;if("complete"==t.readyState){var o=/\bdeps.js$/.test(e);if(o)return!1;throw Error('Cannot write "'+e+'" after document load')}return t.write('<script type="text/javascript" src="'+e+'"></script>'),!0}return!1},goog.writeScripts_=function(){function e(n){if(!(n in r.written)){if(n in r.visited)return n in o||(o[n]=!0,t.push(n)),void 0;if(r.visited[n]=!0,n in r.requires)for(var i in r.requires[n])if(!goog.isProvided_(i)){if(!(i in r.nameToPath))throw Error("Undefined nameToPath for "+i);e(r.nameToPath[i])}n in o||(o[n]=!0,t.push(n))}}var t=[],o={},r=goog.dependencies_;for(var n in goog.included_)r.written[n]||e(n);for(var i=0;i<t.length;i++){if(!t[i])throw Error("Undefined script input");goog.importScript_(goog.basePath+t[i])}},goog.getPathFromDeps_=function(e){return e in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[e]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js")),goog.typeOf=function(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var o=Object.prototype.toString.call(e);if("[object Window]"==o)return"object";if("[object Array]"==o||"number"==typeof e.length&&"undefined"!=typeof e.splice&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==o||"undefined"!=typeof e.call&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&"undefined"==typeof e.call)return"object";return t},goog.isDef=function(e){return void 0!==e},goog.isNull=function(e){return null===e},goog.isDefAndNotNull=function(e){return null!=e},goog.isArray=function(e){return"array"==goog.typeOf(e)},goog.isArrayLike=function(e){var t=goog.typeOf(e);return"array"==t||"object"==t&&"number"==typeof e.length},goog.isDateLike=function(e){return goog.isObject(e)&&"function"==typeof e.getFullYear},goog.isString=function(e){return"string"==typeof e},goog.isBoolean=function(e){return"boolean"==typeof e},goog.isNumber=function(e){return"number"==typeof e},goog.isFunction=function(e){return"function"==goog.typeOf(e)},goog.isObject=function(e){var t=typeof e;return"object"==t&&null!=e||"function"==t},goog.getUid=function(e){return e[goog.UID_PROPERTY_]||(e[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.removeUid=function(e){"removeAttribute"in e&&e.removeAttribute(goog.UID_PROPERTY_);try{delete e[goog.UID_PROPERTY_]}catch(t){}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.getHashCode=goog.getUid,goog.removeHashCode=goog.removeUid,goog.cloneObject=function(e){var t=goog.typeOf(e);if("object"==t||"array"==t){if(e.clone)return e.clone();var o="array"==t?[]:{};for(var r in e)o[r]=goog.cloneObject(e[r]);return o}return e},goog.bindNative_=function(e){return e.call.apply(e.bind,arguments)},goog.bindJs_=function(e,t){if(!e)throw new Error;if(arguments.length>2){var o=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,o),e.apply(t,r)}}return function(){return e.apply(t,arguments)}},goog.bind=function(){return goog.bind=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bindNative_:goog.bindJs_,goog.bind.apply(null,arguments)
},goog.partial=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){var o=Array.prototype.slice.call(arguments);return o.unshift.apply(o,t),e.apply(this,o)}},goog.mixin=function(e,t){for(var o in t)e[o]=t[o]},goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date},goog.globalEval=function(e){if(goog.global.execScript)goog.global.execScript(e,"JavaScript");else{if(!goog.global.eval)throw Error("goog.globalEval not available");if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),"undefined"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(e);else{var t=goog.global.document,o=t.createElement("script");o.type="text/javascript",o.defer=!1,o.appendChild(t.createTextNode(e)),t.body.appendChild(o),t.body.removeChild(o)}}},goog.evalWorksForGlobals_=null,goog.cssNameMapping_,goog.cssNameMappingStyle_,goog.getCssName=function(e,t){var o,r=function(e){return goog.cssNameMapping_[e]||e},n=function(e){for(var t=e.split("-"),o=[],n=0;n<t.length;n++)o.push(r(t[n]));return o.join("-")};return o=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?r:n:function(e){return e},t?e+"-"+o(t):o(e)},goog.setCssNameMapping=function(e,t){goog.cssNameMapping_=e,goog.cssNameMappingStyle_=t},goog.global.CLOSURE_CSS_NAME_MAPPING,!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING),goog.getMsg=function(e,t){var o=t||{};for(var r in o){var n=(""+o[r]).replace(/\$/g,"$$$$");e=e.replace(new RegExp("\\{\\$"+r+"\\}","gi"),n)}return e},goog.getMsgWithFallback=function(e){return e},goog.exportSymbol=function(e,t,o){goog.exportPath_(e,t,o)},goog.exportProperty=function(e,t,o){e[t]=o},goog.inherits=function(e,t){function o(){}o.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new o,e.prototype.constructor=e},goog.base=function(e,t){var o=arguments.callee.caller;if(goog.DEBUG&&!o)throw Error("arguments.caller not defined.  goog.base() expects not to be running in strict mode. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(o.superClass_)return o.superClass_.constructor.apply(e,Array.prototype.slice.call(arguments,1));for(var r=Array.prototype.slice.call(arguments,2),n=!1,i=e.constructor;i;i=i.superClass_&&i.superClass_.constructor)if(i.prototype[t]===o)n=!0;else if(n)return i.prototype[t].apply(e,r);if(e[t]===o)return e.constructor.prototype[t].apply(e,r);throw Error("goog.base called from a method of one name to a method of a different name")},goog.scope=function(e){e.call(goog.global)},goog.provide("goog.debug.Error"),goog.debug.Error=function(e){Error.captureStackTrace?Error.captureStackTrace(this,goog.debug.Error):this.stack=(new Error).stack||"",e&&(this.message=String(e))},goog.inherits(goog.debug.Error,Error),goog.debug.Error.prototype.name="CustomError",goog.provide("goog.string"),goog.provide("goog.string.Unicode"),goog.string.Unicode={NBSP:""},goog.string.startsWith=function(e,t){return 0==e.lastIndexOf(t,0)},goog.string.endsWith=function(e,t){var o=e.length-t.length;return o>=0&&e.indexOf(t,o)==o},goog.string.caseInsensitiveStartsWith=function(e,t){return 0==goog.string.caseInsensitiveCompare(t,e.substr(0,t.length))},goog.string.caseInsensitiveEndsWith=function(e,t){return 0==goog.string.caseInsensitiveCompare(t,e.substr(e.length-t.length,t.length))},goog.string.caseInsensitiveEquals=function(e,t){return e.toLowerCase()==t.toLowerCase()},goog.string.subs=function(e){for(var t=1;t<arguments.length;t++){var o=String(arguments[t]).replace(/\$/g,"$$$$");e=e.replace(/\%s/,o)}return e},goog.string.collapseWhitespace=function(e){return e.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},goog.string.isEmpty=function(e){return/^[\s\xa0]*$/.test(e)},goog.string.isEmptySafe=function(e){return goog.string.isEmpty(goog.string.makeSafe(e))},goog.string.isBreakingWhitespace=function(e){return!/[^\t\n\r ]/.test(e)},goog.string.isAlpha=function(e){return!/[^a-zA-Z]/.test(e)},goog.string.isNumeric=function(e){return!/[^0-9]/.test(e)},goog.string.isAlphaNumeric=function(e){return!/[^a-zA-Z0-9]/.test(e)},goog.string.isSpace=function(e){return" "==e},goog.string.isUnicodeChar=function(e){return 1==e.length&&e>=" "&&"~">=e||e>=""&&"">=e},goog.string.stripNewlines=function(e){return e.replace(/(\r\n|\r|\n)+/g," ")},goog.string.canonicalizeNewlines=function(e){return e.replace(/(\r\n|\r|\n)/g,"\n")},goog.string.normalizeWhitespace=function(e){return e.replace(/\xa0|\s/g," ")},goog.string.normalizeSpaces=function(e){return e.replace(/\xa0|[ \t]+/g," ")},goog.string.collapseBreakingSpaces=function(e){return e.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")},goog.string.trim=function(e){return e.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},goog.string.trimLeft=function(e){return e.replace(/^[\s\xa0]+/,"")},goog.string.trimRight=function(e){return e.replace(/[\s\xa0]+$/,"")},goog.string.caseInsensitiveCompare=function(e,t){var o=String(e).toLowerCase(),r=String(t).toLowerCase();return r>o?-1:o==r?0:1},goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g,goog.string.numerateCompare=function(e,t){if(e==t)return 0;if(!e)return-1;if(!t)return 1;for(var o=e.toLowerCase().match(goog.string.numerateCompareRegExp_),r=t.toLowerCase().match(goog.string.numerateCompareRegExp_),n=Math.min(o.length,r.length),i=0;n>i;i++){var s=o[i],a=r[i];if(s!=a){var g=parseInt(s,10);if(!isNaN(g)){var d=parseInt(a,10);if(!isNaN(d)&&g-d)return g-d}return a>s?-1:1}}return o.length!=r.length?o.length-r.length:t>e?-1:1},goog.string.urlEncode=function(e){return encodeURIComponent(String(e))},goog.string.urlDecode=function(e){return decodeURIComponent(e.replace(/\+/g," "))},goog.string.newLineToBr=function(e,t){return e.replace(/(\r\n|\r|\n)/g,t?"<br />":"<br>")},goog.string.htmlEscape=function(e,t){return t?e.replace(goog.string.amperRe_,"&amp;").replace(goog.string.ltRe_,"&lt;").replace(goog.string.gtRe_,"&gt;").replace(goog.string.quotRe_,"&quot;"):goog.string.allRe_.test(e)?(-1!=e.indexOf("&")&&(e=e.replace(goog.string.amperRe_,"&amp;")),-1!=e.indexOf("<")&&(e=e.replace(goog.string.ltRe_,"&lt;")),-1!=e.indexOf(">")&&(e=e.replace(goog.string.gtRe_,"&gt;")),-1!=e.indexOf('"')&&(e=e.replace(goog.string.quotRe_,"&quot;")),e):e},goog.string.amperRe_=/&/g,goog.string.ltRe_=/</g,goog.string.gtRe_=/>/g,goog.string.quotRe_=/\"/g,goog.string.allRe_=/[&<>\"]/,goog.string.unescapeEntities=function(e){return goog.string.contains(e,"&")?"document"in goog.global?goog.string.unescapeEntitiesUsingDom_(e):goog.string.unescapePureXmlEntities_(e):e},goog.string.unescapeEntitiesUsingDom_=function(e){var t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'},o=document.createElement("div");return e.replace(goog.string.HTML_ENTITY_PATTERN_,function(e,r){var n=t[e];if(n)return n;if("#"==r.charAt(0)){var i=Number("0"+r.substr(1));isNaN(i)||(n=String.fromCharCode(i))}return n||(o.innerHTML=e+" ",n=o.firstChild.nodeValue.slice(0,-1)),t[e]=n})},goog.string.unescapePureXmlEntities_=function(e){return e.replace(/&([^;]+);/g,function(e,t){switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:if("#"==t.charAt(0)){var o=Number("0"+t.substr(1));if(!isNaN(o))return String.fromCharCode(o)}return e}})},goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g,goog.string.whitespaceEscape=function(e,t){return goog.string.newLineToBr(e.replace(/  /g," &#160;"),t)},goog.string.stripQuotes=function(e,t){for(var o=t.length,r=0;o>r;r++){var n=1==o?t:t.charAt(r);if(e.charAt(0)==n&&e.charAt(e.length-1)==n)return e.substring(1,e.length-1)}return e},goog.string.truncate=function(e,t,o){return o&&(e=goog.string.unescapeEntities(e)),e.length>t&&(e=e.substring(0,t-3)+"..."),o&&(e=goog.string.htmlEscape(e)),e},goog.string.truncateMiddle=function(e,t,o,r){if(o&&(e=goog.string.unescapeEntities(e)),r&&e.length>t){r>t&&(r=t);var n=e.length-r,i=t-r;e=e.substring(0,i)+"..."+e.substring(n)}else if(e.length>t){var s=Math.floor(t/2),a=e.length-s;s+=t%2,e=e.substring(0,s)+"..."+e.substring(a)}return o&&(e=goog.string.htmlEscape(e)),e},goog.string.specialEscapeChars_={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\x0B",'"':'\\"',"\\":"\\\\"},goog.string.jsEscapeCache_={"'":"\\'"},goog.string.quote=function(e){if(e=String(e),e.quote)return e.quote();for(var t=['"'],o=0;o<e.length;o++){var r=e.charAt(o),n=r.charCodeAt(0);t[o+1]=goog.string.specialEscapeChars_[r]||(n>31&&127>n?r:goog.string.escapeChar(r))}return t.push('"'),t.join("")},goog.string.escapeString=function(e){for(var t=[],o=0;o<e.length;o++)t[o]=goog.string.escapeChar(e.charAt(o));return t.join("")},goog.string.escapeChar=function(e){if(e in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[e];if(e in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[e]=goog.string.specialEscapeChars_[e];var t=e,o=e.charCodeAt(0);return o>31&&127>o?t=e:(256>o?(t="\\x",(16>o||o>256)&&(t+="0")):(t="\\u",4096>o&&(t+="0")),t+=o.toString(16).toUpperCase()),goog.string.jsEscapeCache_[e]=t},goog.string.toMap=function(e){for(var t={},o=0;o<e.length;o++)t[e.charAt(o)]=!0;return t},goog.string.contains=function(e,t){return-1!=e.indexOf(t)},goog.string.countOf=function(e,t){return e&&t?e.split(t).length-1:0},goog.string.removeAt=function(e,t,o){var r=e;return t>=0&&t<e.length&&o>0&&(r=e.substr(0,t)+e.substr(t+o,e.length-t-o)),r},goog.string.remove=function(e,t){var o=new RegExp(goog.string.regExpEscape(t),"");return e.replace(o,"")},goog.string.removeAll=function(e,t){var o=new RegExp(goog.string.regExpEscape(t),"g");return e.replace(o,"")},goog.string.regExpEscape=function(e){return String(e).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},goog.string.repeat=function(e,t){return new Array(t+1).join(e)},goog.string.padNumber=function(e,t,o){var r=goog.isDef(o)?e.toFixed(o):String(e),n=r.indexOf(".");return-1==n&&(n=r.length),goog.string.repeat("0",Math.max(0,t-n))+r},goog.string.makeSafe=function(e){return null==e?"":String(e)},goog.string.buildString=function(){return Array.prototype.join.call(arguments,"")},goog.string.getRandomString=function(){var e=2147483648;return Math.floor(Math.random()*e).toString(36)+Math.abs(Math.floor(Math.random()*e)^goog.now()).toString(36)},goog.string.compareVersions=function(e,t){for(var o=0,r=goog.string.trim(String(e)).split("."),n=goog.string.trim(String(t)).split("."),i=Math.max(r.length,n.length),s=0;0==o&&i>s;s++){var a=r[s]||"",g=n[s]||"",d=new RegExp("(\\d*)(\\D*)","g"),u=new RegExp("(\\d*)(\\D*)","g");do{var l=d.exec(a)||["","",""],c=u.exec(g)||["","",""];if(0==l[0].length&&0==c[0].length)break;var h=0==l[1].length?0:parseInt(l[1],10),p=0==c[1].length?0:parseInt(c[1],10);o=goog.string.compareElements_(h,p)||goog.string.compareElements_(0==l[2].length,0==c[2].length)||goog.string.compareElements_(l[2],c[2])}while(0==o)}return o},goog.string.compareElements_=function(e,t){return t>e?-1:e>t?1:0},goog.string.HASHCODE_MAX_=4294967296,goog.string.hashCode=function(e){for(var t=0,o=0;o<e.length;++o)t=31*t+e.charCodeAt(o),t%=goog.string.HASHCODE_MAX_;return t},goog.string.uniqueStringCounter_=2147483648*Math.random()|0,goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++},goog.string.toNumber=function(e){var t=Number(e);return 0==t&&goog.string.isEmpty(e)?0/0:t},goog.string.isLowerCamelCase=function(e){return/^[a-z]+([A-Z][a-z]*)*$/.test(e)},goog.string.isUpperCamelCase=function(e){return/^([A-Z][a-z]*)+$/.test(e)},goog.string.toCamelCase=function(e){return String(e).replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()})},goog.string.toSelectorCase=function(e){return String(e).replace(/([A-Z])/g,"-$1").toLowerCase()},goog.string.toTitleCase=function(e,t){var o=goog.isString(t)?goog.string.regExpEscape(t):"\\s";o=o?"|["+o+"]+":"";var r=new RegExp("(^"+o+")([a-z])","g");return e.replace(r,function(e,t,o){return t+o.toUpperCase()})},goog.string.parseInt=function(e){return isFinite(e)&&(e=String(e)),goog.isString(e)?/^\s*-?0x/i.test(e)?parseInt(e,16):parseInt(e,10):0/0},goog.provide("goog.asserts"),goog.provide("goog.asserts.AssertionError"),goog.require("goog.debug.Error"),goog.require("goog.string"),goog.define("goog.asserts.ENABLE_ASSERTS",goog.DEBUG),goog.asserts.AssertionError=function(e,t){t.unshift(e),goog.debug.Error.call(this,goog.string.subs.apply(null,t)),t.shift(),this.messagePattern=e},goog.inherits(goog.asserts.AssertionError,goog.debug.Error),goog.asserts.AssertionError.prototype.name="AssertionError",goog.asserts.doAssertFailure_=function(e,t,o,r){var n="Assertion failed";if(o){n+=": "+o;var i=r}else e&&(n+=": "+e,i=t);throw new goog.asserts.AssertionError(""+n,i||[])},goog.asserts.assert=function(e,t){return goog.asserts.ENABLE_ASSERTS&&!e&&goog.asserts.doAssertFailure_("",null,t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.fail=function(e){if(goog.asserts.ENABLE_ASSERTS)throw new goog.asserts.AssertionError("Failure"+(e?": "+e:""),Array.prototype.slice.call(arguments,1))},goog.asserts.assertNumber=function(e,t){return goog.asserts.ENABLE_ASSERTS&&!goog.isNumber(e)&&goog.asserts.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertString=function(e,t){return goog.asserts.ENABLE_ASSERTS&&!goog.isString(e)&&goog.asserts.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertFunction=function(e,t){return goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(e)&&goog.asserts.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertObject=function(e,t){return goog.asserts.ENABLE_ASSERTS&&!goog.isObject(e)&&goog.asserts.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertArray=function(e,t){return goog.asserts.ENABLE_ASSERTS&&!goog.isArray(e)&&goog.asserts.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertBoolean=function(e,t){return goog.asserts.ENABLE_ASSERTS&&!goog.isBoolean(e)&&goog.asserts.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertInstanceof=function(e,t,o){return!goog.asserts.ENABLE_ASSERTS||e instanceof t||goog.asserts.doAssertFailure_("instanceof check failed.",null,o,Array.prototype.slice.call(arguments,3)),e},goog.provide("goog.array"),goog.provide("goog.array.ArrayLike"),goog.require("goog.asserts"),goog.define("goog.NATIVE_ARRAY_PROTOTYPES",goog.TRUSTED_SITE),goog.array.ArrayLike,goog.array.peek=function(e){return e[e.length-1]},goog.array.ARRAY_PROTOTYPE_=Array.prototype,goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.indexOf?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.indexOf.call(e,t,o)}:function(e,t,o){var r=null==o?0:0>o?Math.max(0,e.length+o):o;if(goog.isString(e))return goog.isString(t)&&1==t.length?e.indexOf(t,r):-1;for(var n=r;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.lastIndexOf?function(e,t,o){goog.asserts.assert(null!=e.length);var r=null==o?e.length-1:o;return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(e,t,r)}:function(e,t,o){var r=null==o?e.length-1:o;if(0>r&&(r=Math.max(0,e.length+r)),goog.isString(e))return goog.isString(t)&&1==t.length?e.lastIndexOf(t,r):-1;for(var n=r;n>=0;n--)if(n in e&&e[n]===t)return n;return-1},goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.forEach?function(e,t,o){goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.forEach.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;r>i;i++)i in n&&t.call(o,n[i],i,e)},goog.array.forEachRight=function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=r-1;i>=0;--i)i in n&&t.call(o,n[i],i,e)},goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.filter?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.filter.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=[],i=0,s=goog.isString(e)?e.split(""):e,a=0;r>a;a++)if(a in s){var g=s[a];t.call(o,g,a,e)&&(n[i++]=g)}return n},goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.map?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.map.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=new Array(r),i=goog.isString(e)?e.split(""):e,s=0;r>s;s++)s in i&&(n[s]=t.call(o,i[s],s,e));return n},goog.array.reduce=function(e,t,o,r){if(e.reduce)return r?e.reduce(goog.bind(t,r),o):e.reduce(t,o);var n=o;return goog.array.forEach(e,function(o,i){n=t.call(r,n,o,i,e)}),n},goog.array.reduceRight=function(e,t,o,r){if(e.reduceRight)return r?e.reduceRight(goog.bind(t,r),o):e.reduceRight(t,o);var n=o;return goog.array.forEachRight(e,function(o,i){n=t.call(r,n,o,i,e)}),n},goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.some?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.some.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;r>i;i++)if(i in n&&t.call(o,n[i],i,e))return!0;return!1},goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.every?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.every.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;r>i;i++)if(i in n&&!t.call(o,n[i],i,e))return!1;return!0},goog.array.count=function(e,t,o){var r=0;return goog.array.forEach(e,function(e,n,i){t.call(o,e,n,i)&&++r},o),r},goog.array.find=function(e,t,o){var r=goog.array.findIndex(e,t,o);return 0>r?null:goog.isString(e)?e.charAt(r):e[r]},goog.array.findIndex=function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;r>i;i++)if(i in n&&t.call(o,n[i],i,e))return i;return-1},goog.array.findRight=function(e,t,o){var r=goog.array.findIndexRight(e,t,o);return 0>r?null:goog.isString(e)?e.charAt(r):e[r]},goog.array.findIndexRight=function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=r-1;i>=0;i--)if(i in n&&t.call(o,n[i],i,e))return i;return-1},goog.array.contains=function(e,t){return goog.array.indexOf(e,t)>=0},goog.array.isEmpty=function(e){return 0==e.length},goog.array.clear=function(e){if(!goog.isArray(e))for(var t=e.length-1;t>=0;t--)delete e[t];e.length=0},goog.array.insert=function(e,t){goog.array.contains(e,t)||e.push(t)},goog.array.insertAt=function(e,t,o){goog.array.splice(e,o,0,t)},goog.array.insertArrayAt=function(e,t,o){goog.partial(goog.array.splice,e,o,0).apply(null,t)},goog.array.insertBefore=function(e,t,o){var r;2==arguments.length||(r=goog.array.indexOf(e,o))<0?e.push(t):goog.array.insertAt(e,t,r)},goog.array.remove=function(e,t){var o,r=goog.array.indexOf(e,t);return(o=r>=0)&&goog.array.removeAt(e,r),o},goog.array.removeAt=function(e,t){return goog.asserts.assert(null!=e.length),1==goog.array.ARRAY_PROTOTYPE_.splice.call(e,t,1).length},goog.array.removeIf=function(e,t,o){var r=goog.array.findIndex(e,t,o);return r>=0?(goog.array.removeAt(e,r),!0):!1},goog.array.concat=function(){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.toArray=function(e){var t=e.length;if(t>0){for(var o=new Array(t),r=0;t>r;r++)o[r]=e[r];return o}return[]},goog.array.clone=goog.array.toArray,goog.array.extend=function(e){for(var t=1;t<arguments.length;t++){var o,r=arguments[t];if(goog.isArray(r)||(o=goog.isArrayLike(r))&&Object.prototype.hasOwnProperty.call(r,"callee"))e.push.apply(e,r);else if(o)for(var n=e.length,i=r.length,s=0;i>s;s++)e[n+s]=r[s];else e.push(r)}},goog.array.splice=function(e){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.splice.apply(e,goog.array.slice(arguments,1))},goog.array.slice=function(e,t,o){return goog.asserts.assert(null!=e.length),arguments.length<=2?goog.array.ARRAY_PROTOTYPE_.slice.call(e,t):goog.array.ARRAY_PROTOTYPE_.slice.call(e,t,o)},goog.array.removeDuplicates=function(e,t){for(var o=t||e,r={},n=0,i=0;i<e.length;){var s=e[i++],a=goog.isObject(s)?"o"+goog.getUid(s):(typeof s).charAt(0)+s;Object.prototype.hasOwnProperty.call(r,a)||(r[a]=!0,o[n++]=s)}o.length=n},goog.array.binarySearch=function(e,t,o){return goog.array.binarySearch_(e,o||goog.array.defaultCompare,!1,t)},goog.array.binarySelect=function(e,t,o){return goog.array.binarySearch_(e,t,!0,void 0,o)},goog.array.binarySearch_=function(e,t,o,r,n){for(var i,s=0,a=e.length;a>s;){var g,d=s+a>>1;g=o?t.call(n,e[d],d,e):t(r,e[d]),g>0?s=d+1:(a=d,i=!g)}return i?s:~s},goog.array.sort=function(e,t){goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.sort.call(e,t||goog.array.defaultCompare)},goog.array.stableSort=function(e,t){function o(e,t){return n(e.value,t.value)||e.index-t.index}for(var r=0;r<e.length;r++)e[r]={index:r,value:e[r]};var n=t||goog.array.defaultCompare;goog.array.sort(e,o);for(var r=0;r<e.length;r++)e[r]=e[r].value},goog.array.sortObjectsByKey=function(e,t,o){var r=o||goog.array.defaultCompare;goog.array.sort(e,function(e,o){return r(e[t],o[t])})},goog.array.isSorted=function(e,t,o){for(var r=t||goog.array.defaultCompare,n=1;n<e.length;n++){var i=r(e[n-1],e[n]);if(i>0||0==i&&o)return!1}return!0},goog.array.equals=function(e,t,o){if(!goog.isArrayLike(e)||!goog.isArrayLike(t)||e.length!=t.length)return!1;for(var r=e.length,n=o||goog.array.defaultCompareEquality,i=0;r>i;i++)if(!n(e[i],t[i]))return!1;return!0},goog.array.compare=function(e,t,o){return goog.array.equals(e,t,o)},goog.array.compare3=function(e,t,o){for(var r=o||goog.array.defaultCompare,n=Math.min(e.length,t.length),i=0;n>i;i++){var s=r(e[i],t[i]);if(0!=s)return s}return goog.array.defaultCompare(e.length,t.length)},goog.array.defaultCompare=function(e,t){return e>t?1:t>e?-1:0},goog.array.defaultCompareEquality=function(e,t){return e===t},goog.array.binaryInsert=function(e,t,o){var r=goog.array.binarySearch(e,t,o);return 0>r?(goog.array.insertAt(e,t,-(r+1)),!0):!1},goog.array.binaryRemove=function(e,t,o){var r=goog.array.binarySearch(e,t,o);return r>=0?goog.array.removeAt(e,r):!1},goog.array.bucket=function(e,t,o){for(var r={},n=0;n<e.length;n++){var i=e[n],s=t.call(o,i,n,e);if(goog.isDef(s)){var a=r[s]||(r[s]=[]);a.push(i)}}return r},goog.array.toObject=function(e,t,o){var r={};return goog.array.forEach(e,function(n,i){r[t.call(o,n,i,e)]=n}),r},goog.array.range=function(e,t,o){var r=[],n=0,i=e,s=o||1;if(void 0!==t&&(n=e,i=t),0>s*(i-n))return[];if(s>0)for(var a=n;i>a;a+=s)r.push(a);else for(var a=n;a>i;a+=s)r.push(a);return r},goog.array.repeat=function(e,t){for(var o=[],r=0;t>r;r++)o[r]=e;return o},goog.array.flatten=function(){for(var e=[],t=0;t<arguments.length;t++){var o=arguments[t];goog.isArray(o)?e.push.apply(e,goog.array.flatten.apply(null,o)):e.push(o)}return e},goog.array.rotate=function(e,t){return goog.asserts.assert(null!=e.length),e.length&&(t%=e.length,t>0?goog.array.ARRAY_PROTOTYPE_.unshift.apply(e,e.splice(-t,t)):0>t&&goog.array.ARRAY_PROTOTYPE_.push.apply(e,e.splice(0,-t))),e},goog.array.zip=function(){if(!arguments.length)return[];for(var e=[],t=0;!0;t++){for(var o=[],r=0;r<arguments.length;r++){var n=arguments[r];if(t>=n.length)return e;o.push(n[t])}e.push(o)}},goog.array.shuffle=function(e,t){for(var o=t||Math.random,r=e.length-1;r>0;r--){var n=Math.floor(o()*(r+1)),i=e[r];e[r]=e[n],e[n]=i}},goog.provide("goog.functions"),goog.functions.constant=function(e){return function(){return e}},goog.functions.FALSE=goog.functions.constant(!1),goog.functions.TRUE=goog.functions.constant(!0),goog.functions.NULL=goog.functions.constant(null),goog.functions.identity=function(e){return e},goog.functions.error=function(e){return function(){throw Error(e)}},goog.functions.fail=function(e){return function(){throw e}},goog.functions.lock=function(e,t){return t=t||0,function(){return e.apply(this,Array.prototype.slice.call(arguments,0,t))}},goog.functions.withReturnValue=function(e,t){return goog.functions.sequence(e,goog.functions.constant(t))},goog.functions.compose=function(){var e=arguments,t=e.length;return function(){var o;t&&(o=e[t-1].apply(this,arguments));for(var r=t-2;r>=0;r--)o=e[r].call(this,o);return o}},goog.functions.sequence=function(){var e=arguments,t=e.length;return function(){for(var o,r=0;t>r;r++)o=e[r].apply(this,arguments);return o}},goog.functions.and=function(){var e=arguments,t=e.length;return function(){for(var o=0;t>o;o++)if(!e[o].apply(this,arguments))return!1;return!0}},goog.functions.or=function(){var e=arguments,t=e.length;return function(){for(var o=0;t>o;o++)if(e[o].apply(this,arguments))return!0;return!1}},goog.functions.not=function(e){return function(){return!e.apply(this,arguments)}},goog.functions.create=function(e){var t=function(){};t.prototype=e.prototype;var o=new t;return e.apply(o,Array.prototype.slice.call(arguments,1)),o},goog.provide("goog.async.Deferred"),goog.provide("goog.async.Deferred.AlreadyCalledError"),goog.provide("goog.async.Deferred.CanceledError"),goog.provide("goog.async.Deferred.CancelledError"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.debug.Error"),goog.require("goog.functions"),goog.async.Deferred=function(e,t){this.sequence_=[],this.onCancelFunction_=e,this.defaultScope_=t||null},goog.async.Deferred.prototype.fired_=!1,goog.async.Deferred.prototype.hadError_=!1,goog.async.Deferred.prototype.result_,goog.async.Deferred.prototype.blocked_=!1,goog.async.Deferred.prototype.blocking_=!1,goog.async.Deferred.prototype.silentlyCanceled_=!1,goog.async.Deferred.prototype.unhandledExceptionTimeoutId_,goog.async.Deferred.prototype.parent_,goog.async.Deferred.prototype.branches_=0,goog.async.Deferred.STRICT_ERRORS=!1,goog.async.Deferred.prototype.cancel=function(e){if(this.hasFired())this.result_ instanceof goog.async.Deferred&&this.result_.cancel();else{if(this.parent_){var t=this.parent_;delete this.parent_,e?t.cancel(e):t.branchCancel_()}this.onCancelFunction_?this.onCancelFunction_.call(this.defaultScope_,this):this.silentlyCanceled_=!0,this.hasFired()||this.errback(new goog.async.Deferred.CanceledError(this))}},goog.async.Deferred.prototype.branchCancel_=function(){this.branches_--,this.branches_<=0&&this.cancel()},goog.async.Deferred.prototype.continue_=function(e,t){this.blocked_=!1,this.updateResult_(e,t)},goog.async.Deferred.prototype.updateResult_=function(e,t){this.fired_=!0,this.result_=t,this.hadError_=!e,this.fire_()},goog.async.Deferred.prototype.check_=function(){if(this.hasFired()){if(!this.silentlyCanceled_)throw new goog.async.Deferred.AlreadyCalledError(this);this.silentlyCanceled_=!1}},goog.async.Deferred.prototype.callback=function(e){this.check_(),this.assertNotDeferred_(e),this.updateResult_(!0,e)},goog.async.Deferred.prototype.errback=function(e){this.check_(),this.assertNotDeferred_(e),this.updateResult_(!1,e)},goog.async.Deferred.prototype.assertNotDeferred_=function(e){goog.asserts.assert(!(e instanceof goog.async.Deferred),"An execution sequence may not be initiated with a blocking Deferred.")},goog.async.Deferred.prototype.addCallback=function(e,t){return this.addCallbacks(e,null,t)},goog.async.Deferred.prototype.addErrback=function(e,t){return this.addCallbacks(null,e,t)},goog.async.Deferred.prototype.addBoth=function(e,t){return this.addCallbacks(e,e,t)},goog.async.Deferred.prototype.addCallbacks=function(e,t,o){return goog.asserts.assert(!this.blocking_,"Blocking Deferreds can not be re-used"),this.sequence_.push([e,t,o]),this.hasFired()&&this.fire_(),this},goog.async.Deferred.prototype.chainDeferred=function(e){return this.addCallbacks(e.callback,e.errback,e),this},goog.async.Deferred.prototype.awaitDeferred=function(e){return this.addCallback(goog.bind(e.branch,e))},goog.async.Deferred.prototype.branch=function(e){var t=new goog.async.Deferred;return this.chainDeferred(t),e&&(t.parent_=this,this.branches_++),t},goog.async.Deferred.prototype.hasFired=function(){return this.fired_},goog.async.Deferred.prototype.isError=function(e){return e instanceof Error},goog.async.Deferred.prototype.hasErrback_=function(){return goog.array.some(this.sequence_,function(e){return goog.isFunction(e[1])})},goog.async.Deferred.prototype.fire_=function(){this.unhandledExceptionTimeoutId_&&this.hasFired()&&this.hasErrback_()&&(goog.global.clearTimeout(this.unhandledExceptionTimeoutId_),delete this.unhandledExceptionTimeoutId_),this.parent_&&(this.parent_.branches_--,delete this.parent_);for(var e=this.result_,t=!1,o=!1;this.sequence_.length&&!this.blocked_;){var r=this.sequence_.shift(),n=r[0],i=r[1],s=r[2],a=this.hadError_?i:n;if(a)try{var g=a.call(s||this.defaultScope_,e);goog.isDef(g)&&(this.hadError_=this.hadError_&&(g==e||this.isError(g)),this.result_=e=g),e instanceof goog.async.Deferred&&(o=!0,this.blocked_=!0)}catch(d){e=d,this.hadError_=!0,this.hasErrback_()||(t=!0)}}this.result_=e,o?(e.addCallbacks(goog.bind(this.continue_,this,!0),goog.bind(this.continue_,this,!1)),e.blocking_=!0):!goog.async.Deferred.STRICT_ERRORS||!this.isError(e)||e instanceof goog.async.Deferred.CanceledError||(this.hadError_=!0,t=!0),t&&(this.unhandledExceptionTimeoutId_=goog.global.setTimeout(goog.functions.fail(e),0))},goog.async.Deferred.succeed=function(e){var t=new goog.async.Deferred;return t.callback(e),t},goog.async.Deferred.fail=function(e){var t=new goog.async.Deferred;return t.errback(e),t},goog.async.Deferred.canceled=function(){var e=new goog.async.Deferred;return e.cancel(),e},goog.async.Deferred.cancelled=goog.async.Deferred.canceled,goog.async.Deferred.when=function(e,t,o){return e instanceof goog.async.Deferred?e.branch(!0).addCallback(t,o):goog.async.Deferred.succeed(e).addCallback(t,o)},goog.async.Error=function(e){Error.captureStackTrace?Error.captureStackTrace(this,goog.async.Error):this.stack=(new Error).stack||"",e&&(this.message=String(e))},goog.inherits(goog.async.Error,Error),goog.async.Deferred.AlreadyCalledError=function(e){goog.async.Error.call(this),this.deferred=e},goog.inherits(goog.async.Deferred.AlreadyCalledError,goog.async.Error),goog.async.Deferred.AlreadyCalledError.prototype.message="Deferred has already fired",goog.async.Deferred.AlreadyCalledError.prototype.name="AlreadyCalledError",goog.async.Deferred.CanceledError=function(e){goog.async.Error.call(this),this.deferred=e},goog.inherits(goog.async.Deferred.CanceledError,goog.async.Error),goog.async.Deferred.CanceledError.prototype.message="Deferred was canceled",goog.async.Deferred.CanceledError.prototype.name="CanceledError",goog.async.Deferred.CancelledError=goog.async.Deferred.CanceledError,goog.provide("ydn.debug.error.ArgumentException"),goog.provide("ydn.debug.error.TypeError"),goog.provide("ydn.debug.error.InternalError"),goog.provide("ydn.debug.error.InvalidOperationException"),goog.provide("ydn.debug.error.NotImplementedException"),goog.provide("ydn.debug.error.NotSupportedException"),goog.require("goog.debug.Error"),ydn.debug.error.ArgumentException=function(e){goog.base(this,e),this.name="ydn.error.ArgumentException"},goog.inherits(ydn.debug.error.ArgumentException,goog.debug.Error),ydn.debug.error.TypeError=function(e){goog.base(this,e),this.name="ydn.error.TypeError"},goog.inherits(ydn.debug.error.TypeError,goog.debug.Error),ydn.debug.error.NotSupportedException=function(e){goog.base(this,e),this.name="ydn.error.NotSupportedException"},goog.inherits(ydn.debug.error.NotSupportedException,goog.debug.Error),ydn.debug.error.NotImplementedException=function(e){goog.base(this,e),this.name="ydn.error.NotImplementedException"},goog.inherits(ydn.debug.error.NotImplementedException,goog.debug.Error),ydn.debug.error.InvalidOperationException=function(e){goog.base(this,e),this.name="ydn.error.InvalidOperationException"},goog.inherits(ydn.debug.error.InvalidOperationException,goog.debug.Error),ydn.debug.error.InternalError=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.debug.error.InternalError):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="ydn.error.InternalError"},goog.inherits(ydn.debug.error.InternalError,Error),ydn.debug.error.InternalError.prototype.name="ydn.error.InternalError",goog.provide("ydn.base"),ydn.base.JQUERY=!1,goog.provide("ydn.async.Deferred"),goog.require("goog.async.Deferred"),goog.require("ydn.debug.error.ArgumentException"),goog.require("ydn.base"),ydn.async.Deferred=function(e,t){goog.base(this,e,t),this.progbacks_=[]},goog.inherits(ydn.async.Deferred,goog.async.Deferred),ydn.async.Deferred.prototype.addProgback=function(e,t){return this.progbacks_.push([e,t]),this
},ydn.async.Deferred.prototype.notify=function(e){for(var t=0;t<this.progbacks_.length;t++){var o=this.progbacks_[t][0],r=this.progbacks_[t][1];o.call(r,e)}},ydn.async.Deferred.prototype.callback=function(e){this.progbacks_.length=0,goog.base(this,"callback",e)},ydn.async.Deferred.prototype.errback=function(e){this.progbacks_.length=0,goog.base(this,"errback",e)},ydn.async.Deferred.prototype.then=function(e,t,o){if(o&&goog.isFunction(o))throw new ydn.debug.error.ArgumentException("progress callback is not supported");var r=e;return goog.isFunction(e)&&(r=function(t){var r=e.call(o,t);if(goog.isObject(r)&&goog.isFunction(r.then)){var n=new goog.async.Deferred;return r.then.call(o,function(e){n.callback(e)},function(e){n.errback(e)}),n}return r}),this.addCallbacks(r,t,o)},goog.provide("ydn.base.exports"),goog.require("ydn.async.Deferred"),goog.exportProperty(goog.async.Deferred.prototype,"done",goog.async.Deferred.prototype.addCallback),goog.exportProperty(goog.async.Deferred.prototype,"fail",goog.async.Deferred.prototype.addErrback),goog.exportProperty(goog.async.Deferred.prototype,"always",goog.async.Deferred.prototype.addBoth),goog.exportProperty(ydn.async.Deferred.prototype,"then",ydn.async.Deferred.prototype.then),goog.provide("goog.object"),goog.object.forEach=function(e,t,o){for(var r in e)t.call(o,e[r],r,e)},goog.object.filter=function(e,t,o){var r={};for(var n in e)t.call(o,e[n],n,e)&&(r[n]=e[n]);return r},goog.object.map=function(e,t,o){var r={};for(var n in e)r[n]=t.call(o,e[n],n,e);return r},goog.object.some=function(e,t,o){for(var r in e)if(t.call(o,e[r],r,e))return!0;return!1},goog.object.every=function(e,t,o){for(var r in e)if(!t.call(o,e[r],r,e))return!1;return!0},goog.object.getCount=function(e){var t=0;for(var o in e)t++;return t},goog.object.getAnyKey=function(e){for(var t in e)return t},goog.object.getAnyValue=function(e){for(var t in e)return e[t]},goog.object.contains=function(e,t){return goog.object.containsValue(e,t)},goog.object.getValues=function(e){var t=[],o=0;for(var r in e)t[o++]=e[r];return t},goog.object.getKeys=function(e){var t=[],o=0;for(var r in e)t[o++]=r;return t},goog.object.getValueByKeys=function(e,t){for(var o=goog.isArrayLike(t),r=o?t:arguments,n=o?0:1;n<r.length&&(e=e[r[n]],goog.isDef(e));n++);return e},goog.object.containsKey=function(e,t){return t in e},goog.object.containsValue=function(e,t){for(var o in e)if(e[o]==t)return!0;return!1},goog.object.findKey=function(e,t,o){for(var r in e)if(t.call(o,e[r],r,e))return r;return void 0},goog.object.findValue=function(e,t,o){var r=goog.object.findKey(e,t,o);return r&&e[r]},goog.object.isEmpty=function(e){for(var t in e)return!1;return!0},goog.object.clear=function(e){for(var t in e)delete e[t]},goog.object.remove=function(e,t){var o;return(o=t in e)&&delete e[t],o},goog.object.add=function(e,t,o){if(t in e)throw Error('The object already contains the key "'+t+'"');goog.object.set(e,t,o)},goog.object.get=function(e,t,o){return t in e?e[t]:o},goog.object.set=function(e,t,o){e[t]=o},goog.object.setIfUndefined=function(e,t,o){return t in e?e[t]:e[t]=o},goog.object.clone=function(e){var t={};for(var o in e)t[o]=e[o];return t},goog.object.unsafeClone=function(e){var t=goog.typeOf(e);if("object"==t||"array"==t){if(e.clone)return e.clone();var o="array"==t?[]:{};for(var r in e)o[r]=goog.object.unsafeClone(e[r]);return o}return e},goog.object.transpose=function(e){var t={};for(var o in e)t[e[o]]=o;return t},goog.object.PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],goog.object.extend=function(e){for(var t,o,r=1;r<arguments.length;r++){o=arguments[r];for(t in o)e[t]=o[t];for(var n=0;n<goog.object.PROTOTYPE_FIELDS_.length;n++)t=goog.object.PROTOTYPE_FIELDS_[n],Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=o[t])}},goog.object.create=function(){var e=arguments.length;if(1==e&&goog.isArray(arguments[0]))return goog.object.create.apply(null,arguments[0]);if(e%2)throw Error("Uneven number of arguments");for(var t={},o=0;e>o;o+=2)t[arguments[o]]=arguments[o+1];return t},goog.object.createSet=function(){var e=arguments.length;if(1==e&&goog.isArray(arguments[0]))return goog.object.createSet.apply(null,arguments[0]);for(var t={},o=0;e>o;o++)t[arguments[o]]=!0;return t},goog.object.createImmutableView=function(e){var t=e;return Object.isFrozen&&!Object.isFrozen(e)&&(t=Object.create(e),Object.freeze(t)),t},goog.object.isImmutableView=function(e){return!!Object.isFrozen&&Object.isFrozen(e)},goog.provide("goog.structs"),goog.require("goog.array"),goog.require("goog.object"),goog.structs.getCount=function(e){return"function"==typeof e.getCount?e.getCount():goog.isArrayLike(e)||goog.isString(e)?e.length:goog.object.getCount(e)},goog.structs.getValues=function(e){if("function"==typeof e.getValues)return e.getValues();if(goog.isString(e))return e.split("");if(goog.isArrayLike(e)){for(var t=[],o=e.length,r=0;o>r;r++)t.push(e[r]);return t}return goog.object.getValues(e)},goog.structs.getKeys=function(e){if("function"==typeof e.getKeys)return e.getKeys();if("function"==typeof e.getValues)return void 0;if(goog.isArrayLike(e)||goog.isString(e)){for(var t=[],o=e.length,r=0;o>r;r++)t.push(r);return t}return goog.object.getKeys(e)},goog.structs.contains=function(e,t){return"function"==typeof e.contains?e.contains(t):"function"==typeof e.containsValue?e.containsValue(t):goog.isArrayLike(e)||goog.isString(e)?goog.array.contains(e,t):goog.object.containsValue(e,t)},goog.structs.isEmpty=function(e){return"function"==typeof e.isEmpty?e.isEmpty():goog.isArrayLike(e)||goog.isString(e)?goog.array.isEmpty(e):goog.object.isEmpty(e)},goog.structs.clear=function(e){"function"==typeof e.clear?e.clear():goog.isArrayLike(e)?goog.array.clear(e):goog.object.clear(e)},goog.structs.forEach=function(e,t,o){if("function"==typeof e.forEach)e.forEach(t,o);else if(goog.isArrayLike(e)||goog.isString(e))goog.array.forEach(e,t,o);else for(var r=goog.structs.getKeys(e),n=goog.structs.getValues(e),i=n.length,s=0;i>s;s++)t.call(o,n[s],r&&r[s],e)},goog.structs.filter=function(e,t,o){if("function"==typeof e.filter)return e.filter(t,o);if(goog.isArrayLike(e)||goog.isString(e))return goog.array.filter(e,t,o);var r,n=goog.structs.getKeys(e),i=goog.structs.getValues(e),s=i.length;if(n){r={};for(var a=0;s>a;a++)t.call(o,i[a],n[a],e)&&(r[n[a]]=i[a])}else{r=[];for(var a=0;s>a;a++)t.call(o,i[a],void 0,e)&&r.push(i[a])}return r},goog.structs.map=function(e,t,o){if("function"==typeof e.map)return e.map(t,o);if(goog.isArrayLike(e)||goog.isString(e))return goog.array.map(e,t,o);var r,n=goog.structs.getKeys(e),i=goog.structs.getValues(e),s=i.length;if(n){r={};for(var a=0;s>a;a++)r[n[a]]=t.call(o,i[a],n[a],e)}else{r=[];for(var a=0;s>a;a++)r[a]=t.call(o,i[a],void 0,e)}return r},goog.structs.some=function(e,t,o){if("function"==typeof e.some)return e.some(t,o);if(goog.isArrayLike(e)||goog.isString(e))return goog.array.some(e,t,o);for(var r=goog.structs.getKeys(e),n=goog.structs.getValues(e),i=n.length,s=0;i>s;s++)if(t.call(o,n[s],r&&r[s],e))return!0;return!1},goog.structs.every=function(e,t,o){if("function"==typeof e.every)return e.every(t,o);if(goog.isArrayLike(e)||goog.isString(e))return goog.array.every(e,t,o);for(var r=goog.structs.getKeys(e),n=goog.structs.getValues(e),i=n.length,s=0;i>s;s++)if(!t.call(o,n[s],r&&r[s],e))return!1;return!0},goog.provide("goog.structs.Collection"),goog.structs.Collection=function(){},goog.structs.Collection.prototype.add,goog.structs.Collection.prototype.remove,goog.structs.Collection.prototype.contains,goog.structs.Collection.prototype.getCount,goog.provide("goog.iter"),goog.provide("goog.iter.Iterator"),goog.provide("goog.iter.StopIteration"),goog.require("goog.array"),goog.require("goog.asserts"),goog.iter.Iterable,goog.iter.StopIteration="StopIteration"in goog.global?goog.global.StopIteration:Error("StopIteration"),goog.iter.Iterator=function(){},goog.iter.Iterator.prototype.next=function(){throw goog.iter.StopIteration},goog.iter.Iterator.prototype.__iterator__=function(){return this},goog.iter.toIterator=function(e){if(e instanceof goog.iter.Iterator)return e;if("function"==typeof e.__iterator__)return e.__iterator__(!1);if(goog.isArrayLike(e)){var t=0,o=new goog.iter.Iterator;return o.next=function(){for(;;){if(t>=e.length)throw goog.iter.StopIteration;{if(t in e)return e[t++];t++}}},o}throw Error("Not implemented")},goog.iter.forEach=function(e,t,o){if(goog.isArrayLike(e))try{goog.array.forEach(e,t,o)}catch(r){if(r!==goog.iter.StopIteration)throw r}else{e=goog.iter.toIterator(e);try{for(;;)t.call(o,e.next(),void 0,e)}catch(r){if(r!==goog.iter.StopIteration)throw r}}},goog.iter.filter=function(e,t,o){var r=goog.iter.toIterator(e),n=new goog.iter.Iterator;return n.next=function(){for(;;){var e=r.next();if(t.call(o,e,void 0,r))return e}},n},goog.iter.range=function(e,t,o){var r=0,n=e,i=o||1;if(arguments.length>1&&(r=e,n=t),0==i)throw Error("Range step argument must not be zero");var s=new goog.iter.Iterator;return s.next=function(){if(i>0&&r>=n||0>i&&n>=r)throw goog.iter.StopIteration;var e=r;return r+=i,e},s},goog.iter.join=function(e,t){return goog.iter.toArray(e).join(t)},goog.iter.map=function(e,t,o){var r=goog.iter.toIterator(e),n=new goog.iter.Iterator;return n.next=function(){for(;;){var e=r.next();return t.call(o,e,void 0,r)}},n},goog.iter.reduce=function(e,t,o,r){var n=o;return goog.iter.forEach(e,function(e){n=t.call(r,n,e)}),n},goog.iter.some=function(e,t,o){e=goog.iter.toIterator(e);try{for(;;)if(t.call(o,e.next(),void 0,e))return!0}catch(r){if(r!==goog.iter.StopIteration)throw r}return!1},goog.iter.every=function(e,t,o){e=goog.iter.toIterator(e);try{for(;;)if(!t.call(o,e.next(),void 0,e))return!1}catch(r){if(r!==goog.iter.StopIteration)throw r}return!0},goog.iter.chain=function(){var e=arguments,t=e.length,o=0,r=new goog.iter.Iterator;return r.next=function(){try{if(o>=t)throw goog.iter.StopIteration;var r=goog.iter.toIterator(e[o]);return r.next()}catch(n){if(n!==goog.iter.StopIteration||o>=t)throw n;return o++,this.next()}},r},goog.iter.dropWhile=function(e,t,o){var r=goog.iter.toIterator(e),n=new goog.iter.Iterator,i=!0;return n.next=function(){for(;;){var e=r.next();if(!i||!t.call(o,e,void 0,r))return i=!1,e}},n},goog.iter.takeWhile=function(e,t,o){var r=goog.iter.toIterator(e),n=new goog.iter.Iterator,i=!0;return n.next=function(){for(;;){if(!i)throw goog.iter.StopIteration;var e=r.next();if(t.call(o,e,void 0,r))return e;i=!1}},n},goog.iter.toArray=function(e){if(goog.isArrayLike(e))return goog.array.toArray(e);e=goog.iter.toIterator(e);var t=[];return goog.iter.forEach(e,function(e){t.push(e)}),t},goog.iter.equals=function(e,t){e=goog.iter.toIterator(e),t=goog.iter.toIterator(t);var o,r;try{for(;;){o=r=!1;var n=e.next();o=!0;var i=t.next();if(r=!0,n!=i)return!1}}catch(s){if(s!==goog.iter.StopIteration)throw s;if(o&&!r)return!1;if(!r)try{return i=t.next(),!1}catch(a){if(a!==goog.iter.StopIteration)throw a;return!0}}return!1},goog.iter.nextOrValue=function(e,t){try{return goog.iter.toIterator(e).next()}catch(o){if(o!=goog.iter.StopIteration)throw o;return t}},goog.iter.product=function(){var e=goog.array.some(arguments,function(e){return!e.length});if(e||!arguments.length)return new goog.iter.Iterator;var t=new goog.iter.Iterator,o=arguments,r=goog.array.repeat(0,o.length);return t.next=function(){if(r){for(var e=goog.array.map(r,function(e,t){return o[t][e]}),t=r.length-1;t>=0;t--){if(goog.asserts.assert(r),r[t]<o[t].length-1){r[t]++;break}if(0==t){r=null;break}r[t]=0}return e}throw goog.iter.StopIteration},t},goog.iter.cycle=function(e){var t=goog.iter.toIterator(e),o=[],r=0,n=new goog.iter.Iterator,i=!1;return n.next=function(){var e=null;if(!i)try{return e=t.next(),o.push(e),e}catch(n){if(n!=goog.iter.StopIteration||goog.array.isEmpty(o))throw n;i=!0}return e=o[r],r=(r+1)%o.length,e},n},goog.provide("goog.structs.Map"),goog.require("goog.iter.Iterator"),goog.require("goog.iter.StopIteration"),goog.require("goog.object"),goog.require("goog.structs"),goog.structs.Map=function(e){this.map_={},this.keys_=[];var t=arguments.length;if(t>1){if(t%2)throw Error("Uneven number of arguments");for(var o=0;t>o;o+=2)this.set(arguments[o],arguments[o+1])}else e&&this.addAll(e)},goog.structs.Map.prototype.count_=0,goog.structs.Map.prototype.version_=0,goog.structs.Map.prototype.getCount=function(){return this.count_},goog.structs.Map.prototype.getValues=function(){this.cleanupKeysArray_();for(var e=[],t=0;t<this.keys_.length;t++){var o=this.keys_[t];e.push(this.map_[o])}return e},goog.structs.Map.prototype.getKeys=function(){return this.cleanupKeysArray_(),this.keys_.concat()},goog.structs.Map.prototype.containsKey=function(e){return goog.structs.Map.hasKey_(this.map_,e)},goog.structs.Map.prototype.containsValue=function(e){for(var t=0;t<this.keys_.length;t++){var o=this.keys_[t];if(goog.structs.Map.hasKey_(this.map_,o)&&this.map_[o]==e)return!0}return!1},goog.structs.Map.prototype.equals=function(e,t){if(this===e)return!0;if(this.count_!=e.getCount())return!1;var o=t||goog.structs.Map.defaultEquals;this.cleanupKeysArray_();for(var r,n=0;r=this.keys_[n];n++)if(!o(this.get(r),e.get(r)))return!1;return!0},goog.structs.Map.defaultEquals=function(e,t){return e===t},goog.structs.Map.prototype.isEmpty=function(){return 0==this.count_},goog.structs.Map.prototype.clear=function(){this.map_={},this.keys_.length=0,this.count_=0,this.version_=0},goog.structs.Map.prototype.remove=function(e){return goog.structs.Map.hasKey_(this.map_,e)?(delete this.map_[e],this.count_--,this.version_++,this.keys_.length>2*this.count_&&this.cleanupKeysArray_(),!0):!1},goog.structs.Map.prototype.cleanupKeysArray_=function(){if(this.count_!=this.keys_.length){for(var e=0,t=0;e<this.keys_.length;){var o=this.keys_[e];goog.structs.Map.hasKey_(this.map_,o)&&(this.keys_[t++]=o),e++}this.keys_.length=t}if(this.count_!=this.keys_.length){for(var r={},e=0,t=0;e<this.keys_.length;){var o=this.keys_[e];goog.structs.Map.hasKey_(r,o)||(this.keys_[t++]=o,r[o]=1),e++}this.keys_.length=t}},goog.structs.Map.prototype.get=function(e,t){return goog.structs.Map.hasKey_(this.map_,e)?this.map_[e]:t},goog.structs.Map.prototype.set=function(e,t){goog.structs.Map.hasKey_(this.map_,e)||(this.count_++,this.keys_.push(e),this.version_++),this.map_[e]=t},goog.structs.Map.prototype.addAll=function(e){var t,o;e instanceof goog.structs.Map?(t=e.getKeys(),o=e.getValues()):(t=goog.object.getKeys(e),o=goog.object.getValues(e));for(var r=0;r<t.length;r++)this.set(t[r],o[r])},goog.structs.Map.prototype.clone=function(){return new goog.structs.Map(this)},goog.structs.Map.prototype.transpose=function(){for(var e=new goog.structs.Map,t=0;t<this.keys_.length;t++){var o=this.keys_[t],r=this.map_[o];e.set(r,o)}return e},goog.structs.Map.prototype.toObject=function(){this.cleanupKeysArray_();for(var e={},t=0;t<this.keys_.length;t++){var o=this.keys_[t];e[o]=this.map_[o]}return e},goog.structs.Map.prototype.getKeyIterator=function(){return this.__iterator__(!0)},goog.structs.Map.prototype.getValueIterator=function(){return this.__iterator__(!1)},goog.structs.Map.prototype.__iterator__=function(e){this.cleanupKeysArray_();var t=0,o=this.keys_,r=this.map_,n=this.version_,i=this,s=new goog.iter.Iterator;return s.next=function(){for(;;){if(n!=i.version_)throw Error("The map has changed since the iterator was created");if(t>=o.length)throw goog.iter.StopIteration;var s=o[t++];return e?s:r[s]}},s},goog.structs.Map.hasKey_=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},goog.provide("goog.structs.Set"),goog.require("goog.structs"),goog.require("goog.structs.Collection"),goog.require("goog.structs.Map"),goog.structs.Set=function(e){this.map_=new goog.structs.Map,e&&this.addAll(e)},goog.structs.Set.getKey_=function(e){var t=typeof e;return"object"==t&&e||"function"==t?"o"+goog.getUid(e):t.substr(0,1)+e},goog.structs.Set.prototype.getCount=function(){return this.map_.getCount()},goog.structs.Set.prototype.add=function(e){this.map_.set(goog.structs.Set.getKey_(e),e)},goog.structs.Set.prototype.addAll=function(e){for(var t=goog.structs.getValues(e),o=t.length,r=0;o>r;r++)this.add(t[r])},goog.structs.Set.prototype.removeAll=function(e){for(var t=goog.structs.getValues(e),o=t.length,r=0;o>r;r++)this.remove(t[r])},goog.structs.Set.prototype.remove=function(e){return this.map_.remove(goog.structs.Set.getKey_(e))},goog.structs.Set.prototype.clear=function(){this.map_.clear()},goog.structs.Set.prototype.isEmpty=function(){return this.map_.isEmpty()},goog.structs.Set.prototype.contains=function(e){return this.map_.containsKey(goog.structs.Set.getKey_(e))},goog.structs.Set.prototype.containsAll=function(e){return goog.structs.every(e,this.contains,this)},goog.structs.Set.prototype.intersection=function(e){for(var t=new goog.structs.Set,o=goog.structs.getValues(e),r=0;r<o.length;r++){var n=o[r];this.contains(n)&&t.add(n)}return t},goog.structs.Set.prototype.difference=function(e){var t=this.clone();return t.removeAll(e),t},goog.structs.Set.prototype.getValues=function(){return this.map_.getValues()},goog.structs.Set.prototype.clone=function(){return new goog.structs.Set(this)},goog.structs.Set.prototype.equals=function(e){return this.getCount()==goog.structs.getCount(e)&&this.isSubsetOf(e)},goog.structs.Set.prototype.isSubsetOf=function(e){var t=goog.structs.getCount(e);return this.getCount()>t?!1:(!(e instanceof goog.structs.Set)&&t>5&&(e=new goog.structs.Set(e)),goog.structs.every(this,function(t){return goog.structs.contains(e,t)}))},goog.structs.Set.prototype.__iterator__=function(){return this.map_.__iterator__(!1)},goog.provide("goog.userAgent"),goog.require("goog.string"),goog.define("goog.userAgent.ASSUME_IE",!1),goog.define("goog.userAgent.ASSUME_GECKO",!1),goog.define("goog.userAgent.ASSUME_WEBKIT",!1),goog.define("goog.userAgent.ASSUME_MOBILE_WEBKIT",!1),goog.define("goog.userAgent.ASSUME_OPERA",!1),goog.define("goog.userAgent.ASSUME_ANY_VERSION",!1),goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA,goog.userAgent.getUserAgentString=function(){return goog.global.navigator?goog.global.navigator.userAgent:null},goog.userAgent.getNavigator=function(){return goog.global.navigator},goog.userAgent.init_=function(){goog.userAgent.detectedOpera_=!1,goog.userAgent.detectedIe_=!1,goog.userAgent.detectedWebkit_=!1,goog.userAgent.detectedMobile_=!1,goog.userAgent.detectedGecko_=!1;var e;if(!goog.userAgent.BROWSER_KNOWN_&&(e=goog.userAgent.getUserAgentString())){var t=goog.userAgent.getNavigator();goog.userAgent.detectedOpera_=0==e.indexOf("Opera"),goog.userAgent.detectedIe_=!goog.userAgent.detectedOpera_&&-1!=e.indexOf("MSIE"),goog.userAgent.detectedWebkit_=!goog.userAgent.detectedOpera_&&-1!=e.indexOf("WebKit"),goog.userAgent.detectedMobile_=goog.userAgent.detectedWebkit_&&-1!=e.indexOf("Mobile"),goog.userAgent.detectedGecko_=!goog.userAgent.detectedOpera_&&!goog.userAgent.detectedWebkit_&&"Gecko"==t.product}},goog.userAgent.BROWSER_KNOWN_||goog.userAgent.init_(),goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.userAgent.detectedOpera_,goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.userAgent.detectedIe_,goog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.userAgent.detectedGecko_,goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.userAgent.detectedWebkit_,goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.detectedMobile_,goog.userAgent.SAFARI=goog.userAgent.WEBKIT,goog.userAgent.determinePlatform_=function(){var e=goog.userAgent.getNavigator();return e&&e.platform||""},goog.userAgent.PLATFORM=goog.userAgent.determinePlatform_(),goog.define("goog.userAgent.ASSUME_MAC",!1),goog.define("goog.userAgent.ASSUME_WINDOWS",!1),goog.define("goog.userAgent.ASSUME_LINUX",!1),goog.define("goog.userAgent.ASSUME_X11",!1),goog.define("goog.userAgent.ASSUME_ANDROID",!1),goog.define("goog.userAgent.ASSUME_IPHONE",!1),goog.define("goog.userAgent.ASSUME_IPAD",!1),goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11||goog.userAgent.ASSUME_ANDROID||goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD,goog.userAgent.initPlatform_=function(){goog.userAgent.detectedMac_=goog.string.contains(goog.userAgent.PLATFORM,"Mac"),goog.userAgent.detectedWindows_=goog.string.contains(goog.userAgent.PLATFORM,"Win"),goog.userAgent.detectedLinux_=goog.string.contains(goog.userAgent.PLATFORM,"Linux"),goog.userAgent.detectedX11_=!!goog.userAgent.getNavigator()&&goog.string.contains(goog.userAgent.getNavigator().appVersion||"","X11");var e=goog.userAgent.getUserAgentString();goog.userAgent.detectedAndroid_=!!e&&e.indexOf("Android")>=0,goog.userAgent.detectedIPhone_=!!e&&e.indexOf("iPhone")>=0,goog.userAgent.detectedIPad_=!!e&&e.indexOf("iPad")>=0},goog.userAgent.PLATFORM_KNOWN_||goog.userAgent.initPlatform_(),goog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.userAgent.detectedMac_,goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.userAgent.detectedWindows_,goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.userAgent.detectedLinux_,goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.detectedX11_,goog.userAgent.ANDROID=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_ANDROID:goog.userAgent.detectedAndroid_,goog.userAgent.IPHONE=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE:goog.userAgent.detectedIPhone_,goog.userAgent.IPAD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPAD:goog.userAgent.detectedIPad_,goog.userAgent.determineVersion_=function(){var e,t="";if(goog.userAgent.OPERA&&goog.global.opera){var o=goog.global.opera.version;t="function"==typeof o?o():o}else if(goog.userAgent.GECKO?e=/rv\:([^\);]+)(\)|;)/:goog.userAgent.IE?e=/MSIE\s+([^\);]+)(\)|;)/:goog.userAgent.WEBKIT&&(e=/WebKit\/(\S+)/),e){var r=e.exec(goog.userAgent.getUserAgentString());t=r?r[1]:""}if(goog.userAgent.IE){var n=goog.userAgent.getDocumentMode_();if(n>parseFloat(t))return String(n)}return t},goog.userAgent.getDocumentMode_=function(){var e=goog.global.document;return e?e.documentMode:void 0},goog.userAgent.VERSION=goog.userAgent.determineVersion_(),goog.userAgent.compare=function(e,t){return goog.string.compareVersions(e,t)},goog.userAgent.isVersionOrHigherCache_={},goog.userAgent.isVersionOrHigher=function(e){return goog.userAgent.ASSUME_ANY_VERSION||goog.userAgent.isVersionOrHigherCache_[e]||(goog.userAgent.isVersionOrHigherCache_[e]=goog.string.compareVersions(goog.userAgent.VERSION,e)>=0)},goog.userAgent.isVersion=goog.userAgent.isVersionOrHigher,goog.userAgent.isDocumentModeOrHigher=function(e){return goog.userAgent.IE&&goog.userAgent.DOCUMENT_MODE>=e},goog.userAgent.isDocumentMode=goog.userAgent.isDocumentModeOrHigher,goog.userAgent.DOCUMENT_MODE=function(){var e=goog.global.document;if(!e||!goog.userAgent.IE)return void 0;var t=goog.userAgent.getDocumentMode_();return t||("CSS1Compat"==e.compatMode?parseInt(goog.userAgent.VERSION,10):5)}(),goog.provide("goog.debug"),goog.require("goog.array"),goog.require("goog.string"),goog.require("goog.structs.Set"),goog.require("goog.userAgent"),goog.define("goog.debug.LOGGING_ENABLED",goog.DEBUG),goog.debug.catchErrors=function(e,t,o){var r=o||goog.global,n=r.onerror,i=!!t;goog.userAgent.WEBKIT&&!goog.userAgent.isVersionOrHigher("535.3")&&(i=!i),r.onerror=function(t,o,r){return n&&n(t,o,r),e({message:t,fileName:o,line:r}),i}},goog.debug.expose=function(e,t){if("undefined"==typeof e)return"undefined";if(null==e)return"NULL";var o=[];for(var r in e)if(t||!goog.isFunction(e[r])){var n=r+" = ";try{n+=e[r]}catch(i){n+="*** "+i+" ***"}o.push(n)}return o.join("\n")},goog.debug.deepExpose=function(e,t){var o=new goog.structs.Set,r=[],n=function(e,i){var s=i+"  ",a=function(e){return e.replace(/\n/g,"\n"+i)};try{if(goog.isDef(e))if(goog.isNull(e))r.push("NULL");else if(goog.isString(e))r.push('"'+a(e)+'"');else if(goog.isFunction(e))r.push(a(String(e)));else if(goog.isObject(e))if(o.contains(e))r.push("*** reference loop detected ***");else{o.add(e),r.push("{");for(var g in e)(t||!goog.isFunction(e[g]))&&(r.push("\n"),r.push(s),r.push(g+" = "),n(e[g],s));r.push("\n"+i+"}")}else r.push(e);else r.push("undefined")}catch(d){r.push("*** "+d+" ***")}};return n(e,""),r.join("")},goog.debug.exposeArray=function(e){for(var t=[],o=0;o<e.length;o++)goog.isArray(e[o])?t.push(goog.debug.exposeArray(e[o])):t.push(e[o]);return"[ "+t.join(", ")+" ]"},goog.debug.exposeException=function(e,t){try{var o=goog.debug.normalizeErrorObject(e),r="Message: "+goog.string.htmlEscape(o.message)+'\nUrl: <a href="view-source:'+o.fileName+'" target="_new">'+o.fileName+"</a>\nLine: "+o.lineNumber+"\n\nBrowser stack:\n"+goog.string.htmlEscape(o.stack+"-> ")+"[end]\n\nJS stack traversal:\n"+goog.string.htmlEscape(goog.debug.getStacktrace(t)+"-> ");return r}catch(n){return"Exception trying to expose exception! You win, we lose. "+n}},goog.debug.normalizeErrorObject=function(e){var t=goog.getObjectByName("window.location.href");if(goog.isString(e))return{message:e,name:"Unknown error",lineNumber:"Not available",fileName:t,stack:"Not available"};var o,r,n=!1;try{o=e.lineNumber||e.line||"Not available"}catch(i){o="Not available",n=!0}try{r=e.fileName||e.filename||e.sourceURL||goog.global.$googDebugFname||t}catch(i){r="Not available",n=!0}return!n&&e.lineNumber&&e.fileName&&e.stack?e:{message:e.message,name:e.name,lineNumber:o,fileName:r,stack:e.stack||"Not available"}},goog.debug.enhanceError=function(e,t){var o="string"==typeof e?Error(e):e;if(o.stack||(o.stack=goog.debug.getStacktrace(arguments.callee.caller)),t){for(var r=0;o["message"+r];)++r;o["message"+r]=String(t)}return o},goog.debug.getStacktraceSimple=function(e){for(var t=[],o=arguments.callee.caller,r=0;o&&(!e||e>r);){t.push(goog.debug.getFunctionName(o)),t.push("()\n");try{o=o.caller}catch(n){t.push("[exception trying to get caller]\n");break}if(r++,r>=goog.debug.MAX_STACK_DEPTH){t.push("[...long stack...]");break}}return e&&r>=e?t.push("[...reached max depth limit...]"):t.push("[end]"),t.join("")},goog.debug.MAX_STACK_DEPTH=50,goog.debug.getStacktrace=function(e){return goog.debug.getStacktraceHelper_(e||arguments.callee.caller,[])},goog.debug.getStacktraceHelper_=function(e,t){var o=[];if(goog.array.contains(t,e))o.push("[...circular reference...]");else if(e&&t.length<goog.debug.MAX_STACK_DEPTH){o.push(goog.debug.getFunctionName(e)+"(");for(var r=e.arguments,n=0;n<r.length;n++){n>0&&o.push(", ");var i,s=r[n];switch(typeof s){case"object":i=s?"object":"null";break;case"string":i=s;break;case"number":i=String(s);break;case"boolean":i=s?"true":"false";break;case"function":i=goog.debug.getFunctionName(s),i=i?i:"[fn]";break;case"undefined":default:i=typeof s}i.length>40&&(i=i.substr(0,40)+"..."),o.push(i)}t.push(e),o.push(")\n");try{o.push(goog.debug.getStacktraceHelper_(e.caller,t))}catch(a){o.push("[exception trying to get caller]\n")}}else e?o.push("[...long stack...]"):o.push("[end]");return o.join("")},goog.debug.setFunctionResolver=function(e){goog.debug.fnNameResolver_=e},goog.debug.getFunctionName=function(e){if(goog.debug.fnNameCache_[e])return goog.debug.fnNameCache_[e];if(goog.debug.fnNameResolver_){var t=goog.debug.fnNameResolver_(e);if(t)return goog.debug.fnNameCache_[e]=t,t}var o=String(e);if(!goog.debug.fnNameCache_[o]){var r=/function ([^\(]+)/.exec(o);if(r){var n=r[1];goog.debug.fnNameCache_[o]=n}else goog.debug.fnNameCache_[o]="[Anonymous]"}return goog.debug.fnNameCache_[o]},goog.debug.makeWhitespaceVisible=function(e){return e.replace(/ /g,"[_]").replace(/\f/g,"[f]").replace(/\n/g,"[n]\n").replace(/\r/g,"[r]").replace(/\t/g,"[t]")},goog.debug.fnNameCache_={},goog.debug.fnNameResolver_,goog.provide("goog.debug.LogRecord"),goog.debug.LogRecord=function(e,t,o,r,n){this.reset(e,t,o,r,n)},goog.debug.LogRecord.prototype.time_,goog.debug.LogRecord.prototype.level_,goog.debug.LogRecord.prototype.msg_,goog.debug.LogRecord.prototype.loggerName_,goog.debug.LogRecord.prototype.sequenceNumber_=0,goog.debug.LogRecord.prototype.exception_=null,goog.debug.LogRecord.prototype.exceptionText_=null,goog.define("goog.debug.LogRecord.ENABLE_SEQUENCE_NUMBERS",!0),goog.debug.LogRecord.nextSequenceNumber_=0,goog.debug.LogRecord.prototype.reset=function(e,t,o,r,n){goog.debug.LogRecord.ENABLE_SEQUENCE_NUMBERS&&(this.sequenceNumber_="number"==typeof n?n:goog.debug.LogRecord.nextSequenceNumber_++),this.time_=r||goog.now(),this.level_=e,this.msg_=t,this.loggerName_=o,delete this.exception_,delete this.exceptionText_},goog.debug.LogRecord.prototype.getLoggerName=function(){return this.loggerName_},goog.debug.LogRecord.prototype.getException=function(){return this.exception_},goog.debug.LogRecord.prototype.setException=function(e){this.exception_=e},goog.debug.LogRecord.prototype.getExceptionText=function(){return this.exceptionText_},goog.debug.LogRecord.prototype.setExceptionText=function(e){this.exceptionText_=e},goog.debug.LogRecord.prototype.setLoggerName=function(e){this.loggerName_=e},goog.debug.LogRecord.prototype.getLevel=function(){return this.level_},goog.debug.LogRecord.prototype.setLevel=function(e){this.level_=e},goog.debug.LogRecord.prototype.getMessage=function(){return this.msg_},goog.debug.LogRecord.prototype.setMessage=function(e){this.msg_=e},goog.debug.LogRecord.prototype.getMillis=function(){return this.time_},goog.debug.LogRecord.prototype.setMillis=function(e){this.time_=e},goog.debug.LogRecord.prototype.getSequenceNumber=function(){return this.sequenceNumber_},goog.provide("goog.debug.LogBuffer"),goog.require("goog.asserts"),goog.require("goog.debug.LogRecord"),goog.debug.LogBuffer=function(){goog.asserts.assert(goog.debug.LogBuffer.isBufferingEnabled(),"Cannot use goog.debug.LogBuffer without defining goog.debug.LogBuffer.CAPACITY."),this.clear()},goog.debug.LogBuffer.getInstance=function(){return goog.debug.LogBuffer.instance_||(goog.debug.LogBuffer.instance_=new goog.debug.LogBuffer),goog.debug.LogBuffer.instance_},goog.define("goog.debug.LogBuffer.CAPACITY",0),goog.debug.LogBuffer.prototype.buffer_,goog.debug.LogBuffer.prototype.curIndex_,goog.debug.LogBuffer.prototype.isFull_,goog.debug.LogBuffer.prototype.addRecord=function(e,t,o){var r=(this.curIndex_+1)%goog.debug.LogBuffer.CAPACITY;if(this.curIndex_=r,this.isFull_){var n=this.buffer_[r];return n.reset(e,t,o),n}return this.isFull_=r==goog.debug.LogBuffer.CAPACITY-1,this.buffer_[r]=new goog.debug.LogRecord(e,t,o)},goog.debug.LogBuffer.isBufferingEnabled=function(){return goog.debug.LogBuffer.CAPACITY>0},goog.debug.LogBuffer.prototype.clear=function(){this.buffer_=new Array(goog.debug.LogBuffer.CAPACITY),this.curIndex_=-1,this.isFull_=!1},goog.debug.LogBuffer.prototype.forEachRecord=function(e){var t=this.buffer_;if(t[0]){var o=this.curIndex_,r=this.isFull_?o:-1;do r=(r+1)%goog.debug.LogBuffer.CAPACITY,e(t[r]);while(r!=o)}},goog.provide("goog.debug.LogManager"),goog.provide("goog.debug.Logger"),goog.provide("goog.debug.Logger.Level"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.debug"),goog.require("goog.debug.LogBuffer"),goog.require("goog.debug.LogRecord"),goog.debug.Logger=function(e){this.name_=e},goog.debug.Logger.prototype.parent_=null,goog.debug.Logger.prototype.level_=null,goog.debug.Logger.prototype.children_=null,goog.debug.Logger.prototype.handlers_=null,goog.define("goog.debug.Logger.ENABLE_HIERARCHY",!0),goog.debug.Logger.ENABLE_HIERARCHY||(goog.debug.Logger.rootHandlers_=[],goog.debug.Logger.rootLevel_),goog.debug.Logger.Level=function(e,t){this.name=e,this.value=t},goog.debug.Logger.Level.prototype.toString=function(){return this.name},goog.debug.Logger.Level.OFF=new goog.debug.Logger.Level("OFF",1/0),goog.debug.Logger.Level.SHOUT=new goog.debug.Logger.Level("SHOUT",1200),goog.debug.Logger.Level.SEVERE=new goog.debug.Logger.Level("SEVERE",1e3),goog.debug.Logger.Level.WARNING=new goog.debug.Logger.Level("WARNING",900),goog.debug.Logger.Level.INFO=new goog.debug.Logger.Level("INFO",800),goog.debug.Logger.Level.CONFIG=new goog.debug.Logger.Level("CONFIG",700),goog.debug.Logger.Level.FINE=new goog.debug.Logger.Level("FINE",500),goog.debug.Logger.Level.FINER=new goog.debug.Logger.Level("FINER",400),goog.debug.Logger.Level.FINEST=new goog.debug.Logger.Level("FINEST",300),goog.debug.Logger.Level.ALL=new goog.debug.Logger.Level("ALL",0),goog.debug.Logger.Level.PREDEFINED_LEVELS=[goog.debug.Logger.Level.OFF,goog.debug.Logger.Level.SHOUT,goog.debug.Logger.Level.SEVERE,goog.debug.Logger.Level.WARNING,goog.debug.Logger.Level.INFO,goog.debug.Logger.Level.CONFIG,goog.debug.Logger.Level.FINE,goog.debug.Logger.Level.FINER,goog.debug.Logger.Level.FINEST,goog.debug.Logger.Level.ALL],goog.debug.Logger.Level.predefinedLevelsCache_=null,goog.debug.Logger.Level.createPredefinedLevelsCache_=function(){goog.debug.Logger.Level.predefinedLevelsCache_={};
for(var e,t=0;e=goog.debug.Logger.Level.PREDEFINED_LEVELS[t];t++)goog.debug.Logger.Level.predefinedLevelsCache_[e.value]=e,goog.debug.Logger.Level.predefinedLevelsCache_[e.name]=e},goog.debug.Logger.Level.getPredefinedLevel=function(e){return goog.debug.Logger.Level.predefinedLevelsCache_||goog.debug.Logger.Level.createPredefinedLevelsCache_(),goog.debug.Logger.Level.predefinedLevelsCache_[e]||null},goog.debug.Logger.Level.getPredefinedLevelByValue=function(e){if(goog.debug.Logger.Level.predefinedLevelsCache_||goog.debug.Logger.Level.createPredefinedLevelsCache_(),e in goog.debug.Logger.Level.predefinedLevelsCache_)return goog.debug.Logger.Level.predefinedLevelsCache_[e];for(var t=0;t<goog.debug.Logger.Level.PREDEFINED_LEVELS.length;++t){var o=goog.debug.Logger.Level.PREDEFINED_LEVELS[t];if(o.value<=e)return o}return null},goog.debug.Logger.getLogger=function(e){return goog.debug.LogManager.getLogger(e)},goog.debug.Logger.logToProfilers=function(e){goog.global.console&&(goog.global.console.timeStamp?goog.global.console.timeStamp(e):goog.global.console.markTimeline&&goog.global.console.markTimeline(e)),goog.global.msWriteProfilerMark&&goog.global.msWriteProfilerMark(e)},goog.debug.Logger.prototype.getName=function(){return this.name_},goog.debug.Logger.prototype.addHandler=function(e){goog.debug.LOGGING_ENABLED&&(goog.debug.Logger.ENABLE_HIERARCHY?(this.handlers_||(this.handlers_=[]),this.handlers_.push(e)):(goog.asserts.assert(!this.name_,"Cannot call addHandler on a non-root logger when goog.debug.Logger.ENABLE_HIERARCHY is false."),goog.debug.Logger.rootHandlers_.push(e)))},goog.debug.Logger.prototype.removeHandler=function(e){if(goog.debug.LOGGING_ENABLED){var t=goog.debug.Logger.ENABLE_HIERARCHY?this.handlers_:goog.debug.Logger.rootHandlers_;return!!t&&goog.array.remove(t,e)}return!1},goog.debug.Logger.prototype.getParent=function(){return this.parent_},goog.debug.Logger.prototype.getChildren=function(){return this.children_||(this.children_={}),this.children_},goog.debug.Logger.prototype.setLevel=function(e){goog.debug.LOGGING_ENABLED&&(goog.debug.Logger.ENABLE_HIERARCHY?this.level_=e:(goog.asserts.assert(!this.name_,"Cannot call setLevel() on a non-root logger when goog.debug.Logger.ENABLE_HIERARCHY is false."),goog.debug.Logger.rootLevel_=e))},goog.debug.Logger.prototype.getLevel=function(){return goog.debug.LOGGING_ENABLED?this.level_:goog.debug.Logger.Level.OFF},goog.debug.Logger.prototype.getEffectiveLevel=function(){return goog.debug.LOGGING_ENABLED?goog.debug.Logger.ENABLE_HIERARCHY?this.level_?this.level_:this.parent_?this.parent_.getEffectiveLevel():(goog.asserts.fail("Root logger has no level set."),null):goog.debug.Logger.rootLevel_:goog.debug.Logger.Level.OFF},goog.debug.Logger.prototype.isLoggable=function(e){return goog.debug.LOGGING_ENABLED&&e.value>=this.getEffectiveLevel().value},goog.debug.Logger.prototype.log=function(e,t,o){goog.debug.LOGGING_ENABLED&&this.isLoggable(e)&&this.doLogRecord_(this.getLogRecord(e,t,o))},goog.debug.Logger.prototype.getLogRecord=function(e,t,o){if(goog.debug.LogBuffer.isBufferingEnabled())var r=goog.debug.LogBuffer.getInstance().addRecord(e,t,this.name_);else r=new goog.debug.LogRecord(e,String(t),this.name_);return o&&(r.setException(o),r.setExceptionText(goog.debug.exposeException(o,arguments.callee.caller))),r},goog.debug.Logger.prototype.shout=function(e,t){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.SHOUT,e,t)},goog.debug.Logger.prototype.severe=function(e,t){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.SEVERE,e,t)},goog.debug.Logger.prototype.warning=function(e,t){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.WARNING,e,t)},goog.debug.Logger.prototype.info=function(e,t){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.INFO,e,t)},goog.debug.Logger.prototype.config=function(e,t){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.CONFIG,e,t)},goog.debug.Logger.prototype.fine=function(e,t){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.FINE,e,t)},goog.debug.Logger.prototype.finer=function(e,t){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.FINER,e,t)},goog.debug.Logger.prototype.finest=function(e,t){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.FINEST,e,t)},goog.debug.Logger.prototype.logRecord=function(e){goog.debug.LOGGING_ENABLED&&this.isLoggable(e.getLevel())&&this.doLogRecord_(e)},goog.debug.Logger.prototype.doLogRecord_=function(e){if(goog.debug.Logger.logToProfilers("log:"+e.getMessage()),goog.debug.Logger.ENABLE_HIERARCHY)for(var t=this;t;)t.callPublish_(e),t=t.getParent();else for(var o,r=0;o=goog.debug.Logger.rootHandlers_[r++];)o(e)},goog.debug.Logger.prototype.callPublish_=function(e){if(this.handlers_)for(var t,o=0;t=this.handlers_[o];o++)t(e)},goog.debug.Logger.prototype.setParent_=function(e){this.parent_=e},goog.debug.Logger.prototype.addChild_=function(e,t){this.getChildren()[e]=t},goog.debug.LogManager={},goog.debug.LogManager.loggers_={},goog.debug.LogManager.rootLogger_=null,goog.debug.LogManager.initialize=function(){goog.debug.LogManager.rootLogger_||(goog.debug.LogManager.rootLogger_=new goog.debug.Logger(""),goog.debug.LogManager.loggers_[""]=goog.debug.LogManager.rootLogger_,goog.debug.LogManager.rootLogger_.setLevel(goog.debug.Logger.Level.CONFIG))},goog.debug.LogManager.getLoggers=function(){return goog.debug.LogManager.loggers_},goog.debug.LogManager.getRoot=function(){return goog.debug.LogManager.initialize(),goog.debug.LogManager.rootLogger_},goog.debug.LogManager.getLogger=function(e){goog.debug.LogManager.initialize();var t=goog.debug.LogManager.loggers_[e];return t||goog.debug.LogManager.createLogger_(e)},goog.debug.LogManager.createFunctionForCatchErrors=function(e){return function(t){var o=e||goog.debug.LogManager.getRoot();o.severe("Error: "+t.message+" ("+t.fileName+" @ Line: "+t.line+")")}},goog.debug.LogManager.createLogger_=function(e){var t=new goog.debug.Logger(e);if(goog.debug.Logger.ENABLE_HIERARCHY){var o=e.lastIndexOf("."),r=e.substr(0,o),n=e.substr(o+1),i=goog.debug.LogManager.getLogger(r);i.addChild_(n,t),t.setParent_(i)}return goog.debug.LogManager.loggers_[e]=t,t},goog.provide("ydn.db.IDBKeyRange"),goog.provide("ydn.db.KeyRange"),ydn.db.KeyRange=function(e,t,o,r){this.lower=e,this.upper=t,this.lowerOpen=!!o,this.upperOpen=!!r,goog.DEBUG&&goog.isFunction(Object.freeze)&&Object.freeze(this)},ydn.db.KeyRange.prototype.lower=void 0,ydn.db.KeyRange.prototype.upper=void 0,ydn.db.KeyRange.prototype.lowerOpen,ydn.db.KeyRange.prototype.upperOpen,ydn.db.KeyRange.prototype.toJSON=function(){return ydn.db.KeyRange.toJSON(this)},ydn.db.KeyRange.prototype.toIDBKeyRange=function(){return ydn.db.KeyRange.parseIDBKeyRange(this)},ydn.db.KeyRange.clone=function(e){return goog.isDefAndNotNull(e)?new ydn.db.KeyRange(e.lower,e.upper,!!e.lowerOpen,!!e.upperOpen):void 0},ydn.db.KeyRange.only=function(e){return new ydn.db.KeyRange(e,e,!1,!1)},ydn.db.KeyRange.bound=function(e,t,o,r){return new ydn.db.KeyRange(e,t,o,r)},ydn.db.KeyRange.upperBound=function(e,t){return new ydn.db.KeyRange(void 0,e,void 0,!!t)},ydn.db.KeyRange.lowerBound=function(e,t){return new ydn.db.KeyRange(e,void 0,!!t,void 0)},ydn.db.KeyRange.starts=function(e){var t;if(goog.isArray(e))t=goog.array.clone(e),t.push("");else{if(!goog.isString(e))return ydn.db.KeyRange.only(e);t=e+""}return ydn.db.KeyRange.bound(e,t,!1,!0)},ydn.db.KeyRange.toJSON=function(e){e=e||{};var t={lower:e.lower,upper:e.upper,lowerOpen:e.lowerOpen,upperOpen:e.upperOpen};return t},ydn.db.KeyRange.parseKeyRange=function(e){if(!goog.isDefAndNotNull(e))return null;if(e instanceof ydn.db.KeyRange)return e;if(goog.isObject(e))return new ydn.db.KeyRange(e.lower,e.upper,e.lowerOpen,e.upperOpen);throw new ydn.debug.error.ArgumentException("Invalid key range: "+e+" of type "+typeof e)},ydn.db.KeyRange.parseIDBKeyRange=function(e){if(goog.isDefAndNotNull(e)){var t=e;return goog.isDefAndNotNull(t.upper)&&goog.isDefAndNotNull(t.lower)?ydn.db.IDBKeyRange.bound(t.lower,t.upper,!!t.lowerOpen,!!t.upperOpen):goog.isDefAndNotNull(t.upper)?ydn.db.IDBKeyRange.upperBound(t.upper,t.upperOpen):goog.isDefAndNotNull(t.lower)?ydn.db.IDBKeyRange.lowerBound(t.lower,t.lowerOpen):null}return null},ydn.db.KeyRange.validate=function(e){if(e instanceof ydn.db.KeyRange)return"";if(goog.isDefAndNotNull(e)){if(goog.isObject(e)){for(var t in e)if(e.hasOwnProperty(t)&&!goog.array.contains(["lower","upper","lowerOpen","upperOpen"],t))return'invalid attribute "'+t+'" in key range object';return""}return"key range must be an object"}return""},ydn.db.KeyRange.prototype.and=function(e){var t=this.lower,o=this.upper,r=this.lowerOpen,n=this.upperOpen;return goog.isDefAndNotNull(e.lower)&&(!goog.isDefAndNotNull(this.lower)||e.lower>=this.lower)&&(t=e.lower,r=e.lowerOpen||this.lowerOpen),goog.isDefAndNotNull(e.upper)&&(!goog.isDefAndNotNull(this.upper)||e.upper<=this.upper)&&(o=e.upper,n=e.upperOpen||this.upperOpen),ydn.db.KeyRange.bound(t,o,r,n)},ydn.db.KeyRange.toString=function(e){if(!e)return"";var t=e.lowerOpen?"(":"[";return goog.isDefAndNotNull(e.lower)&&(t+=e.lower+", "),goog.isDefAndNotNull(e.upper)&&(t+=e.upper),t+=e.upperOpen?")":"]"},ydn.db.KeyRange.toSql=function(e,t,o,r,n){if(o)if(!o.lowerOpen&&!o.upperOpen&&goog.isDefAndNotNull(o.lower)&&goog.isDefAndNotNull(o.upper)&&0===ydn.db.cmp(o.lower,o.upper))r.push(e+" = ?"),n.push(ydn.db.schema.Index.js2sql(o.lower,t));else{if(goog.isDefAndNotNull(o.lower)){var i=o.lowerOpen?" > ":" >= ";r.push(e+i+"?"),n.push(ydn.db.schema.Index.js2sql(o.lower,t))}if(goog.isDefAndNotNull(o.upper)){var i=o.upperOpen?" < ":" <= ";r.push(e+i+"?"),n.push(ydn.db.schema.Index.js2sql(o.upper,t))}}},ydn.db.KeyRange.where=function(e,t,o,r){var n,i,s,a;if("starts"==e||"^"==e)return goog.asserts.assert(goog.isString(t)||goog.isArray(t),"key value of starts with must be an array or a string"),goog.asserts.assert(!goog.isDef(o),"op2 must not be defined"),goog.asserts.assert(!goog.isDef(r),"value2 must not be defined"),ydn.db.KeyRange.starts(t);if("<"==e||"<="==e)n=t,s="<"==e;else if(">"==e||">="==e)i=t,a=">"==e;else{if("="!=e&&"=="!=e)throw new ydn.debug.error.ArgumentException("invalid op: "+e);i=t,n=t}if("<"==o||"<="==o)n=r,s="<"==o;else if(">"==o||">="==o)i=r,a=">"==o;else if(goog.isDef(o))throw new ydn.debug.error.ArgumentException("invalid op2: "+o);return ydn.db.KeyRange.bound(i,n,a,s)},ydn.db.IDBKeyRange=goog.global.IDBKeyRange||goog.global.webkitIDBKeyRange||ydn.db.KeyRange,goog.provide("ydn.db.base"),goog.provide("ydn.db.base.Transaction"),goog.require("goog.async.Deferred"),goog.require("ydn.async.Deferred"),ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME="_ROWID_",ydn.db.base.DEFAULT_BLOB_COLUMN="_default_",ydn.db.base.DISPATCH_EVENT=!1,ydn.db.base.DEFAULT_RESULT_LIMIT=100,ydn.db.base.DEFAULT_CONNECTION_TIMEOUT=18e5,ydn.db.base.Mechanisms={IDB:"indexeddb",USER_DATA:"userdata",LOCAL_STORAGE:"localstorage",MEMORY_STORAGE:"memory",SESSION_STORAGE:"sessionstorage",WEBSQL:"websql"},ydn.db.base.TxEventTypes={COMPLETE:"complete",ABORT:"abort",ERROR:"error"},ydn.db.base.StandardTransactionMode={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange"},ydn.db.base.IDBTransaction=goog.global.IDBRequest&&"LOADING"in goog.global.IDBRequest?goog.global.IDBTransaction:goog.global.webkitIDBRequest&&"LOADING"in goog.global.webkitIDBRequest&&1===goog.global.webkitIDBTransaction.READ_WRITE?goog.global.webkitIDBTransaction:ydn.db.base.StandardTransactionMode,ydn.db.base.TransactionMode={READ_ONLY:ydn.db.base.IDBTransaction.READ_ONLY,READ_WRITE:ydn.db.base.IDBTransaction.READ_WRITE,VERSION_CHANGE:ydn.db.base.IDBTransaction.VERSION_CHANGE},ydn.db.base.ENABLE_DEFAULT_TEXT_STORE=!1,ydn.db.base.ENABLE_ENCRYPTION=!1,ydn.db.base.Direction={NEXT:"next",NEXT_UNIQUE:"nextunique",PREV:"prev",PREV_UNIQUE:"prevunique"},ydn.db.base.DIRECTIONS=[ydn.db.base.Direction.NEXT,ydn.db.base.Direction.NEXT_UNIQUE,ydn.db.base.Direction.PREV,ydn.db.base.Direction.PREV_UNIQUE],ydn.db.base.getDirection=function(e,t){return e?t?ydn.db.base.Direction.PREV_UNIQUE:ydn.db.base.Direction.PREV:t?ydn.db.base.Direction.NEXT_UNIQUE:ydn.db.base.Direction.NEXT},ydn.db.base.indexedDb=goog.global.indexedDB||goog.global.mozIndexedDB||goog.global.webkitIndexedDB||goog.global.moz_indexedDB||goog.global.msIndexedDB,ydn.db.base.PREFIX_MULTIENTRY="ydn.db.me:",ydn.db.base.QueryMethod={NONE:0,LIST_KEY:1,LIST_PRIMARY_KEY:2,LIST_KEYS:3,LIST_VALUE:4,GET:5,COUNT:6},ydn.db.base.Transaction,goog.provide("ydn.db.utils"),goog.require("ydn.db.base"),ydn.db.utils.getValueByKeys=function(e,t){var o,r;2==arguments.length&&goog.isString(arguments[1])?(o=!0,r=arguments[1].split(".")):(o=goog.isArrayLike(t),r=o?t:arguments);for(var n=o?0:1;n<r.length&&(e=e[r[n]],goog.isDef(e));n++);return e},ydn.db.utils.setValueByKeys=function(e,t,o){if(e){if(-1==t.indexOf("."))return e[t]=o,void 0;for(var r,n=t.split("."),i=n.pop();r=n.shift();)goog.isObject(e[r])||(goog.asserts.assert(!goog.isDef(e[r]),'key "'+r+'" already defined'),e[r]={}),e=e[r];e[i]=o}},ydn.db.utils.ARRAY_TERMINATOR={},ydn.db.utils.BYTE_TERMINATOR=0,ydn.db.utils.TYPE_NUMBER=1,ydn.db.utils.TYPE_DATE=2,ydn.db.utils.TYPE_STRING=3,ydn.db.utils.TYPE_ARRAY=4,ydn.db.utils.MAX_TYPE_BYTE_SIZE=12,ydn.db.utils.encodeKey=function(e){for(var t,o,r=[e],n=new ydn.db.utils.HexStringWriter,i=0;void 0!==(o=r.pop());){if(i%4===0&&i+ydn.db.utils.TYPE_ARRAY>ydn.db.utils.MAX_TYPE_BYTE_SIZE&&(n.write(i),i=0),t=typeof o,o instanceof Array){if(i+=ydn.db.utils.TYPE_ARRAY,o.length>0){r.push(ydn.db.utils.ARRAY_TERMINATOR);for(var s=o.length;s--;)r.push(o[s]);continue}n.write(i)}else if("number"===t)i+=ydn.db.utils.TYPE_NUMBER,n.write(i),ydn.db.utils.encodeNumber(n,o);else if(o instanceof Date)i+=ydn.db.utils.TYPE_DATE,n.write(i),ydn.db.utils.encodeNumber(n,o.valueOf());else if("string"===t)i+=ydn.db.utils.TYPE_STRING,n.write(i),ydn.db.utils.encodeString(n,o);else{if(o!==ydn.db.utils.ARRAY_TERMINATOR)return"";n.write(ydn.db.utils.BYTE_TERMINATOR)}i=0}return n.trim().toString()},ydn.db.utils.decodeKey=function(e){for(var t,o,r,n=[],i=n,s=[],a=new ydn.db.utils.HexStringReader(e);null!=a.read();)if(0!==a.current){if(null===a.current)return n[0];for(;;){o=a.current/4|0,t=a.current%4;for(var g=0;o>g;g++)r=[],i.push(r),s.push(i),i=r;if(!(0===t&&a.current+ydn.db.utils.TYPE_ARRAY>ydn.db.utils.MAX_TYPE_BYTE_SIZE))break;a.read()}t===ydn.db.utils.TYPE_NUMBER?i.push(ydn.db.utils.decodeNumber(a)):t===ydn.db.utils.TYPE_DATE?i.push(new Date(ydn.db.utils.decodeNumber(a))):t===ydn.db.utils.TYPE_STRING?i.push(ydn.db.utils.decodeString(a)):0===t&&(i=s.pop())}else i=s.pop();return n[0]},ydn.db.utils.p16=65536,ydn.db.utils.p32=4294967296,ydn.db.utils.p48=281474976710656,ydn.db.utils.p52=4503599627370496,ydn.db.utils.pNeg1074=5e-324,ydn.db.utils.pNeg1022=2.2250738585072014e-308,ydn.db.utils.ieee754=function(e){var t=0,o=0,r=0;if(0!==e)if(isFinite(e)){0>e&&(t=1,e=-e);var n=0;if(e>=ydn.db.utils.pNeg1022){for(var i=e;1>i;)n--,i*=2;for(;i>=2;)n++,i/=2;o=n+1023}r=o?Math.floor((e/Math.pow(2,n)-1)*ydn.db.utils.p52):Math.floor(e/ydn.db.utils.pNeg1074)}else o=2047,isNaN(e)?r=0x8000000000000:e===-1/0&&(t=1);return{sign:t,exponent:o,mantissa:r}},ydn.db.utils.encodeNumber=function(e,t){var o=ydn.db.utils.ieee754(t);o.sign&&(o.mantissa=ydn.db.utils.p52-1-o.mantissa,o.exponent=2047-o.exponent);var r,n=o.mantissa;e.write((o.sign?0:128)|o.exponent>>4),e.write((15&o.exponent)<<4|(0|n/ydn.db.utils.p48)),n%=ydn.db.utils.p48,r=0|n/ydn.db.utils.p32,e.write(r>>8,255&r),n%=ydn.db.utils.p32,r=0|n/ydn.db.utils.p16,e.write(r>>8,255&r),r=n%ydn.db.utils.p16,e.write(r>>8,255&r)},ydn.db.utils.decodeNumber=function(e){var t=0|e.read(),o=t>>7?!1:!0,r=o?-1:1,n=(127&t)<<4;t=0|e.read(),n+=t>>4,o&&(n=2047-n);for(var i=[o?15-(15&t):15&t],s=6;s--;)i.push(o?255-(0|e.read()):0|e.read());var a=0;for(s=7;s--;)a=a/256+i[s];return a/=16,0===a&&0===n?0:(a+1)*Math.pow(2,n-1023)*r},ydn.db.utils.secondLayer=16510,ydn.db.utils.encodeString=function(e,t){for(var o=0;o<t.length;o++){var r=t.charCodeAt(o);126>=r?e.write(r+1):r<=ydn.db.utils.secondLayer?(r-=127,e.write(128|r>>8,255&r)):e.write(192|r>>10,r>>2|255,(3|r)<<6)}e.write(ydn.db.utils.BYTE_TERMINATOR)},ydn.db.utils.decodeString=function(e){for(var t,o,r=[],n=0,i=0,s=0;;){if(t=e.read(),0===t||null==t)break;0===n?(o=t>>6,2>o&&!isNaN(t)?r.push(String.fromCharCode(t-1)):(n=o,i=t<<10,s++)):2===n?(r.push(String.fromCharCode(i+t+127)),n=i=s=0):2===s?(i+=t<<2,s++):(r.push(String.fromCharCode(i|t>>6)),n=i=s=0)}return r.join("")},ydn.db.utils.HexStringReader=function(e){this.current=null,this.string=e,this.lastIndex=this.string.length-1,this.index=-1},ydn.db.utils.HexStringReader.prototype.current,ydn.db.utils.HexStringReader.prototype.index,ydn.db.utils.HexStringReader.prototype.lastIndex,ydn.db.utils.HexStringReader.prototype.string,ydn.db.utils.HexStringReader.prototype.read=function(){return this.current=this.index<this.lastIndex?parseInt(this.string[++this.index]+this.string[++this.index],16):null},ydn.db.utils.HexStringWriter=function(){this.buffer=[],this.c=void 0},ydn.db.utils.HexStringWriter.prototype.c,ydn.db.utils.HexStringWriter.prototype.buffer,ydn.db.utils.HexStringWriter.prototype.write=function(){for(var e=0;e<arguments.length;e++)this.c=arguments[e].toString(16),this.buffer.push(2===this.c.length?this.c:this.c="0"+this.c)},ydn.db.utils.HexStringWriter.prototype.trim=function(){for(var e=this.buffer.length;"00"===this.buffer[--e];);return this.buffer.length=++e,this},ydn.db.utils.HexStringWriter.prototype.toString=function(){return this.buffer.length?this.buffer.join(""):""},ydn.db.utils.cmp=function(e,t){var o=ydn.db.utils.encodeKey(e),r=ydn.db.utils.encodeKey(t);return o>r?1:o==r?0:-1},goog.provide("ydn.db.Where"),goog.require("goog.string"),goog.require("ydn.db.KeyRange"),goog.require("ydn.db.utils"),goog.require("ydn.debug.error.ArgumentException"),ydn.db.Where=function(e,t,o,r,n){this.key_range_=t instanceof ydn.db.KeyRange?t:goog.isString(t)&&goog.isDef(o)?ydn.db.KeyRange.where(t,o,r,n):ydn.db.KeyRange.parseKeyRange(t),this.field=e},ydn.db.Where.prototype.field="",ydn.db.Where.prototype.key_range_,ydn.db.Where.prototype.getField=function(){return this.field},ydn.db.Where.prototype.getKeyRange=function(){return this.key_range_},ydn.db.Where.resolvedStartsWith=function(e){return goog.isDefAndNotNull(e)&&goog.isDefAndNotNull(e.lower)&&goog.isDefAndNotNull(e.upper)?goog.isArray(e.lower)&&goog.isArray(e.upper)?e.lower.length==e.upper.length-1&&""==e.upper[e.upper.length-1]&&e.lower.every(function(t,o){return t==e.upper[o]}):!e.lowerOpen&&!e.upperOpen&&e.lower.length==e.upper.length+1&&""==e.upper[e.lower.length-1]:!1},ydn.db.Where.prototype.and=function(e){if(this.field!=e.field)return null;var t=goog.isDefAndNotNull(this.key_range_)&&goog.isDefAndNotNull(e.key_range_)?this.key_range_.and(e.key_range_):this.key_range_||e.key_range_;return new ydn.db.Where(this.field,t)},goog.provide("goog.disposable.IDisposable"),goog.disposable.IDisposable=function(){},goog.disposable.IDisposable.prototype.dispose,goog.disposable.IDisposable.prototype.isDisposed,goog.provide("ydn.db.core.req.ICursor"),goog.require("goog.disposable.IDisposable"),ydn.db.core.req.ICursor=function(){},ydn.db.core.req.ICursor.prototype.onError=goog.abstractMethod,ydn.db.core.req.ICursor.prototype.onSuccess=goog.abstractMethod,ydn.db.core.req.ICursor.prototype.openCursor=function(){},ydn.db.core.req.ICursor.prototype.continuePrimaryKey=function(){},ydn.db.core.req.ICursor.prototype.continueEffectiveKey=function(){},ydn.db.core.req.ICursor.prototype.advance=function(){},ydn.db.core.req.ICursor.prototype.restart=function(){},ydn.db.core.req.ICursor.prototype.hasCursor=function(){},ydn.db.core.req.ICursor.prototype.update=function(){},ydn.db.core.req.ICursor.prototype.clear=function(){},ydn.db.core.req.ICursor.prototype.isIndexCursor=function(){},ydn.db.core.req.ICursor.prototype.isPrimaryCursor=function(){},ydn.db.core.req.ICursor.prototype.isValueCursor=function(){},goog.provide("goog.Disposable"),goog.provide("goog.dispose"),goog.require("goog.disposable.IDisposable"),goog.Disposable=function(){goog.Disposable.MONITORING_MODE!=goog.Disposable.MonitoringMode.OFF&&(this.creationStack=(new Error).stack,goog.Disposable.instances_[goog.getUid(this)]=this)},goog.Disposable.MonitoringMode={OFF:0,PERMANENT:1,INTERACTIVE:2},goog.define("goog.Disposable.MONITORING_MODE",0),goog.Disposable.instances_={},goog.Disposable.getUndisposedObjects=function(){var e=[];for(var t in goog.Disposable.instances_)goog.Disposable.instances_.hasOwnProperty(t)&&e.push(goog.Disposable.instances_[Number(t)]);return e},goog.Disposable.clearUndisposedObjects=function(){goog.Disposable.instances_={}},goog.Disposable.prototype.disposed_=!1,goog.Disposable.prototype.onDisposeCallbacks_,goog.Disposable.prototype.creationStack,goog.Disposable.prototype.isDisposed=function(){return this.disposed_},goog.Disposable.prototype.getDisposed=goog.Disposable.prototype.isDisposed,goog.Disposable.prototype.dispose=function(){if(!this.disposed_&&(this.disposed_=!0,this.disposeInternal(),goog.Disposable.MONITORING_MODE!=goog.Disposable.MonitoringMode.OFF)){var e=goog.getUid(this);if(goog.Disposable.MONITORING_MODE==goog.Disposable.MonitoringMode.PERMANENT&&!goog.Disposable.instances_.hasOwnProperty(e))throw Error(this+" did not call the goog.Disposable base constructor or was disposed of after a clearUndisposedObjects call");delete goog.Disposable.instances_[e]}},goog.Disposable.prototype.registerDisposable=function(e){this.addOnDisposeCallback(goog.partial(goog.dispose,e))},goog.Disposable.prototype.addOnDisposeCallback=function(e,t){this.onDisposeCallbacks_||(this.onDisposeCallbacks_=[]),this.onDisposeCallbacks_.push(goog.bind(e,t))},goog.Disposable.prototype.disposeInternal=function(){if(this.onDisposeCallbacks_)for(;this.onDisposeCallbacks_.length;)this.onDisposeCallbacks_.shift()()},goog.Disposable.isDisposed=function(e){return e&&"function"==typeof e.isDisposed?e.isDisposed():!1},goog.dispose=function(e){e&&"function"==typeof e.dispose&&e.dispose()},goog.disposeAll=function(){for(var e=0,t=arguments.length;t>e;++e){var o=arguments[e];goog.isArrayLike(o)?goog.disposeAll.apply(null,o):goog.dispose(o)}},goog.provide("ydn.db.core.req.AbstractCursor"),goog.require("goog.Disposable"),goog.require("ydn.debug.error.InternalError"),ydn.db.core.req.AbstractCursor=function(e,t,o,r){goog.base(this),this.store_schema=o,this.store_name=o.getName(),this.index_name=void 0,this.is_index=!1,this.key_range=null,this.tx=e,this.tx_no=t,this.count_=0,this.done_=!1,this.exited_=!1,this.query_method=r||ydn.db.base.QueryMethod.LIST_VALUE,this.key_=void 0,this.primary_key_=void 0,this.value_=void 0,this.reverse,this.unique,this.onNext=function(){throw new ydn.debug.error.InternalError},this.onFail=function(){throw new ydn.debug.error.InternalError},this.onTerminated=function(){}},goog.inherits(ydn.db.core.req.AbstractCursor,goog.Disposable),ydn.db.core.req.AbstractCursor.prototype.init=function(e,t,o,r,n){goog.asserts.assert(this.store_name==e,"expect store name of "+this.store_name+" but "+e+" found."),goog.isDef(t)&&(this.index_name=this.store_schema.getIndexName(t),goog.asserts.assertString(this.index_name,'index "'+t+'" not found in store "'+e+'"')),this.is_index=goog.isString(this.index_name),this.key_range=o||null,this.count_=0,this.done_=!1,this.exited_=!1,this.reverse=r==ydn.db.base.Direction.PREV||r==ydn.db.base.Direction.PREV_UNIQUE,this.unique=r==ydn.db.base.Direction.NEXT_UNIQUE||r==ydn.db.base.Direction.PREV_UNIQUE,this.dir=r,this.is_key_cursor_=n,this.key_=void 0,this.primary_key_=void 0,this.value_=void 0},ydn.db.core.req.AbstractCursor.prototype.index_name,ydn.db.core.req.AbstractCursor.prototype.is_index,ydn.db.core.req.AbstractCursor.prototype.store_name,ydn.db.core.req.AbstractCursor.prototype.dir="",ydn.db.core.req.AbstractCursor.prototype.key_range=null,ydn.db.core.req.AbstractCursor.prototype.unique=!1,ydn.db.core.req.AbstractCursor.prototype.reverse=!1,ydn.db.core.req.AbstractCursor.prototype.is_key_cursor_=!0,ydn.db.core.req.AbstractCursor.prototype.query_method,ydn.db.core.req.AbstractCursor.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.req.AbstractCursor"),ydn.db.core.req.AbstractCursor.prototype.isActive=function(){return!!this.tx},ydn.db.core.req.AbstractCursor.prototype.isIndexCursor=function(){return this.is_index},ydn.db.core.req.AbstractCursor.prototype.isPrimaryCursor=function(){return!this.is_index},ydn.db.core.req.AbstractCursor.prototype.isValueCursor=function(){return!this.is_key_cursor_},ydn.db.core.req.AbstractCursor.prototype.onError=function(e){this.onFail(e),this.finalize_(),this.done_=!0},ydn.db.core.req.AbstractCursor.prototype.onSuccess=function(e,t,o){if(goog.isDefAndNotNull(e)||(this.logger.finer(this+" finished."),this.done_=!0),this.key_=e,this.primary_key_=t,this.value_=o,this.count_++,this.done_)this.logger.finest(this+" DONE."),this.onNext(),this.finalize_();else{var r=this.is_index?this.key_+", "+this.primary_key_:this.key_;this.logger.finest(this+" new cursor position {"+r+"}"),this.onNext(this.key_)}},ydn.db.core.req.AbstractCursor.prototype.disposeInternal=function(){this.tx=null},goog.DEBUG&&(ydn.db.core.req.AbstractCursor.prototype.toString=function(){var e=goog.isDef(this.index_name)?":"+this.index_name:"",t=this.tx?"":"~";return"Cursor:"+this.store_name+e+"["+t+this.tx_no+"]"}),ydn.db.core.req.AbstractCursor.prototype.finalize_=function(){this.primary_key_=goog.isDefAndNotNull(this.primary_key_)?ydn.db.Key.clone(this.primary_key_):void 0,this.key_=goog.isDefAndNotNull(this.key_)?ydn.db.Key.clone(this.key_):void 0,this.onTerminated(this.exited_,this.key_,this.primary_key_)},ydn.db.core.req.AbstractCursor.prototype.openCursor=goog.abstractMethod,ydn.db.core.req.AbstractCursor.prototype.open=function(e,t,o,r){this.tx=e,this.tx_no=t,this.exited_=!1,this.done_=!1,this.key_=o,this.primary_key_=r,this.openCursor(this.key_,this.primary_key_)},ydn.db.core.req.AbstractCursor.prototype.resume=function(e,t){this.done_?this.open(e,t):this.open(e,t,this.key_,this.primary_key_)},ydn.db.core.req.AbstractCursor.prototype.exit=function(){this.exited_=!0,this.logger.finest(this+": exit"),this.finalize_()},ydn.db.core.req.AbstractCursor.prototype.getCount=function(){return this.count_},ydn.db.core.req.AbstractCursor.prototype.getKey=function(){return this.key_},ydn.db.core.req.AbstractCursor.prototype.getPrimaryKey=function(){return this.isIndexCursor()?this.primary_key_:this.key_},ydn.db.core.req.AbstractCursor.prototype.getValue=function(){return this.isValueCursor()?this.value_:this.getPrimaryKey()},ydn.db.core.req.AbstractCursor.prototype.hasDone=function(){return this.done_},ydn.db.core.req.AbstractCursor.prototype.isExited=function(){return this.exited_},ydn.db.core.req.AbstractCursor.prototype.continuePrimaryKey=function(){},ydn.db.core.req.AbstractCursor.prototype.continueEffectiveKey=function(){},ydn.db.core.req.AbstractCursor.prototype.advance=goog.abstractMethod,ydn.db.core.req.AbstractCursor.prototype.hasCursor=goog.abstractMethod,ydn.db.core.req.AbstractCursor.prototype.update=goog.abstractMethod,ydn.db.core.req.AbstractCursor.prototype.clear=goog.abstractMethod,ydn.db.core.req.AbstractCursor.prototype.restart=function(e,t){this.logger.finest(this+" restarting"),this.done_=!1,this.exited_=!1,this.openCursor(t,e)},goog.provide("ydn.db.core.AbstractIterator"),goog.require("ydn.db.core.req.AbstractCursor"),ydn.db.core.AbstractIterator=function(){},ydn.db.core.AbstractIterator.prototype.load=goog.abstractMethod,ydn.db.core.AbstractIterator.prototype.stores=goog.abstractMethod,goog.provide("ydn.db.IndexIterator"),goog.provide("ydn.db.IndexValueIterator"),goog.provide("ydn.db.Iterator"),goog.provide("ydn.db.Iterator.State"),goog.provide("ydn.db.KeyIterator"),goog.provide("ydn.db.ValueIterator"),goog.require("goog.debug.Logger"),goog.require("goog.functions"),goog.require("ydn.db.KeyRange"),goog.require("ydn.db.Where"),goog.require("ydn.db.base"),goog.require("ydn.db.core.req.ICursor"),goog.require("ydn.db.core.AbstractIterator"),goog.require("ydn.debug.error.ArgumentException"),ydn.db.Iterator=function(e,t,o,r,n,i,s){if(goog.DEBUG&&!goog.isString(e))throw new TypeError("store name must be a string, but "+e+" found.");if(this.store_name_=e,this.index_name_=t,this.index_key_path_=s,this.is_index_iterator_=!!this.index_name_,goog.DEBUG){if(goog.isDef(r)&&!goog.isBoolean(r))throw new ydn.debug.error.ArgumentException("reverse value must be a boolean, but "+typeof r+" found");if(goog.isDef(n)&&!goog.isBoolean(n))throw new ydn.debug.error.ArgumentException("unique value must be a boolean, but "+typeof n+" found");if(goog.isDef(i)&&!goog.isBoolean(i))throw new ydn.debug.error.ArgumentException("key_only value must be a boolean, but "+typeof i+" found")}this.is_key_iterator_=goog.isDef(i)?i:!!goog.isString(this.index_name_);var a=ydn.db.base.Direction.NEXT;if(r&&n?a=ydn.db.base.Direction.PREV_UNIQUE:r?a=ydn.db.base.Direction.PREV:n&&(a=ydn.db.base.Direction.NEXT_UNIQUE),this.direction_=a,goog.DEBUG){var g=ydn.db.KeyRange.validate(o);if(g)throw new ydn.debug.error.ArgumentException("Invalid key range: "+g)}this.key_range_=ydn.db.KeyRange.parseIDBKeyRange(o),this.state_=ydn.db.Iterator.State.INITIAL,this.i_key_,this.i_primary_key_},goog.inherits(ydn.db.Iterator,ydn.db.core.AbstractIterator),ydn.db.Iterator.DEBUG=!1,ydn.db.Iterator.prototype.store_name_,ydn.db.Iterator.prototype.index_name_,ydn.db.Iterator.prototype.index_key_path_,ydn.db.Iterator.prototype.is_index_iterator_,ydn.db.Iterator.prototype.key_range_,ydn.db.Iterator.prototype.is_key_iterator_=!0,ydn.db.Iterator.prototype.direction_,ydn.db.KeyIterator=function(e,t,o){if(arguments.length>3)throw new ydn.debug.error.ArgumentException("too many argument");goog.base(this,e,void 0,t,o,void 0,!0)},goog.inherits(ydn.db.KeyIterator,ydn.db.Iterator),ydn.db.KeyIterator.where=function(e,t,o,r,n){return new ydn.db.KeyIterator(e,ydn.db.KeyRange.where(t,o,r,n))},ydn.db.IndexIterator=function(e,t,o,r,n){if(!goog.isString(t))throw new ydn.debug.error.ArgumentException("index name must be string");goog.base(this,e,t,o,r,n,!0)},goog.inherits(ydn.db.IndexIterator,ydn.db.Iterator),ydn.db.IndexIterator.where=function(e,t,o,r,n,i){return new ydn.db.IndexIterator(e,t,ydn.db.KeyRange.where(o,r,n,i))},ydn.db.ValueIterator=function(e,t,o){if(arguments.length>3)throw new ydn.debug.error.ArgumentException("too many argument");goog.base(this,e,void 0,t,o,void 0,!1)},goog.inherits(ydn.db.ValueIterator,ydn.db.Iterator),ydn.db.ValueIterator.where=function(e,t,o,r,n){return new ydn.db.ValueIterator(e,ydn.db.KeyRange.where(t,o,r,n))},ydn.db.IndexValueIterator=function(e,t,o,r,n){if(!goog.isString(t))throw new ydn.debug.error.ArgumentException("index name must be string");goog.base(this,e,t,o,r,n,!1)},goog.inherits(ydn.db.IndexValueIterator,ydn.db.Iterator),ydn.db.IndexValueIterator.where=function(e,t,o,r,n,i){return new ydn.db.IndexValueIterator(e,t,ydn.db.KeyRange.where(o,r,n,i))},ydn.db.Iterator.State={INITIAL:"init",WORKING:"busy",RESTING:"rest",COMPLETED:"done"},ydn.db.Iterator.prototype.logger=goog.debug.Logger.getLogger("ydn.db.Iterator"),ydn.db.Iterator.prototype.getStoreName=function(){return this.store_name_},ydn.db.Iterator.prototype.getIndexName=function(){return this.index_name_},ydn.db.Iterator.prototype.getDirection=function(){return this.direction_},ydn.db.Iterator.prototype.keyRange=function(){return this.key_range_},ydn.db.Iterator.prototype.hasKeyRange=function(){return!!this.key_range_},ydn.db.Iterator.prototype.getLower=function(){return this.key_range_?void 0:this.key_range_.lower},ydn.db.Iterator.prototype.getLowerOpen=function(){return this.key_range_?void 0:this.key_range_.lowerOpen},ydn.db.Iterator.prototype.getUpper=function(){return this.key_range_?void 0:this.key_range_.upper},ydn.db.Iterator.prototype.getUpperOpen=function(){return this.key_range_?void 0:this.key_range_.upperOpen},ydn.db.Iterator.prototype.getKeyRange=function(){return this.key_range_?this.key_range_ instanceof ydn.db.IDBKeyRange?this.key_range_:ydn.db.IDBKeyRange.bound(this.key_range_.lower,this.key_range_.upper,this.key_range_.lowerOpen,this.key_range_.upperOpen):null},ydn.db.Iterator.prototype.isKeyIterator=function(){return this.is_key_iterator_},ydn.db.Iterator.prototype.isIndexIterator=function(){return this.is_index_iterator_},ydn.db.Iterator.prototype.isPrimaryIterator=function(){return!this.is_index_iterator_},ydn.db.Iterator.prototype.clone=function(){return new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,this.isReversed(),this.isUnique(),this.isKeyIterator(),this.index_key_path_)},ydn.db.Iterator.prototype.unique=function(e){return new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,this.isReversed(),e,this.isKeyIterator(),this.index_key_path_)
},ydn.db.Iterator.prototype.copy=function(){return new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,this.isReversed(),this.isUnique(),this.isKeyIterator(),this.index_key_path_)},goog.DEBUG&&(ydn.db.Iterator.prototype.toJSON=function(){return{store:this.store_name_,index:this.index_name_,keyRange:this.key_range_?ydn.db.KeyRange.toJSON(this.key_range_):null,direction:this.direction_}},ydn.db.Iterator.prototype.toString=function(){var e=goog.isDef(this.index_key_path_)?":"+this.index_key_path_.join(","):goog.isDef(this.index_name_)?":"+this.index_name_:"";e+=ydn.db.KeyRange.toString(this.key_range_),this.state_!=ydn.db.Iterator.State.INITIAL&&(e+=this.state_+"{"+this.i_key_,this.isIndexIterator()&&(e+=", "+this.i_primary_key_),e+="}");var t=this.isIndexIterator()?"Index":"";return t+=this.isKeyIterator()?"Key":"Value",t+"Iterator:"+this.store_name_+e}),ydn.db.Iterator.prototype.resume=function(){new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,this.isReversed(),this.isUnique(),this.is_key_iterator_,this.index_key_path_);throw new Error("not possible")},ydn.db.Iterator.prototype.reverse=function(){var e=new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,!this.isReversed(),this.isUnique(),this.is_key_iterator_,this.index_key_path_);return e},ydn.db.Iterator.prototype.isReversed=function(){return this.direction_===ydn.db.base.Direction.PREV||this.direction_===ydn.db.base.Direction.PREV_UNIQUE},ydn.db.Iterator.prototype.isUnique=function(){return this.direction_===ydn.db.base.Direction.NEXT_UNIQUE||this.direction_===ydn.db.base.Direction.PREV_UNIQUE},ydn.db.Iterator.prototype.getNextKeyRange=function(){return this.state_!=ydn.db.Iterator.State.COMPLETED&&this.state_!=ydn.db.Iterator.State.INITIAL&&goog.isDefAndNotNull(this.i_key_)?this.key_range_:this.key_range_},ydn.db.Iterator.prototype.getState=function(){return this.state_},ydn.db.Iterator.prototype.load=function(e){var t=e[0];t.init(this.store_name_,this.index_key_path_||this.index_name_,this.key_range_,this.direction_,this.is_key_iterator_),this.state_=ydn.db.Iterator.State.WORKING;var o=this;return t.onTerminated=function(e,t,r){o.i_key_=t,o.i_primary_key_=r,o.state_=e?ydn.db.Iterator.State.RESTING:ydn.db.Iterator.State.COMPLETED},t.openCursor(this.i_key_,this.i_primary_key_),t},ydn.db.Iterator.prototype.isFreshState=function(){return this.state_==ydn.db.Iterator.State.INITIAL||this.state_==ydn.db.Iterator.State.COMPLETED},ydn.db.Iterator.prototype.getKey=function(){return this.i_key_},ydn.db.Iterator.prototype.getPrimaryKey=function(){return this.i_primary_key_},ydn.db.Iterator.prototype.reset=function(e,t,o){var r=e||ydn.db.Iterator.State.INITIAL;this.getState()==ydn.db.Iterator.State.WORKING?this.logger.warning(this+": resetting state to "+r+" ignore during iteration"):(this.i_key_=t,this.i_primary_key_=o,this.state_=r)},ydn.db.Iterator.prototype.stores=function(){return[this.store_name_]},goog.provide("ydn.db"),goog.require("ydn.db.utils"),ydn.db.version="0",ydn.db.cmp=ydn.db.base.indexedDb&&ydn.db.base.indexedDb.cmp?goog.bind(ydn.db.base.indexedDb.cmp,ydn.db.base.indexedDb):ydn.db.utils.cmp,ydn.db.databaseDeletors=[],ydn.db.deleteDatabase=function(e,t){for(var o,r=0;r<ydn.db.databaseDeletors.length;r++){var n=ydn.db.databaseDeletors[r](e,t);n&&(o=n)}return o||ydn.db.Request.succeed(ydn.db.Request.Method.VERSION_CHANGE,null)},goog.provide("ydn.db.con.ICursorStream"),ydn.db.con.ICursorStream=function(){},ydn.db.con.ICursorStream.prototype.seek=goog.abstractMethod,ydn.db.con.ICursorStream.prototype.onFinish=goog.abstractMethod,goog.provide("ydn.db.con.IStorage"),goog.require("goog.async.Deferred"),ydn.db.con.IStorage=function(){},ydn.db.con.IStorage.prototype.close=goog.abstractMethod,ydn.db.con.IStorage.prototype.transaction=goog.abstractMethod,goog.provide("ydn.db.con.IdbCursorStream"),goog.require("goog.debug.Logger"),goog.require("ydn.db.con.ICursorStream"),goog.require("ydn.db.con.IStorage"),ydn.db.con.IdbCursorStream=function(e,t,o,r){if("transaction"in e)this.db_=e,this.idb_=null,this.tx_=null;else{if(!("objectStore"in e))throw new ydn.error.ArgumentException("storage instance require.");var n=e;if(this.db_=null,this.idb_=n.db,this.tx_=n,goog.DEBUG&&!this.tx_.db.objectStoreNames.contains(t))throw new ydn.error.ArgumentException('store "'+t+'" not in transaction.')}this.store_name_=t,this.index_name_=o,this.sink_=r,this.cursor_=null,this.stack_=[],this.running_=0,this.on_tx_request_=!1},ydn.db.con.IdbCursorStream.prototype.logger=goog.debug.Logger.getLogger("ydn.db.con.IdbCursorStream"),ydn.db.con.IdbCursorStream.prototype.db_,ydn.db.con.IdbCursorStream.prototype.tx_,ydn.db.con.IdbCursorStream.prototype.idb_,ydn.db.con.IdbCursorStream.prototype.on_tx_request_=!1,ydn.db.con.IdbCursorStream.prototype.store_name_,ydn.db.con.IdbCursorStream.prototype.index_name_,ydn.db.con.IdbCursorStream.prototype.stack_=[],ydn.db.con.IdbCursorStream.prototype.sink_,ydn.db.con.IdbCursorStream.prototype.isIndex=function(){return goog.isDefAndNotNull(this.index_name_)},ydn.db.con.IdbCursorStream.prototype.processRequest_=function(e){this.running_++;var t=this;e.onsuccess=function(e){var o=e.target.result;if(o){if(goog.isFunction(t.sink_)){var r=o.value,n=t.isIndex()?r[t.index_name_]:r;t.sink_(o.primaryKey,n)}else t.logger.warning("sink gone, dropping value for: "+o.primaryKey);o&&t.stack_.length>0?o["continue"](t.stack_.shift()):(t.running_--,t.clearStack_())}},e.onerror=function(){var o="error"in e?e.error.name+":"+e.error.message:"";t.logger.warning("seeking fail. "+o),t.running_--,t.clearStack_()}},ydn.db.con.IdbCursorStream.prototype.onFinish=function(e){0==this.stack_.length&&0==this.running_?e():this.collector_=e},ydn.db.con.IdbCursorStream.prototype.createRequest_=function(){if(!this.on_tx_request_){var e=this,t=function(t,o){e.tx_=null,t!==ydn.db.base.TxEventTypes.COMPLETE&&e.logger.warning(o.name+":"+o.message),e.logger.finest(e+" transaction "+t)},o=function(t){var o=e.stack_.shift();e.logger.finest(e+" transaction started for "+o);var r=t.objectStore(e.store_name_);e.processRequest_(r.openCursor(o))};if(this.tx_)e.logger.finest(e+" using existing tx."),o(this.tx_);else if(this.idb_)e.logger.finest(e+" creating tx from IDBDatabase."),this.tx=this.idb_.transaction([this.store_name_],ydn.db.base.TransactionMode.READ_ONLY),this.tx.oncomplete=function(e){t(ydn.db.base.TxEventTypes.COMPLETE,e)},this.tx.onerror=function(e){t(ydn.db.base.TxEventTypes.ERROR,e)},this.tx.onabort=function(e){t(ydn.db.base.TxEventTypes.ABORT,e)};else{if(!this.db_){var r=goog.DEBUG?"no way to create a transaction provided.":"";throw new ydn.error.InternalError(r)}e.logger.finest(e+" creating tx from ydn.db.con.IStorage."),this.on_tx_request_=!0,this.db_.transaction(function(t){e.on_tx_request_=!1,o(t)},[e.store_name_],ydn.db.base.TransactionMode.READ_ONLY,t)}}},ydn.db.con.IdbCursorStream.prototype.clearStack_=function(){this.cursor_&&this.stack_.length>0?this.cursor_["continue"](this.stack_.shift()):0==this.running_&&this.collector_&&this.collector_()},ydn.db.con.IdbCursorStream.prototype.seek=function(e){this.stack_.push(e),this.createRequest_()},goog.provide("ydn.db.Streamer"),goog.require("ydn.db.con.IdbCursorStream"),goog.require("ydn.db.con.IStorage"),goog.require("ydn.db.Iterator"),goog.require("ydn.debug.error.ArgumentException"),ydn.db.Streamer=function(e,t,o){if(e&&e instanceof ydn.db.con.Storage)this.db_=e,this.cursor_=null;else{if(!e||!e.db)throw new ydn.debug.error.ArgumentException("ydn.db.Streamer: First argument requires storage or transaction instance required.");var r=e;this.db_=null,this.setTx(r)}if(!goog.isString(t))throw new ydn.debug.error.ArgumentException("a store name required.");if(this.store_name_=t,goog.isDef(o)&&!goog.isString(o))throw new ydn.debug.error.ArgumentException("index name must be a string.");this.index_name_=o,this.cursor_=null,this.stack_value_=[],this.stack_key_=[],this.is_collecting_=!1},ydn.db.Streamer.prototype.logger=goog.debug.Logger.getLogger("ydn.db.Streamer"),ydn.db.Streamer.prototype.db_=null,ydn.db.Streamer.prototype.key_only_=!0,ydn.db.Streamer.prototype.storage_=null,ydn.db.Streamer.prototype.store_name_,ydn.db.Streamer.prototype.index_name_,ydn.db.Streamer.prototype.sink_=null,ydn.db.Streamer.prototype.stack_key_=[],ydn.db.Streamer.prototype.stack_value_=[],ydn.db.Streamer.prototype.getFieldName=function(){return this.index_name_},ydn.db.Streamer.prototype.cursor_=null,ydn.db.Streamer.prototype.isKeyIterator=function(){return this.key_only_},ydn.db.Streamer.prototype.setSink=function(e){this.sink_=e},ydn.db.Streamer.prototype.setTx=function(e){if(!e.db)throw new ydn.debug.error.ArgumentException("Invalid IndexedDB Transaction.");var t=e;this.cursor_=new ydn.db.con.IdbCursorStream(t,this.store_name_,this.index_name_,goog.bind(this.collector_,this))},ydn.db.Streamer.prototype.push_=function(){var e=this.stack_value_.length>0;if(e&&!this.is_collecting_&&goog.isFunction(this.sink_)){var t=this,o=function(){t.push_()},r=this.stack_key_.shift(),n=this.stack_value_.shift();e=this.stack_value_.length>0;var i=this.sink_(r,n,e?o:null);e&&!i&&this.push_()}},ydn.db.Streamer.prototype.is_collecting_=!1,ydn.db.Streamer.prototype.collect=function(e){if(this.cursor_){this.is_collecting_=!0;var t=this;this.cursor_.onFinish(function(){e(t.stack_key_,t.stack_value_),t.stack_key_=[],t.stack_value_=[],t.is_collecting_=!1})}else e(this.stack_key_,this.stack_value_),this.stack_key_=[],this.stack_value_=[]},ydn.db.Streamer.prototype.collector_=function(e,t){this.stack_key_.push(e),this.stack_value_.push(t),this.push_()},ydn.db.Streamer.prototype.push=function(e,t){if(this.is_collecting_){var o=goog.DEBUG?"push not allowed after a collection is started":"";throw new ydn.error.InvalidOperationError(o)}if(arguments.length>=2)this.collector_(e,t);else{if(!this.cursor_){if(!this.db_){var r=goog.DEBUG?"Database is not setup.":"";throw new ydn.error.InvalidOperationError(r)}var n=this.db_.getType();if(!n){var i=goog.DEBUG?"Database is not connected.":"";throw new ydn.error.InvalidOperationError(i)}if(n!==ydn.db.base.Mechanisms.IDB)throw new ydn.error.NotImplementedException(n);this.cursor_=new ydn.db.con.IdbCursorStream(this.db_,this.store_name_,this.index_name_,goog.bind(this.collector_,this))}this.cursor_.seek(e)}},ydn.db.Streamer.prototype.pull=function(e,t){goog.isDef(this.foreign_key_index_name_)?this.key_only_?this.push(t):goog.isDefAndNotNull(t)?this.push(t[this.foreign_key_index_name_]):this.push(void 0,void 0):this.push(e)},ydn.db.Streamer.prototype.foreign_key_store_name_,ydn.db.Streamer.prototype.foreign_key_index_name_,ydn.db.Streamer.prototype.setRelation=function(e,t){this.foreign_key_store_name_=e,this.foreign_key_index_name_=t},ydn.db.Streamer.prototype.getRelation=function(){return[this.foreign_key_store_name_,this.foreign_key_index_name_]},ydn.db.Streamer.prototype.getStoreName=function(){return this.store_name_},ydn.db.Streamer.prototype.getIndexName=function(){return this.index_name_},goog.DEBUG&&(ydn.db.Streamer.prototype.toString=function(){return"Streamer:"+this.store_name_+(this.index_name_||"")}),goog.provide("ydn.db.algo.AbstractSolver"),goog.require("goog.debug.Logger"),goog.require("ydn.db"),goog.require("ydn.db.Streamer"),ydn.db.algo.AbstractSolver=function(e,t){if(goog.DEBUG&&goog.isDefAndNotNull(e)&&!("push"in e))throw new ydn.error.ArgumentException('output receiver object must have "push" method.');this.out=e||null,this.limit=t,this.match_count=0,this.is_reverse=!1},ydn.db.algo.AbstractSolver.prototype.getIterators=function(){return null},ydn.db.algo.AbstractSolver.prototype.logger=goog.debug.Logger.getLogger("ydn.db.algo.AbstractSolver"),ydn.db.algo.AbstractSolver.prototype.begin=function(e){if(this.is_reverse=e[0].isReversed(),goog.DEBUG)for(var t=0;t<e.length;t++){if(!(e[t]instanceof ydn.db.Iterator))throw new ydn.debug.error.TypeError("item at iterators "+t+" is not an iterator.");if(t>0&&this.is_reverse!=e[t].isReversed()){var o=this.is_reverse?"be reverse":"not be reverse";throw new ydn.debug.error.TypeError("iterator at "+t+" must "+o)}}for(var r="{",t=0;t<e.length;t++)t>0&&(r+=", "),r+=e.toString();return r+="}",this.is_reverse&&(r+=" reverse"),this.logger.fine(this+" begin "+r),!1},ydn.db.algo.AbstractSolver.prototype.pusher=function(e,t,o,r){var n=goog.isDefAndNotNull(r);if(!goog.isDef(r)){r=o[0],n=goog.isDefAndNotNull(r);for(var i=1;n&&i<o.length;i++)goog.isDefAndNotNull(o[i])&&0==ydn.db.cmp(o[i],r)||(n=!1)}return n&&(this.match_count++,this.out&&this.out.push(r),goog.isDef(this.limit)&&this.match_count>=this.limit)?[]:e},ydn.db.algo.AbstractSolver.prototype.solver=function(){return[]},ydn.db.algo.AbstractSolver.prototype.finish=function(){return!1},goog.provide("ydn.db.ConstraintError"),goog.provide("ydn.db.InternalError"),goog.provide("ydn.db.InvalidKeyException"),goog.provide("ydn.db.InvalidStateError"),goog.provide("ydn.db.NotFoundError"),goog.provide("ydn.db.ScopeError"),goog.provide("ydn.db.SecurityError"),goog.provide("ydn.db.TimeoutError"),goog.provide("ydn.db.VersionError"),ydn.db.ConstraintError=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.ConstraintError):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="ConstraintError"},goog.inherits(ydn.db.ConstraintError,Error),ydn.db.ConstraintError.prototype.name="ConstraintError",goog.DEBUG&&(ydn.db.ConstraintError.prototype.toString=function(){return this.name+": "+this.message}),ydn.db.InvalidKeyException=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.InvalidKeyException):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="ydn.db.InvalidKeyException"},goog.inherits(ydn.db.InvalidKeyException,Error),goog.DEBUG&&(ydn.db.InvalidKeyException.prototype.toString=function(){return this.name+": "+this.message}),ydn.db.VersionError=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.VersionError):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="ydn.db.VersionError"},goog.inherits(ydn.db.VersionError,Error),ydn.db.VersionError.prototype.name="ydn.db.VersionError",goog.DEBUG&&(ydn.db.VersionError.prototype.toString=function(){return this.name+": "+this.message}),ydn.db.InternalError=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.InternalError):this.stack=(new Error).stack||"",e&&(this.message=String(e))},goog.inherits(ydn.db.InternalError,Error),ydn.db.InternalError.prototype.name="ydn.db.InternalError",ydn.db.ScopeError=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.ScopeError):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="ydn.db.ScopeError"},goog.inherits(ydn.db.ScopeError,Error),ydn.db.InvalidStateError=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.InvalidStateError):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="InvalidStateError"},goog.inherits(ydn.db.InvalidStateError,Error),ydn.db.InvalidAccessError=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.InvalidAccessError):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="InvalidAccessError"},goog.inherits(ydn.db.InvalidAccessError,Error),ydn.db.NotFoundError=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.NotFoundError):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="NotFoundError"},goog.inherits(ydn.db.NotFoundError,Error),ydn.db.NotFoundError.prototype.name="NotFoundError",goog.DEBUG&&(ydn.db.NotFoundError.prototype.toString=function(){return this.name+": "+this.message}),ydn.db.DataCloneError=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.DataCloneError):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="DataCloneError"},goog.inherits(ydn.db.DataCloneError,Error),goog.DEBUG&&(ydn.db.DataCloneError.prototype.toString=function(){return this.name+": "+this.message}),ydn.db.SQLError=function(e,t){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.SQLError):this.stack=(new Error).stack||"",t&&(this.message=String(t)),this.message+=" :"+e.message+" ["+e.code+"]",this.name="SQLError"},goog.inherits(ydn.db.SQLError,Error),goog.DEBUG&&(ydn.db.SQLError.prototype.toString=function(){return this.name+": "+this.message}),ydn.db.SecurityError=function(e,t){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.SecurityError):this.stack=(new Error).stack||"",t&&(this.message=String(t)),this.message+=" :"+e.message,this.name="SecurityError"},goog.inherits(ydn.db.SecurityError,Error),goog.DEBUG&&(ydn.db.SecurityError.prototype.toString=function(){return this.name+": "+this.message}),ydn.db.SqlParseError=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.SqlParseError):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="ydn.db.SqlParseError"},goog.inherits(ydn.db.SqlParseError,Error),ydn.db.TimeoutError=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.TimeoutError):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="ydn.db.TimeoutError"},goog.inherits(ydn.db.TimeoutError,Error),ydn.db.TxError=function(e,t){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.TxError):this.stack=(new Error).stack||"",t&&(this.message=String(t)),this.name="TxError",this.result=e},goog.inherits(ydn.db.TxError,Error),ydn.db.TxError.prototype.result,ydn.db.TxError.prototype.getResult=function(){return this.result},ydn.db.TxAbortedError=function(e,t){goog.base(this,e,t),this.name="TxAbortedError"},goog.inherits(ydn.db.TxAbortedError,ydn.db.TxError),goog.provide("ydn.db.Key"),ydn.db.Key=function(e,t,o){var r;if(goog.isObject(e))r=e.store,t=e.id,goog.isDefAndNotNull(e.parent)&&(o=new ydn.db.Key(e.parent));else if(goog.asserts.assertString(e,"store name of a key object must be a string"),goog.isDef(t))r=e;else{var n=e.lastIndexOf(ydn.db.Key.SEP_PARENT),i=e;n>0&&(i=e.substr(n),o=new ydn.db.Key(e.substring(0,n)));var s=i.split(ydn.db.Key.SEP_STORE);if(r=s[0],t=s[1],!goog.isDef(t))throw Error("Invalid key value: "+e)}this.store_name=r,this.id=t,this.parent=o||null};var IDBKey;ydn.db.Key.Json,ydn.db.Key.prototype.id,ydn.db.Key.prototype.store_name,ydn.db.Key.prototype.parent,ydn.db.Key.prototype.toJSON=function(){var e={store:this.store_name,id:this.id};return this.parent&&(e.parent=this.parent.toJSON()),e},ydn.db.Key.SEP_PARENT="^|",ydn.db.Key.SEP_STORE="^:",ydn.db.Key.prototype.valueOf=function(){var e=this.parent?this.parent.valueOf()+ydn.db.Key.SEP_PARENT:"";return e+this.store_name+ydn.db.Key.SEP_STORE+this.id},ydn.db.Key.prototype.toString=function(){return this.valueOf().replace("^|","|").replace("^:",":")},ydn.db.Key.prototype.getStoreName=function(){return this.store_name},ydn.db.Key.prototype.getId=function(){return this.id},ydn.db.Key.prototype.getNormalizedId=function(){return goog.isArray(this.id)?this.id.join(ydn.db.Key.SEP_PARENT):this.id instanceof Date?+this.id:this.id},ydn.db.Key.prototype.getParent=function(){return this.parent},ydn.db.Key.isValidKey=function(e){return goog.isNumber(e)||goog.isString(e)||goog.isArray(e)&&goog.array.every(e,ydn.db.Key.isValidKey)||e instanceof Date},ydn.db.Key.clone=function(e){if(goog.isArrayLike(e)){for(var t=[],o=0,r=e.length;r>o;o++)t[o]=e[o];return t}return e},goog.provide("ydn.db.crud.req.RequestExecutor"),goog.require("goog.async.Deferred"),goog.require("goog.debug.Logger"),goog.require("ydn.db.InternalError"),goog.require("ydn.db.Key"),ydn.db.crud.req.RequestExecutor=function(e,t){this.dbname=e,this.schema=t},ydn.db.crud.req.RequestExecutor.prototype.logger=goog.debug.Logger.getLogger("ydn.db.crud.req.RequestExecuto"),goog.DEBUG&&(ydn.db.crud.req.RequestExecutor.prototype.toString=function(){return"RequestExecutor"}),goog.provide("ydn.db.crud.IOperator"),goog.require("ydn.db.KeyRange"),goog.require("ydn.db.crud.req.RequestExecutor"),ydn.db.crud.IOperator=function(){},ydn.db.crud.IOperator.prototype.count=goog.abstractMethod,ydn.db.crud.IOperator.prototype.get=goog.abstractMethod,ydn.db.crud.IOperator.prototype.values=goog.abstractMethod,ydn.db.crud.IOperator.prototype.keys=goog.abstractMethod,ydn.db.crud.IOperator.prototype.add=goog.abstractMethod,ydn.db.crud.IOperator.prototype.load=goog.abstractMethod,ydn.db.crud.IOperator.prototype.put=goog.abstractMethod,ydn.db.crud.IOperator.prototype.clear=goog.abstractMethod,ydn.db.crud.IOperator.prototype.remove=goog.abstractMethod,goog.provide("ydn.db.core.IOperator"),goog.require("ydn.db.crud.IOperator"),ydn.db.core.IOperator=function(){},ydn.db.core.IOperator.prototype.map=goog.abstractMethod,ydn.db.core.IOperator.prototype.reduce=goog.abstractMethod,goog.provide("ydn.db.crud.req.IRequestExecutor"),goog.provide("ydn.db.crud.req.ListType"),ydn.db.crud.req.IRequestExecutor=function(){},ydn.db.crud.req.IRequestExecutor.prototype.removeById=goog.abstractMethod,ydn.db.crud.req.IRequestExecutor.prototype.removeByKeys=goog.abstractMethod,ydn.db.crud.req.IRequestExecutor.prototype.removeByKeyRange=goog.abstractMethod,ydn.db.crud.req.IRequestExecutor.prototype.removeByIndexKeyRange=goog.abstractMethod,ydn.db.crud.req.IRequestExecutor.prototype.clearByKeyRange=goog.abstractMethod,ydn.db.crud.req.IRequestExecutor.prototype.clearByStores=goog.abstractMethod,ydn.db.crud.req.IRequestExecutor.prototype.countStores=goog.abstractMethod,ydn.db.crud.req.IRequestExecutor.prototype.countKeyRange=goog.abstractMethod,ydn.db.crud.req.IRequestExecutor.prototype.getById=goog.abstractMethod,ydn.db.crud.req.IRequestExecutor.prototype.listByIds=goog.abstractMethod,ydn.db.crud.req.IRequestExecutor.prototype.listByKeys=goog.abstractMethod,ydn.db.crud.req.IRequestExecutor.prototype.putData=goog.abstractMethod,ydn.db.crud.req.IRequestExecutor.prototype.insertObjects=goog.abstractMethod,ydn.db.crud.req.IRequestExecutor.prototype.putByKeys=goog.abstractMethod,ydn.db.crud.req.IRequestExecutor.prototype.list=goog.abstractMethod,goog.provide("ydn.db.core.req.IRequestExecutor"),goog.require("ydn.db.Streamer"),goog.require("ydn.db.core.req.AbstractCursor"),goog.require("ydn.db.crud.req.IRequestExecutor"),ydn.db.core.req.IRequestExecutor=function(){},ydn.db.core.req.IRequestExecutor.prototype.getCursor=goog.abstractMethod,ydn.db.core.req.IRequestExecutor.prototype.getStreamer=goog.abstractMethod,goog.provide("ydn.db.Request"),goog.provide("ydn.db.Request.Method"),goog.require("ydn.async.Deferred"),goog.require("goog.debug.Logger"),goog.require("ydn.db.base.Transaction"),ydn.db.Request=function(e,t,o){goog.base(this,t,o),this.method_=e,this.progbacks_=[],this.txbacks_=[],this.transformers_=[],this.tx_=null,this.tx_label_="",this.copy_count_=0},goog.inherits(ydn.db.Request,ydn.async.Deferred),ydn.db.Request.DEBUG=!1,ydn.db.Request.prototype.method_,ydn.db.Request.prototype.tx_,ydn.db.Request.prototype.tx_label_="",ydn.db.Request.prototype.logger=goog.debug.Logger.getLogger("ydn.db.Request"),ydn.db.Request.prototype.setTx=function(e,t){if(goog.asserts.assert(!this.tx_,"TX already set."),this.tx_=e,this.tx_label_=t,this.logger.finer(this+" BEGIN"),e){for(var o=0;o<this.txbacks_.length;o++){var r=this.txbacks_[o][0],n=this.txbacks_[o][1];r.call(n,e)}this.txbacks_.length=0}this.logger.finer(this+" END")},ydn.db.Request.prototype.copy=function(){var e=new ydn.db.Request(this.method_);return this.copy_count_++,e.setTx(this.tx_,this.tx_label_+"C"+this.copy_count_),e},ydn.db.Request.prototype.removeTx=function(){this.tx_=null},ydn.db.Request.prototype.getTx=function(){return this.tx_},ydn.db.Request.prototype.getMethod=function(){return this.method_},ydn.db.Request.prototype.canAbort=function(){return!!this.tx_},ydn.db.Request.prototype.abort=function(){if(!this.tx_){var e=goog.DEBUG?"No active transaction":"";throw new ydn.db.InvalidStateError(e)}if(this.logger.finer(this+" aborting"),goog.isFunction(this.tx_.abort))this.tx_.abort();else{if(!goog.isFunction(this.tx_.executeSql))throw new ydn.debug.error.NotSupportedException;var t=function(){},o=function(){return!0};this.tx_.executeSql("ABORT",[],t,o)}},ydn.db.Request.prototype.setDbValue=function(e,t){var o=this.transformers_.shift(),r=!!t;if(o){var n=this,i=o[0],s=o[1];i.call(s,e,r,function(e,t){n.setDbValue(e,t)})}else ydn.db.Request.DEBUG&&window.console.log(this+" receiving "+(r?"fail":"value"),e),r?this.errback(e):this.callback(e)},ydn.db.Request.prototype.await=function(e,t){goog.asserts.assert(!this.hasFired(),"transformer cannot be added after resolved."),this.transformers_.push([e,t])},ydn.db.Request.prototype.addTxback=function(e,t){return this.tx_?e.call(t,this.tx_):this.txbacks_.push([e,t]),this},ydn.db.Request.prototype.callback=function(e){this.logger.finer(this+" SUCCESS"),goog.base(this,"callback",e),this.dispose_()},ydn.db.Request.prototype.errback=function(e){this.logger.finer(this+" ERROR"),goog.base(this,"errback",e),this.dispose_()},ydn.db.Request.prototype.state=function(){return this.hasFired()?this.hadError_?"rejected":"resolved":"pending"},ydn.db.Request.prototype.dispose_=function(){this.tx_=null,this.tx_label_=this.tx_label_},ydn.db.Request.prototype.getLabel=function(){var e="";return this.tx_label_&&(e=this.tx_?"*":"",e="["+this.tx_label_+e+"]"),this.method_+e},ydn.db.Request.succeed=function(e,t){var o=new ydn.db.Request(e);return o.setDbValue(t),o},ydn.db.Request.prototype.promise=function(){return this},ydn.db.Request.prototype.toString=function(){return"Request:"+this.getLabel()},ydn.db.Request.prototype.fire_=function(){this.unhandledExceptionTimeoutId_&&this.hasFired()&&this.hasErrback_()&&(goog.global.clearTimeout(this.unhandledExceptionTimeoutId_),delete this.unhandledExceptionTimeoutId_),this.parent_&&(this.parent_.branches_--,delete this.parent_);for(var e=this.result_,t=!1,o=!1;this.sequence_.length&&!this.blocked_;){var r=this.sequence_.shift(),n=r[0],i=r[1],s=r[2],a=this.hadError_?i:n;if(a){var g=a.call(s||this.defaultScope_,e);goog.isDef(g)&&(this.hadError_=this.hadError_&&(g==e||this.isError(g)),this.result_=e=g),e instanceof goog.async.Deferred&&(o=!0,this.blocked_=!0)}}this.result_=e,o?(e.addCallbacks(goog.bind(this.continue_,this,!0),goog.bind(this.continue_,this,!1)),e.blocking_=!0):!goog.async.Deferred.STRICT_ERRORS||!this.isError(e)||e instanceof goog.async.Deferred.CanceledError||(this.hadError_=!0,t=!0),t&&(this.unhandledExceptionTimeoutId_=goog.global.setTimeout(goog.functions.fail(e),0))},ydn.db.Request.prototype.toJSON=function(){var e=this.tx_label_||"",t=e.match(/B(\d+)T(\d+)(?:Q(\d+?))?(?:R(\d+))?/)||[];return{method:this.method_?this.method_.split(":"):[],branchNo:parseFloat(t[1]),transactionNo:parseFloat(t[2]),queueNo:parseFloat(t[3]),requestNo:parseFloat(t[4])}},ydn.db.Request.Method={ADD:goog.DEBUG?"add":"a",ADDS:goog.DEBUG?"add:array":"b",CLEAR:goog.DEBUG?"clear":"c",COUNT:goog.DEBUG?"count":"d",GET:goog.DEBUG?"get":"e",GET_BY_KEY:goog.DEBUG?"get:key":"ek",GET_ITER:goog.DEBUG?"get:iter":"f",KEYS:goog.DEBUG?"keys":"g",KEYS_ITER:goog.DEBUG?"keys:iter":"h",KEYS_INDEX:goog.DEBUG?"keys:iter:index":"i",LIST:goog.DEBUG?"list":"i2",LOAD:goog.DEBUG?"load":"i3",MAP:goog.DEBUG?"map":"i4",OPEN:goog.DEBUG?"open":"i5",PUT:goog.DEBUG?"put":"j",PUTS:goog.DEBUG?"put:array":"k",PUT_KEYS:goog.DEBUG?"put:keys":"l",REDUCE:goog.DEBUG?"reduce":"m0",REMOVE_ID:goog.DEBUG?"rm":"m",REMOVE:goog.DEBUG?"rm:iter":"n",REMOVE_KEYS:goog.DEBUG?"rm:keys":"o",REMOVE_INDEX:goog.DEBUG?"rm:iter:index":"p",RUN:goog.DEBUG?"run":"q",SCAN:goog.DEBUG?"scan":"qa",SEARCH:goog.DEBUG?"search":"qb",SQL:goog.DEBUG?"sql":"r",VALUES:goog.DEBUG?"values":"s",VALUES_ITER:goog.DEBUG?"values:iter":"t",VALUES_INDEX:goog.DEBUG?"values:iter:index":"u",VALUES_IDS:goog.DEBUG?"values:array":"v",VALUES_KEYS:goog.DEBUG?"values:keys":"w",VERSION_CHANGE:goog.DEBUG?"IDBVersionChangeEvent ":"vc",NONE:""},goog.provide("ydn.db.tr.Thread"),goog.provide("ydn.db.tr.Thread.Policy"),goog.require("ydn.db.Request"),goog.require("goog.debug.Logger"),ydn.db.tr.Thread=function(e,t,o,r,n,i){this.storage_=e,this.q_no_=t,this.tx_no_=0,this.r_no_=0,this.scope_store_names=r,this.scope_mode=n,this.policy=o||ydn.db.tr.Thread.Policy.SINGLE,this.max_tx_no=i||0,this.generator_,this.gen_req_=null,this.break_tx_=!1,this.yield_no_=0},ydn.db.tr.Thread.prototype.logger=goog.debug.Logger.getLogger("ydn.db.tr.Thread"),ydn.db.tr.Thread.prototype.setGenerator=function(e,t){return goog.asserts.assert(!this.generator_,"thread can have only one generator"),this.generator_=e,this.gen_req_=t,goog.bind(this.onGenTxCommitted_,this)},ydn.db.tr.Thread.prototype.onGenTxCommitted_=function(e){var t=e==ydn.db.base.TxEventTypes.COMPLETE||e==ydn.db.base.TxEventTypes.ABORT;if(t)if(this.break_tx_)this.logger.finest("tx "+this.getTxNo()+" committed"),this.break_tx_=!1;else{this.logger.finest("Generator done "+this.break_tx_);var o=e==ydn.db.base.TxEventTypes.COMPLETE;this.gen_req_.setDbValue(this.getTxNo(),!o)}},ydn.db.tr.Thread.prototype.commit=function(){if(!goog.isDef(this.generator_))throw new ydn.debug.error.InvalidOperationException("Transaction thread not running in a generator");if(!this.generator_)throw new ydn.debug.error.InvalidOperationException("Coroutine transaction thread has been ended");this.logger.finest("Receive to commit tx "+this.getTxNo()+" on yield "+this.yield_no_),this.break_tx_=!0},ydn.db.tr.Thread.prototype.sendNext_=function(e){if(this.break_tx_){this.logger.finest("waiting tx to be committed for yielding "+this.yield_no_);var t=this;setTimeout(function(){t.processTx(function(){t.logger.finest("sending result to yield "+t.yield_no_),t.generator_.next(e)},t.scope_store_names,t.scope_mode,goog.bind(t.onGenTxCommitted_,t))},4)}else this.logger.finest("sending result to yield "+this.yield_no_),this.generator_.next(e);this.yield_no_++},ydn.db.tr.Thread.prototype.request=function(e){var t=new ydn.db.Request(e);return this.generator_&&t.addCallbacks(function(e){this.sendNext_(e)},function(e){var t=e;e instanceof Error||(t=new Error,t.error=e),this.sendNext_(t)},this),t},ydn.db.tr.Thread.prototype.exec=goog.abstractMethod,ydn.db.tr.Thread.prototype.abort=goog.abstractMethod,ydn.db.tr.Thread.prototype.getTxNo=function(){return this.tx_no_},ydn.db.tr.Thread.prototype.type=function(){return this.storage_.getType()},ydn.db.tr.Thread.prototype.getQueueNo=function(){return this.q_no_},ydn.db.tr.Thread.prototype.addStoreSchema=function(e){return this.storage_.addStoreSchema(e)},ydn.db.tr.Thread.prototype.getStorage=function(){return this.storage_},ydn.db.tr.Thread.prototype.getLabel=function(){return"B"+this.q_no_+"T"+this.tx_no_},ydn.db.tr.Thread.prototype.processTx=goog.abstractMethod,ydn.db.tr.Thread.Policy={MULTI:"multi",REPEAT:"repeat",ALL:"all",ATOMIC:"atomic",SINGLE:"single"},ydn.db.tr.Thread.abort=function(e){if(!e)throw new ydn.db.InvalidStateError("No active transaction");if(goog.isFunction(e.abort))e.abort();else{if(!goog.isFunction(e.executeSql))throw new ydn.debug.error.NotSupportedException;var t=function(){return!0};e.executeSql("ABORT",[],null,t)}},goog.provide("ydn.db.tr.Mutex"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("ydn.db.InvalidStateError"),ydn.db.tr.Mutex=function(e){this.tr_no=e,this.tx_=null,this.tx_count_=0},ydn.db.tr.Mutex.prototype.tx_,ydn.db.tr.Mutex.prototype.logger=goog.debug.Logger.getLogger("ydn.db.tr.Mutex"),ydn.db.tr.Mutex.DEBUG=!1,ydn.db.tr.Mutex.prototype.up=function(e,t,o){ydn.db.tr.Mutex.DEBUG&&window.console.log(this+": up"),goog.asserts.assert(!this.tx_,this+": transaction overlap"),this.tx_=e,this.is_locked_=!1,this.out_of_scope_=!1,this.store_names=t,this.mode=o,this.tx_count_++,this.oncompleted=null},ydn.db.tr.Mutex.prototype.store_names=null,ydn.db.tr.Mutex.prototype.mode,ydn.db.tr.Mutex.prototype.sameScope=function(e,t){if(!this.store_names||!this.mode)return!1;if(t!=this.mode)return!1;if(this.store_names.length!=e.length)return!1;for(var o=0;o<e.length;o++)if(-1==this.store_names.indexOf(e[o]))return!1;return!0},ydn.db.tr.Mutex.prototype.subScope=function(e,t){if(!this.store_names||!this.mode)return!1;if(t!=this.mode&&(this.mode!=ydn.db.base.TransactionMode.READ_WRITE||t!=ydn.db.base.TransactionMode.READ_ONLY))return!1;if(e.length>this.store_names.length)return!1;for(var o=0;o<e.length;o++)if(-1==this.store_names.indexOf(e[o]))return!1;return!0},ydn.db.tr.Mutex.prototype.down=function(e,t){this.tx_?(ydn.db.tr.Mutex.DEBUG&&window.console.log(this+": down"),this.tx_=null,this.store_names=null,this.mode=null,goog.isFunction(this.oncompleted)&&this.oncompleted(e,t),this.oncompleted=null):this.logger.warning(this+" has no TX to be unlocked for "+e)},ydn.db.tr.Mutex.prototype.out=function(){this.out_of_scope_=!0},ydn.db.tr.Mutex.prototype.inScope=function(){return!this.out_of_scope_},ydn.db.tr.Mutex.prototype.lock=function(){ydn.db.tr.Mutex.DEBUG&&window.console.log(this+": locked"),this.is_locked_=!0
},ydn.db.tr.Mutex.prototype.getTxCount=function(){return this.tx_count_},ydn.db.tr.Mutex.prototype.isLocked=function(){return this.is_locked_},ydn.db.tr.Mutex.prototype.isActive=function(){return!!this.tx_},ydn.db.tr.Mutex.prototype.isAvailable=function(){return!this.is_locked_},ydn.db.tr.Mutex.prototype.isActiveAndAvailable=function(){return this.isActive()&&this.isAvailable()},ydn.db.tr.Mutex.prototype.oncompleted=null,ydn.db.tr.Mutex.prototype.getTx=function(){return this.tx_},ydn.db.tr.Mutex.prototype.getLabel=function(){return"B"+this.tr_no+"T"+this.tx_count_},goog.DEBUG&&(ydn.db.tr.Mutex.prototype.toString=function(){var e=this.tx_?"*":"";return"Mutex:"+this.getLabel()+e}),goog.provide("ydn.db.tr.Serial"),goog.require("ydn.db.tr.Thread"),goog.require("ydn.db.tr.Mutex"),goog.require("ydn.debug.error.NotSupportedException"),ydn.db.tr.Serial=function(e,t,o,r,n,i){goog.base(this,e,t,o,r,n,i),this.trQueue_=[],this.completed_handlers_=[],this.s_request_tx=null,this.mu_tx_=new ydn.db.tr.Mutex(t),this.max_tx_no_=i||0,this.has_tx_started_=!1},goog.inherits(ydn.db.tr.Serial,ydn.db.tr.Thread),ydn.db.tr.Serial.DEBUG=!1,ydn.db.tr.Serial.prototype.logger=goog.debug.Logger.getLogger("ydn.db.tr.Serial"),ydn.db.tr.Serial.prototype.getMuTx=function(){return this.mu_tx_},ydn.db.tr.Serial.prototype.getActiveTx=function(){return this.mu_tx_.isActiveAndAvailable()?this.mu_tx_:null},ydn.db.tr.Serial.prototype.isActive=function(){return this.mu_tx_.isActiveAndAvailable()},ydn.db.tr.Serial.prototype.reusedTx=function(e,t){return this.policy==ydn.db.tr.Thread.Policy.MULTI?this.mu_tx_.subScope(e,t):this.policy==ydn.db.tr.Thread.Policy.REPEAT?this.mu_tx_.sameScope(e,t):this.policy==ydn.db.tr.Thread.Policy.ALL?!0:!1},ydn.db.tr.Serial.prototype.getTx=function(){return this.mu_tx_.isActiveAndAvailable()?this.mu_tx_.getTx():null},ydn.db.tr.Serial.prototype.lock=function(){this.mu_tx_.lock()},ydn.db.tr.Serial.MAX_QUEUE=1e3,ydn.db.tr.Serial.prototype.popTxQueue_=function(){var e=this.trQueue_.shift();e&&(ydn.db.tr.Serial.DEBUG&&this.logger.finest("pop tx queue["+this.trQueue_.length+"]"),this.processTx(e.fnc,e.store_names,e.mode,e.oncompleted))},ydn.db.tr.Serial.prototype.peekScopes=function(){return this.trQueue_.length>0?this.trQueue_[0].store_names:null},ydn.db.tr.Serial.prototype.peekMode=function(){return this.trQueue_.length>0?this.trQueue_[0].mode:null},ydn.db.tr.Serial.prototype.isNextTxCompatible=function(){var e=this.peekScopes(),t=this.peekMode();return goog.isDefAndNotNull(e)&&goog.isDefAndNotNull(t)?this.reusedTx(e,t):!1},ydn.db.tr.Serial.prototype.pushTxQueue=function(e,t,o,r){this.logger.finest("push tx queue["+this.trQueue_.length+"]"),this.trQueue_.push({fnc:e,store_names:t,mode:o,oncompleted:r})},ydn.db.tr.Serial.prototype.abort=function(){this.logger.finer(this+": aborting"),ydn.db.tr.Thread.abort(this.s_request_tx)},ydn.db.tr.Serial.prototype.processTx=function(e,t,o,r){var n=goog.isString(t)?[t]:t;if(goog.DEBUG){if(!goog.isArrayLike(n))throw new ydn.debug.error.ArgumentException("store names must be an array");if(0==n.length)throw new ydn.debug.error.ArgumentException("number of store names must more than 0");for(var i=0;i<n.length;i++){if(!goog.isString(n[i]))throw new ydn.debug.error.ArgumentException("store name at "+i+" must be string but found "+n[i]+" of type "+typeof n[i]);if(this.scope_store_names_&&!goog.array.contains(this.scope_store_names_,n[i]))throw new ydn.debug.error.ArgumentException('store name "'+i+n[i]+'" in scope of '+this)}}var s=goog.isDef(o)?o:ydn.db.base.TransactionMode.READ_ONLY,a=this;if(this.mu_tx_.isActive()||!this.getStorage().isReady()&&this.has_tx_started_)this.pushTxQueue(e,t,s,r);else{var g=this.getLabel(),d=function(o){for(a.mu_tx_.up(o,t,s),g=a.getLabel(),a.logger.fine(g+" BEGIN "+ydn.json.stringify(t)+" "+s),e(a),e=null,a.mu_tx_.out();a.isNextTxCompatible();){var r=a.trQueue_.shift();r.oncompleted&&a.completed_handlers_.push(r.oncompleted),a.logger.finest("pop tx queue"+(a.trQueue_.length+1)+" reusing T"+a.getTxNo()),r.fnc()}},u=function(e,t){a.logger.fine(g+" "+e),a.mu_tx_.down(e,t);for(var o=0;o<a.completed_handlers_.length;o++){var r=a.completed_handlers_[o];r(e,t)}a.completed_handlers_.length=0,a.popTxQueue_(),a.r_no_=0};if(r&&this.completed_handlers_.push(r),this.max_tx_no_&&this.getTxNo()>=this.max_tx_no_)throw new ydn.debug.error.InvalidOperationException("Exceed maximum number of transactions of "+this.max_tx_no_);this.has_tx_started_=!0,this.getStorage().transaction(d,n,s,u)}},ydn.db.tr.Serial.prototype.getLabel=function(){return this.mu_tx_.getLabel()},ydn.db.tr.Serial.prototype.request=function(e,t,o,r){var n=goog.base(this,"request",e,t,o,r),i=o||ydn.db.base.TransactionMode.READ_ONLY,s=this;if(this.mu_tx_.isActiveAndAvailable()&&this.reusedTx(t,i)){var a=this.mu_tx_.getTx();this.r_no_++,n.setTx(a,this.getLabel()+"R"+this.r_no_),r&&this.completed_handlers_.push(r)}else{var g=function(){var e=s.mu_tx_.getTx();s.r_no_++,n.setTx(e,s.getLabel()+"R"+s.r_no_)};s.processTx(g,t,i,r)}return n},ydn.db.tr.Serial.prototype.exec=function(e,t,o,r,n){var i,s=r||ydn.db.base.TransactionMode.READ_ONLY,a=this;if(a.mu_tx_.isActiveAndAvailable()&&this.reusedTx(o,s)){var g=a.mu_tx_.getTx(),d=function(t,o){a.s_request_tx=g,o?(a.logger.finer(i+" ERROR"),e.errback(t)):(a.logger.finer(i+" SUCCESS"),e.callback(t)),a.s_request_tx=null};a.r_no_++,i=a.getLabel()+"R"+a.r_no_,a.logger.finer(i+" BEGIN"),t(g,i,d),a.logger.finer(i+" END"),t=null}else{var u=function(){var o=a.mu_tx_.getTx(),r=function(t,r){a.s_request_tx=o,r?(a.logger.finer(i+" ERROR"),e.errback(t)):(a.logger.finer(i+" SUCCESS"),e.callback(t)),a.s_request_tx=null};a.r_no_++,i=a.getLabel()+"R"+a.r_no_,a.logger.finer(i+" BEGIN"),t(o,i,r),a.logger.finer(i+" END"),t=null};a.processTx(u,o,s,n)}},ydn.db.tr.Serial.prototype.getName=function(){return this.getStorage().getName()},goog.DEBUG&&(ydn.db.tr.Serial.prototype.toString=function(){var e=this.s_request_tx?"*":"";return"Serial:"+this.getLabel()+e}),goog.provide("ydn.db.tr.AtomicSerial"),goog.require("ydn.db.tr.Serial"),goog.require("ydn.debug.error.NotSupportedException"),ydn.db.tr.AtomicSerial=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.tr.AtomicSerial,ydn.db.tr.Serial),ydn.db.tr.AtomicSerial.DEBUG=!1,ydn.db.tr.AtomicSerial.prototype.logger=goog.debug.Logger.getLogger("ydn.db.tr.AtomicSerial"),ydn.db.tr.AtomicSerial.prototype.request=function(e,t,o){var r,n,i,s=function(e,t){if(a.removeTx(),r)e!=ydn.db.base.TxEventTypes.COMPLETE&&(i=!0,n=t),r(n,i);else{var o=new ydn.db.TimeoutError;a.setDbValue(o,!0)}},a=goog.base(this,"request",e,t,o,s);return a.await(function(e,t,o){i=t,n=e,r=o}),a},ydn.db.tr.AtomicSerial.prototype.exec=function(e,t,o,r,n){var i,s,a=new goog.async.Deferred;a.addCallbacks(function(e){s=!1,i=e},function(e){s=!0,i=e});var g=function(t,o){if(t!=ydn.db.base.TxEventTypes.COMPLETE)e.errback(o);else if(s===!0)e.errback(i);else if(s===!1)e.callback(i);else{var r=new ydn.db.TimeoutError;e.errback(r)}n&&(n(t,o),n=void 0)};goog.base(this,"exec",a,t,o,r,g)},goog.DEBUG&&(ydn.db.tr.AtomicSerial.prototype.toString=function(){return"Atomic"+goog.base(this,"toString")}),goog.provide("ydn.db.tr.DbOperator"),goog.require("ydn.db.crud.IOperator"),goog.require("ydn.db.tr.AtomicSerial"),goog.require("ydn.db.tr.Thread"),goog.require("ydn.debug.error.NotSupportedException"),ydn.db.tr.DbOperator=function(e,t,o,r){this.storage_=e,this.schema=t,this.tx_thread=o,this.sync_thread=r,this.executor=null},ydn.db.tr.DbOperator.prototype.logger=goog.debug.Logger.getLogger("ydn.db.tr.DbOperator"),ydn.db.tr.DbOperator.prototype.executor,ydn.db.tr.DbOperator.prototype.tx_thread,ydn.db.tr.DbOperator.prototype.sync_thread,ydn.db.tr.DbOperator.prototype.getTxNo=function(){return this.tx_thread.getTxNo()},ydn.db.tr.DbOperator.prototype.abort=function(){this.tx_thread.abort()},ydn.db.tr.DbOperator.prototype.getExecutor=function(){return this.executor||(this.executor=this.storage_.newExecutor()),this.executor},ydn.db.tr.DbOperator.prototype.getStorage=function(){return this.storage_},ydn.db.tr.DbOperator.prototype.commit=function(){this.tx_thread.commit()},ydn.db.tr.DbOperator.prototype.addStoreSchema=function(e){return this.getStorage().addStoreSchema(e)},goog.DEBUG&&(ydn.db.tr.DbOperator.prototype.toString=function(){var e="TxStorage:"+this.getStorage().getName();return e}),goog.provide("ydn.db.crud.DbOperator"),goog.require("goog.debug.Logger"),goog.require("goog.userAgent"),goog.require("ydn.db"),goog.require("ydn.db.Key"),goog.require("ydn.db.Request"),goog.require("ydn.db.crud.IOperator"),goog.require("ydn.db.tr.AtomicSerial"),goog.require("ydn.db.tr.DbOperator"),goog.require("ydn.db.tr.Thread"),goog.require("ydn.debug.error.ArgumentException"),goog.require("ydn.debug.error.NotSupportedException"),ydn.db.crud.DbOperator=function(e,t,o,r){goog.base(this,e,t,o,r)},goog.inherits(ydn.db.crud.DbOperator,ydn.db.tr.DbOperator),ydn.db.crud.DbOperator.prototype.logger=goog.debug.Logger.getLogger("ydn.db.crud.DbOperator"),ydn.db.crud.DbOperator.prototype.getCrudExecutor=function(){return this.getExecutor()},ydn.db.crud.DbOperator.prototype.count=function(e,t,o,r){var n,i,s,a;if(goog.isDefAndNotNull(e))if(goog.isArray(e)){if(goog.isDef(o)||goog.isDef(t))throw new ydn.debug.error.ArgumentException("too many arguments.");i=e;for(var g=0;g<i.length;g++)if(!this.schema.hasStore(i[g]))throw new ydn.debug.error.ArgumentException('store name "'+i[g]+'" at '+g+" not found.");this.logger.finer("countStores: "+ydn.json.stringify(i)),n=this.tx_thread.request(ydn.db.Request.Method.COUNT,i),n.addTxback(function(){this.getCrudExecutor().countStores(n,i)},this)}else{if(!goog.isString(e))throw new ydn.debug.error.ArgumentException("Invalid store name or store names.");var d=this.schema.getStore(e);if(!d)throw new ydn.debug.error.ArgumentException('store name "'+e+'" not found.');if(goog.DEBUG&&goog.isDef(r)&&!goog.isBoolean(r))throw new ydn.debug.error.ArgumentException('unique value "'+r+'" must be boolean, but found '+typeof r+".");if(i=[e],goog.isString(t))if(s=t,goog.isObject(o)){if(goog.DEBUG){var u=ydn.db.KeyRange.validate(o);if(u)throw new ydn.debug.error.ArgumentException("invalid key range: "+ydn.json.toShortString(o)+" "+u)}a=ydn.db.KeyRange.parseIDBKeyRange(o)}else{if(goog.DEBUG&&goog.isDefAndNotNull(o))throw new ydn.debug.error.ArgumentException("invalid key range: "+ydn.json.toShortString(o)+" of type "+typeof o);a=null}else{if(!goog.isObject(t)&&goog.isDefAndNotNull(t))throw new ydn.debug.error.ArgumentException('invalid second argument for count "'+ydn.json.toShortString(o)+'" of type '+typeof t);if(goog.isObject(t)){if(goog.DEBUG){var l=ydn.db.KeyRange.validate(t);if(l)throw new ydn.debug.error.ArgumentException("invalid key range: "+ydn.json.toShortString(t)+" "+l)}a=ydn.db.KeyRange.parseIDBKeyRange(t)}else{if(goog.isDefAndNotNull(t))throw new ydn.debug.error.ArgumentException("key range must be  an object but found "+ydn.json.toShortString(t)+" of type "+typeof t);a=null}}this.logger.finer("countKeyRange: "+e+" "+(s?s:"")+ydn.json.stringify(a)),n=this.tx_thread.request(ydn.db.Request.Method.COUNT,i),d.hook(n,arguments),n.addTxback(function(){this.getCrudExecutor().countKeyRange(n,i[0],a,s,!!r)},this)}else{this.logger.warning("count method requires store name(s)");var c=this.schema.getStoreNames();n=this.tx_thread.request(ydn.db.Request.Method.COUNT,c),n.await(function(e,t,o){if(t)return o(e,!0),void 0;for(var r=0,n=0;n<e.length;n++)r+=e[n];o(r,!1)},this),n.addTxback(function(){this.getCrudExecutor().countStores(n,i)},this)}return n},ydn.db.crud.DbOperator.prototype.get=function(e,t){var o,r=this;if(e instanceof ydn.db.Key){var n=e,i=n.getStoreName(),s=this.schema.getStore(i);if(!s){if(this.schema.isAutoSchema())return this.getStorage().isReady()?ydn.db.Request.succeed(ydn.db.Request.Method.GET,void 0):(o=new ydn.db.Request(ydn.db.Request.Method.GET),this.getStorage().onReady(function(){r.get(e,t).addCallbacks(function(e){o.callback(e)},function(e){o.errback(e)})}),o);throw new ydn.debug.error.ArgumentException("Store: "+i+" not found.")}var a=n.getId();this.logger.finer("getByKey: "+i+":"+a),o=this.tx_thread.request(ydn.db.Request.Method.GET_BY_KEY,[i]),s.hook(o,arguments),o.addTxback(function(){this.getCrudExecutor().getById(o,i,a)},this)}else{if(!goog.isString(e)||!goog.isDef(t))throw new ydn.debug.error.ArgumentException("get require valid input arguments.");var g=e,s=this.schema.getStore(g);if(!s){if(this.schema.isAutoSchema())return this.getStorage().isReady()?ydn.db.Request.succeed(ydn.db.Request.Method.GET,void 0):(o=new ydn.db.Request(ydn.db.Request.Method.GET),this.getStorage().onReady(function(){r.get(e,t).addCallbacks(function(e){o.callback(e)},function(e){o.errback(e)})}),o);throw new ydn.debug.error.ArgumentException('Store name "'+g+'" not found.')}var d=t;goog.asserts.assert(ydn.db.Key.isValidKey(d),"key "+d+" of type "+typeof d+" is not a valid key"),this.logger.finer("getById: "+g+":"+d),o=this.tx_thread.request(ydn.db.Request.Method.GET,[g]),s.hook(o,arguments),o.addTxback(function(){this.getCrudExecutor().getById(o,g,d)},this)}return o},ydn.db.crud.DbOperator.prototype.keys=function(e,t,o,r,n,i,s){var a,g,d=null,u=!1,l=!1,c=e,h=this.schema.getStore(c);if(goog.DEBUG){if(!goog.isString(c))throw new ydn.debug.error.ArgumentException("store name must be a string, but "+c+" of type "+typeof c+" is not.");if(!this.schema.isAutoSchema()){if(!h)throw new ydn.debug.error.ArgumentException('store name "'+c+'" not found.');if(goog.isString(t)){var p=h.getIndex(t);if(!p)throw new ydn.debug.error.ArgumentException('index "'+t+'" not found in store "'+c+'".')}}}if(this.schema.isAutoSchema()&&!h)return ydn.db.Request.succeed(ydn.db.Request.Method.KEYS,[]);var f;if(goog.isString(t)){var y=t;if(goog.DEBUG){var b=ydn.db.KeyRange.validate(o);if(b)throw new ydn.debug.error.ArgumentException("invalid key range: "+o+" "+b)}if(d=ydn.db.KeyRange.parseIDBKeyRange(o),goog.isNumber(r))a=r;else{if(goog.isDef(r))throw new ydn.debug.error.ArgumentException("limit must be a number");a=ydn.db.base.DEFAULT_RESULT_LIMIT}if(goog.isNumber(n))g=n;else{if(goog.isDef(n))throw new ydn.debug.error.ArgumentException("offset must be a number");g=0}if(goog.isDef(i)){if(!goog.isBoolean(i))throw new ydn.debug.error.ArgumentException("reverse must be a boolean");u=i}if(goog.isDef(s)){if(!goog.isBoolean(s))throw new ydn.debug.error.ArgumentException("unique must be a boolean");l=s}this.logger.finer("keysByIndexKeyRange: "+c),f=this.tx_thread.request(ydn.db.Request.Method.KEYS_INDEX,[c]),h.hook(f,arguments),f.addTxback(function(){this.getCrudExecutor().list(f,ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,c,y,d,a,g,u,l)},this)}else{if(goog.isObject(t)){if(goog.DEBUG){var b=ydn.db.KeyRange.validate(t);if(b)throw new ydn.debug.error.ArgumentException("invalid key range: "+ydn.json.toShortString(t)+" "+b)}d=ydn.db.KeyRange.parseIDBKeyRange(t)}else{if(goog.DEBUG&&goog.isDefAndNotNull(t))throw new ydn.debug.error.ArgumentException("invalid key range: "+ydn.json.toShortString(t)+" of type "+typeof t);d=null}if(goog.isNumber(o))a=o;else{if(goog.isDef(o))throw new ydn.debug.error.ArgumentException("limit must be a number");a=ydn.db.base.DEFAULT_RESULT_LIMIT}if(goog.isNumber(r))g=r;else{if(goog.isDef(r))throw new ydn.debug.error.ArgumentException("offset must be a number");g=0}if(goog.isDef(n)){if(!goog.isBoolean(n))throw new ydn.debug.error.ArgumentException("reverse must be a boolean");u=n}this.logger.finer("keysByKeyRange: "+c),f=this.tx_thread.request(ydn.db.Request.Method.KEYS,[c]),h.hook(f,arguments),f.addTxback(function(){this.getCrudExecutor().list(f,ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,c,null,d,a,g,u,!1)},this)}return f},ydn.db.crud.DbOperator.prototype.values=function(e,t,o,r,n,i,s){var a,g,d,u=this,l=ydn.db.Request.Method.NONE,c=!1,h=!1;if(goog.isString(e)){var p=e,f=this.schema.getStore(p);if(!f){if(this.schema.isAutoSchema())return this.getStorage().isReady()?ydn.db.Request.succeed(ydn.db.Request.Method.VALUES,[]):(a=new ydn.db.Request(ydn.db.Request.Method.VALUES),this.getStorage().onReady(function(){u.values(e,t,o,r,n,i).addCallbacks(function(e){a.callback(e)},function(e){a.errback(e)})}),a);throw new ydn.db.NotFoundError(p)}if(goog.isArray(t)){if(goog.DEBUG&&(goog.isDef(o)||goog.isDef(r)))throw new ydn.debug.error.ArgumentException("too many input arguments");var y=t;this.logger.finer("listByIds: "+p+" "+y.length+" ids"),a=this.tx_thread.request(ydn.db.Request.Method.VALUES_IDS,[p]),f.hook(a,arguments),a.addTxback(function(){this.getCrudExecutor().listByIds(a,p,y)},this)}else if(goog.isString(t)){var b=t;if(goog.DEBUG){if(!f.hasIndex(b))throw new ydn.debug.error.ArgumentException('index "'+b+'" not found in store "'+p+'"');var m=ydn.db.KeyRange.validate(o);if(m)throw new ydn.debug.error.ArgumentException("invalid key range: "+o+" "+m)}var v=ydn.db.KeyRange.parseIDBKeyRange(o);if(goog.isDef(r)){if(!goog.isNumber(r))throw new ydn.debug.error.ArgumentException("limit must be a number.");g=r}else g=ydn.db.base.DEFAULT_RESULT_LIMIT;if(goog.isDef(n)){if(!goog.isNumber(n))throw new ydn.debug.error.ArgumentException("offset must be a number.");d=n}else d=0;if(goog.isBoolean(i))c=i;else if(goog.isDef(i))throw new ydn.debug.error.ArgumentException("reverse must be a boolean, but "+i);if(goog.isDef(s)){if(!goog.isBoolean(s))throw new ydn.debug.error.ArgumentException("unique must be a boolean");h=s}this.logger.finer("listByIndexKeyRange: "+p+":"+b),l=ydn.db.Request.Method.VALUES_INDEX,a=this.tx_thread.request(l,[p]),f.hook(a,arguments),a.addTxback(function(){this.getCrudExecutor().list(a,ydn.db.base.QueryMethod.LIST_VALUE,p,b,v,g,d,c,h)},this)}else{var v=null;if(goog.isObject(t)){if(goog.DEBUG){var m=ydn.db.KeyRange.validate(t);if(m)throw new ydn.debug.error.ArgumentException("invalid key range: "+t+" "+m)}v=ydn.db.KeyRange.parseIDBKeyRange(t)}else if(goog.DEBUG&&goog.isDefAndNotNull(t))throw new ydn.debug.error.ArgumentException('expect key range object, but found "'+ydn.json.toShortString(t)+'" of type '+typeof t);if(goog.isDef(o)){if(!goog.isNumber(o))throw new ydn.debug.error.ArgumentException("limit must be a number, but "+o+" is "+typeof o);g=o}else g=ydn.db.base.DEFAULT_RESULT_LIMIT;if(goog.isDef(r)){if(!goog.isNumber(r))throw new ydn.debug.error.ArgumentException("offset must be a number, but "+r+" is "+typeof r);d=r}else d=0;if(goog.isDef(n)){if(!goog.isBoolean(n))throw new ydn.debug.error.ArgumentException("reverse must be a boolean, but "+n+" is "+typeof n);c=n}this.logger.finer((v?"listByKeyRange: ":"listByStore: ")+p),l=ydn.db.Request.Method.VALUES,a=this.tx_thread.request(l,[p]),f.hook(a,arguments),a.addTxback(function(){this.getCrudExecutor().list(a,ydn.db.base.QueryMethod.LIST_VALUE,p,null,v,g,d,c,!1)},this)}}else{if(!goog.isArray(e))throw new ydn.debug.error.ArgumentException("first argument "+e+" is invalid.");if(!(e[0]instanceof ydn.db.Key))throw new ydn.debug.error.ArgumentException("first argumentmust be array of ydn.db.Key, but "+e[0]+" of "+typeof e[0]+" found.");for(var _=[],E=e,S=0;S<E.length;S++){var x=E[S],w=x.getStoreName();if(!this.schema.hasStore(w)){if(this.schema.isAutoSchema()){var T=[];return T[E.length-1]=void 0,ydn.db.Request.succeed(ydn.db.Request.Method.GET,T)}throw new ydn.debug.error.ArgumentException("Store: "+w+" not found.")}goog.array.contains(_,w)||_.push(w)}this.logger.finer("listByKeys: "+ydn.json.stringify(_)+" "+E.length+" keys"),a=this.tx_thread.request(ydn.db.Request.Method.VALUES_KEYS,_),a.addTxback(function(){this.getCrudExecutor().listByKeys(a,E)},this)}return a},ydn.db.crud.DbOperator.prototype.list=function(e,t,o,r,n,i,s,a,g){var d=this.schema.getStore(t);if(!d){if(this.schema.isAutoSchema())return ydn.db.Request.succeed(ydn.db.Request.Method.GET,[]);throw new ydn.db.NotFoundError(t)}var u,l=ydn.db.Request.Method.NONE;if(goog.DEBUG){if(o&&!d.hasIndex(o))throw new ydn.debug.error.ArgumentException('index "'+o+'" not found in store "'+t+'"');var c=ydn.db.KeyRange.validate(r);if(c)throw new ydn.debug.error.ArgumentException("invalid key range: "+r+" "+c)}var h=ydn.db.KeyRange.parseIDBKeyRange(r),p=ydn.db.base.DEFAULT_RESULT_LIMIT;if(goog.isNumber(n))p=n;else if(goog.isDefAndNotNull(n))throw new ydn.debug.error.ArgumentException('limit must be a number but "'+n+'" of type '+typeof n+" found.");var f=0;if(goog.isNumber(i))f=i;else if(goog.isDefAndNotNull(i))throw new ydn.debug.error.ArgumentException('offset must be a number but "'+i+'" of type '+typeof i+" found.");var y=!1;if(goog.isBoolean(s))y=s;else if(goog.isDefAndNotNull(s))throw new ydn.debug.error.ArgumentException('reverse must be a boolean but "'+s+'" of type '+typeof s+" found.");var b=!1;if(goog.isBoolean(a))b=a;else if(goog.isDefAndNotNull(a))throw new ydn.debug.error.ArgumentException('unique must be a boolean but "'+a+'" of type '+typeof a+" found.");if(f&&g&&goog.isDef(g[0]))throw new ydn.debug.error.ArgumentException("offset must not given when initial cursor position is defined");return this.logger.finer(e+": "+t+":"+o),l=ydn.db.Request.Method.VALUES_INDEX,u=this.tx_thread.request(l,[t]),u.addTxback(function(){this.getCrudExecutor().list(u,e,t,o||null,h,p,f,y,b,g)},this),u},ydn.db.crud.DbOperator.prototype.add=function(e,t,o){var r=goog.isString(e)?e:goog.isObject(e)?e.name:void 0;if(!goog.isString(r))throw new ydn.debug.error.ArgumentException("store name "+r+" must be a string, but "+typeof r);var n=this.schema.getStore(r);if(n){if(this.schema.isAutoSchema()&&goog.isObject(e)){var i=ydn.db.schema.Store.fromJSON(e),s=n.difference(i);if(s)throw new ydn.debug.error.NotSupportedException(s)}}else{if(!this.schema.isAutoSchema())throw new ydn.debug.error.ArgumentException('store name "'+r+'" not found.');var a=goog.isObject(e)?e:{name:r};n=ydn.db.schema.Store.fromJSON(a),this.logger.finer("Adding object store: "+r),this.addStoreSchema(n)}var g;if(!n)throw new ydn.debug.error.ArgumentException('store name "'+r+'" not found.');if(goog.isString(n.keyPath)&&goog.isDef(o))throw new ydn.debug.error.ArgumentException("key must not be provided while the store uses in-line key.");if(!n.usedInlineKey()&&!n.autoIncrement&&!goog.isDef(o))throw new ydn.debug.error.ArgumentException("out-of-line key must be provided.");if(goog.isArray(t)){var d=t,u=o;this.logger.finer("addObjects: "+r+" "+d.length+" objects");for(var l=0;l<d.length;l++)n.generateIndex(d[l]);g=this.tx_thread.request(ydn.db.Request.Method.ADDS,[r],ydn.db.base.TransactionMode.READ_WRITE),g.addTxback(function(){this.getCrudExecutor().insertObjects(g,!1,!1,r,d,u)},this),n.dispatch_events&&g.addCallback(function(e){var t=new ydn.db.events.StoreEvent(ydn.db.events.Types.CREATED,this.getStorage(),n.getName(),e,d);this.getStorage().dispatchDbEvent(t)},this)}else{if(!goog.isObject(t))throw new ydn.debug.error.ArgumentException("record must be an object or array list of objects, but "+t+" of type "+typeof t+" found.");var c=t,h=o,p="store: "+r+" key: "+n.extractKey(c,h);this.logger.finer("addObject: "+p),n.generateIndex(c),g=this.tx_thread.request(ydn.db.Request.Method.ADD,[r],ydn.db.base.TransactionMode.READ_WRITE),g.addTxback(function(){this.getCrudExecutor().insertObjects(g,!1,!0,r,[c],[h])},this),n.dispatch_events&&g.addCallback(function(e){var t=new ydn.db.events.RecordEvent(ydn.db.events.Types.CREATED,this.getStorage(),n.getName(),e,c);this.getStorage().dispatchDbEvent(t)},this)}return g},ydn.db.crud.DbOperator.prototype.getStore_=function(e){var t=goog.isString(e)?e:goog.isObject(e)?e.name:void 0;if(!goog.isString(t))throw new ydn.debug.error.ArgumentException("store name must be a string");var o=this.schema.getStore(t);if(o){if(this.schema.isAutoSchema()&&goog.isObject(e)){var r=ydn.db.schema.Store.fromJSON(e),n=o.difference(r);if(n)throw new ydn.debug.error.NotSupportedException(n)}}else{if(!this.schema.isAutoSchema())throw new ydn.db.NotFoundError(t);var i=goog.isObject(e)?e:{name:t};o=ydn.db.schema.Store.fromJSON(i),this.logger.finer("Adding object store: "+t),this.addStoreSchema(o)}if(!o)throw new ydn.db.NotFoundError(t);return o},ydn.db.crud.DbOperator.prototype.load=function(e,t,o){var r=o||",",n=this.getStore_(e),i=n.getName(),s=this.tx_thread.request(ydn.db.Request.Method.LOAD,[i]),a=this;return this.tx_thread.exec(s,function(e,o,n){a.getCrudExecutor().putData(e,o,n,i,t,r)},[i],ydn.db.base.TransactionMode.READ_WRITE),s},ydn.db.crud.DbOperator.prototype.search=function(e){var t=e.getStoreList();this.logger.finest("query "+e);var o=this.tx_thread.request(ydn.db.Request.Method.SEARCH,t,ydn.db.base.TransactionMode.READ_ONLY);return o.addTxback(function(){var t=this.getCrudExecutor();e.nextLookup(function(r,n,i,s){var a=o.copy();t.list(a,ydn.db.base.QueryMethod.LIST_VALUE,r,n,i.toIDBKeyRange(),100,0,!1,!1),a.addBoth(function(t){var r=null;t instanceof Array||(r=t,t=[]);var n=e.addResult(this,t);if(n===!0?o.notify(e):n===!1&&o.callback(e.collect()),r)throw r},s)})},this),o},ydn.db.crud.DbOperator.prototype.put=function(e,t,o){var r,n=this;if(e instanceof ydn.db.Key){var i=e,s=i.getStoreName(),a=this.schema.getStore(s);if(!a)throw new ydn.debug.error.ArgumentException('store "'+s+'" not found.');if(a.usedInlineKey()){var g=a.extractKey(t);if(goog.isDefAndNotNull(g)){if(0!=ydn.db.cmp(g,i.getId()))throw new ydn.debug.error.ArgumentException("Inline key must be "+i+" but "+g+" found.")}else a.setKeyValue(t,i.getId());return this.put(s,t)}return this.put(s,t,i.getId())}if(goog.isArray(e)){if(goog.DEBUG&&goog.isDef(o))throw new ydn.debug.error.ArgumentException("too many arguments");var d=e;if(goog.DEBUG&&!goog.isDef(t))throw new ydn.debug.error.ArgumentException("record values required");goog.asserts.assertArray(t,"record values must also be in an array");var u=t;goog.asserts.assert(d.length===u.length,"number of keys and number of object must be same, but found "+d.length+" vs. "+u.length);for(var l=[],c=0,h=d.length;h>c;c++){var p=d[c].getStoreName();-1==goog.array.indexOf(l,p)&&l.push(p);var f=this.schema.getStore(p);if(!f)throw new ydn.debug.error.ArgumentException('store "'+p+'" not found.');f.usedInlineKey()&&f.setKeyValue(u[c],d[c].getId())}this.logger.finer("putByKeys: to "+ydn.json.stringify(l)+" "+u.length+" objects");for(var c=0;c<u.length;c++)f.generateIndex(u[c]);r=this.tx_thread.request(ydn.db.Request.Method.PUT_KEYS,l,ydn.db.base.TransactionMode.READ_WRITE),f.hook(r,arguments),r.addTxback(function(){n.getCrudExecutor().putByKeys(r,u,d)},this)}else{if(!goog.isString(e)&&!goog.isObject(e))throw new ydn.debug.error.ArgumentException("the first argument of put must be store name, store schema or array of keys.");var f=this.getStore_(e),y=f.getName();if(f.usedInlineKey()&&goog.isDef(o))throw new ydn.debug.error.ArgumentException("key must not be provided while the store uses in-line key.");if(!f.usedInlineKey()&&!f.autoIncrement&&!goog.isDef(o))throw new ydn.debug.error.ArgumentException("out-of-line key must be provided.");if(goog.isArray(t)){var b=t,m=o;this.logger.finer("putObjects: "+y+" "+b.length+" objects");for(var c=0;c<b.length;c++)f.generateIndex(b[c]);r=this.tx_thread.request(ydn.db.Request.Method.PUTS,[y],ydn.db.base.TransactionMode.READ_WRITE),f.hook(r,arguments),r.addTxback(function(){this.getCrudExecutor().insertObjects(r,!0,!1,y,b,m)},this),f.dispatch_events&&r.addCallback(function(e){var t=new ydn.db.events.StoreEvent(ydn.db.events.Types.UPDATED,this.getStorage(),y,e,b);this.getStorage().dispatchDbEvent(t)},this)}else{if(!goog.isObject(t))throw new ydn.debug.error.ArgumentException("put record value must be Object or array of Objects");var v=t,_=o;goog.DEBUG&&(goog.isDef(_)?goog.asserts.assert(ydn.db.Key.isValidKey(_),_+" of type "+typeof _+" is invalid key for "+ydn.json.toShortString(v)):!f.isAutoIncrement()&&f.usedInlineKey()&&goog.asserts.assert(ydn.db.Key.isValidKey(f.extractKey(v)),"in-line key on "+f.getKeyPath()+" must provided in "+ydn.json.toShortString(v))),this.logger.finer("putObject: "+y+" "+_);var E=goog.isDef(goog.global.Blob)&&v instanceof Blob&&f.isFixed()&&!f.usedInlineKey()&&0==f.countIndex()&&goog.userAgent.WEBKIT;if(E){r=new ydn.db.Request(ydn.db.Request.Method.PUT);var S=new FileReader;S.onload=function(e){var t=e.target.result,o=n.tx_thread.request(ydn.db.Request.Method.PUT,[y],ydn.db.base.TransactionMode.READ_WRITE);f.hook(o,[y,v,_]),o.addTxback(function(){n.getCrudExecutor().insertObjects(o,!0,!0,y,[t],[_])},this),o.addCallbacks(function(e){r.callback(e)},function(e){r.errback(e)})},S.onerror=function(e){r.errback(e)},S.onabort=function(e){r.errback(e)},S.readAsDataURL(v)}else{f.generateIndex(v),r=this.tx_thread.request(ydn.db.Request.Method.PUT,[y],ydn.db.base.TransactionMode.READ_WRITE);var x=[y,v,_];f.hook(r,x),r.addTxback(function(){var e=goog.isDef(_)?[x[2]]:void 0;n.getCrudExecutor().insertObjects(r,!0,!0,y,[x[1]],e)},this)}f.dispatch_events&&r.addCallback(function(e){var t=new ydn.db.events.RecordEvent(ydn.db.events.Types.UPDATED,this.getStorage(),y,e,v);this.getStorage().dispatchDbEvent(t)},this)}}return r},ydn.db.crud.DbOperator.prototype.dumpInternal=function(e,t,o,r,n){var i,s,a=r?this.tx_thread:this.sync_thread;if(goog.isString(e)){var g=this.schema.getStore(e);if(goog.DEBUG){if(!g)throw new ydn.db.NotFoundError(e);if(!g.usedInlineKey()&&!g.isAutoIncrement()&&!goog.isDefAndNotNull(o))throw new ydn.debug.error.ArgumentException('key required for store "'+e+'"')}for(var d=0;d<t.length;d++)g.generateIndex(t[d]);i=[e]}else{goog.asserts.assertArray(e,"store name "+e+" + must be an array or string, but "+typeof e),s=e,i=[];for(var d=0,u=s.length;u>d;d++){var l=s[d].getStoreName(),g=this.schema.getStore(l);if(-1==goog.array.indexOf(i,l)&&i.push(l),goog.DEBUG&&!g)throw new ydn.db.NotFoundError(l);g.generateIndex(t[d])}}var c;if(goog.isString(e)){var h=e,g=this.schema.getStore(h);c=a.request(ydn.db.Request.Method.PUTS,i,ydn.db.base.TransactionMode.READ_WRITE),n&&g.hook(c,[h,t,o],n),c.addTxback(function(){this.getCrudExecutor().insertObjects(c,!0,!1,h,t,o)},this)}else{if(c=a.request(ydn.db.Request.Method.PUT_KEYS,i,ydn.db.base.TransactionMode.READ_WRITE),n)for(var d=0;d<i.length;d++){var g=this.schema.getStore(i[d]);g.hook(c,[t,s],n)}c.addTxback(function(){this.getCrudExecutor().putByKeys(c,t,s)},this)}return c},ydn.db.crud.DbOperator.prototype.removeInternalByKeys=function(e){for(var t=[],o=0,r=e.length;r>o;o++){var n=e[o].getStoreName();if(-1==goog.array.indexOf(t,n)&&t.push(n),goog.DEBUG&&!this.schema.hasStore(n))throw new ydn.db.NotFoundError(n)}var i=this.sync_thread.request(ydn.db.Request.Method.REMOVE_KEYS,t,ydn.db.base.TransactionMode.READ_WRITE);return i.addTxback(function(){this.getCrudExecutor().removeByKeys(i,e)},this),i},ydn.db.crud.DbOperator.prototype.removeInternal=function(e,t){var o=this.sync_thread.request(ydn.db.Request.Method.REMOVE,[e],ydn.db.base.TransactionMode.READ_WRITE);return o.addTxback(function(){this.getCrudExecutor().removeByKeyRange(o,e,t||null)},this),o},ydn.db.crud.DbOperator.prototype.listInternal=function(e,t,o,r,n,i){n=n||ydn.db.base.DEFAULT_RESULT_LIMIT;var s,a=i||0;if(goog.DEBUG){var g=this.schema.getStore(e);if(!g)throw new ydn.db.NotFoundError(e);if(t&&!g.hasIndex(t))throw new ydn.db.NotFoundError('index "'+t+'" in store "'+e+'"')}var d=ydn.db.KeyRange.parseIDBKeyRange(o);if(goog.isString(t)){var u=t;s=this.sync_thread.request(ydn.db.Request.Method.VALUES_INDEX,[e]),s.addTxback(function(){this.getCrudExecutor().list(s,ydn.db.base.QueryMethod.LIST_VALUE,e,u,d,n,a,r,!1)},this)}else s=this.sync_thread.request(ydn.db.Request.Method.VALUES,[e]),s.addTxback(function(){this.getCrudExecutor().list(s,ydn.db.base.QueryMethod.LIST_VALUE,e,null,d,n,a,r,!1)},this);return s},ydn.db.crud.DbOperator.prototype.valuesInternal=function(e){var t=[],o=e.length;if(0==o)return ydn.db.Request.succeed(ydn.db.Request.Method.KEYS,[]);for(var r=0;o>r;r++){var n=e[r].getStoreName();if(-1==goog.array.indexOf(t,n)&&t.push(n),goog.DEBUG&&!this.schema.hasStore(n))throw new ydn.db.NotFoundError(n)}var i=this,s=this.sync_thread.request(ydn.db.Request.Method.KEYS,t);return s.addTxback(function(){i.getCrudExecutor().listByKeys(s,e)},this),s},ydn.db.crud.DbOperator.prototype.countInternal=function(e,t){var o=t?this.tx_thread:this.sync_thread,r=o.request(ydn.db.Request.Method.COUNT,e);return r.addTxback(function(){this.getCrudExecutor().countStores(r,e)},this),r},ydn.db.crud.DbOperator.prototype.keysInternal=function(e,t,o,r,n,i,s){var a;if(r=r||ydn.db.base.DEFAULT_RESULT_LIMIT,goog.DEBUG){var g=this.schema.getStore(e);if(!g)throw new ydn.db.NotFoundError(e);if(t&&!g.hasIndex(t))throw new ydn.db.NotFoundError('index "'+t+'" in store "'+e+'"')}if(goog.isString(t)){var d=t;a=this.sync_thread.request(ydn.db.Request.Method.KEYS_INDEX,[e]),a.addTxback(function(){this.getCrudExecutor().list(a,ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,e,d,o,r,n,i,s)},this)
}else a=this.sync_thread.request(ydn.db.Request.Method.KEYS,[e]),a.addTxback(function(){this.getCrudExecutor().list(a,ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,e,null,o,r,n,i,s)},this);return a},ydn.db.crud.DbOperator.prototype.clear=function(e,t,o){if(goog.DEBUG&&goog.isDef(o))throw new ydn.debug.error.ArgumentException("too many input arguments");var r;if(goog.isString(e)){var n=e,i=this.schema.getStore(n);if(!i)throw new ydn.debug.error.ArgumentException('store name "'+n+'" not found.');if(goog.isObject(t)){var s=ydn.db.KeyRange.parseIDBKeyRange(t);if(goog.isNull(s))throw new ydn.debug.error.ArgumentException("clear method requires a valid non-null KeyRange object.");this.logger.finer("clearByKeyRange: "+n+":"+ydn.json.stringify(s)),r=this.tx_thread.request(ydn.db.Request.Method.CLEAR,[n],ydn.db.base.TransactionMode.READ_WRITE),i.hook(r,[n,s]),r.addTxback(function(){this.getCrudExecutor().clearByKeyRange(r,n,s)},this)}else{if(goog.isDef(t))throw new ydn.debug.error.ArgumentException("clear method requires a valid KeyRange object as second argument, but found "+t+" of type "+typeof t);this.logger.finer("clearByStore: "+n),r=this.tx_thread.request(ydn.db.Request.Method.CLEAR,[n],ydn.db.base.TransactionMode.READ_WRITE),r.addTxback(function(){this.getCrudExecutor().clearByStores(r,[n])},this)}}else{if(!(!goog.isDef(e)||goog.isArray(e)&&goog.isString(e[0])))throw new ydn.debug.error.ArgumentException('first argument "'+e+'" is invalid.');var a=e||this.schema.getStoreNames();this.logger.finer("clearByStores: "+ydn.json.stringify(a)),r=this.tx_thread.request(ydn.db.Request.Method.CLEAR,a,ydn.db.base.TransactionMode.READ_WRITE),r.addTxback(function(){this.getCrudExecutor().clearByStores(r,a)},this)}return r},ydn.db.crud.DbOperator.prototype.remove=function(e,t,o){var r;if(goog.isString(e)){var n=e,i=this.schema.getStore(n);if(!i)throw new ydn.debug.error.ArgumentException('store name "'+n+'" not found.');if(goog.isDef(o)){if(!goog.isString(t))throw new ydn.debug.error.ArgumentException('index name "'+t+'" must be a string, but '+typeof t+" found.");var s=i.getIndex(t);if(!s)throw new ydn.debug.error.ArgumentException("index: "+t+" not found in "+n);if(!goog.isObject(o)&&!goog.isNull(o))throw new ydn.debug.error.ArgumentException("key range "+o+' is invalid type "'+typeof o+'".');var a=ydn.db.KeyRange.parseIDBKeyRange(o);this.logger.finer("removeByIndexKeyRange: "+n+":"+s.getName()+" "+n),r=this.tx_thread.request(ydn.db.Request.Method.REMOVE_INDEX,[n],ydn.db.base.TransactionMode.READ_WRITE),r.addTxback(function(){this.getCrudExecutor().removeByIndexKeyRange(r,n,s.getName(),a)},this)}else if(goog.isString(t)||goog.isNumber(t)||goog.isArrayLike(t)||t instanceof Date){var g=t;this.logger.finer("removeById: "+n+":"+g),r=this.tx_thread.request(ydn.db.Request.Method.REMOVE_ID,[n],ydn.db.base.TransactionMode.READ_WRITE);var d=[n,g];i.hook(r,d),r.addTxback(function(){this.getCrudExecutor().removeById(r,n,d[1])},this),i.dispatch_events&&r.addCallback(function(e){var t=new ydn.db.events.RecordEvent(ydn.db.events.Types.DELETED,this.getStorage(),n,e,void 0);this.getStorage().dispatchDbEvent(t)},this)}else{if(!goog.isObject(t))throw new ydn.debug.error.ArgumentException('Invalid key or key range "'+t+'" of type '+typeof t);var a=ydn.db.KeyRange.parseIDBKeyRange(t);this.logger.finer("removeByKeyRange: "+n+":"+ydn.json.stringify(a)),r=this.tx_thread.request(ydn.db.Request.Method.REMOVE,[n],ydn.db.base.TransactionMode.READ_WRITE),i.hook(r,[n,a]),r.addTxback(function(){this.getCrudExecutor().removeByKeyRange(r,n,a)},this),i.dispatch_events&&r.addCallback(function(e){var t=new ydn.db.events.StoreEvent(ydn.db.events.Types.DELETED,this.getStorage(),n,e,void 0);this.getStorage().dispatchDbEvent(t)},this)}}else if(e instanceof ydn.db.Key){var u=e,l=u.getStoreName(),i=this.schema.getStore(l);goog.asserts.assert(i,'store "'+l+'" not found.'),r=this.tx_thread.request(ydn.db.Request.Method.REMOVE_ID,[l],ydn.db.base.TransactionMode.READ_WRITE);var c=[l,u.getId()];i.hook(r,c),r.addTxback(function(){this.getCrudExecutor().removeById(r,l,c[1])},this)}else{if(!goog.isArray(e))throw new ydn.debug.error.ArgumentException('first argument requires store name, key (ydn.db.Key) or list of keys (array) , but "'+ydn.json.toShortString(e)+'" ('+goog.typeOf(e)+") found.");for(var h=e,p=[],f=0,y=h.length;y>f;f++){if(goog.DEBUG&&!(h[f]instanceof ydn.db.Key))throw new ydn.debug.error.ArgumentException("key list element at "+f+" of "+y+' must be yn.db.Key, but "'+ydn.json.toShortString(e[f])+'" ('+goog.typeOf(e[f])+") is not ydn.db.Key.");var b=h[f].getStoreName();-1==goog.array.indexOf(p,b)&&p.push(b)}if(p.length<1)throw new ydn.debug.error.ArgumentException('at least one valid key required in key list "'+ydn.json.toShortString(e)+'"');r=this.tx_thread.request(ydn.db.Request.Method.REMOVE_KEYS,p,ydn.db.base.TransactionMode.READ_WRITE),r.addTxback(function(){this.getCrudExecutor().removeByKeys(r,h)},this)}return r},goog.DEBUG&&(ydn.db.crud.DbOperator.prototype.toString=function(){var e="DbOperator:"+this.getStorage().getName();return e}),goog.provide("ydn.db.core.DbOperator"),goog.require("ydn.db.Iterator"),goog.require("ydn.db.algo.AbstractSolver"),goog.require("ydn.db.core.IOperator"),goog.require("ydn.db.core.req.IRequestExecutor"),goog.require("ydn.db.crud.DbOperator"),goog.require("ydn.debug.error.ArgumentException"),ydn.db.core.DbOperator=function(e,t,o,r){goog.base(this,e,t,o,r)},goog.inherits(ydn.db.core.DbOperator,ydn.db.crud.DbOperator),ydn.db.core.DbOperator.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.DbOperator"),ydn.db.core.DbOperator.DEBUG=!1,ydn.db.core.DbOperator.prototype.get=function(e,t){if(e instanceof ydn.db.Iterator){var o=e,r=o.getStoreName(),n=this.schema.getStore(r);if(!n)throw new ydn.debug.error.ArgumentException('store "'+r+'" not found.');var i=o.getIndexName();if(goog.isDef(i)&&!n.hasIndex(i))throw new ydn.debug.error.ArgumentException('index "'+i+'" not found in store "'+r+'".');this.logger.finer("getByIterator:"+o);var s=this.tx_thread.request(ydn.db.Request.Method.GET_ITER,[r]);return s.addTxback(function(){this.iterate(ydn.db.base.QueryMethod.GET,s,o,1)},this),s}return goog.base(this,"get",e,t)},ydn.db.core.DbOperator.prototype.keys=function(e,t,o,r,n,i,s){if(e instanceof ydn.db.Iterator){var a=ydn.db.base.DEFAULT_RESULT_LIMIT;if(goog.isNumber(t)){if(a=t,1>a)throw new ydn.debug.error.ArgumentException("limit must be a positive value, but "+t)}else if(goog.isDef(t))throw new ydn.debug.error.ArgumentException("limit must be a number,  but "+t);if(goog.isDef(o))throw new ydn.debug.error.ArgumentException("offset must not be specified");var g=e;this.logger.finer("keysByIterator:"+g);var d=this.tx_thread.request(ydn.db.Request.Method.KEYS_ITER,g.stores());return d.addTxback(function(){g.isIndexIterator()?this.iterate(ydn.db.base.QueryMethod.LIST_KEY,d,g,a):this.iterate(ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,d,g,a)},this),d}return goog.base(this,"keys",e,t,o,r,n,i,s)},ydn.db.core.DbOperator.prototype.count=function(e,t,o){if(e instanceof ydn.db.Iterator){if(goog.isDef(t)||goog.isDef(o))throw new ydn.debug.error.ArgumentException("too many arguments.");var r=e;this.logger.finer("countIterator:"+r);var n=this.tx_thread.request(ydn.db.Request.Method.COUNT,r.stores());return n.addTxback(function(){this.iterate(ydn.db.base.QueryMethod.COUNT,n,r)},this),n}return goog.base(this,"count",e,t,o)},ydn.db.core.DbOperator.prototype.values=function(e,t,o,r,n,i){if(e instanceof ydn.db.Iterator){var s;if(goog.isNumber(t)){if(s=t,1>s)throw new ydn.debug.error.ArgumentException("limit must be a positive value, but "+s)}else if(goog.isDef(t))throw new ydn.debug.error.ArgumentException("limit must be a number, but "+t);if(goog.isDef(o))throw new ydn.debug.error.ArgumentException("offset must not be specified");var a=e;this.logger.finer("listByIterator:"+a);var g=this.tx_thread.request(ydn.db.Request.Method.VALUES_ITER,a.stores());return g.addTxback(function(){a.isKeyIterator()?this.iterate(ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,g,a,s):this.iterate(ydn.db.base.QueryMethod.LIST_VALUE,g,a,s)},this),g}return goog.base(this,"values",e,t,o,r,n,i)},ydn.db.core.DbOperator.prototype.scan=function(e,t){if(goog.DEBUG&&goog.isDef(t)){if(!goog.isArray(t))throw new ydn.debug.error.ArgumentException("Iterator argument must be an array.");for(var o=0;o<t.length;o++){var r=t[o]instanceof ydn.db.Iterator;if(!r)throw new ydn.debug.error.ArgumentException("Iterator at "+o+" must be cursor range iterator.")}}var n;if(t)n=t;else{var i=e.getIterators();goog.asserts.assertArray(i,"array of iterators required."),n=i}for(var s=ydn.db.base.TransactionMode.READ_ONLY,a=[],o=0;o<n.length;o++)for(var g=n[o].stores(),d=0;d<g.length;d++)goog.array.contains(a,g[d])||a.push(g[d]);this.logger.finest(this+": scan for "+n.length+" iterators on "+a);var u=this,l=this.tx_thread.request(ydn.db.Request.Method.SCAN,a);return this.tx_thread.exec(l,function(t,o,r){var i=o+" "+u+" scanning";u.logger.finest(i);var s,a=!1,g=[],d=[],l=[],c=[],h=function(){for(var e=0;e<c.length;e++)c[e].exit();a=!0,goog.array.clear(c),u.logger.finer("success "+i),r(void 0)},p=0,f=function(){var t;t=e instanceof ydn.db.algo.AbstractSolver?e.solver(d,l):e(d,l),ydn.db.core.DbOperator.DEBUG&&window.console.log(u+" received result from solver "+ydn.json.stringify(t)+" for keys "+ydn.json.stringify(d));var o=[],r=[],i=[],s=[];if(goog.isArray(t))for(var a=0;a<t.length;a++)t[a]===!0?i[a]=1:t[a]===!1?s[a]=!0:r[a]=t[a];else if(goog.isNull(t))o=[];else if(goog.isDef(t)){if(!goog.isObject(t))throw new ydn.debug.error.InvalidOperationException("scan callback output");if(goog.DEBUG){var f=["advance","continue","continuePrimary","restart"];for(var y in t)if(!goog.array.contains(f,y))throw new ydn.debug.error.InvalidOperationException('Unknown attribute "'+y+'" in cursor advancement object')}o=t.continuePrimary||[],r=t["continue"]||[],i=t.advance||[],s=t.restart||[]}else{o=[];for(var a=0;a<n.length;a++)goog.isDef(g[a])&&(i[a]=1)}var b=0;p=0;for(var a=0;a<n.length;a++)goog.isDefAndNotNull(o[a])||goog.isDef(r[a])||goog.isDefAndNotNull(s[a])||goog.isDefAndNotNull(i[a])||p++;for(var a=0;a<n.length;a++)if(goog.isDefAndNotNull(o[a])||goog.isDef(r[a])||goog.isDefAndNotNull(s[a])||goog.isDefAndNotNull(i[a])){var m=g[a];if(!goog.isDef(m))throw new ydn.error.InvalidOperationException(a+" is not an iterator.");var v=n[m],_=c[a];if(goog.DEBUG&&!goog.isDefAndNotNull(d[a])){var E=a+"/"+n.length;if(goog.isDefAndNotNull(i[a]))throw new ydn.error.InvalidOperationError(_+" "+E+" must not advance "+i[a]+" steps");if(goog.isDef(r[a]))throw new ydn.error.InvalidOperationError(_+" "+E+" must not continue to key "+r[a]);if(goog.isDefAndNotNull(o[a]))throw new ydn.error.InvalidOperationError(_+" "+E+" must not continue to primary key "+o[a])}if(d[a]=void 0,l[a]=void 0,goog.isDefAndNotNull(s[a]))ydn.db.core.DbOperator.DEBUG&&window.console.log("cursor "+_+" of iterator "+v+": restarting."),goog.asserts.assert(s[a]===!0,a+" restart must be true"),_.restart();else if(goog.isDef(r[a]))ydn.db.core.DbOperator.DEBUG&&window.console.log(v+": continuing to "+r[a]),_.continueEffectiveKey(r[a]);else if(goog.isDefAndNotNull(o[a]))ydn.db.core.DbOperator.DEBUG&&window.console.log(_+": continuing to primary key "+o[a]),_.continuePrimaryKey(o[a]);else{if(!goog.isDefAndNotNull(i[a]))throw new ydn.error.InternalError(v+": has no action");ydn.db.core.DbOperator.DEBUG&&window.console.log(v+": advancing "+i[a]+" steps."),goog.asserts.assert(1===i[a],a+" advance value must be 1"),_.advance(1)}b++}0==b&&h()},y=function(e,t){if(a)throw ydn.db.core.DbOperator.DEBUG&&window.console.log("iterator "+e+" done"),new ydn.error.InternalError;p++;var o=p===s,r=g[e],i=n[r],u=c[r],h=u.getPrimaryKey(),y=u.getValue();if(ydn.db.core.DbOperator.DEBUG){var b=t+(goog.isDefAndNotNull(h)?", "+h:""),m=o?" (all result done)":"";window.console.log(u+" new position "+b+m)}d[e]=t,l[e]=i.isIndexIterator()?i.isKeyIterator()?h:y:i.isKeyIterator()?t:y,o&&f()},b=function(e){for(var t=0;t<c.length;t++)c[t].exit();goog.array.clear(c),u.logger.finer(i+" error"),r(e,!0)},m=function(){for(var e=0,r=0;r<n.length;r++){for(var i=n[r],a=i.stores(),d=[],l=0;l<a.length;l++)d[l]=u.getIndexExecutor().getCursor(t,o,a[l]);var h=i.load(d);h.onFail=b,h.onNext=goog.partial(y,e),c[r]=h,g[e]=r,e++}s=n.length};if(e instanceof ydn.db.algo.AbstractSolver){var v=e.begin(n,function(){m()});v||m()}else m()},a,s),l},ydn.db.core.DbOperator.prototype.getIndexExecutor=function(){return this.getExecutor()},ydn.db.core.DbOperator.prototype.open=function(e,t,o,r){if(goog.DEBUG&&!(t instanceof ydn.db.Iterator))throw new ydn.debug.error.ArgumentException("Second argument must be cursor range iterator.");var n=this.schema.getStore(t.getStoreName());if(!n)throw new ydn.debug.error.ArgumentException('Store "'+t.getStoreName()+'" not found.');var i=o||ydn.db.base.TransactionMode.READ_ONLY,s=this,a=this.tx_thread.request(ydn.db.Request.Method.OPEN,t.stores(),i);return this.logger.finer("open:"+i+" "+t),a.addTxback(function(o){var n=a.getLabel(),i=n+" iterating "+t;s.logger.finer(i);for(var g=t.stores(),d=[],u=0;u<g.length;u++)d[u]=s.getIndexExecutor().getCursor(o,n,g[u]);var l=t.load(d);l.onFail=function(e){a.setDbValue(e,!0)},l.onNext=function(t){if(goog.isDefAndNotNull(t)){var o=e.call(r,l);o===!0?l.restart():goog.isObject(o)?o.restart===!0?l.restart(o["continue"],o.continuePrimary):goog.isDefAndNotNull(o["continue"])?l.continueEffectiveKey(o["continue"]):goog.isDefAndNotNull(o.continuePrimary)?l.continuePrimaryKey(o.continuePrimary):(l.exit(),a.setDbValue(void 0)):l.advance(1)}else l.exit(),a.setDbValue(void 0)}},this),a},ydn.db.core.DbOperator.prototype.map=function(e,t){for(var o,r=this,n=e.stores(),i=0;o=n[i];i++)if(!o)throw new ydn.debug.error.ArgumentException('Store "'+o+'" not found.');var s=this.tx_thread.request(ydn.db.Request.Method.MAP,n);return this.logger.finest("map:"+e),this.tx_thread.exec(s,function(o,n,i){var s=n+" iterating "+e;r.logger.finest(s);for(var a=e.stores(),g=[],d=0;d<a.length;d++)g[d]=r.getIndexExecutor().getCursor(o,n,a[d]);var u=e.load(g);u.onFail=function(e){i(e,!1)},u.onNext=function(o){if(goog.isDefAndNotNull(o)){var r,n=o;r=e.isIndexIterator()?e.isKeyIterator()?n:u.getPrimaryKey():e.isKeyIterator()?n:u.getValue(),t(r),u.advance(1)}else i(void 0),t=null}},n,ydn.db.base.TransactionMode.READ_ONLY),s},ydn.db.core.DbOperator.prototype.reduce=function(e,t,o){for(var r,n=this,i=e.stores(),s=0;r=i[s];s++)if(!r)throw new ydn.debug.error.ArgumentException('Store "'+r+'" not found.');var a=this.tx_thread.request(ydn.db.Request.Method.REDUCE,i),g=goog.isObject(o)?ydn.object.clone(o):o;return this.logger.finer("reduce:"+e),this.tx_thread.exec(a,function(o,r,i){for(var s=e.stores(),a=[],d=0;d<s.length;d++)a[d]=n.getIndexExecutor().getCursor(o,r,s[d]);var u=e.load(a);u.onFail=function(e){i(e,!0)};var l=0;u.onNext=function(o){if(goog.isDefAndNotNull(o)){var r;r=e.isIndexIterator()?e.isKeyIterator()?o:u.getPrimaryKey():e.isKeyIterator()?o:u.getValue(),g=t(g,r,l++),u.advance(1)}else i(g)}},i,ydn.db.base.TransactionMode.READ_ONLY),a},ydn.db.core.DbOperator.prototype.listIter=function(e,t,o,r){var n=r||0,i=t.getStoreName(),s=t.getIndexName()||null,a=o||ydn.db.base.DEFAULT_RESULT_LIMIT;this.logger.finer("listIter:"+e+" "+t+(o?" limit="+a:"")+(r?" offset="+n:""));var g=ydn.db.Request.Method.VALUES_INDEX,d=this.tx_thread.request(g,[i]),u=t.getState()==ydn.db.Iterator.State.COMPLETED||t.getState()==ydn.db.Iterator.State.INITIAL?[]:[t.getKey(),t.getPrimaryKey()];return d.addTxback(function(){t.getKey();this.getCrudExecutor().list(d,e,i,s,t.getKeyRange(),a,n,t.isReversed(),t.isUnique(),u)},this),d.addCallback(function(){goog.isDefAndNotNull(u[0])?t.reset(ydn.db.Iterator.State.RESTING,u[0],u[1]):t.reset()}),d},ydn.db.core.DbOperator.prototype.iterate=function(e,t,o,r,n){var i=[],s=t.getTx(),a=t.getLabel(),g=a+" "+e+"ByIterator "+o;r>0&&(g+=" limit "+r);var d=this;this.logger.finer(g);for(var u=this.getIndexExecutor(),l=[],c=o.stores(),h=0;h<c.length;h++)l[h]=u.getCursor(s,a,c[h]);var p=o.load(l);p.onFail=function(e){p.exit(),t.setDbValue(e,!0)};var f=0,y=!1,b=!1;p.onNext=function(o){if(b||(d.logger.finest(g+" starting"),b=!0),goog.isDefAndNotNull(o)){{p.getPrimaryKey()}if(!y&&n>0)return p.advance(n),y=!0,void 0;f++,e==ydn.db.base.QueryMethod.LIST_KEY?i.push(o):e==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?i.push(p.getPrimaryKey()):e==ydn.db.base.QueryMethod.LIST_KEYS?i.push([o,p.getPrimaryKey()]):e==ydn.db.base.QueryMethod.COUNT||i.push(p.getValue()),e==ydn.db.base.QueryMethod.GET?(p.exit(),t.setDbValue(i[0])):e==ydn.db.base.QueryMethod.COUNT||!goog.isDef(r)||r>f?p.continueEffectiveKey():(d.logger.finer("success:"+g+" yields "+i.length+" records"),p.exit(),t.setDbValue(i))}else{d.logger.finer("success:"+g+" yields "+i.length+" records"),p.exit();var s=e==ydn.db.base.QueryMethod.GET?i[0]:e==ydn.db.base.QueryMethod.COUNT?f:i;t.setDbValue(s)}}},goog.provide("goog.events.Event"),goog.provide("goog.events.EventLike"),goog.require("goog.Disposable"),goog.events.EventLike,goog.events.Event=function(e,t){this.type=e,this.target=t,this.currentTarget=this.target},goog.events.Event.prototype.disposeInternal=function(){},goog.events.Event.prototype.dispose=function(){},goog.events.Event.prototype.propagationStopped_=!1,goog.events.Event.prototype.defaultPrevented=!1,goog.events.Event.prototype.returnValue_=!0,goog.events.Event.prototype.stopPropagation=function(){this.propagationStopped_=!0},goog.events.Event.prototype.preventDefault=function(){this.defaultPrevented=!0,this.returnValue_=!1},goog.events.Event.stopPropagation=function(e){e.stopPropagation()},goog.events.Event.preventDefault=function(e){e.preventDefault()},goog.provide("ydn.db.events.RecordEvent"),goog.provide("ydn.db.events.StorageEvent"),goog.provide("ydn.db.events.StoreEvent"),goog.provide("ydn.db.events.Types"),goog.require("goog.events.Event"),ydn.db.events.Types={READY:"ready",ERROR:"error",FAIL:"fail",CREATED:"created",DELETED:"deleted",UPDATED:"updated"},ydn.db.events.Event=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.events.Event,goog.events.Event),ydn.db.events.Event.prototype.store_name,ydn.db.events.Event.prototype.getStoreName=function(){return this.store_name},ydn.db.events.StorageEvent=function(e,t,o,r,n){goog.base(this,e,t),this.version=o,this.oldVersion=r,this.old_schema_=n},goog.inherits(ydn.db.events.StorageEvent,ydn.db.events.Event),ydn.db.events.StorageEvent.prototype.name="ReadyEvent",ydn.db.events.StorageEvent.prototype.version=0/0,ydn.db.events.StorageEvent.prototype.oldVersion=0/0,ydn.db.events.StorageEvent.prototype.old_schema_=null,ydn.db.events.StorageEvent.prototype.getVersion=function(){return this.version},ydn.db.events.StorageEvent.prototype.getOldVersion=function(){return this.oldVersion},ydn.db.events.StorageEvent.prototype.getOldSchema=function(){return this.old_schema_},ydn.db.events.StorageErrorEvent=function(e,t,o){var r=o||ydn.db.events.Types.ERROR;goog.base(this,r,e),this.error=t},goog.inherits(ydn.db.events.StorageErrorEvent,ydn.db.events.Event),ydn.db.events.StorageErrorEvent.prototype.toString=function(){return this.name+":"+(this.error?this.error:"")},ydn.db.events.StorageErrorEvent.prototype.name="ErrorEvent",ydn.db.events.StorageErrorEvent.prototype.error=null,ydn.db.events.StorageErrorEvent.prototype.getError=function(){return this.error},ydn.db.events.StorageFailEvent=function(e,t){goog.base(this,e,t,ydn.db.events.Types.FAIL)},goog.inherits(ydn.db.events.StorageFailEvent,ydn.db.events.StorageErrorEvent),ydn.db.events.StorageFailEvent.prototype.name="FailEvent",ydn.db.events.RecordEvent=function(e,t,o,r,n){goog.base(this,e,t),this.store_name=o,this.key=r,this.value=n},goog.inherits(ydn.db.events.RecordEvent,ydn.db.events.Event),ydn.db.events.RecordEvent.prototype.name="RecordEvent",ydn.db.events.RecordEvent.prototype.key,ydn.db.events.RecordEvent.prototype.value,ydn.db.events.RecordEvent.prototype.getKey=function(){return this.key},ydn.db.events.RecordEvent.prototype.getValue=function(){return this.value},ydn.db.events.StoreEvent=function(e,t,o,r,n){goog.base(this,e,t),this.store_name=o,this.keys=r,this.values=n},goog.inherits(ydn.db.events.StoreEvent,ydn.db.events.Event),ydn.db.events.StoreEvent.prototype.name="StoreEvent",ydn.db.events.StoreEvent.prototype.keys,ydn.db.events.StoreEvent.prototype.values,ydn.db.events.StoreEvent.prototype.getKeys=function(){return this.keys},ydn.db.events.StoreEvent.prototype.getValues=function(){return this.values},goog.provide("ydn.db.con.IDatabase"),goog.require("goog.async.Deferred"),ydn.db.con.IDatabase=function(){},ydn.db.con.IDatabase.prototype.close=function(){},ydn.db.con.IDatabase.prototype.getType=function(){},ydn.db.con.IDatabase.prototype.isReady=function(){},ydn.db.con.IDatabase.prototype.connect=function(){},ydn.db.con.IDatabase.prototype.getVersion=goog.abstractMethod,ydn.db.con.IDatabase.prototype.getDbInstance=function(){},ydn.db.con.IDatabase.prototype.doTransaction=goog.abstractMethod,ydn.db.con.IDatabase.prototype.getSchema=goog.abstractMethod,ydn.db.con.IDatabase.prototype.onFail=goog.abstractMethod,ydn.db.con.IDatabase.prototype.onError=goog.abstractMethod,ydn.db.con.IDatabase.prototype.onVersionChange=goog.abstractMethod,goog.provide("ydn.db.schema.DataType"),goog.provide("ydn.db.schema.Index"),goog.require("ydn.db.base"),goog.require("ydn.db.utils"),goog.require("ydn.debug.error.ArgumentException"),ydn.db.schema.Index=function(e,t,o,r,n,i){if(goog.isDef(n)||(n=goog.isArray(e)?e.join(", "):e),goog.isDefAndNotNull(e)&&!goog.isString(e)&&!goog.isArrayLike(e))throw new ydn.debug.error.ArgumentException("index keyPath for "+n+" must be a string or array, but "+e+" is "+typeof e);if(goog.DEBUG&&goog.isArray(e)&&Object.freeze&&Object.freeze(e),!goog.isDef(e)&&goog.isDef(n)&&(e=n),this.keyPath=e,this.is_composite_=goog.isArrayLike(this.keyPath),this.index_name_=n,this.type=ydn.db.schema.Index.toType(t),goog.isDef(t)){if(!goog.isDef(this.type))throw new ydn.debug.error.ArgumentException("type invalid in index: "+this.index_name_);if(goog.isArray(this.keyPath))throw new ydn.debug.error.ArgumentException('composite key for store "'+this.index_name_+'" must not specified type')}this.unique=!!o,this.multiEntry=!!r,this.keyColumnType_=goog.isString(this.type)?this.type:ydn.db.schema.DataType.TEXT,this.index_column_name_=goog.isString(n)?n:goog.isArray(e)?this.keyPath.join(","):e,this.index_column_name_quoted_=goog.string.quote(this.index_column_name_),this.key_paths_=this.is_composite_||this.multiEntry?null:this.keyPath.split("."),goog.asserts.assert(!goog.isDefAndNotNull(i)||goog.isFunction(i),"index generator must be a function, , but "+typeof i+" found."),this.index_generator_=i||null},ydn.db.schema.Index.prototype.extractKey=function(e){if(goog.isDefAndNotNull(e)){if(goog.isArrayLike(this.keyPath)){for(var t=[],o=0,r=this.keyPath.length;r>o;o++){var n=ydn.db.utils.getValueByKeys(e,this.keyPath[o]);goog.asserts.assert(goog.isDefAndNotNull(n),ydn.json.toShortString(e)+" does not issue require composite key value "+o+" of "+r+' on index "'+this.index_name_+'"'),t[o]=n}return t}return ydn.db.utils.getValueByKeys(e,this.keyPath)}},ydn.db.schema.Index.prototype.applyValue=function(e,t){for(var o=0;o<this.key_paths_.length;o++)o==this.key_paths_.length-1?e[this.key_paths_[o]]=t:goog.isObject(e[this.key_paths_[o]])||(e[this.key_paths_[o]]={})},ydn.db.schema.Index.prototype.keyColumnType_,ydn.db.schema.Index.prototype.keyPath,ydn.db.schema.Index.prototype.key_paths_,ydn.db.schema.Index.prototype.multiEntry,ydn.db.schema.Index.prototype.is_composite_,ydn.db.schema.Index.prototype.unique,ydn.db.schema.DataType={BLOB:"BLOB",DATE:"DATE",INTEGER:"INTEGER",NUMERIC:"NUMERIC",TEXT:"TEXT"},ydn.db.DataTypeAbbr={DATE:"d",NUMERIC:"n",TEXT:"t",BLOB:"b"},ydn.db.schema.Index.ARRAY_SEP=String.fromCharCode(31),ydn.db.schema.Index.js2sql=function(e,t){return t!=ydn.db.schema.DataType.DATE?goog.isDefAndNotNull(t)?e:ydn.db.utils.encodeKey(e):e instanceof Date?+e:void 0},ydn.db.schema.Index.sql2js=function(e,t){return t==ydn.db.schema.DataType.DATE?new Date(e):goog.isDef(t)?e:ydn.db.utils.decodeKey(e)},ydn.db.schema.Index.TYPES=[ydn.db.schema.DataType.BLOB,ydn.db.schema.DataType.DATE,ydn.db.schema.DataType.INTEGER,ydn.db.schema.DataType.NUMERIC,ydn.db.schema.DataType.TEXT],ydn.db.schema.Index.toType=function(e){if(goog.isString(e)){var t=goog.array.indexOf(ydn.db.schema.Index.TYPES,e);return ydn.db.schema.Index.TYPES[t]}return void 0},ydn.db.schema.Index.toAbbrType=function(e){return e instanceof Date?ydn.db.DataTypeAbbr.DATE:goog.isNumber(e)?ydn.db.DataTypeAbbr.NUMERIC:goog.isString(e)?ydn.db.DataTypeAbbr.TEXT:ydn.db.DataTypeAbbr.BLOB},ydn.db.schema.Index.type2AbbrType=function(e){return e===ydn.db.schema.DataType.DATE?ydn.db.DataTypeAbbr.DATE:e===ydn.db.schema.DataType.NUMERIC?ydn.db.DataTypeAbbr.NUMERIC:e===ydn.db.schema.DataType.TEXT?ydn.db.DataTypeAbbr.TEXT:ydn.db.DataTypeAbbr.BLOB},ydn.db.schema.Index.prototype.getType=function(){return this.type},ydn.db.schema.Index.prototype.getSqlType=function(){return this.keyColumnType_},ydn.db.schema.Index.prototype.getName=function(){return this.index_name_},ydn.db.schema.Index.prototype.isMultiEntry=function(){return this.multiEntry},ydn.db.schema.Index.prototype.isComposite=function(){return this.is_composite_},ydn.db.schema.Index.prototype.isUnique=function(){return this.unique},ydn.db.schema.Index.prototype.toJSON=function(){return{name:this.index_name_,keyPath:this.keyPath,type:this.type,unique:this.unique,multiEntry:this.multiEntry}},ydn.db.schema.Index.prototype.clone=function(){var e=goog.isArray(this.keyPath)?goog.array.clone(this.keyPath):this.keyPath;return new ydn.db.schema.Index(e,this.type,this.unique,this.multiEntry,this.index_name_,this.index_generator_)},ydn.db.schema.Index.compareKeyPath=function(e,t){return goog.isDefAndNotNull(e)||goog.isDefAndNotNull(t)?goog.isDefAndNotNull(e)?goog.isDefAndNotNull(t)?goog.isArrayLike(e)&&goog.isArrayLike(t)?goog.array.equals(e,t)?null:"expect: "+e+", but: "+t:ydn.object.equals(e,t)?null:"expect: "+e+", but: "+t:"keyPath: "+e+" no longer defined":"newly define "+t:null},ydn.db.schema.Index.prototype.equalsKeyPath=function(e){return!ydn.db.schema.Index.compareKeyPath(this.keyPath,e)},ydn.db.schema.Index.prototype.difference=function(e){if(!e)return"no index for "+this.index_name_;if(this.index_name_!=e.index_name_)return"name, expect: "+this.index_name_+", but: "+e.index_name_;var t=ydn.db.schema.Index.compareKeyPath(this.keyPath,e.keyPath);return t?"keyPath, "+t:goog.isDefAndNotNull(this.unique)&&goog.isDefAndNotNull(e.unique)&&this.unique!=e.unique?"unique, expect: "+this.unique+", but: "+e.unique:goog.isDefAndNotNull(this.multiEntry)&&goog.isDefAndNotNull(e.multiEntry)&&this.multiEntry!=e.multiEntry?"multiEntry, expect: "+this.multiEntry+", but: "+e.multiEntry:goog.isDef(this.type)&&goog.isDef(e.type)&&(goog.isArrayLike(this.type)?!goog.array.equals(this.type,e.type):this.type!=e.type)?"data type, expect: "+this.type+", but: "+e.type:""},ydn.db.schema.Index.prototype.hint=function(e){if(!e)return this;goog.asserts.assert(this.index_name_==e.index_name_,"index name: "+this.index_name_+" != "+e.index_name_);var t=goog.isArray(this.keyPath)?goog.array.clone(this.keyPath):this.keyPath,o=this.type;return goog.isDef(e.type)||"TEXT"!=o||(o=void 0),new ydn.db.schema.Index(t,o,this.unique,this.multiEntry,e.index_name_)},ydn.db.schema.Index.toDir=function(e){var t=goog.array.indexOf(ydn.db.base.DIRECTIONS,e);return ydn.db.base.DIRECTIONS[t]},ydn.db.schema.Index.prototype.getKeyPath=function(){return this.keyPath},ydn.db.schema.Index.prototype.getSQLIndexColumnName=function(){return this.index_column_name_},ydn.db.schema.Index.prototype.getSQLIndexColumnNameQuoted=function(){return this.index_column_name_quoted_},ydn.db.schema.Index.prototype.index_column_name_,ydn.db.schema.Index.prototype.index_column_name_quoted_,ydn.db.schema.Index.prototype.index_generator_,ydn.db.schema.Index.prototype.setGenerator=function(e){goog.asserts.assert(!this.index_generator_,"index "+this.index_name_+" already has a generator"),this.index_generator_=e},ydn.db.schema.Index.prototype.generateIndex=function(e){if(this.index_generator_){var t=this.index_generator_(e),o=typeof t;if("string"==o||"number"==o||"array"==o||"undefined"==o||t instanceof Date){for(var r=0;r<this.key_paths_.length-1;r++)goog.isObject(e[this.key_paths_[r]])||(e[this.key_paths_[r]]={});e[this.key_paths_[this.key_paths_.length-1]]=t}}},ydn.db.schema.Index.fromJSON=function(e){if(goog.DEBUG){var t=["name","unique","type","keyPath","multiEntry","generator"];for(var o in e)if(e.hasOwnProperty(o)&&-1==goog.array.indexOf(t,o))throw new ydn.debug.error.ArgumentException("Unknown field: "+o+" in "+ydn.json.stringify(e))}return new ydn.db.schema.Index(e.keyPath,e.type,e.unique,e.multiEntry,e.name,e.generator)},goog.DEBUG&&(ydn.db.schema.Index.prototype.toString=function(){var e=this.multiEntry?"MultiEntry":"";return this.key_paths_&&this.key_paths_.length>1&&(e+="Compound"),e+"Index:"+this.index_name_}),goog.provide("ydn.db.schema.Store"),goog.require("goog.array.ArrayLike"),goog.require("ydn.db.KeyRange"),goog.require("ydn.db.Request.Method"),goog.require("ydn.db.schema.Index"),ydn.db.schema.Store=function(e,t,o,r,n,i,s,a){if(this.name_=e,!goog.isString(this.name_))throw new ydn.debug.error.ArgumentException("store name must be a string");if(this.keyPath=goog.isDef(t)?t:null,this.isComposite=goog.isArrayLike(this.keyPath),!goog.isNull(this.keyPath)&&!goog.isString(this.keyPath)&&!this.isComposite)throw new ydn.debug.error.ArgumentException("keyPath must be a string or array");this.autoIncrement=o;var g;if(goog.isDefAndNotNull(r)){if(g=ydn.db.schema.Index.toType(r),!goog.isDef(g))throw new ydn.debug.error.ArgumentException('type "'+r+'" for primary key in store "'+this.name_+'" is invalid.');if(this.isComposite)throw new ydn.debug.error.ArgumentException('composite key for store "'+this.name_+'" must not specified type')}if(this.type=goog.isDefAndNotNull(g)?g:this.autoIncrement?ydn.db.schema.DataType.INTEGER:void 0,this.keyPaths=goog.isString(this.keyPath)?this.keyPath.split("."):[],this.indexes=n||[],this.dispatch_events=!!i,this.fixed=!!s,this.keyColumnType_=goog.isString(this.type)?this.type:ydn.db.schema.DataType.TEXT,this.primary_column_name_=goog.isArray(this.keyPath)?this.keyPath.join(","):goog.isString(this.keyPath)?this.keyPath:ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME,this.primary_column_name_quoted_=goog.string.quote(this.primary_column_name_),this.is_encrypted_=!!a,goog.DEBUG&&this.is_encrypted_){if(this.keyPath)throw new ydn.debug.error.ArgumentException('encrypted store "'+this.name_+'" must not use inline key');if(this.isAutoIncrement())throw new ydn.debug.error.ArgumentException('encrypted store "'+this.name_+'" must not use key generator')}this.hooks_=[]},ydn.db.schema.Store.FetchStrategy={LAST_UPDATED:"last-updated",ASCENDING_KEY:"ascending-key",DESCENDING_KEY:"descending-key"},ydn.db.schema.Store.FetchStrategies=[ydn.db.schema.Store.FetchStrategy.LAST_UPDATED,ydn.db.schema.Store.FetchStrategy.ASCENDING_KEY,ydn.db.schema.Store.FetchStrategy.DESCENDING_KEY],ydn.db.schema.Store.prototype.isComposite,ydn.db.schema.Store.prototype.keyPath,ydn.db.schema.Store.prototype.autoIncrement,ydn.db.schema.Store.prototype.type,ydn.db.schema.Store.prototype.keyColumnType_,ydn.db.schema.Store.prototype.keyPaths,ydn.db.schema.Store.prototype.indexes,ydn.db.schema.Store.prototype.dispatch_events=!1,ydn.db.schema.Store.prototype.fixed=!1,ydn.db.schema.Store.prototype.toJSON=function(){for(var e=[],t=0;t<this.indexes.length;t++)e.push(this.indexes[t].toJSON());return{name:this.name_,keyPath:this.keyPath,autoIncrement:this.autoIncrement,type:this.type,indexes:e}},ydn.db.schema.Store.fromJSON=function(e){if(goog.DEBUG){var t=["name","keyPath","autoIncrement","type","indexes","dispatchEvents","fixed","Sync","encrypted"];for(var o in e)if(e.hasOwnProperty(o)&&-1==goog.array.indexOf(t,o))throw new ydn.debug.error.ArgumentException('Unknown attribute "'+o+'"')}var r=[],n=e.indexes||[];if(goog.isArray(n))for(var i=0;i<n.length;i++){var s=ydn.db.schema.Index.fromJSON(n[i]);goog.isDef(s.keyPath)&&s.keyPath===e.keyPath||r.push(s)}var a="undefined"===e.type||"null"===e.type?void 0:e.type;return new ydn.db.schema.Store(e.name,e.keyPath,e.autoIncrement,a,r,e.dispatchEvents,e.fixed,e.encrypted)},ydn.db.schema.Store.prototype.toSql=function(e,t,o,r,n,i){var s=this.inSql(e,t,o,r,n,i),a="";return t!=ydn.db.base.QueryMethod.NONE&&(a+="SELECT "+s.select),a+=" FROM "+s.from,s.where&&(a+=" WHERE "+s.where),s.group&&(a+=" GROUP BY "+s.group),s.order&&(a+=" ORDER BY "+s.order),a},ydn.db.schema.Store.SqlParts,ydn.db.schema.Store.prototype.inSql=function(e,t,o,r,n,i){var s={select:"",from:"",where:"",group:"",order:""},a=this.primary_column_name_,g=this.primary_column_name_quoted_,d=null;
o!==a&&goog.isString(o)&&(d=this.getIndex(o));var u=!!d,l=o||a,c=goog.string.quote(l),h=(u?d.getKeyPath():this.getKeyPath(),u?d.getType():this.getType()),p=u&&d.isMultiEntry();s.from=this.getQuotedName(),t===ydn.db.base.QueryMethod.COUNT?s.select="COUNT("+g+")":t===ydn.db.base.QueryMethod.LIST_KEYS||t===ydn.db.base.QueryMethod.LIST_KEY||t===ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?(s.select=g,goog.isDefAndNotNull(o)&&o!=a&&(s.select+=", "+c)):s.select="*";var f=i?"DISTINCT ":"",y=[];if(p){var b=goog.string.quote(ydn.db.base.PREFIX_MULTIENTRY+this.getName()+":"+d.getName());s.select=t===ydn.db.base.QueryMethod.COUNT?"COUNT("+f+b+"."+c+")":t===ydn.db.base.QueryMethod.LIST_KEYS||t===ydn.db.base.QueryMethod.LIST_KEY||t===ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?"DISTINCT "+this.getQuotedName()+"."+g+", "+b+"."+c+" AS "+l:"DISTINCT "+this.getQuotedName()+".*, "+b+"."+c+" AS "+l,s.from=b+" INNER JOIN "+this.getQuotedName()+" USING ("+g+")";var m=b+"."+c;goog.isDefAndNotNull(r)&&(ydn.db.KeyRange.toSql(m,h,r,y,e),y.length>0&&(s.where?s.where+=" AND "+y.join(" AND "):s.where=y.join(" AND ")))}else goog.isDefAndNotNull(r)&&(ydn.db.KeyRange.toSql(c,h,r,y,e),y.length>0&&(s.where?s.where+=" AND "+y.join(" AND "):s.where=y.join(" AND ")));u&&!d.isUnique()&&i&&(s.group=c);var v=n?"DESC":"ASC";return s.order=c+" "+v,u&&(s.order+=", "+g+" "+v),s},ydn.db.schema.Store.prototype.sqlContinueEffectiveKey=function(e,t,o,r,n,i,s,a){var g,d,u,l;if(goog.isDefAndNotNull(r))if(g=r.lower,d=r.upper,u=r.lowerOpen,l=r.upperOpen,n)if(goog.isDefAndNotNull(d)){var c=ydn.db.cmp(s,d);-1==c?(d=s,l=a):0==c&&(l=a||l)}else d=s,l=a;else if(goog.isDefAndNotNull(g)){var h=ydn.db.cmp(s,g);1==h?(g=s,u=a):0==h&&(u=a||u)}else g=s,u=a;else n?(d=s,l=a):(g=s,u=a);r=new ydn.db.KeyRange(g,d,!!u,!!l);var p=o?this.getIndex(o):null,f=p?p.getSQLIndexColumnName():this.getSQLKeyColumnName(),y=this.inSql(t,e,f,r,n,i),b="SELECT "+y.select+" FROM "+y.from+(y.where?" WHERE "+y.where:"")+(y.group?" GROUP BY "+y.group:"")+" ORDER BY "+y.order;if(p){var m=n?"DESC":"ASC";b+=", "+this.getSQLKeyColumnNameQuoted()+m}return b},ydn.db.schema.Store.prototype.sqlContinueIndexEffectiveKey=function(e,t,o,r,n,i,s,a,g){var d=this.getIndex(o),u=d.getSQLIndexColumnName(),l=d.getSQLIndexColumnNameQuoted(),c=(this.getSQLKeyColumnName(),this.getSQLKeyColumnNameQuoted()),h=a?" <":" >";h+=i?" ":"= ";var p,f=ydn.db.schema.Index.js2sql(n,d.getType()),y=ydn.db.schema.Index.js2sql(s,this.getType()),b="";return r?(p=this.inSql(t,e,u,r,a,g),p.where+=" AND ",b=l+h+"?",t.push(f)):(r=a?ydn.db.KeyRange.upperBound(n,!0):ydn.db.KeyRange.lowerBound(n,!0),p=this.inSql(t,e,u,r,a,g),b=p.where,p.where=""),p.where+="("+b+" OR ("+l+" = ? AND "+c+h+"?))",t.push(f),t.push(y),"SELECT "+p.select+" FROM "+p.from+" WHERE "+p.where+(p.group?" GROUP BY "+p.group:"")+" ORDER BY "+p.order},ydn.db.schema.Store.prototype.clone=function(){return ydn.db.schema.Store.fromJSON(this.toJSON())},ydn.db.schema.Store.prototype.countIndex=function(){return this.indexes.length},ydn.db.schema.Store.prototype.index=function(e){return this.indexes[e]||null},ydn.db.schema.Store.prototype.getIndex=function(e){return goog.array.find(this.indexes,function(t){return t.getName()==e})},ydn.db.schema.Store.prototype.getIndexByKeyPath=function(e){for(var t=0;t<this.indexes.length;t++)if(this.indexes[t].equalsKeyPath(e))return this.indexes[t];return null},ydn.db.schema.Store.prototype.isFixed=function(){return this.fixed},ydn.db.schema.Store.prototype.isEncrypted=function(){return this.is_encrypted_},ydn.db.schema.Store.prototype.hasIndex=function(e){return e===this.keyPath?!0:goog.array.some(this.indexes,function(t){return t.getName()==e})},ydn.db.schema.Store.prototype.isKeyPath=function(e){return goog.isDef(this.keyPath)?1==this.keyPaths.length?this.keyPath===e:goog.isArrayLike(e)?goog.array.equals(this.keyPaths,e):!1:!1},ydn.db.schema.Store.prototype.hasIndexByKeyPath=function(e){return this.keyPath&&goog.isNull(ydn.db.schema.Index.compareKeyPath(this.keyPath,e))?!0:goog.array.some(this.indexes,function(t){return goog.isDefAndNotNull(t.keyPath)&&goog.isNull(ydn.db.schema.Index.compareKeyPath(t.keyPath,e))})},ydn.db.schema.Store.prototype.getSQLKeyColumnNameQuoted=function(){return this.primary_column_name_quoted_},ydn.db.schema.Store.prototype.getSQLKeyColumnName=function(){return this.primary_column_name_},ydn.db.schema.Store.prototype.primary_column_name_,ydn.db.schema.Store.prototype.primary_column_name_quoted_,ydn.db.schema.Store.prototype.getQuotedName=function(){return goog.string.quote(this.name_)},ydn.db.schema.Store.prototype.getColumns=function(){if(this.columns_&&this.columns_.length!=this.indexes.length){this.columns_=[];for(var e=0;e<this.indexes.length;e++)this.columns_.push(this.indexes[e].getName())}return this.columns_},ydn.db.schema.Store.prototype.hintForIdb=function(e){for(var t=0;t<e.indexes.length;t++){var o=e.indexes[t];if(!this.hasIndex(o.getName())&&o.getType()==ydn.db.schema.DataType.BLOB){var r=new ydn.db.schema.Index(o.getKeyPath(),o.getType(),o.isUnique(),o.isMultiEntry(),o.getName());this.indexes.push(r)}}},ydn.db.schema.Store.prototype.hintForWebSql=function(e){if(!e)return this;goog.asserts.assert(this.name_==e.name_,"store name: "+this.name_+" != "+e.name_);var t=this.autoIncrement,o=goog.isArray(this.keyPath)?goog.array.clone(this.keyPath):this.keyPath,r=this.type,n=goog.array.map(this.indexes,function(e){return e.clone()});goog.isDef(e.type)||"TEXT"!=r||(r=void 0),goog.isArray(e.keyPath)&&goog.isString(o)&&o==e.keyPath.join(",")&&(o=goog.array.clone(e.keyPath));for(var i=0,s=e.indexes.length;s>i;i++)if(e.indexes[i].isComposite())for(var a=e.indexes[i].getName(),g=n.length-1;g>=0;g--)if(a.indexOf(n[g].getName())>=0){n[g]=e.indexes[i].clone();break}for(var i=0;i<n.length;i++){var d=e.getIndex(n[i].getName());d&&(n[i]=n[i].hint(d))}return new ydn.db.schema.Store(e.name_,o,t,r,n)},ydn.db.schema.Store.prototype.getName=function(){return this.name_},ydn.db.schema.Store.prototype.isAutoIncrement=function(){return this.autoIncrement},ydn.db.schema.Store.prototype.getKeyPath=function(){return this.keyPath},ydn.db.schema.Store.prototype.usedInlineKey=function(){return!!this.keyPath},ydn.db.schema.Store.prototype.getIndexNames=function(){return this.indexes.map(function(e){return e.getName()})},ydn.db.schema.Store.prototype.getType=function(){return this.type},ydn.db.schema.Store.prototype.getSqlType=function(){return this.keyColumnType_},ydn.db.schema.Store.prototype.getIndexKeyPaths=function(){return this.indexes.map(function(e){return e.keyPath})},ydn.db.schema.Store.prototype.addIndex=function(e,t,o,r){this.indexes.push(new ydn.db.schema.Index(e,t,o,r))},ydn.db.schema.Store.prototype.extractKey=function(e,t){if(!e)return void 0;if(!this.usedInlineKey()&&goog.isDefAndNotNull(t))return t;if(this.isComposite){for(var o=[],r=0;r<this.keyPath.length;r++)o.push(ydn.db.utils.getValueByKeys(e,this.keyPath[r]));return o}return this.keyPath?goog.object.getValueByKeys(e,this.keyPaths):void 0},ydn.db.schema.Store.prototype.getRowValue=function(e){if(goog.isDefAndNotNull(this.keyPath)){var t=e[this.keyPath];return this.type==ydn.db.schema.DataType.DATE?t=Date.parse(t):this.type==ydn.db.schema.DataType.NUMERIC?t=parseFloat(t):this.type==ydn.db.schema.DataType.INTEGER&&(t=parseInt(t,10)),t}return void 0},ydn.db.schema.Store.prototype.generateKey=function(){return goog.isDef(this.current_key_)||(this.current_key_=0),this.current_key_++},ydn.db.schema.Store.prototype.setKeyValue=function(e,t){for(var o=0;o<this.keyPaths.length;o++){var r=this.keyPaths[o];if(o==this.keyPaths.length-1)return e[r]=t,void 0;goog.isDef(e[r])||(e[r]={}),e=e[r]}},ydn.db.schema.Store.prototype.sqlNamesValues=function(e,t,o){var r=[],n=[],i=goog.isDef(t)?t:this.extractKey(e);goog.isDef(i)&&(n.push(this.getSQLKeyColumnNameQuoted()),r.push(ydn.db.schema.Index.js2sql(i,this.getType())));for(var s=0;s<this.indexes.length;s++){var a=this.indexes[s];if(!(a.isMultiEntry()||a.getName()===this.keyPath||a.getName()==ydn.db.base.DEFAULT_BLOB_COLUMN||o&&a.isUnique())){var g=a.extractKey(e);goog.isDefAndNotNull(g)&&(r.push(ydn.db.schema.Index.js2sql(g,a.getType())),n.push(a.getSQLIndexColumnNameQuoted()))}}if(this.fixed){if(this.isFixed()&&!this.usedInlineKey()&&0==this.countIndex()){var d=";base64,";goog.isString(e)&&-1==e.indexOf(d)?(r.push(e),n.push(ydn.db.base.DEFAULT_BLOB_COLUMN)):(r.push(ydn.json.stringify(e)),n.push(ydn.db.base.DEFAULT_BLOB_COLUMN))}}else r.push(ydn.json.stringify(e)),n.push(ydn.db.base.DEFAULT_BLOB_COLUMN);for(var u=[],s=r.length-1;s>=0;s--)u[s]="?";return{columns:n,slots:u,values:r,key:i}},ydn.db.schema.Store.prototype.equals=function(e){return this.name_===e.name_&&ydn.object.equals(this.toJSON(),e.toJSON())},ydn.db.schema.Store.prototype.difference=function(e){if(!e)return"missing store: "+this.name_;if(this.name_!=e.name_)return"store name, expect: "+this.name_+", but: "+e.name_;var t=ydn.db.schema.Index.compareKeyPath(this.keyPath,e.keyPath);if(t)return"keyPath, "+t;if(goog.isDef(this.autoIncrement)&&goog.isDef(e.autoIncrement)&&this.autoIncrement!=e.autoIncrement)return"autoIncrement, expect:  "+this.autoIncrement+", but: "+e.autoIncrement;if(this.indexes.length!=e.indexes.length)return"indexes length, expect:  "+this.indexes.length+", but: "+e.indexes.length;if(goog.isDef(this.type)&&goog.isDef(e.type)&&(goog.isArrayLike(this.type)?!goog.array.equals(this.type,e.type):this.type!=e.type))return"data type, expect:  "+this.type+", but: "+e.type;for(var o=0;o<this.indexes.length;o++){var r=e.getIndex(this.indexes[o].getName()),n=this.indexes[o].difference(r);if(n.length>0)return'index "'+this.indexes[o].getName()+'" '+n}return""},ydn.db.schema.Store.prototype.similar=function(e){return 0==this.difference(e).length},ydn.db.schema.Store.prototype.index_generators,ydn.db.schema.Store.prototype.generateIndex=function(e){if(e)for(var t=0;t<this.indexes.length;t++)this.indexes[t].generateIndex(e)},ydn.db.schema.Store.prototype.addHook=function(e){return this.hooks_.push(e),this.hooks_.length-1},ydn.db.schema.Store.prototype.hook=function(e,t,o){for(var r=0;r<this.hooks_.length;r++)o!==r&&this.hooks_[r](e,t)},ydn.db.schema.Store.prototype.getIndexName=function(e){var t,o=e;if(goog.isArray(e)?(t=this.getIndexByKeyPath(e),o=e.join(", ")):t=this.getIndex(e),goog.DEBUG&&!t)throw new ydn.debug.error.ArgumentException('require index "'+o+'" not found in store "'+this.getName()+'"');return t.getName()},goog.DEBUG&&(ydn.db.schema.Store.prototype.toString=function(){return"Store:"+this.name_+"["+this.countIndex()+"index]"}),goog.provide("ydn.db.schema.fulltext.Entry"),ydn.db.schema.fulltext.Entry=function(){},goog.provide("ydn.db.schema.fulltext.Engine"),goog.provide("ydn.db.schema.fulltext.ResultSet"),goog.require("ydn.db.schema.fulltext.Entry"),ydn.db.schema.fulltext.ResultSet=function(){},ydn.db.schema.fulltext.ResultSet.prototype.getStoreList=function(){},ydn.db.schema.fulltext.ResultSet.prototype.nextLookup=function(){},ydn.db.schema.fulltext.ResultSet.prototype.addResult=function(){},ydn.db.schema.fulltext.ResultSet.prototype.collect=function(){},ydn.db.schema.fulltext.Engine=function(){},ydn.db.schema.fulltext.Engine.prototype.query=function(){},ydn.db.schema.fulltext.Engine.prototype.analyze=function(){},goog.provide("goog.json"),goog.provide("goog.json.Serializer"),goog.json.isValid_=function(e){if(/^\s*$/.test(e))return!1;var t=/\\["\\\/bfnrtu]/g,o=/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,r=/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,n=/^[\],:{}\s\u2028\u2029]*$/;return n.test(e.replace(t,"@").replace(o,"]").replace(r,""))},goog.json.parse=function(s){var o=String(s);if(goog.json.isValid_(o))try{return eval("("+o+")")}catch(ex){}throw Error("Invalid JSON string: "+o)},goog.json.unsafeParse=function(s){return eval("("+s+")")},goog.json.Replacer,goog.json.Reviver,goog.json.serialize=function(e,t){return new goog.json.Serializer(t).serialize(e)},goog.json.Serializer=function(e){this.replacer_=e},goog.json.Serializer.prototype.serialize=function(e){var t=[];return this.serialize_(e,t),t.join("")},goog.json.Serializer.prototype.serialize_=function(e,t){switch(typeof e){case"string":this.serializeString_(e,t);break;case"number":this.serializeNumber_(e,t);break;case"boolean":t.push(e);break;case"undefined":t.push("null");break;case"object":if(null==e){t.push("null");break}if(goog.isArray(e)){this.serializeArray(e,t);break}this.serializeObject_(e,t);break;case"function":break;default:throw Error("Unknown type: "+typeof e)}},goog.json.Serializer.charToJsonCharCache_={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\u000b"},goog.json.Serializer.charsToReplace_=/\uffff/.test("")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g,goog.json.Serializer.prototype.serializeString_=function(e,t){t.push('"',e.replace(goog.json.Serializer.charsToReplace_,function(e){if(e in goog.json.Serializer.charToJsonCharCache_)return goog.json.Serializer.charToJsonCharCache_[e];var t=e.charCodeAt(0),o="\\u";return 16>t?o+="000":256>t?o+="00":4096>t&&(o+="0"),goog.json.Serializer.charToJsonCharCache_[e]=o+t.toString(16)}),'"')},goog.json.Serializer.prototype.serializeNumber_=function(e,t){t.push(isFinite(e)&&!isNaN(e)?e:"null")},goog.json.Serializer.prototype.serializeArray=function(e,t){var o=e.length;t.push("[");for(var r="",n=0;o>n;n++){t.push(r);var i=e[n];this.serialize_(this.replacer_?this.replacer_.call(e,String(n),i):i,t),r=","}t.push("]")},goog.json.Serializer.prototype.serializeObject_=function(e,t){t.push("{");var o="";for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=e[r];"function"!=typeof n&&(t.push(o),this.serializeString_(r,t),t.push(":"),this.serialize_(this.replacer_?this.replacer_.call(e,r,n):n,t),o=",")}t.push("}")},goog.provide("ydn.json"),goog.require("goog.debug.Logger"),goog.require("goog.json"),ydn.json.DEBUG=!1,ydn.json.POLY_FILL=!1,ydn.json.logger=goog.debug.Logger.getLogger("ydn"),ydn.json.parse=function(e){return!goog.isString(e)||goog.string.isEmpty(e)?{}:ydn.json.POLY_FILL&&"undefined"==typeof goog.global.JSON?goog.json.unsafeParse(e):JSON.parse(e)},ydn.json.toShortString=function(e){var t;try{t=ydn.json.stringify(e)}catch(o){t=""}return t?t.substr(0,70)+(t.length>70?"...":""):""},ydn.json.stringify=function(e,t,o){return ydn.json.POLY_FILL&&"undefined"==typeof goog.global.JSON?goog.json.serialize(e,t):JSON.stringify(e,t,o)},goog.provide("ydn.db.schema.fulltext.InvIndex"),goog.require("goog.array"),goog.require("ydn.debug.error.ArgumentException"),goog.require("ydn.json"),ydn.db.schema.fulltext.InvIndex=function(e,t,o){if(goog.DEBUG){if(!e||goog.string.isEmpty(e))throw new ydn.debug.error.ArgumentException("store_name must be provided for primary full text index");if(!t||goog.string.isEmpty(t))throw new ydn.debug.error.ArgumentException("index_name must be provided for primary full text index")}this.store_name=e,this.key_path=t,this.weight=o||1},ydn.db.schema.fulltext.InvIndex.prototype.getStoreName=function(){return this.store_name},ydn.db.schema.fulltext.InvIndex.prototype.getWeight=function(){return this.weight},ydn.db.schema.fulltext.InvIndex.prototype.getKeyPath=function(){return this.key_path},ydn.db.schema.fulltext.InvIndex.fromJson=function(e){if(goog.DEBUG){var t=["storeName","keyPath","weight"];for(var o in e)if(e.hasOwnProperty(o)&&-1==goog.array.indexOf(t,o))throw new ydn.debug.error.ArgumentException("Unknown field: "+o+" in "+ydn.json.toShortString(e))}return new ydn.db.schema.fulltext.InvIndex(e.storeName,e.keyPath,e.weight)},goog.provide("ydn.db.schema.fulltext.Catalog"),goog.require("goog.array"),goog.require("ydn.db.schema.fulltext.Engine"),goog.require("ydn.db.schema.fulltext.InvIndex"),goog.require("ydn.debug.error.ArgumentException"),ydn.db.schema.fulltext.Catalog=function(e,t,o,r){if(this.name=e,this.indexes=t,this.lang=o||"",goog.DEBUG&&-1==["","en","fr"].indexOf(this.lang))throw new ydn.debug.error.ArgumentException('Unsupported lang "'+o+" for full text search index "+e);this.normalizers=r||null,this.engine=null},ydn.db.schema.fulltext.Catalog.prototype.getSourceNames=function(){for(var e=[],t=0;t<this.indexes.length;t++){var o=this.indexes[t].getStoreName();-1==e.indexOf(o)&&e.push(o)}return e},ydn.db.schema.fulltext.Catalog.prototype.getName=function(){return this.name},ydn.db.schema.fulltext.Catalog.prototype.count=function(){return this.indexes.length},ydn.db.schema.fulltext.Catalog.prototype.index=function(e){return this.indexes[e]},ydn.db.schema.fulltext.Catalog.prototype.getSource=function(e,t){return goog.array.find(this.indexes,function(o){return o.getStoreName()==e&&o.getKeyPath()==t})},ydn.db.schema.fulltext.Catalog.fromJson=function(e){if(goog.DEBUG){var t=["name","sources","lang"];for(var o in e)if(e.hasOwnProperty(o)&&-1==goog.array.indexOf(t,o))throw new ydn.debug.error.ArgumentException("Unknown field: "+o+" in "+ydn.json.stringify(e))}if(!goog.isArray(e.sources))throw new ydn.debug.error.ArgumentException("indexes require for full text search index "+e.name+", but "+e.sources+" of type "+typeof e.sources+" found.");var r=e.sources.map(function(e){return ydn.db.schema.fulltext.InvIndex.fromJson(e)});return new ydn.db.schema.fulltext.Catalog(e.name,r,e.lang)},goog.provide("ydn.db.schema.Database"),goog.require("ydn.db.Key"),goog.require("ydn.db.schema.Store"),goog.require("ydn.db.schema.fulltext.Catalog"),ydn.db.schema.Database=function(e,t){var o,r,n=t;if(goog.isObject(e)){if(r=e,goog.DEBUG){var i=["version","stores","fullTextCatalogs"];for(var s in r)if(r.hasOwnProperty(s)&&-1==goog.array.indexOf(i,s))throw new ydn.debug.error.ArgumentException("Unknown field: "+s+" in schema.")}o=r.version,n=[];var a=r.stores||[];if(goog.DEBUG&&!goog.isArray(a))throw new ydn.debug.error.ArgumentException("stores must be array");this.default_text_store_name_=r.defaultTextStoreName;for(var g=0;g<a.length;g++){var d=ydn.db.schema.Store.fromJSON(a[g]);if(goog.DEBUG){var u=goog.array.findIndex(n,function(e){return e.name==d.getName()});if(-1!=u)throw new ydn.debug.error.ArgumentException('duplicate store name "'+d.getName()+'".')}n.push(d)}}else goog.isString(e)?o=0==e.length?void 0:parseFloat(e):goog.isNumber(e)&&(o=e);if(goog.isDef(o)){if(!goog.isNumber(o)||0>o)throw new ydn.debug.error.ArgumentException("Invalid version: "+o+" ("+e+")");isNaN(o)&&(o=void 0)}if(goog.isDef(t)&&(!goog.isArray(t)||t.length>0&&!(t[0]instanceof ydn.db.schema.Store)))throw new ydn.debug.error.ArgumentException("stores");this.version=o,this.is_auto_version_=!goog.isDef(this.version),this.stores=n||[];var l=[];if(r&&r.fullTextCatalogs){goog.asserts.assertArray(r.fullTextCatalogs,"fullTextCatalogs");for(var g=0;g<r.fullTextCatalogs.length;g++){var c=ydn.db.schema.fulltext.Catalog.fromJson(r.fullTextCatalogs[g]);if(l[g]=c,!this.getStore(c.getName())){var h=[new ydn.db.schema.Index("k",ydn.db.schema.DataType.TEXT),new ydn.db.schema.Index("v",ydn.db.schema.DataType.TEXT)],p=new ydn.db.schema.Store(c.getName(),"id",!1,void 0,h);this.stores.push(p)}}}this.full_text_schema_=l},ydn.db.schema.Database.prototype.countFullTextIndex=function(){return this.full_text_schema_.length},ydn.db.schema.Database.prototype.fullTextIndex=function(e){return this.full_text_schema_[e]},ydn.db.schema.Database.prototype.getFullTextIndex=function(e){return goog.array.find(this.full_text_schema_,function(t){return t.getName()==e})},ydn.db.schema.Database.prototype.getDefaultTextStoreName=function(){return goog.asserts.assertString(this.default_text_store_name_,"defaultTextStoreName is not defined in the database schema"),this.default_text_store_name_},ydn.db.schema.Database.prototype.toJSON=function(){var e=goog.array.map(this.stores,function(e){return e.toJSON()}),t={};return t.stores=e,goog.isDef(this.version)&&(t.version=this.version),t},ydn.db.schema.Database.prototype.is_auto_version_=!1,ydn.db.schema.Database.prototype.version,ydn.db.schema.Database.prototype.getVersion=function(){return this.version},ydn.db.schema.Database.prototype.setVersion=function(e){goog.asserts.assert(this.is_auto_version_,"autoversion schema cannot set a version"),goog.asserts.assertNumber(e,"version must be a number"),this.version=e},ydn.db.schema.Database.prototype.isAutoVersion=function(){return this.is_auto_version_},ydn.db.schema.Database.prototype.isAutoSchema=function(){return!1},ydn.db.schema.Database.prototype.getStoreNames=function(){return goog.array.map(this.stores,function(e){return e.getName()})},ydn.db.schema.Database.prototype.store=function(e){return this.stores[e]||null},ydn.db.schema.Database.prototype.count=function(){return this.stores.length},ydn.db.schema.Database.prototype.getStore=function(e){return goog.array.find(this.stores,function(t){return t.getName()==e})},ydn.db.schema.Database.prototype.getIndexOf=function(e){return goog.array.indexOf(this.stores,function(t){return t.name==e})},ydn.db.schema.Database.prototype.hasStore=function(e){return goog.array.some(this.stores,function(t){return t.getName()==e})},ydn.db.schema.Database.prototype.difference=function(e,t,o){if(!e||this.stores.length!=e.stores.length)return"Number of store: "+this.stores.length+" vs "+e.stores.length;for(var r=0;r<this.stores.length;r++){var n=e.getStore(this.stores[r].getName());if(!n)return'missing object store "'+this.stores[r].getName()+'"';t&&(n=n.hintForWebSql(this.stores[r])),o&&n.hintForIdb(this.stores[r]);var i=this.stores[r].difference(n);if(i.length>0)return'store: "'+this.stores[r].getName()+'" '+i}return""},ydn.db.schema.Database.prototype.similar=function(e){return 0==this.difference(e,!1,!1).length},ydn.db.schema.Database.prototype.getFullTextSchema=function(e){return goog.array.find(this.full_text_schema_,function(t){return t.getName()==e})},ydn.db.schema.Database.prototype.listStores=function(){return this.store_names||(this.store_names=goog.array.map(this.stores,function(e){return e.getName()})),this.store_names},goog.provide("ydn.db.schema.EditableDatabase"),goog.require("ydn.db.schema.Database"),ydn.db.schema.EditableDatabase=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.schema.EditableDatabase,ydn.db.schema.Database),ydn.db.schema.EditableDatabase.prototype.isAutoSchema=function(){return!0},ydn.db.schema.EditableDatabase.prototype.addStore=function(e){this.stores.push(e)},goog.provide("ydn.error"),goog.provide("ydn.error.ArgumentException"),goog.provide("ydn.error.NotImplementedException"),goog.provide("ydn.error.ConstraintError"),goog.provide("ydn.error.NotSupportedException"),goog.provide("ydn.error.InternalError"),goog.provide("ydn.error.InvalidOperationException"),goog.provide("ydn.error.InvalidOperationError"),ydn.error.ArgumentException=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.ArgumentException):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="ydn.error.ArgumentException"},goog.inherits(ydn.error.ArgumentException,Error),ydn.error.NotSupportedException=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.NotSupportedException):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="ydn.error.NotSupportedException"},goog.inherits(ydn.error.ArgumentException,Error),ydn.error.NotSupportedException.prototype.name="ydn.error.NotSupportedException",ydn.error.NotImplementedException=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.NotImplementedException):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="ydn.error.NotImplementedException"},goog.inherits(ydn.error.NotImplementedException,Error),ydn.error.InternalError=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.InternalError):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="ydn.error.InternalError"},goog.inherits(ydn.error.InternalError,Error),ydn.error.InternalError.prototype.name="ydn.InternalError",ydn.error.ConstraintError=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.ConstraintError):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="ydn.error.ConstraintError"},goog.inherits(ydn.error.ConstraintError,Error),ydn.error.ConstraintError.prototype.name="ydn.error.ConstraintError",ydn.error.InvalidOperationException=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.InvalidOperationException):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="ydn.error.InvalidOperationException"},goog.inherits(ydn.error.ArgumentException,Error),ydn.error.InvalidOperationError=function(e){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.InvalidOperationError):this.stack=(new Error).stack||"",e&&(this.message=String(e)),this.name="ydn.error.InvalidOperationError"},goog.inherits(ydn.error.InvalidOperationError,Error),goog.provide("ydn.object"),goog.require("ydn.json"),ydn.object.clone=function(e){return ydn.json.parse(ydn.json.stringify(e))},ydn.object.equals=function(e,t,o){if(o=o||{},goog.isDefAndNotNull(e)&&goog.isDefAndNotNull(t)){if(goog.isArrayLike(e)&&goog.isArrayLike(t)){var r=e,n=t;if(e.length!=t.length)return!1;for(var i=0;i<e.length;i++){var s=goog.array.find(n,function(e){return ydn.object.equals(e,r[i])});if(-1==s)return!1}return!0}if(goog.isArrayLike(e))return 1==e.length&&ydn.object.equals(e[0],t);if(goog.isArrayLike(t))return 1==t.length&&ydn.object.equals(t[0],e);if(goog.isObject(e)&&goog.isObject(e)){for(var a in e)if(e.hasOwnProperty(a)&&!o[a]){var g=ydn.object.equals(e[a],t[a]);if(!g)return!1}for(var a in t)if(t.hasOwnProperty(a)&&!o[a]){var g=ydn.object.equals(e[a],t[a]);if(!g)return!1}return!0}return e===t}return!1},ydn.object.length=function(e){if(e&&e.length&&goog.isNumber(e.length))return e.length;var t=0;for(var o in e)e.hasOwnProperty(o)&&t++;return t},ydn.object.extend=function(e,t){var o=ydn.object.clone(e);for(var r in t)t.hasOwnProperty(r)&&(o[r]=t[r]);return o},ydn.object.reparr=function(e,t){for(var o=[],r=0;t>r;r++)o[r]=e;return o},ydn.object.takeFirst=function(e){if(e){for(var t in e)if(e.hasOwnProperty(t))return e[t];return void 0}},goog.provide("ydn.db.con.Storage"),goog.require("ydn.db"),goog.require("ydn.db.base"),goog.require("ydn.db.con.IDatabase"),goog.require("ydn.db.con.IStorage"),goog.require("ydn.db.events.StorageEvent"),goog.require("ydn.db.schema.EditableDatabase"),goog.require("ydn.debug.error.ArgumentException"),goog.require("ydn.error.ConstraintError"),goog.require("ydn.object"),ydn.db.con.Storage=function(e,t,o){var r=o||{};if(goog.DEBUG){var n=["autoSchema","connectionTimeout","size","mechanisms","policy","isSerial","Encryption"];for(var i in r)if(r.hasOwnProperty(i)&&-1==goog.array.indexOf(n,i))throw new ydn.debug.error.ArgumentException('Unknown attribute "'+i+'" in options.');if(r.mechanisms){if(!goog.isArray(r.mechanisms))throw new ydn.debug.error.ArgumentException("mechanisms attribute must be an array but "+goog.typeOf(r.mechanisms)+" found.");for(var s=0;s<r.mechanisms.length;s++)if(!goog.array.contains(ydn.db.con.Storage.PREFERENCE,r.mechanisms[s]))throw new ydn.debug.error.ArgumentException('Invalid mechanism "'+r.mechanisms[s]+'"')}}this.mechanisms=r.mechanisms||ydn.db.con.Storage.PREFERENCE,this.size=r.size,this.connectionTimeout=goog.isDef(r.connectionTimeout)?r.connectionTimeout:ydn.db.con.Storage.DEBUG?1e3:goog.DEBUG?3e4:18e5,this.db_=null,this.txQueue_=[],this.in_version_change_tx_=!1;var a;if(t instanceof ydn.db.schema.Database)a=t;else if(goog.isObject(t)){var g=t;a=r.autoSchema||!goog.isDef(g.stores)?new ydn.db.schema.EditableDatabase(g):new ydn.db.schema.Database(g);for(var d=g.stores?g.stores.length:0,s=0;d>s;s++){var u=a.getStore(g.stores[s].name);g.stores[s].Sync&&this.addSynchronizer(u,g.stores[s].Sync)}}else a=new ydn.db.schema.EditableDatabase;var l=this.setEncryption(r.Encryption);this.schema=a;for(var s=0;s<this.schema.count();s++)if(this.schema.store(s).isEncrypted()){if(goog.DEBUG&&!l)throw new Error("encryption option must be defined");this.addEncryption(this.schema.store(s))}goog.isDef(e)&&this.setName(e),this.event_target=null,this.df_on_ready_=new goog.async.Deferred},ydn.db.con.Storage.DEBUG=!1,ydn.db.con.Storage.prototype.logger=goog.debug.Logger.getLogger("ydn.db.con.Storage"),ydn.db.con.Storage.prototype.getSchema=function(e){if(goog.isDef(e)){var t=function(t){e(t.toJSON())};if(this.db_)this.db_.getSchema(t);else{var o=this;goog.asserts.assertFunction(t,"schema");var r=function(e){o.db_.getSchema(t,e)};this.transaction(r,null,ydn.db.base.TransactionMode.READ_ONLY)}}return this.schema?this.schema.toJSON():null},ydn.db.con.Storage.prototype.addStoreSchema=function(e){var t=e instanceof ydn.db.schema.Store?e:ydn.db.schema.Store.fromJSON(e),o=e.name,r=this.schema.getStore(o);if(t.similar(r))return goog.async.Deferred.succeed(!1);var n=r?"update":"add";if(this.schema instanceof ydn.db.schema.EditableDatabase){var i=this.schema;return i.addStore(t),this.db_?(this.db_.close(),this.db_=null,this.connectDatabase()):goog.async.Deferred.succeed(!1)}var s=goog.DEBUG?"Cannot "+n+" store: "+o+". Not auto schema generation mode.":"";throw new ydn.error.ConstraintError(s)},ydn.db.con.Storage.prototype.setName=function(e){if(this.db_)throw new ydn.debug.error.InvalidOperationException("Already connected with "+this.db_name);goog.asserts.assertString(e,"database name must be a string but found "+e+" of type "+typeof e),this.db_name=e,this.connectDatabase()},ydn.db.con.Storage.prototype.db_name,ydn.db.con.Storage.prototype.db_,ydn.db.con.Storage.prototype.size,ydn.db.con.Storage.prototype.connectionTimeout,ydn.db.con.Storage.prototype.schema,ydn.db.con.Storage.prototype.getName=function(){return this.db_name},ydn.db.con.Storage.PREFERENCE=[ydn.db.base.Mechanisms.IDB,ydn.db.base.Mechanisms.WEBSQL,ydn.db.base.Mechanisms.LOCAL_STORAGE,ydn.db.base.Mechanisms.SESSION_STORAGE,ydn.db.base.Mechanisms.USER_DATA,ydn.db.base.Mechanisms.MEMORY_STORAGE],ydn.db.con.Storage.prototype.createDbInstance=function(){return null},ydn.db.con.Storage.prototype.connectDatabase=function(){for(var e=this,t=new goog.async.Deferred,o=function(o,n){o?(e.logger.finest(e+": ready."),e.last_queue_checkin_=0/0,r.onError=function(t){var o=new ydn.db.events.StorageErrorEvent(e,t);e.dispatchDbEvent(o)},r.onFail=function(t){var o=new ydn.db.events.StorageFailEvent(e,t);e.dispatchDbEvent(o),e.db_=null},r.onVersionChange=function(t){e.dispatchDbEvent(t)},setTimeout(function(){e.dispatchReady(n),e.popTxQueue_()},10),t.callback(n)):(e.logger.warning(e+": database connection fail "+n.name),setTimeout(function(){var t=new ydn.db.events.StorageFailEvent(e,n);e.dispatchReady(t),e.purgeTxQueue_(n)},10),t.errback(n))},r=null,n=this.mechanisms,i=0;i<n.length;i++){var s=n[i].toLowerCase();if(r=this.createDbInstance(s)){r=this.createDbInstance(s);break}}if(goog.isNull(r)){var a=new ydn.error.ConstraintError("No storage mechanism found."),g=new ydn.db.events.StorageFailEvent(this,a);o(!1,g)}else this.init(),r.connect(this.db_name,this.schema).addCallbacks(function(e){this.db_=r;var t=new ydn.db.events.StorageEvent(ydn.db.events.Types.READY,this,parseFloat(r.getVersion()),parseFloat(e),null);o(!0,t)},function(e){this.logger.warning(this+": opening fail"),o(!1,e)},this);return t},ydn.db.con.Storage.prototype.getType=function(){return this.db_?this.db_.getType():void 0},ydn.db.con.Storage.prototype.onReady=function(e,t){this.df_on_ready_.addBoth(e,t)},ydn.db.con.Storage.prototype.dispatchReady=function(e){var t=this;setTimeout(function(){if(e instanceof ydn.db.events.StorageErrorEvent){var o=e;t.df_on_ready_.errback(o.error)}else t.df_on_ready_.callback();t.dispatchDbEvent(e)},4)},ydn.db.con.Storage.prototype.isReady=function(){return!!this.db_&&this.db_.isReady()},ydn.db.con.Storage.prototype.init=function(){},ydn.db.con.Storage.prototype.close=function(){this.db_&&(this.db_.close(),this.db_=null,this.logger.finest(this+" closed"))},ydn.db.con.Storage.prototype.getDbInstance=function(){return this.db_?this.db_.getDbInstance():null},ydn.db.con.Storage.prototype.last_queue_checkin_=0/0,ydn.db.con.Storage.QUEUE_LIMIT=100,ydn.db.con.Storage.prototype.countTxQueue=function(){return this.txQueue_.length},ydn.db.con.Storage.prototype.popTxQueue_=function(){var e=this.txQueue_.shift();e&&(this.logger.finest("pop tx queue["+(this.txQueue_.length+1)+"]"),this.transaction(e.fnc,e.scopes,e.mode,e.oncompleted)),this.last_queue_checkin_=goog.now()},ydn.db.con.Storage.prototype.pushTxQueue_=function(e,t,o,r){this.logger.finest("push tx queue["+this.txQueue_.length+"]"),this.txQueue_.push({fnc:e,scopes:t,mode:o,oncompleted:r}),goog.DEBUG&&this.txQueue_.length>ydn.db.con.Storage.QUEUE_LIMIT&&this.txQueue_.length%ydn.db.con.Storage.QUEUE_LIMIT==0&&this.logger.warning("Transaction queue stack size is "+this.txQueue_.length+". It is too large, possibility due to incorrect usage.")
},ydn.db.con.Storage.prototype.purgeTxQueue_=function(e){if(this.txQueue_){this.logger.info("Purging "+this.txQueue_.length+" transactions request.");for(var t;t=this.txQueue_.shift();)t.oncompleted&&t.oncompleted(ydn.db.base.TxEventTypes.ERROR,e)}},ydn.db.con.Storage.prototype.in_version_change_tx_=!1,ydn.db.con.Storage.prototype.transaction=function(e,t,o,r){var n=t;if(goog.isString(t))n=[t];else if(goog.isDefAndNotNull(t)){if(goog.DEBUG){if(!goog.isArrayLike(t))throw new ydn.debug.error.ArgumentException("store names must be an array");if(0==t.length)throw new ydn.debug.error.ArgumentException("number of store names must more than 0");for(var i=0;i<t.length;i++)if(!goog.isString(t[i]))throw new ydn.debug.error.ArgumentException("store name at "+i+" must be string but found "+typeof t[i])}}else n=null;var s=!!this.db_&&this.db_.isReady();if(!s||this.in_version_change_tx_)return this.pushTxQueue_(e,n,o,r),void 0;var a=this,g=goog.isDef(o)?o:ydn.db.base.TransactionMode.READ_ONLY;g==ydn.db.base.TransactionMode.VERSION_CHANGE&&(this.in_version_change_tx_=!0);var d=function(e,t){goog.isFunction(r)&&(r(e,t),r=void 0),g==ydn.db.base.TransactionMode.VERSION_CHANGE&&(a.in_version_change_tx_=!1),a.popTxQueue_()};this.db_.doTransaction(function(t){e(t),e=null},n,g,d)},ydn.db.con.Storage.prototype.isAutoVersion=function(){return this.schema.isAutoVersion()},ydn.db.con.Storage.prototype.isAutoSchema=function(){return this.schema.isAutoSchema()},ydn.db.con.Storage.prototype.addSynchronizer=function(e){this.logger.warning("Synchronization option for "+e.getName()+" ignored.")},ydn.db.con.Storage.prototype.addEncryption=function(e){this.logger.warning("Encryption option for "+e.getName()+" ignored.")},ydn.db.con.Storage.prototype.setEncryption=function(){return!1},ydn.db.con.Storage.prototype.addFullTextIndexer=function(e){this.logger.warning("Full text indexer option for "+e.getName()+" ignored.")},ydn.db.con.Storage.prototype.getEventTypes=function(){return["created","error","fail","ready","deleted","updated","versionchange"]},ydn.db.con.Storage.prototype.dispatchDbEvent=function(){},goog.DEBUG&&(ydn.db.con.Storage.prototype.toString=function(){return"Storage:"+this.db_}),goog.provide("ydn.db.tr.ParallelTxExecutor"),goog.require("ydn.debug.error.InternalError"),ydn.db.tr.ParallelTxExecutor=function(e,t,o,r){this.tx_=e,this.tx_no_=t,this.scopes_=goog.array.clone(o),this.mode_=r,this.oncompleted_handlers=[]},ydn.db.tr.ParallelTxExecutor.prototype.tx_=null,ydn.db.tr.ParallelTxExecutor.prototype.tx_no_,ydn.db.tr.ParallelTxExecutor.prototype.oncompleted_handlers,ydn.db.tr.ParallelTxExecutor.prototype.scopes_,ydn.db.tr.ParallelTxExecutor.prototype.mode_,ydn.db.tr.ParallelTxExecutor.prototype.isActive=function(){return!!this.tx_},ydn.db.tr.ParallelTxExecutor.prototype.getTx=function(){return this.tx_},ydn.db.tr.ParallelTxExecutor.prototype.getTxNo=function(){return this.tx_no_},ydn.db.tr.ParallelTxExecutor.prototype.onCompleted=function(e,t){goog.asserts.assert(this.isActive(),this.tx_no_+" already completed?");for(var o=0;o<this.oncompleted_handlers.length;o++)this.oncompleted_handlers[o](e,t);this.oncompleted_handlers.length=0,this.tx_=null,this.scopes_=null,this.oncompleted_handlers=null},ydn.db.tr.ParallelTxExecutor.prototype.executeTx=function(e,t){if(!this.tx_)throw new ydn.debug.error.InternalError("tx committed on ParallelTxExecutor");t&&this.oncompleted_handlers.push(t),e(this.tx_)},ydn.db.tr.ParallelTxExecutor.prototype.sameScope=function(e,t){if(!this.scopes_||!this.mode_)return!1;if(t!=this.mode_)return!1;if(this.scopes_.length!=e.length)return!1;for(var o=0;o<e.length;o++)if(-1==this.scopes_.indexOf(e[o]))return!1;return!0},ydn.db.tr.ParallelTxExecutor.prototype.subScope=function(e,t){if(!this.scopes_||!this.mode_)return!1;if(t!=this.mode_&&(this.mode_!=ydn.db.base.TransactionMode.READ_WRITE||t!=ydn.db.base.TransactionMode.READ_ONLY))return!1;if(e.length>this.scopes_.length)return!1;for(var o=0;o<e.length;o++)if(-1==this.scopes_.indexOf(e[o]))return!1;return!0},goog.DEBUG&&(ydn.db.tr.ParallelTxExecutor.prototype.toString=function(){return"ParallelTxExecutor: txNo:"+this.tx_no_+" mode:"+this.mode_+" scopes:"+ydn.json.stringify(this.scopes_)}),goog.provide("ydn.db.tr.Parallel"),goog.require("ydn.db.tr.Thread"),goog.require("ydn.db.tr.ParallelTxExecutor"),goog.require("ydn.debug.error.NotSupportedException"),ydn.db.tr.Parallel=function(e,t,o,r,n,i){goog.base(this,e,t,o,r,n,i),this.pl_tx_ex_=null,this.p_request_tx=null},goog.inherits(ydn.db.tr.Parallel,ydn.db.tr.Thread),ydn.db.tr.Parallel.DEBUG=!1,ydn.db.tr.Parallel.prototype.logger=goog.debug.Logger.getLogger("ydn.db.tr.Parallel"),ydn.db.tr.Parallel.prototype.getPlTx=function(){return this.pl_tx_ex_},ydn.db.tr.Parallel.prototype.isActive=function(){return!!this.pl_tx_ex_&&this.pl_tx_ex_.isActive()},ydn.db.tr.Parallel.prototype.sameScope=function(e,t){return this.pl_tx_ex_.sameScope(e,t)},ydn.db.tr.Parallel.prototype.subScope=function(e,t){return this.pl_tx_ex_.subScope(e,t)},ydn.db.tr.Parallel.prototype.abort=function(){this.logger.finer(this+": aborting"),ydn.db.tr.Thread.abort(this.p_request_tx)},ydn.db.tr.Parallel.prototype.getExecutor=goog.abstractMethod,ydn.db.tr.Parallel.prototype.reusedTx=function(e,t){return this.policy==ydn.db.tr.Thread.Policy.MULTI?this.pl_tx_ex_.subScope(e,t):this.policy==ydn.db.tr.Thread.Policy.REPEAT?this.pl_tx_ex_.sameScope(e,t):this.policy==ydn.db.tr.Thread.Policy.ALL?!0:!1},ydn.db.tr.Parallel.prototype.processTx=function(e,t,o,r){var n;this.scope_store_names&&(t=this.scope_store_names),this.scope_mode&&(o=this.scope_mode);var i,s=goog.isDef(o)?o:ydn.db.base.TransactionMode.READ_ONLY,a=this,g=function(e,t){a.logger.fine(n+" "+e),i&&i.onCompleted(e,t),a.r_no_=0},d=function(o){a.tx_no_++,i=new ydn.db.tr.ParallelTxExecutor(o,a.tx_no_,t,s),n=a.getLabel(),a.logger.fine(n+" BEGIN "+ydn.json.stringify(t)+" "+s),a.pl_tx_ex_=i,a.pl_tx_ex_.executeTx(e,r)},u=this.isActive()&&this.reusedTx(t,s);if(ydn.db.tr.Parallel.DEBUG){var l=this.isActive()?"active":"inactive";window.console.log(this+" "+this.pl_tx_ex_+(u?" reusing "+l+" transaction":" opening "+l+" transaction ")+" for mode:"+s+" scopes:"+ydn.json.stringify(t))}if(u)this.pl_tx_ex_.executeTx(e,r);else{if(this.max_tx_no&&this.tx_no_>=this.max_tx_no)throw new ydn.debug.error.InvalidOperationException("Exceed maximum number of transactions of "+this.max_tx_no);this.getStorage().transaction(d,t,s,g)}},ydn.db.tr.Parallel.prototype.request=function(e,t,o,r){var n=goog.base(this,"request",e,t,o,r),i=o||ydn.db.base.TransactionMode.READ_ONLY,s=this;if(ydn.db.tr.Parallel.DEBUG){var a="SN"+Math.random();a=a.replace(".",""),window.console.log(this+" scheduling to execute "+t+" "+i+" "+a)}return this.processTx(function(e){ydn.db.tr.Parallel.DEBUG&&window.console.log(s+" executing "+a),s.r_no_++;var t=s.getLabel()+"R"+s.r_no_;n.setTx(e,t)},t,i,r),n},ydn.db.tr.Parallel.prototype.exec=function(e,t,o,r,n){var i,s=this;if(ydn.db.tr.Parallel.DEBUG){var a="SN"+Math.random();a=a.replace(".",""),window.console.log(this+" scheduling to execute "+o+" "+r+" "+a)}this.processTx(function(o){ydn.db.tr.Parallel.DEBUG&&window.console.log(this+" executing "+a),s.r_no_++,i=s.getLabel()+"R"+s.r_no_;var r=function(t,r){s.p_request_tx=o,i=s.getLabel()+"R"+s.r_no_,r?(s.logger.finer(i+" ERROR"),e.errback(t)):(s.logger.finer(i+" SUCCESS"),e.callback(t)),s.p_request_tx=null};s.logger.finer(i+" BEGIN"),t(o,i,r),t=null,s.logger.finer(i+" END")},o,r,n)},goog.DEBUG&&(ydn.db.tr.Parallel.prototype.toString=function(){var e=this.p_request_tx?"*":"";return"Parallel:"+this.policy+":"+this.getLabel()+e}),goog.provide("ydn.db.tr.AtomicParallel"),goog.require("ydn.db.tr.Thread"),goog.require("ydn.db.tr.Parallel"),goog.require("ydn.debug.error.NotSupportedException"),ydn.db.tr.AtomicParallel=function(e,t){goog.base(this,e,t,ydn.db.tr.Thread.Policy.SINGLE)},goog.inherits(ydn.db.tr.AtomicParallel,ydn.db.tr.Parallel),ydn.db.tr.AtomicParallel.DEBUG=!1,ydn.db.tr.AtomicParallel.prototype.logger=goog.debug.Logger.getLogger("ydn.db.tr.AtomicParallel"),ydn.db.tr.AtomicParallel.prototype.reusedTx=function(){return!1},ydn.db.tr.AtomicParallel.prototype.request=function(e,t,o){var r,n,i,s=this,a=function(e,t){if(g.removeTx(),s.logger.finer("transaction "+e),r)e!=ydn.db.base.TxEventTypes.COMPLETE&&(i=!0,n=t),r(n,i);else{var o=new ydn.db.TimeoutError;g.setDbValue(o,!0)}},g=goog.base(this,"request",e,t,o,a);return g.await(function(e,t,o){i=t,n=e,r=o}),g},ydn.db.tr.AtomicParallel.prototype.exec=function(e,t,o,r,n){var i,s,a=new goog.async.Deferred;a.addCallbacks(function(e){s=!1,i=e},function(e){s=!0,i=e});var g=function(t,o){if(t!=ydn.db.base.TxEventTypes.COMPLETE)e.errback(o);else if(s===!0)e.errback(i);else if(s===!1)e.callback(i);else{var r=new ydn.db.TimeoutError;e.errback(r)}n&&(n(t,o),n=void 0)};goog.base(this,"exec",a,t,o,r,g)},goog.DEBUG&&(ydn.db.tr.AtomicParallel.prototype.toString=function(){return"Atomic"+goog.base(this,"toString")}),goog.provide("ydn.db.tr.Storage"),goog.require("ydn.db.con.Storage"),goog.require("ydn.db.tr.AtomicParallel"),goog.require("ydn.db.tr.AtomicSerial"),goog.require("ydn.db.tr.DbOperator"),goog.require("ydn.db.tr.Parallel"),goog.require("ydn.db.tr.Serial"),ydn.db.tr.Storage=function(e,t,o){goog.base(this,e,t,o),this.ptx_no=0;var r=!0,n=ydn.db.tr.Thread.Policy.SINGLE;o&&(goog.isDef(o.isSerial)&&(r=!!o.isSerial),o.policy&&(n=o.policy));var i=this.newTxQueue(n,r);this.sync_thread=this.newTxQueue(ydn.db.tr.Thread.Policy.ATOMIC,!1),this.db_operator=this.newOperator(i,this.sync_thread)},goog.inherits(ydn.db.tr.Storage,ydn.db.con.Storage),ydn.db.tr.Storage.prototype.sync_thread,ydn.db.tr.Storage.prototype.db_operator,ydn.db.tr.Storage.prototype.ptx_no=0,ydn.db.tr.Storage.prototype.branch=function(e,t,o,r,n){var i;r==ydn.db.base.StandardTransactionMode.READ_ONLY?i=ydn.db.base.TransactionMode.READ_ONLY:r==ydn.db.base.StandardTransactionMode.READ_WRITE&&(i=ydn.db.base.TransactionMode.READ_WRITE);var s=this.newTxQueue(e,t,o,i,n);return this.newOperator(s,this.sync_thread)},ydn.db.tr.Storage.prototype.newOperator=function(e,t){return new ydn.db.tr.DbOperator(this,this.schema,e,t)},ydn.db.tr.Storage.prototype.newTxQueue=function(e,t,o,r,n){if(t){if(e==ydn.db.tr.Thread.Policy.MULTI||e==ydn.db.tr.Thread.Policy.REPEAT||e==ydn.db.tr.Thread.Policy.ALL||e==ydn.db.tr.Thread.Policy.SINGLE)return new ydn.db.tr.Serial(this,this.ptx_no++,e,o,r,n);if(e==ydn.db.tr.Thread.Policy.ATOMIC)return new ydn.db.tr.AtomicSerial(this,this.ptx_no++);throw new ydn.debug.error.ArgumentException('Invalid requestType "'+e+'"')}if(e==ydn.db.tr.Thread.Policy.MULTI||e==ydn.db.tr.Thread.Policy.REPEAT||e==ydn.db.tr.Thread.Policy.ALL||e==ydn.db.tr.Thread.Policy.SINGLE)return new ydn.db.tr.Parallel(this,this.ptx_no++,e,o,r,n);if(e==ydn.db.tr.Thread.Policy.ATOMIC)return new ydn.db.tr.AtomicParallel(this,this.ptx_no++);throw new ydn.debug.error.ArgumentException('Invalid requestType "'+e+'"')},ydn.db.tr.Storage.prototype.run=function(e,t,o){if(goog.DEBUG&&arguments.length>3)throw new ydn.debug.error.ArgumentException("too many input arguments, run accept not more than 3 input arguments, but "+arguments.length+" found.");this.ptx_no++;var r=t||this.schema.getStoreNames(),n=ydn.db.base.TransactionMode.READ_ONLY;if(o)if(o==ydn.db.base.StandardTransactionMode.READ_WRITE)n=ydn.db.base.TransactionMode.READ_WRITE;else if(o!=ydn.db.base.StandardTransactionMode.READ_ONLY)throw new ydn.debug.error.ArgumentException('Invalid transaction mode "'+o+'"');var i=this.newTxQueue(ydn.db.tr.Thread.Policy.ALL,!1,r,n,1),s=this.newOperator(i,this.sync_thread),a=new ydn.db.Request(ydn.db.Request.Method.RUN),g=function(e){a.removeTx();var t=e===ydn.db.base.TxEventTypes.COMPLETE;a.setDbValue(i.getTxNo(),!t)},d=this;return i.processTx(function(t){d.logger.finest("executing run in transaction on "+i),a.setTx(t,i.getLabel()+"R0"),e(s)},r,n,g),a},ydn.db.tr.Storage.prototype.spawn=function(e,t,o,r){if(goog.DEBUG&&arguments.length>3)throw new ydn.debug.error.ArgumentException("too many input arguments, run accept not more than 3 input arguments, but "+arguments.length+" found.");this.ptx_no++;var n=t||this.schema.getStoreNames(),i=ydn.db.base.TransactionMode.READ_ONLY;if(o)if(o==ydn.db.base.StandardTransactionMode.READ_WRITE)i=ydn.db.base.TransactionMode.READ_WRITE;else if(o!=ydn.db.base.StandardTransactionMode.READ_ONLY)throw new ydn.debug.error.ArgumentException('Invalid transaction mode "'+o+'"');var s,a=this.newTxQueue(ydn.db.tr.Thread.Policy.ALL,!1,n,i,r),g=this.newOperator(a,this.sync_thread),d=new ydn.db.Request(ydn.db.Request.Method.RUN),u=function(e,t){d.removeTx();var o=e==ydn.db.base.TxEventTypes.COMPLETE||e==ydn.db.base.TxEventTypes.ABORT;o&&s(e,t)},l=this;return a.processTx(function(t){l.logger.finest("executing run in transaction on "+a),d.setTx(t,a.getLabel()+"R0");var o=e(g);s=a.setGenerator(o,d),o.next()},n,i,u),d},ydn.db.tr.Storage.prototype.getTxNo=function(){return this.db_operator?this.db_operator.getTxNo():0/0},goog.provide("ydn.db.crud.Storage"),goog.require("ydn.db.crud.DbOperator"),goog.require("ydn.db.crud.IOperator"),goog.require("ydn.db.crud.req.IRequestExecutor"),goog.require("ydn.db.events.RecordEvent"),goog.require("ydn.db.events.StoreEvent"),goog.require("ydn.db.tr.Storage"),goog.require("ydn.object"),ydn.db.crud.Storage=function(e,t,o){goog.base(this,e,t,o);for(var r=this.schema,n=0;n<r.countFullTextIndex();n++){var i=r.fullTextIndex(n),s=r.getStore(i.getName());if(!s)throw new ydn.debug.error.ArgumentException('full text index store "'+i.getName()+'" required.');if(!s.hasIndex("k"))throw new ydn.debug.error.ArgumentException('full text index store "'+s.getName()+'" must have "keyword" index');if(!s.hasIndex("v"))throw new ydn.debug.error.ArgumentException('full text index store "'+s.getName()+'" must have "keyword" index');if("id"!=s.getKeyPath())throw new ydn.debug.error.ArgumentException('full text index store "'+s.getName()+'" must use "id" as key path.');for(var a=0;a<i.count();a++){var g=i.index(a),d=r.getStore(g.getStoreName());if(!d)throw new ydn.debug.error.ArgumentException('full text source store "'+g.getStoreName()+'" does not exist for full text index "'+i.getName()+'"');this.addFullTextIndexer(d,i)}}},goog.inherits(ydn.db.crud.Storage,ydn.db.tr.Storage),ydn.db.crud.Storage.prototype.init=function(){goog.base(this,"init")},ydn.db.crud.Storage.prototype.newOperator=function(e,t){return new ydn.db.crud.DbOperator(this,this.schema,e,t)},ydn.db.crud.Storage.prototype.getCoreOperator=function(){return this.db_operator},ydn.db.crud.Storage.prototype.add=function(e,t,o){return this.getCoreOperator().add(e,t,o)},ydn.db.crud.Storage.prototype.count=function(e,t,o,r){return this.getCoreOperator().count(e,t,o,r)},ydn.db.crud.Storage.prototype.get=function(e,t){return this.getCoreOperator().get(e,t)},ydn.db.crud.Storage.prototype.keys=function(e,t,o,r,n,i,s){return this.getCoreOperator().keys(e,t,o,r,n,i,s)},ydn.db.crud.Storage.prototype.values=function(e,t,o,r,n,i){return this.getCoreOperator().values(e,t,o,r,n,i)},ydn.db.crud.Storage.prototype.list=function(e,t,o,r,n,i,s,a,g){return this.getCoreOperator().list(e,t,o,r,n,i,s,a,g)},ydn.db.crud.Storage.prototype.load=function(e,t,o){return this.getCoreOperator().load(e,t,o)},ydn.db.crud.Storage.prototype.put=function(e,t,o){return this.getCoreOperator().put(e,t,o)},ydn.db.crud.Storage.prototype.clear=function(e,t,o){return this.getCoreOperator().clear(e,t,o)},ydn.db.crud.Storage.prototype.remove=function(e,t,o){return this.getCoreOperator().remove(e,t,o)},goog.DEBUG&&(ydn.db.crud.Storage.prototype.toString=function(){var e="Storage:"+this.getName();return this.isReady()&&(e+=" ["+this.getType()+"]"),e}),goog.provide("ydn.db.core.Storage"),goog.require("ydn.db.core.DbOperator"),goog.require("ydn.db.crud.Storage"),ydn.db.core.Storage=function(e,t,o){goog.base(this,e,t,o)},goog.inherits(ydn.db.core.Storage,ydn.db.crud.Storage),ydn.db.core.Storage.prototype.newOperator=function(e,t){return new ydn.db.core.DbOperator(this,this.schema,e,t)},ydn.db.core.Storage.prototype.getIndexOperator=function(){return this.db_operator},ydn.db.core.Storage.prototype.open=function(e,t,o,r){return this.getIndexOperator().open(e,t,o,r)},ydn.db.core.Storage.prototype.listIter=function(e,t,o,r){return this.getIndexOperator().listIter(e,t,o,r)},ydn.db.core.Storage.prototype.scan=function(e,t){return this.getIndexOperator().scan(e,t)},ydn.db.core.Storage.prototype.map=function(e,t){return this.getIndexOperator().map(e,t)},ydn.db.core.Storage.prototype.reduce=function(e,t,o){return this.getIndexOperator().reduce(e,t,o)},goog.provide("ydn.db.query.Base"),goog.require("ydn.db.core.Storage"),ydn.db.query.Base=function(e,t){this.db=e,this.schema=t},ydn.db.query.Base.DEBUG=!1,ydn.db.query.Base.prototype.list=function(e,t,o,r){var n=this.db.listIter(e,t,o,r);return n},ydn.db.query.Base.prototype.patch=function(e,t,o){var r=this.db.open(function(e){var n=e.getValue();if(goog.isString(t))ydn.db.utils.setValueByKeys(n,t,o);else if(goog.isArray(t))for(var i=0;i<t.length;i++)ydn.db.utils.setValueByKeys(n,t[i],o[i]);else if(goog.isObject(t))for(var s in t)t.hasOwnProperty(s)&&(n[s]=t[s]);r.awaitDeferred(e.update(n))},e,ydn.db.base.TransactionMode.READ_WRITE,this);return r},ydn.db.query.Base.prototype.open=function(e,t,o){var r=this.db.open(t,e,ydn.db.base.TransactionMode.READ_WRITE,o);return r},ydn.db.query.Base.prototype.count=function(e){var t;return t=e.isUnique()?this.db.count(e):e.isIndexIterator()?this.db.count(e.getStoreName(),e.getIndexName(),e.getKeyRange()):this.db.count(e.getStoreName(),e.getKeyRange()),e.getState()!=ydn.db.Iterator.State.INITIAL&&t.addBoth(function(){e.getState()!=ydn.db.Iterator.State.WORKING&&e.reset()}),t},ydn.db.query.Base.prototype.clear=function(e){var t=e.isIndexIterator()?this.db.clear(e.getStoreName(),e.getIndexName(),e.keyRange()):this.db.clear(e.getStoreName(),e.keyRange());return t},goog.provide("ydn.db.algo.SortedMerge"),goog.require("ydn.db"),goog.require("ydn.db.algo.AbstractSolver"),ydn.db.algo.SortedMerge=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.algo.SortedMerge,ydn.db.algo.AbstractSolver),ydn.db.algo.SortedMerge.DEBUG=!1,ydn.db.algo.SortedMerge.prototype.solver=function(e,t){var o=[],r=t[0];if(!goog.isDefAndNotNull(r))return ydn.db.algo.SortedMerge.DEBUG&&window.console.log("SortedMerge: done."),[];for(var n=!0,i=!1,s=r,a=[],g=1;g<e.length;g++)if(goog.isDefAndNotNull(t[g])){var d=ydn.db.cmp(r,t[g]);a[g]=d,this.is_reverse?-1==d?n=!1:1==d&&(n=!1,i=!0,-1==ydn.db.cmp(t[g],s)&&(s=t[g])):1==d?n=!1:-1==d&&(n=!1,i=!0,1==ydn.db.cmp(t[g],s)&&(s=t[g]))}else n=!1,i=!0;if(n)for(var u=0;u<e.length;u++)goog.isDefAndNotNull(t[u])&&(o[u]=!0);else if(i)for(var u=0;u<e.length;u++)goog.isDefAndNotNull(t[u])&&(this.is_reverse?-1==ydn.db.cmp(s,t[u])&&(o[u]=s):1==ydn.db.cmp(s,t[u])&&(o[u]=s));else for(var l=this.is_reverse?-1:1,u=1;u<e.length;u++)a[u]===l&&(o[u]=r);return ydn.db.algo.SortedMerge.DEBUG&&window.console.log("SortedMerge: match: "+n+", skip: "+i+", highest_key: "+JSON.stringify(s)+", keys: "+JSON.stringify(e)+", cmps: "+JSON.stringify(a)+", advancement: "+JSON.stringify(o)),n?(this.match_count++,this.out&&this.out.push(s),o):{continuePrimary:o}},goog.provide("ydn.db.query.Restricted"),goog.require("ydn.db.core.Storage"),goog.require("ydn.db.algo.SortedMerge"),ydn.db.query.Restricted=function(e,t){this.db=e,this.schema=t},ydn.db.query.Restricted.DEBUG=!1,ydn.db.query.Restricted.prototype.list=function(e,t,o){var r=[],n=new ydn.db.algo.SortedMerge(r,o),i=this.db.scan(n,t),s=t[0].getStoreName(),a=i.copy();return i.addCallbacks(function(t){e==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?a.callback(t):a.chainDeferred(this.db.values(s,t))},function(e){a.errback(e)},this),a},ydn.db.query.Restricted.prototype.count=function(e){var t;return t=e.isUnique()?this.db.count(e):e.isIndexIterator()?this.db.count(e.getStoreName(),e.getIndexName(),e.getKeyRange()):this.db.count(e.getStoreName(),e.getKeyRange()),e.getState()!=ydn.db.Iterator.State.INITIAL&&t.addBoth(function(){e.getState()!=ydn.db.Iterator.State.WORKING&&e.reset()}),t},ydn.db.query.Restricted.prototype.clear=function(e){var t=e.isIndexIterator()?this.db.clear(e.getStoreName(),e.getIndexName(),e.keyRange()):this.db.clear(e.getStoreName(),e.keyRange());return t},goog.provide("ydn.db.Query"),goog.require("ydn.db.core.Storage"),goog.require("ydn.db.query.Base"),goog.require("ydn.db.query.Restricted"),ydn.db.Query=function(e,t,o,r){this.db=e,this.schema=t,this.type=r||ydn.db.base.QueryMethod.NONE,this.orders=[],this.iterators=goog.isArray(o)?o:[o],this.filter_=null,this.filter_scope_},ydn.db.Query.DEBUG=!1,ydn.db.Query.prototype.copy=function(){for(var e=[],t=0;t<this.iterators.length;t++)e[t]=this.iterators[t].copy();var o=new ydn.db.Query(this.db,this.schema,e,this.type);return o.filter_=this.filter_,o.filter_scope_=this.filter_scope_,o},ydn.db.Query.prototype.reverse=function(){for(var e=[],t=0;t<this.iterators.length;t++)e[t]=this.iterators[t].reverse();return new ydn.db.Query(this.db,this.schema,e,this.type)},ydn.db.Query.prototype.unique=function(e){if(!goog.isBoolean(e))throw new ydn.debug.error.ArgumentException("unique value must be a boolean, but "+typeof e+" found");if(this.iterators.length>1)throw new ydn.debug.error.ArgumentException("multi-iterators cannot be set unique property");var t=this.iterators[0];if(!t.isIndexIterator())throw new ydn.debug.error.ArgumentException("primary key query is already unique");return new ydn.db.Query(this.db,this.schema,[t.unique(e)],this.type)},ydn.db.Query.prototype.order=function(e){var t=goog.isString(e)?[e]:e;if(1!=t.length)throw new ydn.debug.error.ArgumentException("Multi ordering not implemented, wait for next release");if(this.iterators.length>1)throw new ydn.debug.error.ArgumentException("order cannot be set");var o=this.iterators[0],r=this.schema.getStore(o.getStoreName()),n=o.getKeyRange();if(o.isIndexIterator()){if(o.getIndexName()!=t[0]){var i=[o.getIndexName(),t[0]];if(n){if(n.lower!=n.upper)throw new ydn.debug.error.ArgumentException("Not supported");var s=ydn.db.KeyRange.starts([n.lower]);o=new ydn.db.Iterator(o.getStoreName(),i.join(", "),s,o.isReversed(),o.isUnique(),o.isKeyIterator(),i)}else o=new ydn.db.Iterator(o.getStoreName(),i.join(", "),null,o.isReversed(),o.isUnique(),o.isKeyIterator(),i)}}else if(t[0]!=r.getKeyPath()){if(n)throw new ydn.debug.error.ArgumentException("Not possible without using in memory sorting.");o=new ydn.db.IndexValueIterator(o.getStoreName(),t[0],null,o.isReversed(),o.isUnique())}return new ydn.db.Query(this.db,this.schema,o,this.type)},ydn.db.Query.prototype.where=function(e,t,o,r,n){var i=this.iterators[0];if(i.hasKeyRange())throw new ydn.debug.error.ArgumentException("joint query not implemented yet");var s=i.getStoreName(),a=this.schema.getStore(s);return i=e==a.getKeyPath()?ydn.db.ValueIterator.where(s,t,o,r,n):ydn.db.IndexValueIterator.where(s,e,t,o,r,n),new ydn.db.Query(this.db,this.schema,i,this.type)},ydn.db.Query.prototype.getStore=function(){return this.schema.getStore(this.iterators[0].getStoreName())},ydn.db.Query.prototype.select=function(e){var t=this.getStore(),o=goog.isArray(e)?e:[e],r=this.type,n=this.iterators[0].copy();if(1==o.length){var i=o[0];if(i==ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME||i===t.getKeyPath())r=ydn.db.base.QueryMethod.LIST_PRIMARY_KEY;else if(i&&"*"!=i){if(!t.hasIndex(i))throw new ydn.debug.error.ArgumentException('Invalid select "'+i+'", index not found in store "'+t.getName()+'"');if(n.isIndexIterator()){var s=n.getIndexName();if(i!=s)throw new ydn.debug.error.ArgumentException('select field name must be "'+s+'", but "'+i+'" found.')}else n=new ydn.db.Iterator(n.getStoreName(),i,n.getKeyRange(),n.isReversed(),n.isUnique(),!0);r=ydn.db.base.QueryMethod.LIST_KEY}else r=ydn.db.base.QueryMethod.LIST_VALUE}else{if(2!=o.length)throw new ydn.debug.error.ArgumentException("Selecting more than 2 field names is not supported, but "+o.length+" fields selected.");if(!n.isIndexIterator())throw new ydn.debug.error.ArgumentException("Only primary key can be selected for this query.");for(var a=0;2>a;a++){var g=o[a]==ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME||t.isKeyPath(o[a]);if(!g){var d=n.getIndexName();if(o[a]!=d)throw new ydn.debug.error.ArgumentException('select field name must be "'+d+'", but "'+o[a]+'" found.')}}r=ydn.db.base.QueryMethod.LIST_KEYS}return new ydn.db.Query(this.db,this.schema,n,r)},ydn.db.Query.prototype.list=function(e){var t=0,o=e||ydn.db.base.DEFAULT_RESULT_LIMIT,r=ydn.db.base.QueryMethod.LIST_VALUE;if((this.type==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY||this.type==ydn.db.base.QueryMethod.LIST_KEYS||this.type==ydn.db.base.QueryMethod.LIST_KEY)&&(r=this.type),1==this.iterators.length){var n=new ydn.db.query.Base(this.db,this.schema);return n.list(r,this.iterators[0],o,t)}var i=new ydn.db.query.Restricted(this.db,this.schema);return i.list(r,this.iterators,o)},ydn.db.Query.prototype.patch=function(e,t){if(goog.DEBUG){if(arguments.length<1)throw new ydn.debug.error.ArgumentException("too few arguments");if(2==arguments.length){if(goog.isString(e));else if(goog.isArray(e)){if(!goog.isArray(t))throw new ydn.debug.error.ArgumentException("an array is expected for second argument but, "+ydn.json.toShortString(t)+" of type "+typeof t+" found");if(e.length!=t.length)throw new ydn.debug.error.ArgumentException("length of two input arguments must be equal but, "+e.length+" and "+t.length+" found")}}else{if(1!=arguments.length)throw new ydn.debug.error.ArgumentException("too many arguments");if(!goog.isObject(e))throw new ydn.debug.error.ArgumentException("an object is expected but, "+ydn.json.toShortString(e)+" of type "+typeof e+" found")}}var o=new ydn.db.query.Base(this.db,this.schema),r=o.patch(this.iterators[0],e,t);return r},ydn.db.Query.prototype.open=function(e,t){var o=new ydn.db.query.Base(this.db,this.schema),r=o.open(this.iterators[0],e,t);return r},ydn.db.Query.prototype.count=function(){var e=new ydn.db.query.Base(this.db,this.schema),t=e.count(this.iterators[0]);return t},ydn.db.Query.prototype.clear=function(){var e=new ydn.db.query.Base(this.db,this.schema),t=e.clear(this.iterators[0]);return t},ydn.db.Query.prototype.filter=function(e,t){this.filter_=e,this.filter_scope_=t},ydn.db.core.Storage.prototype.from=function(e,t,o,r,n){if(goog.DEBUG&&!goog.isString(e))throw new TypeError('store name "'+e+'"');if(!this.schema.hasStore(e))throw new ydn.debug.error.ArgumentException('Store "'+e+'" not found.');var i;if(goog.isDef(t)){if(!goog.isDef(o))throw new ydn.debug.error.ArgumentException("boundary value must be defined.");i=ydn.db.KeyRange.where(t,o,r,n)}else if(goog.isDef(r))throw new ydn.debug.error.ArgumentException("second boundary must not be defined.");var s=new ydn.db.ValueIterator(e,i);return new ydn.db.Query(this.getIndexOperator(),this.schema,s)},ydn.db.core.DbOperator.prototype.from=function(e,t,o,r,n){if(goog.DEBUG&&!goog.isString(e))throw new TypeError('store name "'+e+'"');if(!this.schema.hasStore(e))throw new ydn.debug.error.ArgumentException('Store "'+e+'" not found.');var i;if(goog.isDef(t)){if(!goog.isDef(o))throw new ydn.debug.error.ArgumentException("boundary value must be defined.");i=ydn.db.KeyRange.where(t,o,r,n)}else if(goog.isDef(r))throw new ydn.debug.error.ArgumentException("second boundary must not be defined.");var s=new ydn.db.ValueIterator(e,i);return new ydn.db.Query(this,this.schema,s)},goog.provide("ydn.db.core.req.IDBCursor"),goog.require("ydn.db.core.req.AbstractCursor"),goog.require("ydn.debug.error.InternalError"),ydn.db.core.req.IDBCursor=function(e,t,o,r){goog.base(this,e,t,o,r),this.request_=null},goog.inherits(ydn.db.core.req.IDBCursor,ydn.db.core.req.AbstractCursor),ydn.db.core.req.IDBCursor.DEBUG=!1,ydn.db.core.req.IDBCursor.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.req.IDBCursor"),ydn.db.core.req.IDBCursor.prototype.defaultOnSuccess=function(e){var t=e.target.result;ydn.db.core.req.IDBCursor.DEBUG&&window.console.log(this+" onSuccess "+(t?t.key+", "+t.primaryKey:"")),t?this.onSuccess(t.key,t.primaryKey,t.value):this.onSuccess()},ydn.db.core.req.IDBCursor.prototype.openCursor=function(e,t){var o=this+" opening ";goog.isDefAndNotNull(e)&&(o+="{"+e,o+=goog.isDefAndNotNull(t)?";"+t+"}":"}"),this.logger.finest(o);var r=this.key_range,n=this.tx.objectStore(this.store_name),i=goog.isString(this.index_name)?n.index(this.index_name):null;if(goog.isDef(e)){var s=i?!goog.isDef(t):!0,a=e,g=r?r.lower:void 0,d=r?r.upper:void 0,u=r?!!r.lowerOpen:!1,l=r?!!r.upperOpen:!1,c=this.reverse?new ydn.db.KeyRange(g,a,u,s):new ydn.db.KeyRange(a,d,s,l);r=c.toIDBKeyRange()}var h;h=this.isValueCursor()?i?goog.isDefAndNotNull(this.dir)?i.openCursor(r,this.dir):goog.isDefAndNotNull(r)?i.openCursor(r):i.openCursor():goog.isDefAndNotNull(this.dir)?n.openCursor(r,this.dir):goog.isDefAndNotNull(r)?n.openCursor(r):n.openCursor():i?goog.isDefAndNotNull(this.dir)?i.openKeyCursor(r,this.dir):goog.isDefAndNotNull(r)?i.openKeyCursor(r):i.openKeyCursor():goog.isDefAndNotNull(this.dir)?n.openCursor(r,this.dir):goog.isDefAndNotNull(r)?n.openCursor(r):n.openCursor();var p=this;h.onerror=function(e){var t=h.error;e.preventDefault(),p.onError(t)};var f=function(e,t,o){ydn.db.core.req.IDBCursor.DEBUG&&window.console.log(p+" requestReady "+e),p.request_=h,p.request_.onsuccess=goog.bind(p.defaultOnSuccess,p);var r=p.isIndexCursor()?t:void 0;p.onSuccess(e,r,o),h=null};goog.isDefAndNotNull(e)?(ydn.db.core.req.IDBCursor.DEBUG&&window.console.log(p+" seeking start position, now "+e),h.onsuccess=function(o){var r=o.target.result;if(r){var n=ydn.db.base.indexedDb.cmp(r.key,e),i=p.reverse?-1:1;if(n==i)f(r.key,r.primaryKey,r.value);else if(n==-i)r["continue"](e);else if(goog.isDefAndNotNull(t)){var s=ydn.db.base.indexedDb.cmp(r.primaryKey,t);s==i?f(r.key,r.primaryKey,r.value):r["continue"]()}else r["continue"]()}else f()}):(p.request_=h,ydn.db.core.req.IDBCursor.DEBUG&&window.console.log(p+" ready ",p.request_),p.request_.onsuccess=goog.bind(p.defaultOnSuccess,p))},ydn.db.core.req.IDBCursor.prototype.hasCursor=function(){return!!this.request_},ydn.db.core.req.IDBCursor.prototype.update=function(e){var t=this.request_.result;if(t){var o=new goog.async.Deferred,r=t.update(e);return r.onsuccess=function(e){o.callback(e.target.result)},r.onerror=function(e){e.preventDefault(),o.errback(e)},o}throw new ydn.db.InvalidAccessError("cursor gone")},ydn.db.core.req.IDBCursor.prototype.clear=function(){var e=this.request_.result;if(e){var t=new goog.async.Deferred,o=e["delete"]();return o.onsuccess=function(){t.callback(1)},o.onerror=function(e){e.preventDefault(),t.errback(e)},t}throw new ydn.db.InvalidAccessError("cursor gone")},ydn.db.core.req.IDBCursor.prototype.advance=function(e){var t=this.request_.result;1==e?t["continue"]():t.advance(e)},ydn.db.core.req.IDBCursor.prototype.continuePrimaryKey=function(e){var t=this.request_.result;if(goog.DEBUG){var o=ydn.db.base.indexedDb.cmp(e,t.primaryKey),r=this.reverse?-1:1;if(o!=r)throw new ydn.debug.error.InternalError('continuing primary key "'+e+'" must '+(this.reverse?"lower":"higher")+' than current primary key "'+t.primaryKey+'"')}var n=this;this.request_.onsuccess=function(r){if(t=r.target.result)if(o=ydn.db.base.indexedDb.cmp(t.primaryKey,e),0==o||1==o&&!n.reverse||-1==o&&n.reverse){n.request_.onsuccess=goog.bind(n.defaultOnSuccess,n);var i=n.isIndexCursor()?t.primaryKey:void 0;n.onSuccess(t.key,i,t.value)}else t["continue"]();else n.request_.onsuccess=goog.bind(n.defaultOnSuccess,n),n.onSuccess()},t["continue"]()},ydn.db.core.req.IDBCursor.prototype.continueEffectiveKey=function(e){var t=this.request_.result;goog.isDefAndNotNull(e)?t["continue"](e):t["continue"]()},ydn.db.core.req.IDBCursor.prototype.disposeInternal=function(){goog.base(this,"disposeInternal"),this.request_=null},goog.DEBUG&&(ydn.db.core.req.IDBCursor.prototype.toString=function(){return"IDB"+goog.base(this,"toString")}),goog.provide("goog.async.DeferredList"),goog.require("goog.async.Deferred"),goog.async.DeferredList=function(e,t,o,r,n,i){goog.base(this,n,i),this.list_=e,this.deferredResults_=[],this.fireOnOneCallback_=!!t,this.fireOnOneErrback_=!!o,this.consumeErrors_=!!r,this.numFinished_=0;for(var s=0;s<e.length;s++){var a=e[s];a.addCallbacks(goog.bind(this.handleCallback_,this,s,!0),goog.bind(this.handleCallback_,this,s,!1))}0!=e.length||this.fireOnOneCallback_||this.callback(this.deferredResults_)},goog.inherits(goog.async.DeferredList,goog.async.Deferred),goog.async.DeferredList.prototype.handleCallback_=function(e,t,o){return this.numFinished_++,this.deferredResults_[e]=[t,o],this.hasFired()||(this.fireOnOneCallback_&&t?this.callback([e,o]):this.fireOnOneErrback_&&!t?this.errback(o):this.numFinished_==this.list_.length&&this.callback(this.deferredResults_)),this.consumeErrors_&&!t&&(o=null),o
},goog.async.DeferredList.prototype.errback=function(e){goog.base(this,"errback",e);for(var t=0;t<this.list_.length;t++)this.list_[t].cancel()},goog.async.DeferredList.gatherResults=function(e){return new goog.async.DeferredList(e,!1,!0).addCallback(function(e){for(var t=[],o=0;o<e.length;o++)t[o]=e[o][1];return t})},goog.provide("ydn.db.crud.req.IndexedDb"),goog.require("goog.async.DeferredList"),goog.require("goog.userAgent"),goog.require("ydn.db.crud.req.IRequestExecutor"),goog.require("ydn.db.crud.req.RequestExecutor"),goog.require("ydn.error"),goog.require("ydn.json"),ydn.db.crud.req.IndexedDb=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.crud.req.IndexedDb,ydn.db.crud.req.RequestExecutor),ydn.db.crud.req.IndexedDb.prototype.logger=goog.debug.Logger.getLogger("ydn.db.crud.req.IndexedDb"),ydn.db.crud.req.IndexedDb.DEBUG=!1,ydn.db.crud.req.IndexedDb.REQ_PER_TX=10,ydn.db.crud.req.IndexedDb.prototype.countStores=function(e,t){var o=[],r=function(n){var i=t[n],s=e.getTx().objectStore(i),a=s.count();a.onsuccess=function(i){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log(i),o[n]=i.target.result,n++,n==t.length?e.setDbValue(o):r(n)},a.onerror=function(t){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log(t),t.preventDefault(),e.setDbValue(a.error,!0)}};0==t.length?e.setDbValue([]):r(0)},ydn.db.crud.req.IndexedDb.prototype.insertObjects=function(e,t,o,r,n,i){var s=[],a=0,g=!1,d=this,u=t?"put":"add",l=e.getTx().objectStore(r),c=e.getLabel()+" "+u+" "+n.length+' objects to store "'+r+'"';this.logger.finest(c);var h=function(c){if(!goog.isDefAndNotNull(n[c]))if(d.logger.finest("empty object at "+c+" of "+n.length),a++,a==n.length)e.setDbValue(s,g);else{var p=c+ydn.db.crud.req.IndexedDb.REQ_PER_TX;p<n.length&&h(p)}var f,y=n[c];f=goog.isDefAndNotNull(i)?t?l.put(y,i[c]):l.add(y,i[c]):t?l.put(y):l.add(y),f.onsuccess=function(t){if(a++,ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([r,t,c]),s[c]=t.target.result,a==n.length)e.setDbValue(o?s[0]:s,g);else{var i=c+ydn.db.crud.req.IndexedDb.REQ_PER_TX;i<n.length&&h(i)}},f.onerror=function(t){a++,ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([r,t,c]);var i=f.error;if(d.logger.finest(e.getLabel()+u+' request to "'+r+'" cause '+i.name+' for object "'+ydn.json.toShortString(n[c])+'" at index '+c+" of "+n.length+" objects."),s[c]=i,g=!0,t.preventDefault(),a==n.length)e.setDbValue(o?s[0]:s,g);else{var l=c+ydn.db.crud.req.IndexedDb.REQ_PER_TX;l<n.length&&h(l)}}};if(n.length>0)for(var p=0;p<ydn.db.crud.req.IndexedDb.REQ_PER_TX&&p<n.length;p++)h(p);else e.setDbValue([])},ydn.db.crud.req.IndexedDb.prototype.putByKeys=function(e,t,o){var r=[],n=0,i=!1,s=function(){e.setDbValue(r,i)},a=this,g=e.getLabel()+" putByKeys: of "+t.length+" objects";this.logger.finest(g);var d=function(g){var u,l=o[g],c=l.getStoreName(),h=e.getTx().objectStore(c);u=goog.isNull(h.keyPath)?h.put(t[g],l.getId()):h.put(t[g]),u.onsuccess=function(e){if(n++,r[g]=e.target.result,n==t.length)s();else{var o=g+ydn.db.crud.req.IndexedDb.REQ_PER_TX;o<t.length&&d(o)}},u.onerror=function(e){n++,ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([c,e]);var o=e.name;if(goog.DEBUG&&a.logger.warning("request result "+o+' error when put keys to "'+c+'" for object "'+ydn.json.toShortString(t[g])+'" at index '+g+" of "+t.length+" objects."),r[g]=u.error,i=!0,e.preventDefault(),n==t.length)s();else{var l=g+ydn.db.crud.req.IndexedDb.REQ_PER_TX;l<t.length&&d(l)}}};if(t.length>0)for(var u=0;u<ydn.db.crud.req.IndexedDb.REQ_PER_TX&&u<t.length;u++)d(u);else s()},ydn.db.crud.req.IndexedDb.prototype.putData=function(e,t,o,r,n,i){for(var s=this.schema.getStore(r),a=e.objectStore(r),g=[],d=n.indexOf("\n"),u=n.substr(0,d).split(i),l=[],c=0;c<u.length;c++){var h=s.getIndex(u[c]);h?l[c]=h.getType():u[c]==s.getKeyPath()&&(l[c]=s.getType())}d++;var p=t+" Loading data  of "+u.length+"-fields record to "+r;this.logger.finest(p);var f=function(){var e,t={},c=n.indexOf("\n",d),h=!1;-1==c?(h=!0,e=n.substring(d)):(e=n.substring(d,c),d=c+1);for(var p=e.split(i),y=0;y<u.length;y++){var b=p[y];l[y]&&(l[y]==ydn.db.schema.DataType.TEXT?b=goog.string.stripQuotes(b,'"'):l[y]==ydn.db.schema.DataType.INTEGER?b=parseInt(b,10):l[y]==ydn.db.schema.DataType.NUMERIC&&(b=parseFloat(b))),t[u[y]]=b}var m=a.put(t);m.onsuccess=function(e){g.push(e.target.result),h?o(g):f()},m.onerror=function(t){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([r,t]),goog.DEBUG&&"DataError"==t.name&&(t=new ydn.db.InvalidKeyException(s+": "+e.substring(0,70))),t.preventDefault(),o(m.error,!0)}};f()},ydn.db.crud.req.IndexedDb.prototype.removeById=function(e,t,o){var r=e.getTx().objectStore(t),n=e.getLabel()+" clearById: "+t+" "+o;this.logger.finest(n);var i=r.openCursor(ydn.db.IDBKeyRange.only(o));i.onsuccess=function(r){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([t,o,r]);var n=r.target.result;if(n){var i=n["delete"]();i.onsuccess=function(){e.setDbValue(1)},i.onerror=function(){e.setDbValue(i.error,!0)}}else e.setDbValue(0)},i.onerror=function(r){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([t,o,r]),r.preventDefault(),e.setDbValue(i.error,!0)}},ydn.db.crud.req.IndexedDb.prototype.removeByKeys=function(e,t){var o,r,n,i=0,s=e.getLabel()+" removeByKeys: "+t.length+" keys";this.logger.finest(s);var a=[],g=function(s){if(s++,s>=t.length){var d=a.length>0;return d?e.setDbValue(a,!0):e.setDbValue(i),void 0}t[s].getStoreName()!=o&&(o=t[s].getStoreName(),r=e.getTx().objectStore(o));var u=r["delete"](t[s].getId());u.onsuccess=function(){i++,g(s)},u.onerror=function(e){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([o,n,e]),e.preventDefault(),a[s]=u.error,g(s)}};g(-1)},ydn.db.crud.req.IndexedDb.prototype.removeByKeyRange=function(e,t,o){var r=e.getTx().objectStore(t),n=r.count(o),i=e.getLabel()+" clearByKeyRange: "+t+" "+o;this.logger.finest(i),n.onsuccess=function(t){var n=t.target.result,i=r["delete"](o);i.onsuccess=function(){e.setDbValue(n)},i.onerror=function(){e.setDbValue(i.error,!0)}},n.onerror=function(r){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([t,o,r]),r.preventDefault(),e.setDbValue(n.error,!0)}},ydn.db.crud.req.IndexedDb.prototype.clearByKeyRange=function(e,t,o){var r=e.getTx().objectStore(t),n=e.getLabel()+" "+t+" "+o;this.logger.finest(n);var i=r["delete"](o);i.onsuccess=function(){e.setDbValue(void 0)},i.onerror=function(t){t.preventDefault(),e.setDbValue(i.error,!0)}},ydn.db.crud.req.IndexedDb.prototype.removeByIndexKeyRange=function(e,t,o,r){var n=e.getTx().objectStore(t),i=n.index(o),s=e.getLabel()+" clearByIndexKeyRange: "+t+":"+o+" "+r;this.logger.finest(s);var a=[],g=i.openCursor(r),d=0;g.onsuccess=function(t){var o=t.target.result;if(o){var r=o["delete"]();r.onsuccess=function(){d++,o["continue"]()},r.onerror=function(e){a.push(r.error),e.preventDefault(),o["continue"]()}}else{var n=a.length>0;n?e.setDbValue(a,!0):e.setDbValue(d)}},g.onerror=function(t){t.preventDefault(),e.setDbValue(g.error,!0)}},ydn.db.crud.req.IndexedDb.prototype.clearByStores=function(e,t){var o=t.length,r=0,n=e.getLabel()+" clearByStores: "+t;this.logger.finest(n);for(var i=0;o>i;i++){var s=t[i],a=e.getTx().objectStore(s),g=a.clear();g.onsuccess=function(){r++,r==o&&e.setDbValue(r)},g.onerror=function(t){r++,ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([r,t]),t.preventDefault(),r==o&&e.setDbValue(g.error,!0)}}},ydn.db.crud.req.IndexedDb.prototype.getById=function(e,t,o){var r=this,n=e.getLabel()+t+":"+o;this.logger.finest(n);var i=e.getTx().objectStore(t),s=i.get(o);s.onsuccess=function(n){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([t,o,n]),r.logger.finest(e.getLabel()+" record "+o+(goog.isDefAndNotNull(n.target.result)?" ":" not ")+" exists.");var s=";base64,",a=n.target.result;if(!i.keyPath&&0==i.indexNames.length&&goog.userAgent.WEBKIT&&goog.isString(a)&&a.indexOf(s)>=0){'"'==a.charAt(0)&&'"'==a.charAt(a.length-1)&&(a=a.substr(1,a.length-2));for(var g=a.split(s),d=g[0].split(":")[1],u=window.atob(g[1]),l=u.length,c=new Uint8Array(l),h=0;l>h;++h)c[h]=u.charCodeAt(h);var p=new Blob([c.buffer],{type:d});e.setDbValue(p)}else e.setDbValue(n.target.result)},s.onerror=function(r){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([t,o,r]),r.preventDefault(),e.setDbValue(s.error,!0)}},ydn.db.crud.req.IndexedDb.prototype.listByIds=function(e,t,o){var r=[];r.length=o.length;var n=0,i=e.getTx().objectStore(t),s=o.length,a=e.getLabel()+" "+t+":"+s+" ids";this.logger.finest(a);var g=function(a){if(!goog.isDefAndNotNull(o[a]))if(n++,r[a]=void 0,n==s)e.setDbValue(r);else{var d=a+ydn.db.crud.req.IndexedDb.REQ_PER_TX;s>d&&g(d)}var u;u=i.get(o[a]),u.onsuccess=function(i){if(n++,ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([t,o,a,i]),r[a]=i.target.result,n==s)e.setDbValue(r);else{var d=a+ydn.db.crud.req.IndexedDb.REQ_PER_TX;s>d&&g(d)}},u.onerror=function(r){n++,ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([t,o,a,r]),r.preventDefault(),e.setDbValue(u.error,!0)}};if(s>0)for(var d=0;d<ydn.db.crud.req.IndexedDb.REQ_PER_TX&&s>d;d++)g(d);else e.setDbValue([])},ydn.db.crud.req.IndexedDb.prototype.listByKeys=function(e,t){var o=[];o.length=t.length;var r=0,n=e.getLabel()+" "+t.length+" ids";this.logger.finest(n);var i=function(n){var s=t[n],a=e.getTx().objectStore(s.getStoreName()),g=a.get(s.getId());g.onsuccess=function(s){if(r++,ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log(s),o[n]=s.target.result,r==t.length)e.setDbValue(o);else{var a=n+ydn.db.crud.req.IndexedDb.REQ_PER_TX;a<t.length&&i(a)}},g.onerror=function(o){r++,ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([t,o]),o.preventDefault(),e.setDbValue(g.error,!0)}};if(t.length>0)for(var s=0;s<ydn.db.crud.req.IndexedDb.REQ_PER_TX&&s<t.length;s++)i(s);else e.setDbValue([])},ydn.db.crud.req.IndexedDb.prototype.countKeyRange=function(e,t,o,r,n){if(goog.DEBUG&&r&&n)throw new ydn.error.InvalidOperationException("unique count not available in IndexedDB");var i=e.getTx().objectStore(t),s=e.getLabel()+" "+t+(r?":"+r:"")+(o?":"+ydn.json.stringify(o):"");this.logger.finest(s);var a;if(goog.isDefAndNotNull(r)){var g=i.index(r);a=goog.isDefAndNotNull(o)?g.count(o):g.count()}else a=goog.isDefAndNotNull(o)?i.count(o):i.count();a.onsuccess=function(t){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log(t),e.setDbValue(t.target.result)},a.onerror=function(t){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log(t),t.preventDefault(),e.setDbValue(a.error,!0)}},ydn.db.crud.req.IndexedDb.prototype.list=function(e,t,o,r,n,i,s,a,g,d){var u=[],l=e.getTx().objectStore(o),c=ydn.db.base.getDirection(a,g),h=e.getLabel()+" "+t+" "+o+(r?":"+r:"")+(n?ydn.json.stringify(n):"");if(a&&(h+=" reverse"),g&&(h+=" unique"),d&&goog.isDef(d[0])){var p=r?!goog.isDef(d[1]):!0,f=d[0],y=n?n.lower:void 0,b=n?n.upper:void 0,m=n?!!n.lowerOpen:!1,v=n?!!n.upperOpen:!1,_=a?new ydn.db.KeyRange(y,f,m,p):new ydn.db.KeyRange(f,b,p,v);n=_.toIDBKeyRange(),h+=" starting from "+ydn.json.stringify(d[0]),goog.isDef(d[1])&&(h+=", "+ydn.json.stringify(d[1]))}this.logger.finest(h);var E;E=t==ydn.db.base.QueryMethod.LIST_KEY||t==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY||t==ydn.db.base.QueryMethod.LIST_KEYS?r?l.index(r).openKeyCursor(n,c):l.openCursor(n,c):r?l.index(r).openCursor(n,c):l.openCursor(n,c);var S=!1;E.onsuccess=function(o){var n=o.target.result;if(n){if(!S){if(s>0)return S=!0,n.advance(s),void 0;if(d&&r&&goog.isDef(d[0]))if(goog.isDef(d[1])){var g=ydn.db.base.indexedDb.cmp(n.key,d[0]),c=a?-1:1;if(0==g){var h=ydn.db.base.indexedDb.cmp(n.primaryKey,d[1]);if(0==h)return S=!0,n["continue"](),void 0;if(h!=c)return n["continue"](),void 0;S=!0}else S=!0}else S=!0;else S=!0}if(t==ydn.db.base.QueryMethod.LIST_KEY)u.push(n.key);else if(t==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY)u.push(n.primaryKey);else if(t==ydn.db.base.QueryMethod.LIST_KEYS){var p={};r&&(p[r]=n.key),l.keyPath?p[l.keyPath]=n.primaryKey:p[ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME]=n.primaryKey,u.push(p)}else t==ydn.db.base.QueryMethod.LIST_VALUE?u.push(n.value):u.push([n.key,n.primaryKey,n.value]);u.length<i?n["continue"]():(d&&(d[0]=ydn.db.Key.clone(n.key),d[1]=ydn.db.Key.clone(n.primaryKey)),e.setDbValue(u))}else d&&(d[0]=void 0,d[1]=void 0),e.setDbValue(u)},E.onerror=function(t){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([o,t]),t.preventDefault(),e.setDbValue(E.error,!0)}},goog.provide("ydn.db.core.req.IndexedDb"),goog.require("ydn.db.algo.AbstractSolver"),goog.require("ydn.db.core.req.IDBCursor"),goog.require("ydn.db.core.req.IRequestExecutor"),goog.require("ydn.db.crud.req.IndexedDb"),goog.require("ydn.error"),goog.require("ydn.json"),ydn.db.core.req.IndexedDb=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.core.req.IndexedDb,ydn.db.crud.req.IndexedDb),ydn.db.core.req.IndexedDb.DEBUG=!1,ydn.db.core.req.IndexedDb.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.req.IndexedDb"),ydn.db.core.req.IndexedDb.prototype.getCursor=function(e,t,o,r){var n=this.schema.getStore(o);return goog.asserts.assertObject(n,'store "'+o+'" not found.'),new ydn.db.core.req.IDBCursor(e,t,n,r)},ydn.db.core.req.IndexedDb.prototype.getStreamer=function(e,t,o,r){return new ydn.db.Streamer(e,o,r)},goog.provide("ydn.db.base.Mutex"),ydn.db.base.Mutex=function(){this.state_=!1},ydn.db.base.Mutex.prototype.state_=!1,ydn.db.base.Mutex.prototype.up=function(){goog.asserts.assert(!this.state_,"Mutex already up."),this.state_=!0},ydn.db.base.Mutex.prototype.down=function(){goog.asserts.assert(this.state_,"Mutex already down."),this.state_=!1},ydn.db.base.Mutex.prototype.state=function(){return this.state_},goog.provide("ydn.db.core.req.SimpleCursor"),goog.require("ydn.db.base.Mutex"),goog.require("ydn.db.core.req.AbstractCursor"),goog.require("ydn.db.core.req.ICursor"),ydn.db.core.req.SimpleCursor=function(e,t,o,r){goog.base(this,e,t,o,r),goog.asserts.assert(o),this.key_=void 0,this.primary_key_=void 0,this.value_=void 0,this.current_=null,this.onCursorComplete_=null,this.result_ready_=new ydn.db.base.Mutex,this.buffer_=null,this.store_=null},goog.inherits(ydn.db.core.req.SimpleCursor,ydn.db.core.req.AbstractCursor),ydn.db.core.req.SimpleCursor.DEBUG=!1,ydn.db.core.req.SimpleCursor.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.req.SimpleCursor"),ydn.db.core.req.SimpleCursor.prototype.store_schema,ydn.db.core.req.SimpleCursor.prototype.key_,ydn.db.core.req.SimpleCursor.prototype.primary_key_,ydn.db.core.req.SimpleCursor.prototype.value_,ydn.db.core.req.SimpleCursor.prototype.current_,ydn.db.core.req.SimpleCursor.prototype.hasCursor=function(){return this.isActive()},ydn.db.core.req.SimpleCursor.prototype.update=function(e){return this.store_.addRecord(this.getPrimaryKey(),e),goog.async.Deferred.succeed()},ydn.db.core.req.SimpleCursor.prototype.advance=function(e){var t=this,o=this.current_?-1:0;if(ydn.db.core.req.SimpleCursor.DEBUG){var r=this.current_?" advancing ":" starting ";window.console.log(this+r+e+" step")}var n=function(r){return o++,!r||o>=e?(ydn.db.core.req.SimpleCursor.DEBUG&&window.console.log("advance to "+(r?r.value:"null")),t.defaultOnSuccess_(r)):void 0};this.reverse?this.buffer_.reverseTraverse(n,this.current_):this.buffer_.traverse(n,this.current_)},ydn.db.core.req.SimpleCursor.prototype.continueEffectiveKey=function(e){if(goog.isDefAndNotNull(e)){var t=this,o=new ydn.db.con.simple.Node(e),r=function(o){if(t.current_=o,!o)return t.defaultOnSuccess_(o);var r=o.value,n=r.getKey(),i=ydn.db.cmp(n,e);if(t.reverse){if(1!=i)return t.defaultOnSuccess_(o)}else if(-1!=i)return t.defaultOnSuccess_(o)};this.reverse?this.buffer_.reverseTraverse(r,o):this.buffer_.traverse(r,o)}else this.advance(1)},ydn.db.core.req.SimpleCursor.prototype.result_ready_,ydn.db.core.req.SimpleCursor.prototype.dispatchOnSuccess_=function(){var e=this;setTimeout(function(){e.result_ready_.state()?(ydn.db.core.req.SimpleCursor.DEBUG&&window.console.log(this+" invoke success "+e.key_),e.result_ready_.down(),e.onSuccess(e.key_,e.primary_key_,e.value_),e.dispatchOnSuccess_()):(ydn.db.core.req.SimpleCursor.DEBUG&&window.console.log(this+" complete"),e.onCursorComplete_(),e.onCursorComplete_=null)},4)},ydn.db.core.req.SimpleCursor.prototype.defaultOnSuccess_=function(e){if(this.current_=e,e){var t=e.value;if(this.key_range)if(!this.reverse&&goog.isDefAndNotNull(this.key_range.upper)){var o=ydn.db.cmp(t.getKey(),this.key_range.upper);(1==o||0==o&&this.key_range.upperOpen)&&(this.current_=null)}else if(this.reverse&&goog.isDefAndNotNull(this.key_range.lower)){var o=ydn.db.cmp(t.getKey(),this.key_range.lower);(-1==o||0==o&&this.key_range.lowerOpen)&&(this.current_=null)}if(this.current_){if(this.unique&&goog.isDefAndNotNull(this.key_)&&goog.isDefAndNotNull(t.getKey())&&0==ydn.db.cmp(this.key_,t.getKey()))return;this.key_=t.getKey(),this.primary_key_=this.is_index?t.getPrimaryKey():this.key_,this.query_method==ydn.db.base.QueryMethod.LIST_VALUE&&(this.isValueCursor()?(goog.asserts.assert(goog.isDefAndNotNull(this.primary_key_)),this.value_=this.store_.getRecord(null,this.primary_key_)):this.value_=this.primary_key_)}}if(this.current_||(this.key_=void 0,this.primary_key_=void 0,this.value_=void 0),this.result_ready_.up(),ydn.db.core.req.SimpleCursor.DEBUG){var r=this.key_+(this.is_index?", "+this.primary_key_:"");window.console.log(this+" new position "+r+" "+this.result_ready_)}return!0},ydn.db.core.req.SimpleCursor.prototype.onCursorComplete_,ydn.db.core.req.SimpleCursor.prototype.openCursor=function(e,t){var o=null;if(this.key_range)if(this.reverse){var r=this.is_index?"":void 0;goog.isDefAndNotNull(this.key_range.upper)&&(o=new ydn.db.con.simple.Node(this.key_range.upper,r))}else goog.isDefAndNotNull(this.key_range.lower)&&(o=new ydn.db.con.simple.Node(this.key_range.lower));goog.isDefAndNotNull(e)&&(o=this.isIndexCursor()?new ydn.db.con.simple.Node(e,t):new ydn.db.con.simple.Node(e)),this.onCursorComplete_=this.tx.getStorage(function(t){var r=function(t){var r=t.value,n=r.getKey();if(t&&goog.isDefAndNotNull(n))if(goog.isDefAndNotNull(e)){if(0==ydn.db.con.simple.Node.cmp(o,r))return}else if(this.key_range){if(!this.reverse&&this.key_range.lowerOpen&&goog.isDefAndNotNull(this.key_range.lower)){var i=ydn.db.cmp(n,this.key_range.lower);if(0==i)return}if(this.reverse&&this.key_range.upperOpen&&goog.isDefAndNotNull(this.key_range.upper)){var i=ydn.db.cmp(n,this.key_range.upper);if(0==i)return}}return this.defaultOnSuccess_(t)};this.store_=t.getSimpleStore(this.store_name),this.buffer_=this.store_.getIndexCache(this.index_name),this.reverse?this.buffer_.reverseTraverse(goog.bind(r,this),o):this.buffer_.traverse(goog.bind(r,this),o),this.dispatchOnSuccess_()},this)},ydn.db.core.req.SimpleCursor.prototype.clear=function(){throw new ydn.debug.error.NotImplementedException},ydn.db.core.req.SimpleCursor.prototype.continuePrimaryKey=function(){throw new ydn.debug.error.NotImplementedException},goog.DEBUG&&(ydn.db.core.req.SimpleCursor.prototype.toString=function(){return"Simple"+goog.base(this,"toString")}),goog.provide("ydn.db.con.simple"),ydn.db.con.simple.NAMESPACE="ydn.db",ydn.db.con.simple.SEP="^|",ydn.db.con.simple.makeKey=function(e,t,o,r){var n=[ydn.db.con.simple.NAMESPACE,e];return goog.isDef(t)&&(n.push(t),goog.isDef(o)&&(n.push(o),goog.isDef(r)&&n.push(ydn.db.utils.encodeKey(r)))),n.join(ydn.db.con.simple.SEP)},goog.provide("ydn.db.con.simple.Node"),ydn.db.con.simple.Node=function(e,t){this.key=e,this.primary_key=t},ydn.db.con.simple.Node.prototype.key,ydn.db.con.simple.Node.prototype.primary_key,ydn.db.con.simple.Node.prototype.getKey=function(){return this.key},ydn.db.con.simple.Node.prototype.getPrimaryKey=function(){return this.primary_key},goog.DEBUG&&(ydn.db.con.simple.Node.prototype.toString=function(){return"ydn.db.con.simple.Node("+this.key+(goog.isDefAndNotNull(this.primary_key)?", "+this.primary_key+")":")")}),ydn.db.con.simple.Node.cmp=function(e,t){var o=ydn.db.cmp(e.key,t.key);return 0===o?goog.isDefAndNotNull(e.primary_key)?goog.isDefAndNotNull(t.primary_key)?ydn.db.cmp(e.primary_key,t.primary_key):1:goog.isDefAndNotNull(t.primary_key)?-1:0:o},goog.provide("goog.structs.AvlTree"),goog.provide("goog.structs.AvlTree.Node"),goog.require("goog.structs"),goog.require("goog.structs.Collection"),goog.structs.AvlTree=function(e){this.comparator_=e||goog.structs.AvlTree.DEFAULT_COMPARATOR_},goog.structs.AvlTree.DEFAULT_COMPARATOR_=function(e,t){return String(e)<String(t)?-1:String(e)>String(t)?1:0},goog.structs.AvlTree.prototype.root_=null,goog.structs.AvlTree.prototype.comparator_=null,goog.structs.AvlTree.prototype.minNode_=null,goog.structs.AvlTree.prototype.maxNode_=null,goog.structs.AvlTree.prototype.add=function(e){if(null==this.root_)return this.root_=new goog.structs.AvlTree.Node(e),this.minNode_=this.root_,this.maxNode_=this.root_,!0;var t=null;return this.traverse_(function(o){var r=null;return this.comparator_(o.value,e)>0?(r=o.left,null==o.left&&(t=new goog.structs.AvlTree.Node(e,o),o.left=t,o==this.minNode_&&(this.minNode_=t))):this.comparator_(o.value,e)<0&&(r=o.right,null==o.right&&(t=new goog.structs.AvlTree.Node(e,o),o.right=t,o==this.maxNode_&&(this.maxNode_=t))),r}),t&&(this.traverse_(function(e){return e.count++,e.parent},t.parent),this.balance_(t.parent)),!!t},goog.structs.AvlTree.prototype.remove=function(e){var t=null;return this.traverse_(function(o){var r=null;return this.comparator_(o.value,e)>0?r=o.left:this.comparator_(o.value,e)<0?r=o.right:(t=o.value,this.removeNode_(o)),r}),t},goog.structs.AvlTree.prototype.clear=function(){this.root_=null,this.minNode_=null,this.maxNode_=null},goog.structs.AvlTree.prototype.contains=function(e){var t=!1;return this.traverse_(function(o){var r=null;return this.comparator_(o.value,e)>0?r=o.left:this.comparator_(o.value,e)<0?r=o.right:t=!0,r}),t},goog.structs.AvlTree.prototype.getCount=function(){return this.root_?this.root_.count:0},goog.structs.AvlTree.prototype.getKthValue=function(e){return 0>e||e>=this.getCount()?null:this.getKthNode_(e).value},goog.structs.AvlTree.prototype.getMinimum=function(){return this.getMinNode_().value},goog.structs.AvlTree.prototype.getMaximum=function(){return this.getMaxNode_().value},goog.structs.AvlTree.prototype.getHeight=function(){return this.root_?this.root_.height:0},goog.structs.AvlTree.prototype.getValues=function(){var e=[];return this.inOrderTraverse(function(t){e.push(t)}),e},goog.structs.AvlTree.prototype.inOrderTraverse=function(e,t){if(this.root_){var o;t?this.traverse_(function(e){var r=null;return this.comparator_(e.value,t)>0?(r=e.left,o=e):this.comparator_(e.value,t)<0?r=e.right:o=e,r}):o=this.getMinNode_();for(var r=o,n=o.left?o.left:o;null!=r;)if(null!=r.left&&r.left!=n&&r.right!=n)r=r.left;else{if(r.right!=n&&e(r.value))return;var i=r;r=null!=r.right&&r.right!=n?r.right:r.parent,n=i}}},goog.structs.AvlTree.prototype.reverseOrderTraverse=function(e,t){if(this.root_){var o;t?this.traverse_(goog.bind(function(e){var r=null;return this.comparator_(e.value,t)>0?r=e.left:this.comparator_(e.value,t)<0?(r=e.right,o=e):o=e,r},this)):o=this.getMaxNode_();for(var r=o,n=o.right?o.right:o;null!=r;)if(null!=r.right&&r.right!=n&&r.left!=n)r=r.right;else{if(r.left!=n&&e(r.value))return;var i=r;r=null!=r.left&&r.left!=n?r.left:r.parent,n=i}}},goog.structs.AvlTree.prototype.traverse_=function(e,t,o){for(var r=t?t:this.root_,n=o?o:null;r&&r!=n;)r=e.call(this,r)},goog.structs.AvlTree.prototype.balance_=function(e){this.traverse_(function(e){var t=e.left?e.left.height:0,o=e.right?e.right.height:0;return t-o>1?(e.left.right&&(!e.left.left||e.left.left.height<e.left.right.height)&&this.leftRotate_(e.left),this.rightRotate_(e)):o-t>1&&(e.right.left&&(!e.right.right||e.right.right.height<e.right.left.height)&&this.rightRotate_(e.right),this.leftRotate_(e)),t=e.left?e.left.height:0,o=e.right?e.right.height:0,e.height=Math.max(t,o)+1,e.parent},e)},goog.structs.AvlTree.prototype.leftRotate_=function(e){e.isLeftChild()?(e.parent.left=e.right,e.right.parent=e.parent):e.isRightChild()?(e.parent.right=e.right,e.right.parent=e.parent):(this.root_=e.right,this.root_.parent=null);var t=e.right;e.right=e.right.left,null!=e.right&&(e.right.parent=e),t.left=e,e.parent=t,t.count=e.count,e.count-=(t.right?t.right.count:0)+1},goog.structs.AvlTree.prototype.rightRotate_=function(e){e.isLeftChild()?(e.parent.left=e.left,e.left.parent=e.parent):e.isRightChild()?(e.parent.right=e.left,e.left.parent=e.parent):(this.root_=e.left,this.root_.parent=null);var t=e.left;e.left=e.left.right,null!=e.left&&(e.left.parent=e),t.right=e,e.parent=t,t.count=e.count,e.count-=(t.left?t.left.count:0)+1},goog.structs.AvlTree.prototype.removeNode_=function(e){if(null!=e.left||null!=e.right){var t,o=null;null!=e.left?(t=this.getMaxNode_(e.left),this.traverse_(function(e){return e.count--,e.parent},t),t!=e.left&&(t.parent.right=t.left,t.left&&(t.left.parent=t.parent),t.left=e.left,t.left.parent=t,o=t.parent),t.parent=e.parent,t.right=e.right,t.right&&(t.right.parent=t),e==this.maxNode_&&(this.maxNode_=t),t.count=e.count):(t=this.getMinNode_(e.right),this.traverse_(function(e){return e.count--,e.parent},t),t!=e.right&&(t.parent.left=t.right,t.right&&(t.right.parent=t.parent),t.right=e.right,t.right.parent=t,o=t.parent),t.parent=e.parent,t.left=e.left,t.left&&(t.left.parent=t),e==this.minNode_&&(this.minNode_=t),t.count=e.count),e.isLeftChild()?e.parent.left=t:e.isRightChild()?e.parent.right=t:this.root_=t,this.balance_(o?o:t)}else this.traverse_(function(e){return e.count--,e.parent},e.parent),e.isLeftChild()?(this.special=1,e.parent.left=null,e==this.minNode_&&(this.minNode_=e.parent),this.balance_(e.parent)):e.isRightChild()?(e.parent.right=null,e==this.maxNode_&&(this.maxNode_=e.parent),this.balance_(e.parent)):this.clear()},goog.structs.AvlTree.prototype.getKthNode_=function(e,t){var o=t||this.root_,r=o.left?o.left.count:0;return r>e?this.getKthNode_(e,o.left):e==r?o:this.getKthNode_(e-r-1,o.right)},goog.structs.AvlTree.prototype.getMinNode_=function(e){if(!e)return this.minNode_;var t=e;return this.traverse_(function(e){var o=null;return e.left&&(t=e.left,o=e.left),o},e),t},goog.structs.AvlTree.prototype.getMaxNode_=function(e){if(!e)return this.maxNode_;var t=e;return this.traverse_(function(e){var o=null;return e.right&&(t=e.right,o=e.right),o},e),t},goog.structs.AvlTree.Node=function(e,t){this.value=e,this.parent=t?t:null,this.count=1},goog.structs.AvlTree.Node.prototype.left=null,goog.structs.AvlTree.Node.prototype.right=null,goog.structs.AvlTree.Node.prototype.height=1,goog.structs.AvlTree.Node.prototype.isRightChild=function(){return!!this.parent&&this.parent.right==this},goog.structs.AvlTree.Node.prototype.isLeftChild=function(){return!!this.parent&&this.parent.left==this},goog.provide("ydn.structs.Buffer"),goog.provide("ydn.structs.Buffer.Iterator"),goog.require("goog.structs.AvlTree"),goog.require("ydn.db.KeyRange"),ydn.structs.Buffer=function(e){goog.base(this,e)},goog.inherits(ydn.structs.Buffer,goog.structs.AvlTree),ydn.structs.Buffer.prototype.traverse=function(e,t){if(this.root_){var o;if(t instanceof goog.structs.AvlTree.Node)o=t;else if(t){if(this.traverse_(function(e){var r=null;return this.comparator_(e.value,t)>0?(r=e.left,o=e):this.comparator_(e.value,t)<0?r=e.right:o=e,r}),!o)return}else o=this.getMinNode_();for(var r=o,n=o.left?o.left:o;null!=r;)if(null!=r.left&&r.left!=n&&r.right!=n)r=r.left;else{if(r.right!=n&&e(r))return;var i=r;r=null!=r.right&&r.right!=n?r.right:r.parent,n=i}e(null)}},ydn.structs.Buffer.prototype.reverseTraverse=function(e,t){if(this.root_){var o;if(t instanceof goog.structs.AvlTree.Node)o=t;else if(t){if(this.traverse_(goog.bind(function(e){var r=null;return this.comparator_(e.value,t)>0?r=e.left:this.comparator_(e.value,t)<0?(r=e.right,o=e):o=e,r},this)),!o)return}else o=this.getMaxNode_();for(var r=o,n=o.right?o.right:o;null!=r;)if(null!=r.right&&r.right!=n&&r.left!=n)r=r.right;else{if(r.left!=n&&e(r))return;var i=r;r=null!=r.left&&r.left!=n?r.left:r.parent,n=i}e(null)}},ydn.structs.Buffer.prototype.iter=function(e,t,o){return new ydn.structs.Buffer.Iterator(e,t,o)},ydn.structs.Buffer.prototype.scan=function(e,t){var o=t instanceof ydn.structs.Buffer.Iterator?t:this.iter(t);if(!this.root_)return e(),void 0;var r,n=!1;if(o.current_)r=o.current_;else if(o.key_range_){var i;o.reverse_&&goog.isDefAndNotNull(o.key_range_.upper)?(i=o.key_range_.upper,n=!!o.key_range_.upperOpen):goog.isDefAndNotNull(o.key_range_.lower)&&(i=o.key_range_.lower,n=!!o.key_range_.lowerOpen),this.traverse_(goog.bind(function(e){var t=null;return this.comparator_(e.value,i)>0?t=e.left:this.comparator_(e.value,i)<0?(t=e.right,r=e):r=e,t},this))}else r||(r=this.getMaxNode_());if(!r)return o.current_=null,e(),void 0;var s,a=r;if(o.reverse_){for(s=r.right?r.right:r;null!=a;)if(null!=a.right&&a.right!=s&&a.left!=s)a=a.right;else{if(a.left!=s){if(o.current_=a,n){n=!1;continue}if(e(a.value))return}var g=a;a=null!=a.left&&a.left!=s?a.left:a.parent,s=g}o.current_=null,e()}else for(s=r.left?r.left:r;null!=a;)if(null!=a.left&&a.left!=s&&a.right!=s)a=a.left;else{if(a.right!=s){if(o.current_=a,n){n=!1;continue}if(e(a.value))return}var g=a;a=null!=a.right&&a.right!=s?a.right:a.parent,s=g}},ydn.structs.Buffer.prototype.union=function(e){for(var t=(this.getMinNode_(),e.getMinNode_());t;);},ydn.structs.Buffer.Iterator=function(e,t,o){this.key_range_=e||null,this.reverse_=!!t,this.unique_=!!o,this.current_=null},ydn.structs.Buffer.Iterator.prototype.key_range_=null,ydn.structs.Buffer.Iterator.prototype.reverse_=!1,ydn.structs.Buffer.Iterator.prototype.unique_=!1,ydn.structs.Buffer.Iterator.prototype.current_=null,goog.provide("ydn.db.con.simple.Store"),goog.require("ydn.db.base"),goog.require("ydn.db.con.simple"),goog.require("ydn.db.con.simple.Node"),goog.require("ydn.structs.Buffer"),ydn.db.con.simple.Store=function(e,t,o){this.db_name=e,this.storage=t,this.schema=o,this.key_indexes={};var r=this.schema.getKeyPath();this.primary_index=goog.isArray(r)?r.join(","):r||ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME,this.key_indexes[this.primary_index]=null,this.key_prefix=ydn.db.con.simple.makeKey(this.db_name,this.schema.getName(),this.primary_index)+ydn.db.con.simple.SEP},ydn.db.con.simple.Store.DEBUG=!1,ydn.db.con.simple.Store.prototype.storage,ydn.db.con.simple.Store.prototype.db_name,ydn.db.con.simple.Store.prototype.schema,ydn.db.con.simple.Store.prototype.primary_index,ydn.db.con.simple.Store.prototype.key_indexes,ydn.db.con.simple.Store.prototype.makeKey=function(e){return this.key_prefix+ydn.db.utils.encodeKey(e)},ydn.db.con.simple.Store.prototype.key_prefix,ydn.db.con.simple.Store.prototype.extractKey=function(e){var t=ydn.db.utils.decodeKey(e.substr(this.key_prefix.length));return t},ydn.db.con.simple.Store.prototype.generateKey=function(){var e=this.makeKey(),t=ydn.json.parse(this.storage.getItem(e));return t.key_count||(t.key_count=0),t.key_count++,this.storage.setItem(e,ydn.json.stringify(t)),t.key_count},ydn.db.con.simple.Store.prototype.getIndexCache=function(e){var t=e||this.primary_index;if(!this.key_indexes[t]){this.key_indexes[t]=new ydn.structs.Buffer(ydn.db.con.simple.Node.cmp);for(var o=this.storage.length,r=0;o>r;r++){var n=this.storage.key(r);if(!goog.isNull(n)&&goog.string.startsWith(n,this.key_prefix)){var i=this.extractKey(n);if(t==this.primary_index){var s=new ydn.db.con.simple.Node(i);this.key_indexes[t].add(s)}else{var a=this.storage.getItem(n);if(!goog.isNull(a)){var g=this.schema.getIndex(t),d=ydn.json.parse(a),u=g.extractKey(d);if(g.isMultiEntry()){if(goog.isArray(u))for(var l=0;l<u.length;l++){var c=new ydn.db.con.simple.Node(u[l],i);this.key_indexes[t].add(c)}}else{var h=new ydn.db.con.simple.Node(u,i);this.key_indexes[t].add(h)}}}}}ydn.db.con.simple.Store.DEBUG&&window.console.log("index "+t+" of "+this.schema.getName()+" for "+this.key_indexes[t].getCount()+" records.")}return this.key_indexes[t]},ydn.db.con.simple.Store.prototype.updateIndex=function(e,t){for(var o in this.key_indexes){var r=this.key_indexes[o];if(r)if(ydn.db.con.simple.Store.DEBUG&&window.console.log("updating "+e+" in index "+o+" of "+this.schema.getName()),o==this.primary_index)r.add(new ydn.db.con.simple.Node(e));else{var n=this.schema.getIndex(o),i=ydn.db.utils.getValueByKeys(t,n.getKeyPath());if(goog.isDefAndNotNull(i)){var s=new ydn.db.con.simple.Node(e,i);r.add(s)}}}},ydn.db.con.simple.Store.prototype.removeIndex=function(e,t){for(var o in this.key_indexes){var r=this.key_indexes[o];if(r)if(ydn.db.con.simple.Store.DEBUG&&window.console.log("removing "+e+" in index "+o+" of "+this.schema.getName()),o==this.primary_index)r.remove(new ydn.db.con.simple.Node(e));else{var n=this.schema.getIndex(o),i=ydn.db.utils.getValueByKeys(t,n.getKeyPath()),s=new ydn.db.con.simple.Node(e,i);r.remove(s)}}},ydn.db.con.simple.Store.prototype.clearIndexCache=function(){for(var e in this.key_indexes){var t=this.key_indexes[e];t&&(t.clear(),ydn.db.con.simple.Store.DEBUG&&window.console.log("index "+e+" of "+this.schema.getName()+" cleared."))
}this.key_indexes={}},ydn.db.con.simple.Store.prototype.addRecord=function(e,t,o){return goog.isDefAndNotNull(e)||(this.schema.usedInlineKey()&&(e=this.schema.extractKey(t)),this.schema.isAutoIncrement()&&!goog.isDefAndNotNull(e)&&(e=this.generateKey())),goog.asserts.assert(goog.isDefAndNotNull(e),this+"primary key not provided in "+ydn.json.toShortString(t)),ydn.db.con.simple.Store.DEBUG&&window.console.log("add "+e),o&&!goog.isNull(this.storage.getItem(this.makeKey(e)))?null:(this.storage.setItem(this.makeKey(e),ydn.json.stringify(t)),this.updateIndex(e,t),e)},ydn.db.con.simple.Store.prototype.removeRecord=function(e){var t=this.makeKey(e),o=this.storage.getItem(t);if(goog.isNull(o))return 0;this.storage.removeItem(t);var r=ydn.json.parse(o);return this.removeIndex(e,r),1},ydn.db.con.simple.Store.prototype.clear=function(){this.clearIndexCache(),this.removeRecords()},ydn.db.con.simple.Store.prototype.getRecord=function(e,t){if(e&&e!=this.primary_index)throw goog.asserts.assert(this.schema.hasIndex(e),'index "'+e+'" not found in '+this),"impl";var o=this.storage.getItem(this.makeKey(t)),r=void 0;if(!goog.isNull(o)){r=ydn.json.parse(o);for(var n=0,i=this.schema.countIndex();i>n;n++){var s=this.schema.index(n);if(s.getType()==ydn.db.schema.DataType.DATE){var a=s.extractKey(r);if(a){var g=new Date(a);s.applyValue(r,g)}}}}return r},ydn.db.con.simple.Store.prototype.getName=function(){return this.schema.getName()},ydn.db.con.simple.Store.prototype.countRecords=function(e,t){e=e||this.primary_index;var o=this.getIndexCache(e),r=null,n=null,i=0,s=!1,a=!1;goog.isDefAndNotNull(t)&&(goog.isDefAndNotNull(t.lower)&&(r=new ydn.db.con.simple.Node(t.lower)),goog.isDefAndNotNull(t.upper)&&(n=new ydn.db.con.simple.Node(t.upper)),s=t.lowerOpen,a=t.upperOpen);var g=function(e){if(goog.isDefAndNotNull(e)){var t=e.value;if(!s||!goog.isDefAndNotNull(r)||0!=ydn.db.cmp(t.getKey(),r.getKey())){if(goog.isDefAndNotNull(n)){var o=ydn.db.cmp(t.getKey(),n.getKey());if(1===o)return!0;if(0===o&&a)return!0}i++}}};return o.traverse(g,r),i},ydn.db.con.simple.Store.prototype.removeRecords=function(e){var t=this,o=this.getIndexCache(this.primary_index),r=null,n=null,i=0,s=[],a=[],g=!1,d=!1;goog.isDefAndNotNull(e)&&(goog.isDefAndNotNull(e.lower)&&(r=new ydn.db.con.simple.Node(e.lower)),goog.isDefAndNotNull(e.upper)&&(n=new ydn.db.con.simple.Node(e.upper)),g=e.lowerOpen,d=e.upperOpen);var u=function(e){if(goog.isDefAndNotNull(e)){var o=e.value;if(!g||!goog.isDefAndNotNull(r)||0!=ydn.db.con.simple.Node.cmp(o,r)){if(goog.isDefAndNotNull(n)){var u=ydn.db.con.simple.Node.cmp(o,n);if(1===u)return!0;if(0===u&&d)return!0}var l=t.makeKey(o.getKey()),c=t.storage.getItem(l);goog.isNull(c)||(t.storage.removeItem(l),i++,ydn.db.con.simple.Store.DEBUG&&window.console.log(i+". remove "+o.getKey()+" "+l),s.length<10&&(s.push(o.getKey()),a.push(ydn.json.parse(c))))}}};if(o.traverse(u,r),s.length<10)for(var l=0;l<s.length;l++)this.removeIndex(s[l],a[l]);else this.clearIndexCache();return i},ydn.db.con.simple.Store.prototype.getItems=function(e,t,o,r,n,i,s,a){var g,d=[],u=!!a&&goog.isDefAndNotNull(a[0]);t=t||this.primary_index;var l=t!=this.primary_index,c=this.getIndexCache(t),h=null,p=null;goog.isDef(i)||(i=0);var f=-1,y=!1,b=!1;if(goog.isDefAndNotNull(o)&&(goog.isDefAndNotNull(o.lower)&&(h=l&&r?new ydn.db.con.simple.Node(o.lower,""):new ydn.db.con.simple.Node(o.lower)),goog.isDefAndNotNull(o.upper)&&(p=l&&!r?new ydn.db.con.simple.Node(o.upper,""):new ydn.db.con.simple.Node(o.upper)),y=!!o.lowerOpen,b=!!o.upperOpen),u){r?b=!0:y=!0;var m=a[0],v=goog.isDef(a[1])?a[1]:"";r?p=l?new ydn.db.con.simple.Node(m,v):new ydn.db.con.simple.Node(m):h=l?new ydn.db.con.simple.Node(m,v):new ydn.db.con.simple.Node(m)}ydn.db.con.simple.Store.DEBUG&&window.console.log(this+" "+(r?" rev":"")+" from "+h+" to "+p);var _=this,E=function(t){if(t&&(f++,!(i>f))){var o=t.value;if(r){if(b&&goog.isDefAndNotNull(p)){var c=u?ydn.db.con.simple.Node.cmp(o,p):ydn.db.cmp(o.getKey(),p.getKey());if(0==c)return}if(goog.isDefAndNotNull(h)){var c=u?ydn.db.con.simple.Node.cmp(o,h):ydn.db.cmp(o.getKey(),h.getKey());if(-1==c||0==c&&y)return a&&(a[0]=void 0,a[1]=void 0),!0}}else{if(y&&goog.isDefAndNotNull(h)){var c=u?ydn.db.con.simple.Node.cmp(o,h):ydn.db.cmp(o.getKey(),h.getKey());if(0==c)return}if(goog.isDefAndNotNull(p)){var c=u?ydn.db.con.simple.Node.cmp(o,p):ydn.db.cmp(o.getKey(),p.getKey());if(1==c||0==c&&b)return a&&(a[0]=void 0,a[1]=void 0),!0}}var m=o.getKey();if(!s||!l||!goog.isDefAndNotNull(g)||0!=ydn.db.cmp(g,m)){var v=l?o.getPrimaryKey():m;if(e==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY)d.push(v);else if(e==ydn.db.base.QueryMethod.LIST_KEY)d.push(m);else if(e==ydn.db.base.QueryMethod.LIST_KEYS)d.push([m,v]);else if(e==ydn.db.base.QueryMethod.LIST_VALUE){var E=_.getRecord(null,v);d.push(E)}else d.push([m,v,_.getRecord(null,v)]);a&&(a[0]=m,a[1]=v)}return g=m,goog.isDef(n)&&d.length>=n?!0:void 0}};return r?c.reverseTraverse(E,p):c.traverse(E,h),d},ydn.db.con.simple.Store.prototype.getRecords=function(e,t,o,r,n){return this.getItems(ydn.db.base.QueryMethod.LIST_VALUE,e,t,o,r,n)},ydn.db.con.simple.Store.prototype.getKeys=function(e,t,o,r,n){return this.getItems(ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,e,t,o,r,n)},goog.DEBUG&&(ydn.db.con.simple.Store.prototype.toString=function(){return"ydn.db.con.simple.Store:"+this.db_name+":"+this.schema.getName()}),goog.provide("ydn.db.con.simple.IStorageProvider"),ydn.db.con.simple.IStorageProvider=function(){},ydn.db.con.simple.IStorageProvider.prototype.connectDb=function(){},goog.provide("ydn.db.req.InMemoryStorage"),goog.require("ydn.db.con.simple.IStorageProvider"),ydn.db.req.InMemoryStorage=function(){this.clear()},ydn.db.req.InMemoryStorage.prototype.connectDb=function(){return this},ydn.db.req.InMemoryStorage.prototype.setItem=function(e,t){goog.isDef(this.memoryStorage[e])||(this.keys.push(e.toString()),this.length=this.keys.length),this.memoryStorage[e]=t},ydn.db.req.InMemoryStorage.prototype.getItem=function(e){return goog.isDef(this.memoryStorage[e])?this.memoryStorage[e]:null},ydn.db.req.InMemoryStorage.prototype.removeItem=function(e){delete this.memoryStorage[e],goog.array.remove(this.keys,e.toString()),this.length=this.keys.length},ydn.db.req.InMemoryStorage.prototype.length=0,ydn.db.req.InMemoryStorage.prototype.key=function(e){var t=this.keys[e];return goog.isDef(t)?this.memoryStorage[t]:null},ydn.db.req.InMemoryStorage.prototype.clear=function(){this.memoryStorage={},this.keys=[],this.length=0},goog.provide("ydn.db.con.SimpleStorageService"),goog.require("goog.async.Deferred"),goog.require("ydn.db.con.simple.IStorageProvider"),goog.require("ydn.db.con.simple.Store"),goog.require("ydn.db.req.InMemoryStorage"),goog.require("ydn.debug.error.InternalError"),ydn.db.con.SimpleStorageService=function(e){this.provider_=e||new ydn.db.req.InMemoryStorage,this.dbname,this.provider_,this.storage_,this.schema,this.simple_stores_={}},ydn.db.con.SimpleStorageService.DEFAULT_KEY_PATH="_id_",ydn.db.con.SimpleStorageService.prototype.getSimpleStore=function(e){var t=this.schema.getStore(e);if(!t)throw new ydn.debug.error.InternalError('store name "'+e+'" not found.');return this.simple_stores_[e]||(this.simple_stores_[e]=new ydn.db.con.simple.Store(this.dbname,this.storage_,t)),this.simple_stores_[e]},ydn.db.con.SimpleStorageService.prototype.getSchema=function(e){var t=this;setTimeout(function(){var o=ydn.db.con.simple.makeKey(t.dbname),r=t.storage_.getItem(o),n=new ydn.db.schema.Database(r);e(n)},10)},goog.provide("ydn.db.con.simple.TxStorage"),goog.require("ydn.db.con.SimpleStorageService"),ydn.db.con.simple.TxStorage=function(e,t){this.storage_=e,this.on_completed_=t},ydn.db.con.simple.TxStorage.prototype.on_completed_,ydn.db.con.simple.TxStorage.prototype.getStorage=function(e,t){var o=this.storage_;goog.asserts.assertObject(o,"transaction already committed"),setTimeout(function(){e.call(t,o)},4);var r=this,n=function(){r.on_completed_(ydn.db.base.TxEventTypes.COMPLETE,null),r.on_completed_=null,r.storage_=null};return n},goog.provide("ydn.db.crud.req.SimpleStore"),goog.require("goog.asserts"),goog.require("goog.async.Deferred"),goog.require("ydn.db.ConstraintError"),goog.require("ydn.db.con.simple.Store"),goog.require("ydn.db.con.simple.TxStorage"),goog.require("ydn.db.crud.req.IRequestExecutor"),goog.require("ydn.db.crud.req.RequestExecutor"),ydn.db.crud.req.SimpleStore=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.crud.req.SimpleStore,ydn.db.crud.req.RequestExecutor),ydn.db.crud.req.SimpleStore.prototype.logger=goog.debug.Logger.getLogger("ydn.db.crud.req.SimpleStore"),ydn.db.crud.req.SimpleStore.SYNC=!0,ydn.db.crud.req.SimpleStore.DEBUG=!1,ydn.db.crud.req.SimpleStore.prototype.putByKeys=function(e,t,o){this.insertObjects(e,!0,!1,null,t,o)},ydn.db.crud.req.SimpleStore.prototype.insertObjects=function(e,t,o,r,n,i){var s=e.getLabel()+" "+(t?"put":"add")+"Object"+(o?"":"s "+n.length+" objects");this.logger.finest(s);var a=e.getTx(),g=a.getStorage(function(s){var a;if(o){goog.asserts.assertString(r,"store name must be provided"),a=s.getSimpleStore(r);var d=i?i[0]:void 0;if(d=a.addRecord(d,n[0],!t),goog.isDefAndNotNull(d))e.setDbValue(d);else{var u=goog.DEBUG?ydn.json.toShortString(d):"",l=new ydn.db.ConstraintError(u);e.setDbValue(l,!0)}}else{for(var c=r,h=[],p=!1,f=i||{},y=0;y<n.length;y++){var b;if(r)b=f[y];else{var m=i[y];b=m.getId(),c=m.getStoreName()}a&&a.getName()==c||(goog.asserts.assertString(c,"store name a string, but "+c),a=s.getSimpleStore(c));var v=a.addRecord(b,n[y],!t);goog.isDefAndNotNull(v)?h.push(v):(p=!0,h.push(new ydn.db.ConstraintError))}e.setDbValue(h,p)}g(),g=null},this)},ydn.db.crud.req.SimpleStore.prototype.putData=function(){throw new ydn.debug.error.NotImplementedException("putData")},ydn.db.crud.req.SimpleStore.prototype.getById=function(e,t,o){var r=e.getTx().getStorage(function(n){var i=n.getSimpleStore(t),s=i.getRecord(null,o);e.setDbValue(s),r(),r=null},this)},ydn.db.crud.req.SimpleStore.prototype.listByIds_=function(e,t,o){var r=e.getTx().getStorage(function(n){for(var i,s=[],a=!1,g=t,d=0;d<o.length;d++){var u=o[d];if(u instanceof ydn.db.Key){var l=u;u=l.getId(),g=l.getStoreName()}i&&i.getName()==g||(i=n.getSimpleStore(g));var c=i.getRecord(null,u);s[d]=c}e.setDbValue(s,a),r(),r=null},this)},ydn.db.crud.req.SimpleStore.prototype.listByIds=function(e,t,o){this.listByIds_(e,t,o)},ydn.db.crud.req.SimpleStore.prototype.listByKeys=function(e,t){this.listByIds_(e,null,t)},ydn.db.crud.req.SimpleStore.prototype.removeById=function(e,t,o){var r=e.getLabel()+" removeById "+t+" "+o;this.logger.finest(r);var n=this,i=e.getTx().getStorage(function(s){var a=s.getSimpleStore(t),g=a.removeRecord(o);n.logger.finer("success "+r+(0==g?" [not found]":"")),e.setDbValue(g),i(),i=null},this)},ydn.db.crud.req.SimpleStore.prototype.removeByKeys=function(e,t){var o=e.getLabel()+" removeByKeys "+t.length+" keys";this.logger.finest(o);var r,n=0,i=e.getTx().getStorage(function(o){for(var s=0;s<t.length;s++){var a=t[s].getStoreName(),g=t[s].getId();r&&r.getName()==a||(r=o.getSimpleStore(a)),n+=r.removeRecord(g)}e.setDbValue(n),i(),i=null},this)},ydn.db.crud.req.SimpleStore.prototype.clearByKeyRange=function(e,t,o){this.removeByKeyRange(e,t,o)},ydn.db.crud.req.SimpleStore.prototype.removeByKeyRange=function(e,t,o){var r=e.getLabel()+" removeByKeyRange "+(o?ydn.json.stringify(o):"");this.logger.finest(r);var n=this,i=e.getTx().getStorage(function(s){var a=s.getSimpleStore(t),g=a.removeRecords(o);n.logger.finer(r+" deleted "+g+" records."),e.setDbValue(g),i(),i=null},this)},ydn.db.crud.req.SimpleStore.prototype.removeByIndexKeyRange=function(e,t,o,r){var n=e.getLabel()+" removeByIndexKeyRange "+(r?ydn.json.stringify(r):"");this.logger.finest(n);var i=e.getTx().getStorage(function(n){for(var s=n.getSimpleStore(t),a=s.getKeys(o,r),g=a.length,d=0;g>d;d++)s.removeRecord(a[d]);e.setDbValue(g),i(),i=null},this)},ydn.db.crud.req.SimpleStore.prototype.clearByStores=function(e,t){var o=e.getLabel()+" clearByStores";this.logger.finest(o);var r=e.getTx().getStorage(function(n){for(var i=0;i<t.length;i++){var s=n.getSimpleStore(t[i]);s.clear()}this.logger.finer("success "+o),e.setDbValue(t.length),r(),r=null},this)},ydn.db.crud.req.SimpleStore.prototype.countStores=function(e,t){var o=e.getTx().getStorage(function(r){for(var n=[],i=0;i<t.length;i++){var s=r.getSimpleStore(t[i]);n.push(s.countRecords())}e.setDbValue(n),o(),o=null},this)},ydn.db.crud.req.SimpleStore.prototype.countKeyRange=function(e,t,o,r){var n=e.getLabel()+" count"+(goog.isDefAndNotNull(r)?"Index":"")+(goog.isDefAndNotNull(o)?"KeyRange":"Store");this.logger.finest(n);var i=e.getTx().getStorage(function(s){var a=s.getSimpleStore(t),g=a.countRecords(r,o);this.logger.finer("success "+n),e.setDbValue(g),i(),i=null},this)},ydn.db.crud.req.SimpleStore.prototype.list=function(e,t,o,r,n,i,s,a,g,d){var u=e.getLabel()+" "+o+" "+(n?ydn.json.toShortString(n):"");this.logger.finest(u);var l=e.getTx().getStorage(function(c){var h=c.getSimpleStore(o),p=h.getItems(t,r,n,a,i,s,g,d);this.logger.finer(u+" "+p.length+" records found."),e.setDbValue(p),l(),l=null},this)},goog.provide("ydn.db.core.req.SimpleStore"),goog.require("ydn.db.core.req.IRequestExecutor"),goog.require("ydn.db.core.req.SimpleCursor"),goog.require("ydn.db.crud.req.SimpleStore"),ydn.db.core.req.SimpleStore=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.core.req.SimpleStore,ydn.db.crud.req.SimpleStore),ydn.db.core.req.SimpleStore.DEBUG=!1,ydn.db.core.req.SimpleStore.prototype.getCursor=function(e,t,o,r){var n=this.schema.getStore(o);return goog.asserts.assertObject(n,'store "'+o+'" not found.'),new ydn.db.core.req.SimpleCursor(e,t,n,r)},ydn.db.core.req.SimpleStore.prototype.getStreamer=function(){throw"not yet"},goog.provide("ydn.db.core.req.CachedWebsqlCursor"),goog.require("ydn.db.core.req.AbstractCursor"),goog.require("ydn.db.core.req.ICursor"),ydn.db.core.req.CachedWebsqlCursor=function(e,t,o,r){goog.base(this,e,t,o,r),goog.asserts.assert(o),this.store_schema_=o,this.cursor_=null,this.current_cursor_index_=0/0,this.has_pending_request=!1},goog.inherits(ydn.db.core.req.CachedWebsqlCursor,ydn.db.core.req.AbstractCursor),ydn.db.core.req.CachedWebsqlCursor.DEBUG=!1,ydn.db.core.req.CachedWebsqlCursor.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.req.CachedWebsqlCursor"),ydn.db.core.req.CachedWebsqlCursor.prototype.store_schema_,ydn.db.core.req.CachedWebsqlCursor.prototype.current_key_=null,ydn.db.core.req.CachedWebsqlCursor.prototype.current_primary_key_=null,ydn.db.core.req.CachedWebsqlCursor.prototype.current_value_=null,ydn.db.core.req.CachedWebsqlCursor.prototype.cursor_=null,ydn.db.core.req.CachedWebsqlCursor.prototype.current_cursor_index_=0/0,ydn.db.core.req.CachedWebsqlCursor.prototype.moveNext_=function(){return this.current_cursor_index_++,[this.getPrimaryKey(),this.getIndexKey(),this.getValue()]},ydn.db.core.req.CachedWebsqlCursor.prototype.invokeNextSuccess_=function(){var e=this.moveNext_();ydn.db.core.req.CachedWebsqlCursor.DEBUG&&window.console.log(["onSuccess",this.current_cursor_index_].concat(e));var t=e[0],o=e[1],r=e[2];this.onSuccess(t,o,r)},ydn.db.core.req.CachedWebsqlCursor.prototype.openCursor=function(e,t,o){var r=this,n=["SELECT"],i=[],s=this.store_schema_.getSQLKeyColumnName(),a=goog.string.quote(s),g=this.index_name?this.store_schema_.getIndex(this.index_name):null,d=g?g.getType():this.store_schema_.getType(),u=g?g.getSQLIndexColumnName():s,l=goog.string.quote(u),c=" ORDER BY ";this.isValueCursor()?(n.push("*"),g?(goog.asserts.assertString(u),c+=this.reverse?goog.string.quote(u)+" DESC, "+a+" DESC ":goog.string.quote(u)+" ASC, "+a+" ASC "):(c+=a,c+=this.reverse?" DESC":" ASC")):g?(goog.asserts.assertString(u),n.push(goog.string.quote(u)+", "+a),c+=this.reverse?goog.string.quote(u)+" DESC, "+a+" DESC ":goog.string.quote(u)+" ASC, "+a+" ASC "):(n.push(a),c+=a,c+=this.reverse?" DESC":" ASC"),n.push("FROM "+goog.string.quote(this.store_name));var h=[],p=(!!g&&g.isMultiEntry(),this.key_range);if(goog.isDefAndNotNull(e))if(this.index_name){if(goog.asserts.assert(goog.isDefAndNotNull(t)),goog.isDefAndNotNull(this.key_range)){var f=ydn.db.base.indexedDb.cmp(t,this.key_range.upper);if(1==f||0==f&&!this.key_range.upperOpen)return this.onSuccess(void 0,void 0,void 0),void 0;p=ydn.db.IDBKeyRange.bound(t,this.key_range.upper,!1,this.key_range.upperOpen)}else p=ydn.db.IDBKeyRange.lowerBound(t);ydn.db.KeyRange.toSql(l,d,p,h,i)}else p=this.reverse?ydn.db.IDBKeyRange.upperBound(e,!!o):ydn.db.IDBKeyRange.lowerBound(e,!!o),ydn.db.KeyRange.toSql(a,this.store_schema_.getType(),p,h,i);else this.index_name?ydn.db.KeyRange.toSql(l,d,p,h,i):ydn.db.KeyRange.toSql(a,this.store_schema_.getType(),p,h,i);h.length>0&&n.push("WHERE "+h.join(" AND ")),n.push(c);var y=function(t,n){if(ydn.db.core.req.CachedWebsqlCursor.DEBUG&&window.console.log([m,n]),r.has_pending_request=!1,r.cursor_=n,r.current_cursor_index_=0,r.index_name&&goog.isDefAndNotNull(e))for(var i=ydn.db.cmp(r.getPrimaryKey(),e);-1==i||0==i&&o;)r.current_cursor_index_++,i=ydn.db.cmp(r.getPrimaryKey(),e);r.onSuccess(r.getPrimaryKey(),r.getIndexKey(),r.getValue())},b=function(e,t){return ydn.db.core.req.CachedWebsqlCursor.DEBUG&&window.console.log([m,e,t]),r.has_pending_request=!1,r.logger.warning("get error: "+t.message),r.onError(t),!0},m=n.join(" "),v="{"+(t?t+"-":"")+(e?e:"")+"}";r.logger.finest(this+": opened: "+v+" SQL: "+m+" : "+ydn.json.stringify(i)),this.tx.executeSql(m,i,y,b)},ydn.db.core.req.CachedWebsqlCursor.prototype.hasCursor=function(){return!!this.cursor_&&this.current_cursor_index_<this.cursor_.rows.length},ydn.db.core.req.CachedWebsqlCursor.prototype.getIndexKey=function(){if(this.isIndexCursor()){if(this.current_cursor_index_<this.cursor_.rows.length){var e=this.cursor_.rows.item(this.current_cursor_index_),t=this.store_schema_.getIndex(this.index_name),o=t.getType();return ydn.db.schema.Index.sql2js(e[t.getSQLIndexColumnName()],o)}return void 0}return void 0},ydn.db.core.req.CachedWebsqlCursor.prototype.getPrimaryKey=function(){if(this.current_cursor_index_<this.cursor_.rows.length){var e=this.store_schema_.getSQLKeyColumnName(),t=this.cursor_.rows.item(this.current_cursor_index_);return ydn.db.schema.Index.sql2js(t[e],this.store_schema_.getType())}return void 0},ydn.db.core.req.CachedWebsqlCursor.prototype.getEffectiveKey=function(){return this.isIndexCursor()?this.getIndexKey():this.getPrimaryKey()},ydn.db.core.req.CachedWebsqlCursor.prototype.getValue=function(){this.index_name?this.index_name:this.store_schema_.getSQLKeyColumnName();if(this.current_cursor_index_<this.cursor_.rows.length){if(this.isValueCursor()){var e=this.cursor_.rows.item(this.current_cursor_index_);return ydn.db.crud.req.WebSql.parseRow(e,this.store_schema_)}return this.getPrimaryKey()}return void 0},ydn.db.core.req.CachedWebsqlCursor.prototype.clear=function(){if(!this.hasCursor())throw new ydn.db.InvalidAccessError;var e=new goog.async.Deferred,t=this;this.has_pending_request=!0;var o=function(o,r){ydn.db.core.req.CachedWebsqlCursor.DEBUG&&window.console.log([i,r]),t.has_pending_request=!1,e.callback(r.rowsAffected)},r=function(o,r){return ydn.db.core.req.CachedWebsqlCursor.DEBUG&&window.console.log([i,o,r]),t.has_pending_request=!1,t.logger.warning("get error: "+r.message),e.errback(r),!0},n=this.store_schema_.getSQLKeyColumnName(),i="DELETE FROM "+this.store_schema_.getQuotedName()+" WHERE "+n+" = ?",s=[this.getPrimaryKey()];return t.logger.finest(this+': clear "'+i+'" : '+ydn.json.stringify(s)),this.tx.executeSql(i,s,o,r),e},ydn.db.core.req.CachedWebsqlCursor.prototype.update=function(e){if(!this.hasCursor())throw new ydn.db.InvalidAccessError;var t=new goog.async.Deferred,o=this;this.has_pending_request=!0;var r=this.getPrimaryKey(),n=function(e,n){ydn.db.core.req.CachedWebsqlCursor.DEBUG&&window.console.log([a,n]),o.has_pending_request=!1,t.callback(r)},i=function(e,r){return ydn.db.core.req.CachedWebsqlCursor.DEBUG&&window.console.log([a,e,r]),o.has_pending_request=!1,o.logger.warning("get error: "+r.message),t.errback(r),!0};goog.asserts.assertObject(e);var s=o.store_schema_.sqlNamesValues(e,r),a="REPLACE INTO "+this.store_schema_.getQuotedName()+" ("+s.columns.join(", ")+") VALUES ("+s.slots.join(", ")+") ON CONFLICT FAIL";return o.logger.finest(this+': clear "'+a+'" : '+ydn.json.stringify(s.values)),this.tx.executeSql(a,s.values,n,i),t},ydn.db.core.req.CachedWebsqlCursor.prototype.advance=function(e){if(!this.hasCursor())throw new ydn.error.InvalidOperationError(this+" cursor gone.");this.cursor_.rows.length;this.current_cursor_index_+=e;var t=this.getPrimaryKey(),o=this.getIndexKey(),r=this.getValue(),n=this;setTimeout(function(){n.onSuccess(t,o,r)},4)},ydn.db.core.req.CachedWebsqlCursor.prototype.continuePrimaryKey=function(e){if(!this.hasCursor())throw new ydn.error.InvalidOperationError(this+" cursor gone.");var t=ydn.db.cmp(e,this.getPrimaryKey());if(0==t||1==t&&this.reverse||-1==t&&!this.reverse)throw new ydn.error.InvalidOperationError(this+" wrong direction.");for(var o=this.getIndexKey(),r=this.cursor_.rows.length,n=0;r>n;n++){if(0==t||1==t&&this.reverse||-1==t&&!this.reverse)return this.onSuccess(this.getPrimaryKey(),this.getIndexKey(),this.getValue()),void 0;if(this.current_cursor_index_++,o&&o!=this.getIndexKey())return this.onSuccess(this.getPrimaryKey(),this.getIndexKey(),this.getValue()),void 0;var i=this.getPrimaryKey();t=goog.isDefAndNotNull(i)?ydn.db.cmp(e,i):1}this.onSuccess(void 0,void 0,void 0)},ydn.db.core.req.CachedWebsqlCursor.prototype.continueEffectiveKey=function(e){if(!this.hasCursor())throw new ydn.error.InvalidOperationError(this+" cursor gone.");if(!goog.isDefAndNotNull(e))return this.advance(1),void 0;var t=ydn.db.cmp(e,this.getEffectiveKey());if(0==t||1==t&&this.reverse||-1==t&&!this.reverse)throw new ydn.error.InvalidOperationError(this+" wrong direction.");for(var o=this.cursor_.rows.length,r=0;o>r;r++){if(0==t||1==t&&this.reverse||-1==t&&!this.reverse)return this.onSuccess(this.getPrimaryKey(),this.getIndexKey(),this.getValue()),void 0;this.current_cursor_index_++;var n=this.getEffectiveKey();t=goog.isDefAndNotNull(n)?ydn.db.cmp(e,n):1}this.onSuccess(void 0,void 0,void 0)},goog.provide("ydn.db.core.req.WebsqlCursor"),goog.require("ydn.db.core.req.AbstractCursor"),goog.require("ydn.db.core.req.ICursor"),ydn.db.core.req.WebsqlCursor=function(e,t,o,r){goog.base(this,e,t,o,r),goog.asserts.assert(o),this.store_schema_=o,this.index_=null,this.current_key_=void 0,this.current_primary_key_=void 0},goog.inherits(ydn.db.core.req.WebsqlCursor,ydn.db.core.req.AbstractCursor),ydn.db.core.req.WebsqlCursor.DEBUG=!1,ydn.db.core.req.WebsqlCursor.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.req.WebsqlCursor"),ydn.db.core.req.WebsqlCursor.prototype.current_key_,ydn.db.core.req.WebsqlCursor.prototype.current_primary_key_,ydn.db.core.req.WebsqlCursor.prototype.current_value_,ydn.db.core.req.WebsqlCursor.prototype.getIndexKey=function(){return this.current_key_},ydn.db.core.req.WebsqlCursor.prototype.getPrimaryKey=function(){return this.current_primary_key_},ydn.db.core.req.WebsqlCursor.prototype.init=function(e,t,o,r,n){goog.base(this,"init",e,t,o,r,n),this.index_=goog.isString(t)?this.store_schema.getIndex(t):null},ydn.db.core.req.WebsqlCursor.prototype.getValue=function(){return this.current_value_},ydn.db.core.req.WebsqlCursor.prototype.collect=function(e){if(this.current_key_=void 0,this.current_primary_key_=void 0,this.current_value_=void 0,ydn.db.core.req.WebsqlCursor.DEBUG&&window.console.log(e),goog.isDef(e)){var t=e;if(goog.isObject(t)){var o=this.store_schema.getSQLKeyColumnName(),r=ydn.db.schema.Index.sql2js(t[o],this.store_schema.getType());if(this.current_primary_key_=r,this.isIndexCursor()){goog.asserts.assertString(this.index_name);var n=this.store_schema.getIndex(this.index_name).getType();this.current_key_=ydn.db.schema.Index.sql2js(t[this.index_name],n)}else this.current_key_=r;this.current_value_=this.isValueCursor()?ydn.db.crud.req.WebSql.parseRow(t,this.store_schema):r}else this.current_value_=t}},ydn.db.core.req.WebsqlCursor.prototype.continuePrimaryKey_=function(e,t,o,r){goog.asserts.assertString(this.index_name),goog.asserts.assert(goog.isDefAndNotNull(this.current_key_));var n=(this.store_schema.getIndex(this.index_name),[]),i=this.index_name,s=this.key_range,a=this.current_key_;if(goog.isDefAndNotNull(s)){var g=s.lower,d=s.upper,u=s.lowerOpen,l=s.upperOpen;this.reverse?d=goog.isDefAndNotNull(d)&&-1==ydn.db.cmp(d,a)?d:a:g=goog.isDefAndNotNull(g)&&1==ydn.db.cmp(g,a)?g:a,s=goog.isDefAndNotNull(g)&&goog.isDefAndNotNull(d)?ydn.db.KeyRange.bound(g,d,!!u,!!l):goog.isDefAndNotNull(g)?ydn.db.IDBKeyRange.lowerBound(g,!!u):ydn.db.IDBKeyRange.upperBound(d,!!l)}else s=this.reverse?ydn.db.IDBKeyRange.upperBound(a):ydn.db.IDBKeyRange.lowerBound(a);var c=this.store_schema.inSql(n,this.query_method,i,s,this.reverse,this.unique),h=this.reverse?ydn.db.IDBKeyRange.upperBound(t,!o):ydn.db.IDBKeyRange.lowerBound(t,!o),p=this.store_schema.inSql(n,this.query_method,this.store_schema.getSQLKeyColumnName(),h,this.reverse,this.unique);c.where?c.where+=" AND "+p.where:c.where=p.where;var f="SELECT "+c.select+" FROM "+c.from+(c.where?" WHERE "+c.where:"")+(c.group?" GROUP BY "+c.group:"")+" ORDER BY "+c.order;f+=" LIMIT 1",r>0&&(f+=" OFFSET "+r);var y=this,b=function(t,o){ydn.db.core.req.WebsqlCursor.DEBUG&&window.console.log([f,o]),o.rows.length>0?y.collect(o.rows.item(0)):y.collect(),e.call(y,y.current_key_,y.current_primary_key_,y.current_value_),e=null},m=function(t,o){return ydn.db.core.req.WebsqlCursor.DEBUG&&window.console.log([f,o]),y.logger.warning("get error: "+o.message),y.onError(o),y.collect(),e.call(y,y.current_primary_key_,y.current_key_,y.current_value_),e=null,!1};this.logger.finest(this+": continuePrimary:  SQL: "+f+" : "+ydn.json.stringify(n)),this.tx.executeSql(f,n,b,m)},ydn.db.core.req.WebsqlCursor.prototype.continueEffectiveKey_=function(e,t,o,r,n){var i,s=!o,a=[];if(this.is_index&&goog.isDefAndNotNull(n)&&goog.isDefAndNotNull(t))i=this.store_schema.sqlContinueIndexEffectiveKey(this.query_method,a,this.index_.getName(),this.key_range,t,s,n,this.reverse,this.unique);else if(goog.isDefAndNotNull(t)){var g=this.index_?this.index_.getName():null;i=this.store_schema.sqlContinueEffectiveKey(this.query_method,a,g,this.key_range,this.reverse,this.unique,t,s)}else{var d=this.isPrimaryCursor()?this.store_schema.getSQLKeyColumnName():this.index_.getSQLIndexColumnName();if(i=this.store_schema.toSql(a,this.query_method,d,this.key_range,this.reverse,this.unique),this.isIndexCursor()){{this.reverse?"DESC":"ASC"}i+=", "+this.store_schema.getSQLKeyColumnNameQuoted()+" ASC"}}i+=" LIMIT 1",r>0&&(i+=" OFFSET "+r);var u=this,l=function(t,o){o.rows.length>0?u.collect(o.rows.item(0)):u.collect(),e.call(u,u.current_key_,u.current_primary_key_,u.current_value_),e=null},c=function(t,o){return ydn.db.core.req.WebsqlCursor.DEBUG&&window.console.log([i,t,o]),u.logger.warning("get error: "+o.message),u.onError(o),u.collect(),e.call(u,u.current_primary_key_,u.current_key_,u.current_value_),e=null,!1};this.logger.finest(this+": continue:  SQL: "+i+" : "+ydn.json.stringify(a)),this.tx.executeSql(i,a,l,c)},ydn.db.core.req.WebsqlCursor.callback,ydn.db.core.req.WebsqlCursor.prototype.hasCursor=function(){return this.isActive()},ydn.db.core.req.WebsqlCursor.prototype.update=function(e){if(!this.hasCursor())throw new ydn.db.InvalidAccessError;var t=new goog.async.Deferred,o=this,r=this.getPrimaryKey(),n=function(e,o){ydn.db.core.req.WebsqlCursor.DEBUG&&window.console.log([a,o]),t.callback(r)},i=function(e,o){return ydn.db.core.req.WebsqlCursor.DEBUG&&window.console.log([a,e,o]),t.errback(o),!1};goog.asserts.assertObject(e);var s=o.store_schema.sqlNamesValues(e,r),a="REPLACE INTO "+this.store_schema.getQuotedName()+" ("+s.columns.join(", ")+") VALUES ("+s.slots.join(", ")+")";return o.logger.finest(this+': update "'+a+'" : '+ydn.json.stringify(s.values)),this.tx.executeSql(a,s.values,n,i),t},ydn.db.core.req.WebsqlCursor.MONITOR=!0,ydn.db.core.req.WebsqlCursor.prototype.advance=function(e){var t=this.current_key_,o=this.current_primary_key_,r=function(e,r,n){var i=goog.isDefAndNotNull(t)&&goog.isDefAndNotNull(e)&&0==ydn.db.cmp(t,e);if(this.isPrimaryCursor()){if(i)throw new ydn.debug.error.InternalError("current: "+t+" next: "+e)}else{var s=goog.isDefAndNotNull(r)&&goog.isDefAndNotNull(o)&&0==ydn.db.cmp(r,o);if(i&&s)throw new ydn.debug.error.InternalError("current: "+t+";"+o+" next: "+e+";"+r)}this.onSuccess(e,r,n)};goog.asserts.assert(e>0);var n=!0;goog.isDefAndNotNull(this.current_key_)&&(this.isPrimaryCursor()||goog.isDefAndNotNull(this.current_primary_key_))&&(e-=1,n=!1),this.continueEffectiveKey_(ydn.db.core.req.WebsqlCursor.MONITOR?r:this.onSuccess,this.current_key_,n,e,this.current_primary_key_)},ydn.db.core.req.WebsqlCursor.prototype.continueEffectiveKey=function(e){goog.isDefAndNotNull(e)?this.continueEffectiveKey_(this.onSuccess,e,!0):this.advance(1)},ydn.db.core.req.WebsqlCursor.prototype.prepareBaseSql=function(e){var t=this.index_?this.index_.getSQLIndexColumnName():this.store_schema.getSQLKeyColumnName(),o=this.store_schema.inSql(e,this.query_method,t,this.key_range,this.reverse,this.unique);return o},ydn.db.core.req.WebsqlCursor.prototype.openCursor=function(e,t){this.continueEffectiveKey_(this.onSuccess,e,!1,0,t)},ydn.db.core.req.WebsqlCursor.prototype.clear=function(){if(!this.hasCursor())throw new ydn.db.InvalidAccessError;var e=new goog.async.Deferred,t=this,o=function(t,o){ydn.db.core.req.WebsqlCursor.DEBUG&&window.console.log([i,o]),e.callback(o.rowsAffected)},r=function(t,o){return ydn.db.core.req.WebsqlCursor.DEBUG&&window.console.log([i,t,o]),e.errback(o),!1},n=this.store_schema.getSQLKeyColumnName(),i="DELETE FROM "+this.store_schema.getQuotedName()+" WHERE "+n+" = ?",s=[this.getPrimaryKey()];return t.logger.finest(this+': clear "'+i+'" : '+ydn.json.stringify(s)),this.tx.executeSql(i,s,o,r),e},ydn.db.core.req.WebsqlCursor.prototype.continuePrimaryKey=function(e){goog.asserts.assert(this.isIndexCursor()),goog.asserts.assert(goog.isDefAndNotNull(this.current_key_)),goog.asserts.assert(goog.isDefAndNotNull(this.current_primary_key_));var t=ydn.db.cmp(e,this.current_primary_key_);if(0==t||1==t&&this.reverse||-1==t&&!this.reverse)throw new ydn.error.InvalidOperationError(this+" to continuePrimaryKey  from "+this.current_primary_key_+" to "+e+" on "+this.dir+" direction is wrong");this.continuePrimaryKey_(this.onSuccess,e,!0)},goog.DEBUG&&(ydn.db.core.req.WebsqlCursor.prototype.toString=function(){return"WebSql"+goog.base(this,"toString")}),goog.provide("ydn.db.crud.req.WebSql"),goog.require("goog.async.Deferred"),goog.require("goog.debug.Logger"),goog.require("ydn.db.Where"),goog.require("ydn.db.crud.req.IRequestExecutor"),goog.require("ydn.db.crud.req.RequestExecutor"),goog.require("ydn.json"),ydn.db.crud.req.WebSql=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.crud.req.WebSql,ydn.db.crud.req.RequestExecutor),ydn.db.crud.req.WebSql.DEBUG=!1,ydn.db.crud.req.WebSql.REQ_PER_TX=10,ydn.db.crud.req.WebSql.RW_REQ_PER_TX=2,ydn.db.crud.req.WebSql.prototype.logger=goog.debug.Logger.getLogger("ydn.db.crud.req.WebSql"),ydn.db.crud.req.WebSql.parseRow=function(e,t){if(t.isFixed()&&!t.usedInlineKey()&&0==t.countIndex()&&e[ydn.db.base.DEFAULT_BLOB_COLUMN]){var o=e[ydn.db.base.DEFAULT_BLOB_COLUMN],r=";base64,";if(-1==o.indexOf(r))return ydn.json.parse(o);'"'==o.charAt(0)&&'"'==o.charAt(o.length-1)&&(o=o.substr(1,o.length-2));for(var n=o.split(r),i=n[0].split(":")[1],s=window.atob(n[1]),a=s.length,g=new Uint8Array(a),d=0;a>d;++d)g[d]=s.charCodeAt(d);return new Blob([g.buffer],{type:i})}var u=e[ydn.db.base.DEFAULT_BLOB_COLUMN]?ydn.json.parse(e[ydn.db.base.DEFAULT_BLOB_COLUMN]):{};if(goog.isDefAndNotNull(t.keyPath)){var l=ydn.db.schema.Index.sql2js(e[t.keyPath],t.getType());goog.isDefAndNotNull(l)&&t.setKeyValue(u,l)}for(var c=0;c<t.countIndex();c++){var h=t.index(c),p=h.getSQLIndexColumnName();if(p!=ydn.db.base.DEFAULT_BLOB_COLUMN&&!h.isComposite()&&!h.isMultiEntry()&&(h.getType()==ydn.db.schema.DataType.DATE||t.isFixed())){var f=e[p],y=ydn.db.schema.Index.sql2js(f,h.getType());goog.isDef(y)&&h.applyValue(u,y)}}return u},ydn.db.crud.req.WebSql.prototype.getKeyFromRow=function(e,t){return t[e.keyPath||ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME]},ydn.db.crud.req.WebSql.prototype.putByKeys=goog.abstractMethod,ydn.db.crud.req.WebSql.prototype.putData=function(){throw new ydn.debug.error.NotImplementedException("putData")},ydn.db.crud.req.WebSql.prototype.insertObjects=function(e,t,o,r,n,i){var s=!t,a=this.schema.getStore(r),g=s?"INSERT INTO ":"INSERT OR REPLACE INTO ",d=e.getTx(),u=this,l=[],c=0,h=e.getLabel()+" inserting "+n.length+" objects.",p=!1,f=function(t,r){if(!goog.isDefAndNotNull(n[t]))if(u.logger.finest("empty object at "+t+" of "+n.length),c++,c==n.length)u.logger.finer(h+" success "+h),e.setDbValue(l,p);
else{var s=t+ydn.db.crud.req.WebSql.RW_REQ_PER_TX;s<n.length&&f(s,r)}var d;d=goog.isDef(i)?a.sqlNamesValues(n[t],i[t]):a.sqlNamesValues(n[t]);var y=g+a.getQuotedName()+" ("+d.columns.join(", ")+") VALUES ("+d.slots.join(", ")+");",b=e.getLabel()+" SQL: "+y+" PARAMS: "+d.values+" REQ: "+t+" of "+n.length,m=function(i,s){c++;var h=goog.isDef(d.key)?d.key:s.insertId;s.rowsAffected<1&&(p=!0,h=new ydn.db.ConstraintError(h+" no-op"));for(var y=function(t,o){var n=ydn.db.base.PREFIX_MULTIENTRY+a.getName()+":"+t.getName(),i=g+goog.string.quote(n)+" ("+a.getSQLKeyColumnNameQuoted()+", "+t.getSQLIndexColumnNameQuoted()+") VALUES (?, ?)",s=[ydn.db.schema.Index.js2sql(h,a.getType()),ydn.db.schema.Index.js2sql(o,t.getType())],d=function(){},l=function(e,t){return u.logger.warning("multiEntry index insert error: "+t.message),!1};u.logger.finest(e.getLabel()+" multiEntry "+i+" "+s),r.executeSql(i,s,d,l)},b=0,m=a.countIndex();m>b;b++){var v=a.index(b);if(v.isMultiEntry())for(var _=ydn.db.utils.getValueByKeys(n[t],v.getKeyPath()),E=(_?_.length:0)||0,S=0;E>S;S++)y(v,_[S])}if(o)e.setDbValue(h);else if(l[t]=h,c==n.length)e.setDbValue(l,p);else{var x=t+ydn.db.crud.req.WebSql.RW_REQ_PER_TX;x<n.length&&f(x,i)}},v=function(r,i){if(ydn.db.crud.req.WebSql.DEBUG&&window.console.log([y,d,r,i]),c++,p=!0,6==i.code?i.name="ConstraintError":u.logger.warning("error: "+i.message+" "+h),o)e.setDbValue(i,!0);else if(l[t]=i,c==n.length)u.logger.finest("success "+h),e.setDbValue(l,p);else{var s=t+ydn.db.crud.req.WebSql.RW_REQ_PER_TX;s<n.length&&f(s,r)}return!1};u.logger.finest(b),ydn.db.crud.req.WebSql.DEBUG&&window.console.log(y,d.values),r.executeSql(y,d.values,m,v)};if(n.length>0)for(var y=0;y<ydn.db.crud.req.WebSql.RW_REQ_PER_TX&&y<n.length;y++)f(y,d);else this.logger.finer("success"),e.setDbValue([])},ydn.db.crud.req.WebSql.prototype.putByKeys=function(e,t,o){if(0==o.length)return e.setDbValue([]),void 0;for(var r=(e.getTx(),[]),n=0,i=0,s=this,a=function(a,g){var d=[];s.logger.finest("put "+g.length+" objects to "+a);for(var u=s.schema.getStore(a),l=u.usedInlineKey(),c=l?void 0:[],h=0;h<g.length;h++)d.push(t[g[h]]),l||c.push(o[g[h]].getId());var p=e.copy();p.addCallbacks(function(t){for(var o=0;o<g.length;o++)r[g[o]]=t[o];n++,n==i&&e.setDbValue(r)},function(){n++,n==i&&e.setDbValue(r,!0)}),s.insertObjects(p,!1,!1,a,d,c)},g="",d=[],u=[],l=0;l<o.length;l++){var c=o[l].getStoreName(),h=o[l].getId();c!=g?(i++,d.length>0&&a(g,d),d=[l],u=[h],g=c):(d.push(l),u.push(h))}d.length>0&&a(g,d)},ydn.db.crud.req.WebSql.prototype.getById=function(e,t,o){var r=e.getTx(),n=this.schema.getStore(t);goog.asserts.assertInstanceof(n,ydn.db.schema.Store,t+" not found.");var i=this,s=n.getSQLKeyColumnNameQuoted(),a=[ydn.db.schema.Index.js2sql(o,n.getType())],g="SELECT * FROM "+n.getQuotedName()+" WHERE "+s+" = ?",d=e.getLabel()+" SQL: "+g+" PARAMS: "+a,u=function(t,o){if(o.rows.length>0){var r=o.rows.item(0);if(goog.isDefAndNotNull(r)){var s=ydn.db.crud.req.WebSql.parseRow(r,n);e.setDbValue(s)}else i.logger.finer("success no result: "+d),e.setDbValue(void 0)}else i.logger.finer("success no result: "+d),e.setDbValue(void 0)},l=function(t,o){return ydn.db.crud.req.WebSql.DEBUG&&window.console.log([t,o]),i.logger.warning("error: "+d+" "+o.message),e.setDbValue(o,!0),!1};this.logger.finest(d),r.executeSql(g,a,u,l)},ydn.db.crud.req.WebSql.prototype.listByIds=function(e,t,o){var r=e.getTx(),n=this,i=[],s=0,a=this.schema.getStore(t),g=function(t,r){var d=function(r,n){if(s++,n.rows.length>0){var d=n.rows.item(0);goog.isDefAndNotNull(d)&&(i[t]=ydn.db.crud.req.WebSql.parseRow(d,a))}else i[t]=void 0;if(s==o.length)e.setDbValue(i);else{var u=t+ydn.db.crud.req.WebSql.REQ_PER_TX;u<o.length&&g(u,r)}},u=function(r,a){if(s++,ydn.db.crud.req.WebSql.DEBUG&&window.console.log([r,a]),n.logger.warning("error: "+p+" "+a.message),s==o.length)e.setDbValue(i);else{var d=t+ydn.db.crud.req.WebSql.REQ_PER_TX;d<o.length&&g(d,r)}return!1},l=o[t],c=a.getSQLKeyColumnNameQuoted(),h=[ydn.db.schema.Index.js2sql(l,a.getType())],p="SELECT * FROM "+a.getQuotedName()+" WHERE "+c+" = ?";n.logger.finest("SQL: "+p+" PARAMS: "+h),r.executeSql(p,h,d,u)};if(o.length>0)for(var d=0;d<ydn.db.crud.req.WebSql.REQ_PER_TX&&d<o.length;d++)g(d,r);else n.logger.finer("success"),e.setDbValue([])},ydn.db.crud.req.WebSql.prototype.listByKeys=function(e,t){var o=e.getTx(),r=this,n=[],i=0,s=function(o,a){var g=t[o],d=g.getStoreName(),u=r.schema.getStore(d),l=function(a,g){if(i++,g.rows.length>0){var d=g.rows.item(0);goog.isDefAndNotNull(d)&&(n[o]=ydn.db.crud.req.WebSql.parseRow(d,u))}else n[o]=void 0;if(i==t.length)r.logger.finest("success "+y),e.setDbValue(n);else{var l=o+ydn.db.crud.req.WebSql.REQ_PER_TX;l<t.length&&s(l,a)}},c=function(t,o){return ydn.db.crud.req.WebSql.DEBUG&&window.console.log([t,o]),e.setDbValue(o,!0),!1},h=g.getNormalizedId(),p=u.getSQLKeyColumnNameQuoted(),f=[ydn.db.schema.Index.js2sql(h,u.getType())],y="SELECT * FROM "+u.getQuotedName()+" WHERE "+p+" = ?";r.logger.finest("SQL: "+y+" PARAMS: "+f),a.executeSql(y,f,l,c)};if(t.length>0)for(var a=0;a<ydn.db.crud.req.WebSql.REQ_PER_TX&&a<t.length;a++)s(a,o);else this.logger.finest("success"),e.setDbValue([])},ydn.db.crud.req.WebSql.prototype.clearByStores=function(e,t){var o=e.getTx(),r=this,n=function(o,i){var s=r.schema.getStore(t[o]),a="DELETE FROM  "+s.getQuotedName(),g=function(i){o==t.length-1?(r.logger.finest("success "+a),e.setDbValue(t.length)):n(o+1,i)},d=function(t,o){return ydn.db.crud.req.WebSql.DEBUG&&window.console.log([t,o]),e.setDbValue(o,!0),!1};r.logger.finest("SQL: "+a+" PARAMS: []"),i.executeSql(a,[],g,d);for(var u=function(e){var t=ydn.db.base.PREFIX_MULTIENTRY+s.getName()+":"+e.getName(),o="DELETE FROM  "+goog.string.quote(t);r.logger.finest("SQL: "+o),i.executeSql(o,[])},l=0,c=s.countIndex();c>l;l++){var h=s.index(l);h.isMultiEntry()&&u(h)}};t.length>0?n(0,o):(this.logger.finest("success"),e.setDbValue(0))},ydn.db.crud.req.WebSql.prototype.removeByKeys=function(e,t){var o=e.getTx(),r=this,n=0,i=!1,s=e.getLabel()+" removeByKeys: "+t.length+" keys";this.logger.finest(s);var a=function(s){if(s>=t.length)return e.setDbValue(n,i),void 0;var g=r.schema.getStore(t[s].getStoreName()),d=ydn.db.schema.Index.js2sql(t[s].getId(),g.getType()),u=function(e,t){ydn.db.crud.req.WebSql.DEBUG&&window.console.log(t),n++,a(s)},l=function(e,t){return ydn.db.crud.req.WebSql.DEBUG&&window.console.log([e,t]),r.logger.warning("error: "+p+t.message),i=!0,a(s),!1},c=" WHERE "+g.getSQLKeyColumnNameQuoted()+" = ?",h="DELETE FROM "+g.getQuotedName()+c,p=e.getLabel()+" SQL: "+h+" PARAMS: "+[d];ydn.db.crud.req.WebSql.DEBUG&&window.console.log(p),o.executeSql(h,[d],u,l),s++;for(var f=function(t){var n=ydn.db.base.PREFIX_MULTIENTRY+g.getName()+":"+t.getName(),i="DELETE FROM  "+goog.string.quote(n)+c;r.logger.finest(e.getLabel()+0/0+i),o.executeSql(i,[d])},y=0,b=g.countIndex();b>y;y++){var m=g.index(y);m.isMultiEntry()&&f(m)}};a(0)},ydn.db.crud.req.WebSql.prototype.removeById=function(e,t,o){var r=e.getTx(),n=this.schema.getStore(t),i=ydn.db.schema.Index.js2sql(o,n.getType()),s=this,a=function(t,o){ydn.db.crud.req.WebSql.DEBUG&&window.console.log(o),e.setDbValue(o.rowsAffected)},g=function(t,o){return ydn.db.crud.req.WebSql.DEBUG&&window.console.log([t,o]),e.setDbValue(o,!0),!1},d=" WHERE "+n.getSQLKeyColumnNameQuoted()+" = ?",u="DELETE FROM "+n.getQuotedName()+d,l=e.getLabel()+" SQL: "+u+" PARAMS: "+[i];this.logger.finest(l),r.executeSql(u,[i],a,g);for(var c=function(t){var o=ydn.db.base.PREFIX_MULTIENTRY+n.getName()+":"+t.getName(),a="DELETE FROM  "+goog.string.quote(o)+d;s.logger.finest(e.getLabel()+0/0+a),r.executeSql(a,[i])},h=0,p=n.countIndex();p>h;h++){var f=n.index(h);f.isMultiEntry()&&c(f)}},ydn.db.crud.req.WebSql.prototype.clearByKeyRange=function(e,t,o){this.clear_by_key_range_(e,t,void 0,o)},ydn.db.crud.req.WebSql.prototype.removeByKeyRange=function(e,t,o){this.clear_by_key_range_(e,t,void 0,o)},ydn.db.crud.req.WebSql.prototype.removeByIndexKeyRange=function(e,t,o,r){this.clear_by_key_range_(e,t,o,r)},ydn.db.crud.req.WebSql.prototype.clear_by_key_range_=function(e,t,o,r){var n=e.getTx(),i=this,s=this.schema.getStore(t),a="DELETE FROM "+s.getQuotedName(),g=[],d=[],u="";if(goog.isDefAndNotNull(r)){if(goog.isDef(o)){var l=s.getIndex(o);ydn.db.KeyRange.toSql(l.getSQLIndexColumnNameQuoted(),l.getType(),r,d,g)}else ydn.db.KeyRange.toSql(s.getSQLKeyColumnNameQuoted(),s.getType(),r,d,g);u=" WHERE "+d.join(" AND ")}a+=u;var c=function(t,o){i.logger.finest("success "+p),e.setDbValue(o.rowsAffected)},h=function(t,o){return ydn.db.crud.req.WebSql.DEBUG&&window.console.log([t,o]),i.logger.warning("error: "+p+o.message),e.setDbValue(o,!0),!1},p=e.getLabel()+" SQL: "+a+" PARAMS: "+g;this.logger.finest(p),n.executeSql(a,g,c,h);for(var f=function(t){var o=ydn.db.base.PREFIX_MULTIENTRY+s.getName()+":"+t.getName(),r="DELETE FROM  "+goog.string.quote(o)+u;i.logger.finest(e.getLabel()+0/0+r),n.executeSql(r,d)},y=0,b=s.countIndex();b>y;y++){var m=s.index(y);m.isMultiEntry()&&f(m)}},ydn.db.crud.req.WebSql.prototype.countStores=function(e,t){var o=e.getTx(),r=this,n=[],i=function(s){var a=t[s],g="SELECT COUNT(*) FROM "+goog.string.quote(a),d=function(o,r){var a=r.rows.item(0);n[s]=parseInt(a["COUNT(*)"],10),s++,s==t.length?e.setDbValue(n):i(s)},u=function(t,o){return ydn.db.crud.req.WebSql.DEBUG&&window.console.log([t,o]),e.setDbValue(o,!0),!1};r.logger.finest("SQL: "+g+" PARAMS: []"),o.executeSql(g,[],d,u)};0==t.length?(this.logger.finest("success"),e.setDbValue(0)):i(0)},ydn.db.crud.req.WebSql.prototype.countKeyRange=function(e,t,o,r,n){var i=[],s=this.schema.getStore(t),a=s.toSql(i,ydn.db.base.QueryMethod.COUNT,r,o,!1,n),g=function(t,o){ydn.db.crud.req.WebSql.DEBUG&&window.console.log([a,o]);var r=o.rows.item(0);e.setDbValue(ydn.object.takeFirst(r))},d=function(t,o){return ydn.db.crud.req.WebSql.DEBUG&&window.console.log([a,o]),e.setDbValue(o,!0),!1},u=e.getLabel()+" SQL: "+a+" PARAMS: "+i;this.logger.finest(u),e.getTx().executeSql(a,i,g,d)},ydn.db.crud.req.WebSql.prototype.list=function(e,t,o,r,n,i,s,a,g,d){var u=this,l=[],c=this.schema.getStore(o),h=c.getSQLKeyColumnName(),p=c.getType(),f=p,y=goog.isDefAndNotNull(r)&&r!==h?c.getIndex(r):null,b=r||h;y&&(f=y.getType());var m,v=[];if(d&&goog.isDef(d[0])){var _=d[0];if(y&&goog.isDef(d[1])){var E=d[1];m=c.sqlContinueIndexEffectiveKey(t,v,y.getName(),n,_,!0,E,a,g)}else m=c.sqlContinueEffectiveKey(t,v,r,n,a,g,_,!0)}else m=c.toSql(v,t,b,n,a,g);goog.isNumber(i)&&(m+=" LIMIT "+i),goog.isNumber(s)&&(m+=" OFFSET "+s);var S=function(o,r){var n=r.rows.length;ydn.db.crud.req.WebSql.DEBUG&&window.console.log(r);for(var i,s=0;n>s;s++)i=r.rows.item(s),ydn.db.crud.req.WebSql.DEBUG&&window.console.log(i),t==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?l[s]=ydn.db.schema.Index.sql2js(i[h],p):t==ydn.db.base.QueryMethod.LIST_KEY?l[s]=ydn.db.schema.Index.sql2js(i[b],f):t==ydn.db.base.QueryMethod.LIST_KEYS?l[s]=[ydn.db.schema.Index.sql2js(i[b],f),ydn.db.schema.Index.sql2js(i[h],p)]:goog.isDefAndNotNull(i)&&(l[s]=ydn.db.crud.req.WebSql.parseRow(i,c));u.logger.finer("success "+e),d&&i&&(d[0]=ydn.db.schema.Index.sql2js(i[b],f),d[1]=ydn.db.schema.Index.sql2js(i[h],p)),e.setDbValue(l)},x=e+" SQL: "+m+" ;params= "+ydn.json.stringify(v),w=function(t,o){return ydn.db.crud.req.WebSql.DEBUG&&window.console.log([t,o]),u.logger.warning("error: "+x+o.message),e.setDbValue(o,!0),!1};this.logger.finest(x),e.getTx().executeSql(m,v,S,w)},goog.provide("ydn.db.core.req.WebSql"),goog.require("goog.async.Deferred"),goog.require("goog.debug.Logger"),goog.require("ydn.db.core.req.CachedWebsqlCursor"),goog.require("ydn.db.core.req.IRequestExecutor"),goog.require("ydn.db.core.req.WebsqlCursor"),goog.require("ydn.db.crud.req.WebSql"),goog.require("ydn.json"),ydn.db.core.req.WebSql=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.core.req.WebSql,ydn.db.crud.req.WebSql),ydn.db.core.req.WebSql.DEBUG=!1,ydn.db.core.req.WebSql.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.req.WebSql"),ydn.db.core.req.WebSql.prototype.getCursor=function(e,t,o,r){var n=this.schema.getStore(o);return goog.asserts.assertObject(n,'store "'+o+'" not found.'),new ydn.db.core.req.WebsqlCursor(e,t,n,r)},ydn.db.core.req.WebSql.prototype.getStreamer=function(){throw"not yet"},goog.provide("ydn.db.core.Storage.inject_executor"),goog.require("ydn.db.core.Storage"),goog.require("ydn.db.core.req.IndexedDb"),goog.require("ydn.db.core.req.SimpleStore"),goog.require("ydn.db.core.req.WebSql"),ydn.db.core.Storage.prototype.newExecutor=function(){var e=this.getType();if(e==ydn.db.base.Mechanisms.IDB)return new ydn.db.core.req.IndexedDb(this.db_name,this.schema);if(e==ydn.db.base.Mechanisms.WEBSQL)return new ydn.db.core.req.WebSql(this.db_name,this.schema);if(e==ydn.db.base.Mechanisms.MEMORY_STORAGE||e==ydn.db.base.Mechanisms.LOCAL_STORAGE||e==ydn.db.base.Mechanisms.USER_DATA||e==ydn.db.base.Mechanisms.SESSION_STORAGE)return new ydn.db.core.req.SimpleStore(this.db_name,this.schema);throw new ydn.debug.error.InternalError("No executor for "+e)},goog.provide("ydn.db.sql.req.IterableQuery"),goog.require("ydn.db.Iterator"),goog.require("goog.functions"),goog.require("ydn.db.KeyRange"),goog.require("ydn.db.Where"),goog.require("ydn.error.ArgumentException"),ydn.db.sql.req.IterableQuery=function(e,t,o,r,n,i,s,a){goog.base(this,e,t,o,r,n,i),this.initial=null,this.map=null,this.reduce=null,this.finalize=null,this.filter_fn=s||null,this.continued=a||null},goog.inherits(ydn.db.sql.req.IterableQuery,ydn.db.Iterator),ydn.db.sql.req.IterableQuery.prototype.toJSON=function(){var e=goog.base(this,"toJSON");return e.initial=this.initial?this.initial.toString():null,e.map=this.map?this.map.toString():null,e.reduce=this.reduce?this.reduce.toString():null,e.finalize=this.finalize?this.finalize.toString():null,e},ydn.db.sql.req.IterableQuery.prototype.initial=null,ydn.db.sql.req.IterableQuery.prototype.map=null,ydn.db.sql.req.IterableQuery.prototype.reduce=null,ydn.db.sql.req.IterableQuery.prototype.finalize=null,ydn.db.sql.req.IterableQuery.prototype.toString=function(){var e=goog.isDef(this.getIndexName())?":"+this.getIndexName():"";return"Cursor:"+this.getStoreName()+e},ydn.db.sql.req.IterableQuery.prototype.processWhereAsFilter=function(e){var t=goog.functions.TRUE;goog.isFunction(this.filter_fn)&&(t=this.filter_fn),this.filter_fn=function(o){var r=o[e.getField()],n=!0,i=e.getKeyRange();if(i){goog.isDefAndNotNull(i.lower)&&(n=i.lowerOpen?r<i.lower:r<=i.lower);var s=!0;goog.isDefAndNotNull(i.upper)&&(s=i.upperOpen?r>i.upper:r>=i.upper)}return t(o)&&n&&s}},goog.provide("ydn.db.sql.req.IdbQuery"),goog.require("ydn.db.sql.req.IterableQuery"),goog.require("goog.functions"),goog.require("ydn.db.KeyRange"),goog.require("ydn.db.Where"),goog.require("ydn.error.ArgumentException"),ydn.db.sql.req.IdbQuery=function(e,t,o,r,n,i,s,a){goog.base(this,e,t,o,r,n,i,s,a)},goog.inherits(ydn.db.sql.req.IdbQuery,ydn.db.sql.req.IterableQuery),ydn.db.sql.req.IdbQuery.Methods={OPEN:"op",COUNT:"cn"},ydn.db.sql.req.IdbQuery.prototype.method=ydn.db.sql.req.IdbQuery.Methods.OPEN,goog.provide("ydn.string"),ydn.string.split_comma_seperated=function(e){return e.match(/(?:"[^"]*"|[^,])+/g)},ydn.string.split_space_seperated=function(e){return e.match(/\w+|"[^"]+"/g)},ydn.string.split_space=function(e){return e.match(/[^\s"']+|"[^"]*"|'[^']*'/g)},goog.provide("ydn.math.Expression"),goog.require("ydn.string"),goog.require("goog.string"),goog.require("ydn.object"),goog.require("ydn.error"),ydn.math.Expression=function(e){this.tokens=e},ydn.math.Expression.prototype.tokens=[],ydn.math.Expression.prototype.evaluate=function(e){for(var t=[],o=0;o<this.tokens.length;o++){var r=this.tokens[o],n='"'===r[0]&&'"'===r[r.length-1],i="'"===r[0]&&"'"===r[r.length-1];if(n){var s=goog.string.stripQuotes(r,'"').split(".");goog.asserts.assertObject(e);var a=goog.object.getValueByKeys(e,s);t.push(a)}else if(i)t.push(goog.string.stripQuotes(r,"'"));else if(goog.isString(r))if("true"===r)t.push(!0);else if("false"===r)t.push(!1);else if("Date"===r)t.push(new Date(parseInt(t.pop(),10)));else if("now"===r)t.push(new Date);else if("!"===r)t[t.length-1]=!t[t.length-1];else if("=="===r)t.push(t.pop()==t.pop());else if("==="===r)t.push(t.pop()===t.pop());else if("!="===r)t.push(t.pop()!=t.pop());else if("!=="===r)t.push(t.pop()!==t.pop());else if("<="===r)t.push(t.pop()<=t.pop());else if("<"===r)t.push(t.pop()<t.pop());else if(">="===r)t.push(t.pop()>=t.pop());else if(">"===r)t.push(t.pop()>t.pop());else if("&"===r)t.push(t.pop()&t.pop());else if("|"===r)t.push(t.pop()|t.pop());else if("?"===r){var g=!!t.pop(),d=t.pop(),u=t.pop(),l=g?d:u;t.push(l)}else if("+"===r)t.push(t.pop()+t.pop());else if("-"===r)t.push(t.pop()-t.pop());else if("*"===r)t.push(t.pop()*t.pop());else if("/"===r)t.push(t.pop()/t.pop());else if("%"===r)t.push(t.pop()%t.pop());else if("at"===r){var c=t.pop(),h=t.pop();t.push(h[c])}else if("of"===r){var p=t.pop(),h=t.pop(),l=goog.isArray(h)?h.indexOf(p):-1;t.push(l)}else if("in"===r){var p=t.pop(),h=t.pop(),l=goog.isArray(h)?h.indexOf(p)>=0:!1;t.push(l)}else if("abs"===r)t[t.length-1]=Math.abs(t[t.length-1]);else if("$"==r[0]&&/^\$\d$/.test(r)){var f=parseInt(r.match(/^\$(\d)$/)[1],10);t.push(arguments[f])}else t.push(parseFloat(r));else t.push(r)}return t[0]},ydn.math.Expression.prototype.compile=function(){this.tokens;return function(){var e=arguments.length>2?Array.prototype.slice(arguments,2):void 0;return ydn.math.Expression.prototype.evaluate.apply(null,e)}},ydn.math.Expression.prototype.toJSON=function(){return{Tokens:ydn.object.clone(this.tokens)}},ydn.math.Expression.parseRpn=function(e){return new ydn.math.Expression(ydn.string.split_space(e))},ydn.math.Expression.parseInfix=function(){throw new ydn.error.NotImplementedException("Too lazy to learn Dutch in Shunting Yard station, we speak Polish here.")},goog.provide("ydn.db.Sql"),goog.require("goog.functions"),goog.require("ydn.db.KeyRange"),goog.require("ydn.db.Where"),goog.require("ydn.db.schema.Database"),goog.require("ydn.db.sql.req.IdbQuery"),goog.require("ydn.error.ArgumentException"),goog.require("ydn.math.Expression"),goog.require("ydn.string"),ydn.db.Sql=function(e){if(!goog.isString(e))throw new ydn.error.ArgumentException;this.sql_=e,this.mode_=ydn.db.base.TransactionMode.READ_WRITE,this.store_names_=[],this.parseBasic_(e),this.last_error_="",this.has_parsed_=!1},ydn.db.Sql.prototype.sql_="",ydn.db.Sql.prototype.modifier_,ydn.db.Sql.prototype.condition_,ydn.db.Sql.prototype.aggregate_,ydn.db.Sql.prototype.order_,ydn.db.Sql.prototype.limit_=0/0,ydn.db.Sql.prototype.offset_=0/0,ydn.db.Sql.prototype.reverse_=!1,ydn.db.Sql.prototype.selList_,ydn.db.Sql.prototype.last_error_="",ydn.db.Sql.prototype.has_parsed_=!1,ydn.db.Sql.prototype.parseBasic_=function(e){var t=e.split(/\sFROM\s/i);if(2==t.length){var o=t[0],r=t[1],n=o.match(/\s*?(SELECT|INSERT|UPDATE|DELETE)\s+(.*)/i);if(3==n.length){if(this.action_=n[1].toUpperCase(),"SELECT"==this.action_)this.mode_=ydn.db.base.TransactionMode.READ_ONLY;else if("INSERT"==this.action_)this.mode_=ydn.db.base.TransactionMode.READ_WRITE;else if("UPDATE"==this.action_)this.mode_=ydn.db.base.TransactionMode.READ_WRITE;else{if("DELETE"!=this.action_)return;this.mode_=ydn.db.base.TransactionMode.READ_WRITE}var i=n[2].trim(),s=i.match(/^(MIN|MAX|COUNT|AVG|SUM)/i);s?(this.aggregate_=s[0].toUpperCase(),i=i.replace(/^(MIN|MAX|COUNT|AVG|SUM)/i,"").trim()):this.aggregate_=void 0,"("==i.charAt(0)&&(")"==i.charAt(i.length-1)?i=i.substring(1,i.length-1):new ydn.db.SqlParseError("missing closing parentheses")),this.selList_=i;var a=r.search(/(ORDER BY|LIMIT|OFFSET)/i);a>0?(this.modifier_=r.substring(a),r=r.substring(0,a)):this.modifier_="";var g=r.search(/WHERE/i);g>0?(this.condition_=r.substring(g+6).trim(),r=r.substring(0,g)):this.condition_="";var d=r.trim().split(",");this.store_names_=d.map(function(e){return e=goog.string.stripQuotes(e,'"'),e=goog.string.stripQuotes(e,"'"),e.trim()}),this.has_parsed_=!0}}},ydn.db.Sql.prototype.parse=function(e){if(e){for(var t=0;t<e.length;t++)this.sql_=this.sql_.replace("?",e[t]);this.parseBasic_(this.sql_)}if(this.wheres_=this.parseConditions(),!this.wheres_)return this.last_error_;var o=this.modifier_.length,r=/OFFSET\s+(\d+)/i.exec(this.modifier_);r&&(this.offset_=parseInt(r[1],10),o=this.modifier_.search(/OFFSET/i));var n=/LIMIT\s+(\d+)/i.exec(this.modifier_);if(n){this.limit_=parseInt(n[1],10);var i=this.modifier_.search(/LIMIT/i);o>i&&(o=i)}var s=this.modifier_.substr(0,o),a=/ORDER BY\s+(.+)/i.exec(s);if(a){var g=a[1].trim(),d=g.match(/(ASC|DESC)/i);d?(this.reverse_="DESC"==d[0].toUpperCase(),g=g.replace(/\s+(ASC|DESC)/i,"")):this.reverse_=!1,this.order_=goog.string.stripQuotes(goog.string.stripQuotes(g,'"'),"'"),goog.asserts.assert(this.order_.length>0,"Invalid order by field")}else this.order_=void 0;return this.has_parsed_=!0,""},ydn.db.Sql.prototype.getSelList=function(){if("*"==this.selList_)return null;var e=this.selList_.split(",");return e=e.map(function(e){return goog.string.stripQuotes(e.trim(),'"')})},ydn.db.Sql.prototype.getSql=function(){return this.sql_},ydn.db.Sql.prototype.toJSON=function(){return{sql:this.sql_}},ydn.db.Sql.prototype.getStoreNames=function(){return goog.array.clone(this.store_names_)},ydn.db.Sql.prototype.getMode=function(){return this.mode_},ydn.db.Sql.prototype.getLimit=function(){return this.limit_},ydn.db.Sql.prototype.getOffset=function(){return this.offset_},ydn.db.Sql.prototype.getOrderBy=function(){return this.order_},ydn.db.Sql.prototype.isReversed=function(){return this.reverse_},ydn.db.Sql.prototype.getConditions=function(){return this.wheres_},ydn.db.Sql.prototype.parseConditions=function(){var e=[],t=/(.+?)(<=|>=|=|>|<)(.+)/i,o=function(t){return goog.array.findIndex(e,function(e){return e.getField()==t})};if(this.condition_.length>0)for(var r=this.condition_.split("AND"),n=0;n<r.length;n++){var i=r[n],s=t.exec(i);if(!s)return this.last_error_='Invalid clause "'+i+'"',null;var a=s[1].trim();if(a=goog.string.stripQuotes(a,'"'),a=goog.string.stripQuotes(a,"'"),!(a.length>0))return this.last_error_='Invalid clause "'+i+'"',null;var g=s[3].trim();g=goog.string.startsWith(g,'"')?goog.string.stripQuotes(g,'"'):goog.string.startsWith(g,"'")?goog.string.stripQuotes(g,"'"):parseFloat(g);var d=s[2],u=new ydn.db.Where(a,d,g),l=o(a);if(l>=0){if(e[l]=e[l].and(u),!e[l])return this.last_error_='where clause "'+i+'" conflict',null}else e.push(u)}return e},ydn.db.Sql.prototype.getAction=function(){return this.action_},ydn.db.Sql.prototype.toString=function(){return goog.DEBUG?"query:"+this.sql_:goog.base(this,"toString")},ydn.db.Sql.prototype.getAggregate=function(){return this.aggregate_},goog.provide("ydn.db.sql.req.IRequestExecutor"),goog.require("ydn.db.Sql"),goog.require("ydn.db.Streamer"),goog.require("ydn.db.crud.req.IRequestExecutor"),ydn.db.sql.req.IRequestExecutor=function(){},ydn.db.sql.req.IRequestExecutor.prototype.executeSql=goog.abstractMethod,goog.provide("ydn.db.sql.IStorage"),goog.require("ydn.db.sql.req.IRequestExecutor"),goog.require("ydn.db.core.IOperator"),ydn.db.sql.IStorage=function(){},goog.provide("ydn.db.sql.req.nosql.Node"),goog.require("ydn.db.Iterator"),goog.require("ydn.db.KeyRange"),goog.require("ydn.db.Sql"),goog.require("ydn.error.ArgumentException"),ydn.db.sql.req.nosql.Node=function(e,t){this.sql=t,this.store_schema=e},ydn.db.sql.req.nosql.Node.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sql.req.nosql.Node"),ydn.db.sql.req.nosql.Node.prototype.store_schema,ydn.db.sql.req.nosql.Node.prototype.sql,ydn.db.sql.req.nosql.Node.prototype.toJSON=function(){return{sql:this.sql}},ydn.db.sql.req.nosql.Node.prototype.toString=function(){return"idb.Node:"},ydn.db.sql.req.nosql.Node.prototype.execute=function(e,t){var o=this.sql.getStoreNames()[0],r=this.sql.getConditions(),n=this.sql.getLimit();n=isNaN(n)?ydn.db.base.DEFAULT_RESULT_LIMIT:n;var i=this.sql.getOffset();i=isNaN(i)?0:i;var s=this.sql.getOrderBy(),a=this.sql.getSelList(),g=null,d=this.sql.isReversed();if(0==r.length)g=null;else{if(1!=r.length)throw new ydn.debug.error.NotSupportedException("too many conditions.");g=ydn.db.KeyRange.parseIDBKeyRange(r[0].getKeyRange())}goog.isNull(a)||e.await(function(e,t,o){var r=e;t||(r=e.map(function(e){var t=a.length;if(1==t)return ydn.db.utils.getValueByKeys(e,a[0]);for(var o={},r=0;t>r;r++)o[a[r]]=ydn.db.utils.getValueByKeys(e,a[r]);return o})),o(r,t)});var u=r.length>0?r[0].getField():void 0,l=e.getLabel()+" executing on"+o;u&&(l+=":"+u),l+=" "+ydn.db.KeyRange.toString(g),this.logger.finer(l),s&&s!=this.store_schema.getKeyPath()?t.list(e,ydn.db.base.QueryMethod.LIST_VALUE,o,s,g,n,i,d,!1):goog.isDef(u)&&u!=this.store_schema.getKeyPath()?t.list(e,ydn.db.base.QueryMethod.LIST_VALUE,o,u,g,n,i,d,!1):t.list(e,ydn.db.base.QueryMethod.LIST_VALUE,o,null,g,n,i,d,!1)},goog.provide("ydn.db.sql.req.nosql.ReduceNode"),goog.require("ydn.db.sql.req.nosql.Node"),goog.require("ydn.object"),ydn.db.sql.req.nosql.ReduceNode=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.sql.req.nosql.ReduceNode,ydn.db.sql.req.nosql.Node),ydn.db.sql.req.nosql.ReduceNode.prototype.execute=function(e,t){{var o,r=this.sql.getStoreNames()[0],n=this.sql.getConditions(),i=null;this.sql.isReversed()}if(0==n.length)i=null;else{if(1!=n.length)throw new ydn.debug.error.NotSupportedException("too many conditions.");i=ydn.db.KeyRange.parseIDBKeyRange(n[0].getKeyRange())}var s=this.sql.getAggregate(),a=n.length>0?n[0].getField():void 0,g=e.getLabel()+" executing "+s+" on "+r;if(a&&(g+=":"+a),g+=" "+ydn.db.KeyRange.toString(i),this.logger.finer(g),"COUNT"==s)i?t.countKeyRange(e,r,i,a,!1):t.countKeyRange(e,r,null,void 0,!1);else{var d,u=this.sql.getSelList();if(!u||0==u.length)throw new ydn.error.InvalidOperationError("field name require for reduce operation: "+s);var l=u[0];if("MIN"==s)d=ydn.db.sql.req.nosql.ReduceNode.reduceMin(l);else if("MAX"==s)d=ydn.db.sql.req.nosql.ReduceNode.reduceMax(l);else if("AVG"==s)o=0,d=ydn.db.sql.req.nosql.ReduceNode.reduceAverage(l);else{if("SUM"!=s)throw new ydn.error.NotSupportedException(s);o=0,d=ydn.db.sql.req.nosql.ReduceNode.reduceSum(l)}var c;c=goog.isDef(a)?new ydn.db.IndexValueIterator(r,a,i):new ydn.db.ValueIterator(r,i);var h=t.getCursor(e.getTx(),e.getLabel(),r,ydn.db.base.QueryMethod.LIST_VALUE),p=c.load([h]);p.onFail=function(t){e.setDbValue(t,!0)};var f=0;p.onNext=function(t){if(goog.isDefAndNotNull(t)){var r=c.isKeyIterator()?p.getPrimaryKey():p.getValue();o=d(r,o,f),p.advance(1),f++}else e.setDbValue(o)}}},ydn.db.sql.req.nosql.ReduceNode.reduceAverage=function(e){return function(t,o,r){return goog.isDef(o)||(o=0),(o*r+t[e])/(r+1)}},ydn.db.sql.req.nosql.ReduceNode.reduceSum=function(e){return function(t,o){return o+t[e]}},ydn.db.sql.req.nosql.ReduceNode.reduceMin=function(e){return function(t,o){var r=t[e];return goog.isDef(o)?r>o?o:r:r}},ydn.db.sql.req.nosql.ReduceNode.reduceMax=function(e){return function(t,o){var r=t[e];return goog.isDef(o)?o>r?o:r:r}},goog.provide("ydn.db.sql.req.IndexedDb"),goog.require("ydn.db.core.req.IndexedDb"),goog.require("ydn.db.sql.req.IRequestExecutor"),goog.require("ydn.db.sql.req.nosql.Node"),goog.require("ydn.db.sql.req.nosql.ReduceNode"),ydn.db.sql.req.IndexedDb=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.sql.req.IndexedDb,ydn.db.core.req.IndexedDb),ydn.db.sql.req.IndexedDb.DEBUG=!1,ydn.db.sql.req.IndexedDb.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sql.req.IndexedDb"),ydn.db.sql.req.IndexedDb.prototype.executeSql=function(e,t,o){var r=t.parse(o);if(r)throw new ydn.db.SqlParseError(r);var n=t.getStoreNames();if(1!=n.length)throw new ydn.error.NotSupportedException(t.getSql());var i=this.schema.getStore(n[0]);if(!i)throw new ydn.db.NotFoundError(n[0]);var s=t.getSelList();if(s)for(var a=0;a<s.length;a++)if(!i.hasIndex(s[a]))throw new ydn.db.NotFoundError('Index "'+s[a]+'" not found in '+n[0]);var g;g=t.getAggregate()?new ydn.db.sql.req.nosql.ReduceNode(i,t):new ydn.db.sql.req.nosql.Node(i,t),g.execute(e,this)},goog.provide("ydn.db.sql.req.SqlQuery"),goog.require("ydn.db.sql.req.IterableQuery"),goog.require("goog.functions"),goog.require("ydn.db.KeyRange"),goog.require("ydn.db.Where"),goog.require("ydn.error.ArgumentException"),ydn.db.sql.req.SqlQuery=function(e,t,o,r,n,i,s,a){goog.base(this,e,t,o,r,n,i,s,a),this.parseRow=ydn.db.sql.req.SqlQuery.prototype.parseRow,this.sql="",this.params=[]},goog.inherits(ydn.db.sql.req.SqlQuery,ydn.db.sql.req.IterableQuery),ydn.db.sql.req.SqlQuery.prototype.toJSON=function(){var e=goog.base(this,"toJSON");return e.sql=this.sql,e.params=ydn.object.clone(this.params),e},ydn.db.sql.req.SqlQuery.prototype.sql="",ydn.db.sql.req.SqlQuery.prototype.params=[],ydn.db.sql.req.SqlQuery.prototype.toString=function(){var e=goog.isDef(this.getIndexName())?":"+this.getIndexName():"";return"Cursor:"+this.getStoreName()+e},ydn.db.sql.req.SqlQuery.prototype.parseRow=function(e,t){return ydn.db.crud.req.WebSql.parseRow(e,t)},ydn.db.sql.req.SqlQuery.parseRowIdentity=function(e){return e},goog.provide("ydn.db.sql.req.websql.Node"),goog.require("ydn.db.Sql"),goog.require("ydn.db.schema.Store"),ydn.db.sql.req.websql.Node=function(e,t){this.sql=t,this.store_schema_=e,this.sel_fields_=t.getSelList()},ydn.db.sql.req.websql.Node.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sql.req.websql.Node"),ydn.db.sql.req.websql.Node.prototype.store_schema_,ydn.db.sql.req.websql.Node.prototype.sql,ydn.db.sql.req.websql.Node.prototype.sel_fields_,ydn.db.sql.req.websql.Node.prototype.toJSON=function(){return{sql:this.sql.getSql()}},ydn.db.sql.req.websql.Node.prototype.toString=function(){return"websql.Node:"},ydn.db.sql.req.websql.Node.prototype.parseRow=function(e){if(this.sel_fields_){if(1==this.sel_fields_.length)return goog.isObject(e)?goog.object.getValueByKeys(e,this.sel_fields_[0]):void 0;for(var t={},o=0;o<this.sel_fields_.length;o++)t[this.sel_fields_[o]]=goog.object.getValueByKeys(e,this.sel_fields_[o]);return t}return ydn.db.crud.req.WebSql.parseRow(e,this.store_schema_)},ydn.db.sql.req.websql.Node.prototype.execute=function(e,t,o){var r=this.sql.getSql(),n=this,i=[],s=function(t,o){for(var r=o.rows.length,s=0;r>s;s++){var a=o.rows.item(s);if(goog.isObject(a)){var g=n.parseRow(a);i.push(g)}else i.push(g)}e(i)},a=function(t,o){return ydn.db.sql.req.WebSql.DEBUG&&window.console.log([r,t,o]),n.logger.warning("Sqlite error: "+o.message),e(o,!0),!0};ydn.db.sql.req.WebSql.DEBUG&&window.console.log(this+" open SQL: "+r+" PARAMS:"+ydn.json.stringify(o)),t.executeSql(r,o,s,a)},goog.provide("ydn.db.sql.req.websql.ReduceNode"),goog.require("ydn.db.sql.req.websql.Node"),goog.require("ydn.object"),ydn.db.sql.req.websql.ReduceNode=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.sql.req.websql.ReduceNode,ydn.db.sql.req.websql.Node),ydn.db.sql.req.websql.ReduceNode.prototype.execute=function(e,t,o){var r=this.sql.getSql(),n=this,i=function(t,o){var r=o.rows.length;if(1==r){var n=ydn.object.takeFirst(o.rows.item(0));e(n)}else{if(0!=r)throw new ydn.db.InternalError;e(void 0)}},s=function(t,o){return ydn.db.sql.req.WebSql.DEBUG&&window.console.log([r,t,o]),n.logger.warning("Sqlite error: "+o.message),e(o,!0),!0};ydn.db.sql.req.WebSql.DEBUG&&window.console.log(this+" open SQL: "+r+" PARAMS:"+ydn.json.stringify(o)),t.executeSql(r,o,i,s)},goog.provide("ydn.db.sql.req.WebSql"),goog.require("ydn.db.core.req.WebSql"),goog.require("ydn.db.sql.req.SqlQuery"),goog.require("ydn.db.sql.req.IRequestExecutor"),goog.require("ydn.db.sql.req.websql.Node"),goog.require("ydn.db.sql.req.websql.ReduceNode"),ydn.db.sql.req.WebSql=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.sql.req.WebSql,ydn.db.core.req.WebSql),ydn.db.sql.req.WebSql.DEBUG=!1,ydn.db.sql.req.WebSql.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sql.req.WebSql"),ydn.db.sql.req.WebSql.prototype.executeSql=function(e,t,o){var r=t.getStoreNames();if(1!=r.length)throw new ydn.error.NotSupportedException(t.getSql());var n=this.schema.getStore(r[0]);if(!n)throw new ydn.db.NotFoundError(r[0]);var i=t.getSelList();if(i)for(var s=0;s<i.length;s++)if(!n.hasIndex(i[s]))throw new ydn.db.NotFoundError('Index "'+i[s]+'" not found in '+r[0]);var a;a=t.getAggregate()?new ydn.db.sql.req.websql.ReduceNode(n,t):new ydn.db.sql.req.websql.Node(n,t);var g=function(t,o){e.setDbValue(t,o)};a.execute(g,e.getTx(),o)},ydn.db.sql.req.WebSql.prototype.planQuery=function(e){var t=this.schema.getStore(e.getStoreName());if(!t)throw new ydn.db.SqlParseError("TABLE: "+e.getStoreName()+" not found.");var o=e.getKeyRange(),r=new ydn.db.sql.req.SqlQuery(e.getStoreName(),e.getIndexName(),o,e.isReversed(),e.isUnique(),e.isKeyIterator()),n="SELECT",i=r.getIndexName(),s=goog.isDef(i)?t.getIndex(i):null,a=s?s.getKeyPath():goog.isDefAndNotNull(t.keyPath)?t.keyPath:ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME;goog.asserts.assertString(a);
var g=goog.string.quote(a),d=e.isKeyIterator()?g:"*",u=d+" FROM "+t.getQuotedName(),l="";if(o){if(ydn.db.Where.resolvedStartsWith(o))l=g+" LIKE ?",r.params.push(o.lower+"%");else{if(goog.isDefAndNotNull(o.lower)){var c=o.lowerOpen?" > ":" >= ";l+=" "+g+c+"?",r.params.push(o.lower)}if(goog.isDefAndNotNull(o.upper)){var h=o.upperOpen?" < ":" <= ",p=l.length>0?" AND ":" ";l+=p+g+h+"?",r.params.push(o.upper)}}l=" WHERE ("+l+")"}var f="ASC";e.isReversed()&&(f="DESC");var y="ORDER BY "+g;return r.sql=[n,u,l,y,f].join(" "),r},goog.provide("ydn.db.sql.req.SimpleStore"),goog.require("ydn.db.core.req.SimpleStore"),goog.require("ydn.db.sql.req.IRequestExecutor"),goog.require("ydn.db.sql.req.nosql.Node"),goog.require("ydn.db.sql.req.nosql.ReduceNode"),ydn.db.sql.req.SimpleStore=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.sql.req.SimpleStore,ydn.db.core.req.SimpleStore),ydn.db.sql.req.SimpleStore.DEBUG=!1,ydn.db.sql.req.SimpleStore.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sql.req.SimpleStore"),ydn.db.sql.req.SimpleStore.prototype.executeSql=function(e,t,o){var r=t.parse(o);if(r)throw new ydn.db.SqlParseError(r);var n=t.getStoreNames();if(1!=n.length)throw new ydn.debug.error.NotSupportedException(t.getSql());var i=this.schema.getStore(n[0]);if(!i)throw new ydn.db.NotFoundError(n[0]);var s=t.getSelList();if(s)for(var a=0;a<s.length;a++)if(!i.hasIndex(s[a]))throw new ydn.debug.error.ArgumentException('Index "'+s[a]+'" not found in '+n[0]);var g;g=t.getAggregate()?new ydn.db.sql.req.nosql.ReduceNode(i,t):new ydn.db.sql.req.nosql.Node(i,t),g.execute(e,this)},goog.provide("ydn.db.sql.DbOperator"),goog.require("ydn.db.Iterator"),goog.require("ydn.db.core.DbOperator"),goog.require("ydn.db.sql.IStorage"),goog.require("ydn.db.sql.req.IRequestExecutor"),goog.require("ydn.db.sql.req.IndexedDb"),goog.require("ydn.db.sql.req.WebSql"),goog.require("ydn.db.sql.req.SimpleStore"),goog.require("ydn.debug.error.ArgumentException"),ydn.db.sql.DbOperator=function(e,t,o,r){goog.base(this,e,t,o,r)},goog.inherits(ydn.db.sql.DbOperator,ydn.db.core.DbOperator),ydn.db.sql.DbOperator.prototype.executeSql=function(e,t){for(var o=new ydn.db.Sql(e),r=o.getStoreNames(),n=0;n<r.length;n++){var i=this.schema.getStore(r[n]);if(!i)throw new ydn.debug.error.ArgumentException("store: "+i+" not exists.")}this.logger.finer("executeSql: "+e+" params: "+t);var s=this.tx_thread.request(ydn.db.Request.Method.SQL,o.getStoreNames(),o.getMode());return s.addTxback(function(){this.getExecutor().executeSql(s,o,t||[])},this),s},goog.provide("ydn.db.sql.Storage"),goog.require("ydn.db.core.Storage"),goog.require("ydn.db.sql.DbOperator"),ydn.db.sql.Storage=function(e,t,o){goog.base(this,e,t,o)},goog.inherits(ydn.db.sql.Storage,ydn.db.core.Storage),ydn.db.sql.Storage.prototype.newOperator=function(e,t){return new ydn.db.sql.DbOperator(this,this.schema,e,t)},ydn.db.sql.Storage.prototype.getSqlOperator=function(){return this.db_operator},ydn.db.sql.Storage.prototype.executeSql=function(e,t){return this.getSqlOperator().executeSql(e,t)},goog.provide("ydn.db.sql.Storage.inject"),goog.require("ydn.db.core.Storage"),goog.require("ydn.db.sql.req.IndexedDb"),goog.require("ydn.db.sql.req.SimpleStore"),goog.require("ydn.db.sql.req.WebSql"),ydn.db.sql.Storage.prototype.newExecutor=function(){var e=this.getType();if(e==ydn.db.base.Mechanisms.IDB)return new ydn.db.sql.req.IndexedDb(this.db_name,this.schema);if(e==ydn.db.base.Mechanisms.WEBSQL)return new ydn.db.sql.req.WebSql(this.db_name,this.schema);if(e==ydn.db.base.Mechanisms.MEMORY_STORAGE||e==ydn.db.base.Mechanisms.LOCAL_STORAGE||e==ydn.db.base.Mechanisms.SESSION_STORAGE)return new ydn.db.sql.req.SimpleStore(this.db_name,this.schema);throw new ydn.debug.error.InternalError("No executor for "+e)},goog.provide("ydn.db.con.IndexedDb"),goog.require("goog.async.DeferredList"),goog.require("ydn.db"),goog.require("ydn.db.base"),goog.require("ydn.db.con.IDatabase"),goog.require("ydn.db.schema.Database"),goog.require("ydn.error.ConstraintError"),goog.require("ydn.json"),ydn.db.con.IndexedDb=function(e,t){goog.isDef(e)&&e>5242880&&this.logger.warning("storage size request ignored, use Quota Management API instead"),this.idx_db_=null,this.time_out_=t||0/0},ydn.db.con.IndexedDb.prototype.connect=function(e,t){var o=this,r=new goog.async.Deferred,n=void 0,i=function(e,t){r.hasFired()?o.logger.warning("database already set."):goog.isDef(t)?(o.logger.warning(t?t.message:"Error received."),o.idx_db_=null,r.errback(t)):(goog.asserts.assertObject(e,"db"),o.idx_db_=e,o.idx_db_.onabort=function(e){o.logger.finest(o+": abort");var t=e.target;o.onError(t.error)},o.idx_db_.onerror=function(e){ydn.db.con.IndexedDb.DEBUG&&window.console.log(e),o.logger.finest(o+": error");var t=e.target;o.onError(t.error)},o.idx_db_.onversionchange=function(e){if(ydn.db.con.IndexedDb.DEBUG&&window.console.log([this,e]),o.logger.finest(o+" closing connection for onversionchange to: "+e.version),o.idx_db_&&(o.idx_db_.onabort=null,o.idx_db_.onblocked=null,o.idx_db_.onerror=null,o.idx_db_.onversionchange=null,o.onVersionChange(e),!e.defaultPrevented)){o.idx_db_.close(),o.idx_db_=null;var t=new Error;t.name=e.type,o.onFail(t)}},r.callback(parseFloat(n)))},s=function(e,r,i){var s=i?"changing":"upgrading";o.logger.finer(s+" version to "+e.version+" from "+n);for(var a=0;a<t.stores.length;a++)o.update_store_(e,r,t.stores[a]);for(var g=e.objectStoreNames,d=g.length,a=0;d>a;a++)t.hasStore(g[a])||(e.deleteObjectStore(g[a]),o.logger.finer("store: "+g[a]+" deleted."))},a=t.getVersion();o.logger.finer("Opening database: "+e+" ver: "+(t.isAutoVersion()?"auto":a));var g;return g=goog.isDef(a)?ydn.db.base.indexedDb.open(e,a):ydn.db.base.indexedDb.open(e),g.onsuccess=function(r){var a=r.target.result;goog.isDef(n)||(n=a.version);var g="Database: "+a.name+", ver: "+a.version+" opened.";if(o.logger.finer(g),t.isAutoVersion()){var d=function(r){if(t instanceof ydn.db.schema.EditableDatabase)for(var n=t,g=0;g<r.stores.length;g++)n.hasStore(r.stores[g].getName())||n.addStore(r.stores[g].clone());var d=t.difference(r,!1,!0);if(d.length>0){o.logger.finer("Schema change require for difference in "+d);var u=goog.isNumber(a.version)?a.version+1:1;if("IDBOpenDBRequest"in goog.global){a.close();var l=ydn.db.base.indexedDb.open(e,u);l.onupgradeneeded=function(e){var t=e.target.result;o.logger.finer("re-open for version "+t.version),s(t,l.transaction,!1)},l.onsuccess=function(e){i(e.target.result)},l.onerror=function(){o.logger.finer(o+": fail."),i(null)}}else{var c=a.setVersion(u+"");c.onfailure=function(e){o.logger.warning("migrating from "+a.version+" to "+u+" failed."),i(null,e)};{c.transaction}c.onsuccess=function(){c.transaction.oncomplete=h,s(a,c.transaction,!0)};var h=function(){var t=ydn.db.base.indexedDb.open(e);t.onsuccess=function(e){var t=e.target.result;o.logger.finer(o+": OK."),i(t)},t.onerror=function(){o.logger.finer(o+": fail."),i(null)}};goog.isDefAndNotNull(c.transaction)&&(c.transaction.oncomplete=h)}}else i(a)};o.getSchema(d,void 0,a)}else if(t.getVersion()>a.version){goog.asserts.assertFunction(a.setVersion,"Expecting IDBDatabase in old format");var u=t.getVersion(),l=a.setVersion(u);l.onfailure=function(e){o.logger.warning("migrating from "+a.version+" to "+t.getVersion()+" failed."),i(null,e)},l.onsuccess=function(){s(a,l.transaction,!0)}}else{t.getVersion()==a.version?o.logger.finer("database version "+a.version+" ready to go"):o.logger.warning("connected database version "+a.version+" is higher than requested version.");var c=function(e){var r=t.difference(e,!1,!0);r.length>0?(o.logger.finer(r),i(null,new ydn.error.ConstraintError("different schema: "+r))):i(a)};o.getSchema(c,void 0,a)}},g.onupgradeneeded=function(e){var t=e.target.result;n=0/0,o.logger.finer("upgrade needed for version "+t.version),s(t,g.transaction,!1)},g.onerror=function(r){var n=goog.isDef(t.version)?" with version "+t.version:"",s='open request to database "'+e+'" '+n+" cause error of "+g.error.name;ydn.db.con.IndexedDb.DEBUG&&window.console.log([r,g]),o.logger.severe(s),i(null,r)},g.onblocked=function(r){ydn.db.con.IndexedDb.DEBUG&&window.console.log([r,g]),o.logger.severe("database "+e+" "+t.version+" block, close other connections."),i(null,r)},goog.isNumber(this.time_out_)&&!isNaN(this.time_out_)&&setTimeout(function(){if("done"!=g.readyState){var e=o+": database state is still "+g.readyState;o.logger.severe(e),i(null,new ydn.db.TimeoutError("connection timeout after "+o.time_out_))}},this.time_out_),r},ydn.db.con.IndexedDb.DEBUG=!1,ydn.db.con.IndexedDb.isSupported=function(){return!!ydn.db.base.indexedDb},ydn.db.con.IndexedDb.prototype.time_out_=18e4,ydn.db.con.IndexedDb.prototype.onFail=function(){},ydn.db.con.IndexedDb.prototype.onError=function(){},ydn.db.con.IndexedDb.prototype.onVersionChange=function(){},ydn.db.con.IndexedDb.prototype.getType=function(){return ydn.db.base.Mechanisms.IDB},ydn.db.con.IndexedDb.prototype.getDbInstance=function(){return this.idx_db_||null},ydn.db.con.IndexedDb.prototype.isReady=function(){return!!this.idx_db_},ydn.db.con.IndexedDb.prototype.logger=goog.debug.Logger.getLogger("ydn.db.con.IndexedDb"),ydn.db.con.IndexedDb.prototype.idx_db_=null,ydn.db.con.IndexedDb.prototype.getVersion=function(){return this.idx_db_?parseFloat(this.idx_db_.version):void 0},ydn.db.con.IndexedDb.prototype.getSchema=function(e,t,o){var r=o||this.idx_db_,n=ydn.db.base.TransactionMode.READ_ONLY;if(goog.isDef(t)){if(goog.isNull(t)){if(0==r.objectStoreNames.length)return e(new ydn.db.schema.Database(r.version)),void 0;throw new ydn.error.InternalError}r=t.db}else{for(var i=[],s=r.objectStoreNames.length-1;s>=0;s--)i[s]=r.objectStoreNames[s];if(0==i.length)return e(new ydn.db.schema.Database(r.version)),void 0;t=r.transaction(i,n)}for(var a=r.objectStoreNames,g=[],d=a.length,s=0;d>s;s++){for(var u=t.objectStore(a[s]),l=[],c=0,h=u.indexNames.length;h>c;c++){var p=u.index(u.indexNames[c]);l[c]=new ydn.db.schema.Index(p.keyPath,void 0,p.unique,p.multiEntry,p.name)}g[s]=new ydn.db.schema.Store(u.name,u.keyPath,u.autoIncrement,void 0,l)}var f=new ydn.db.schema.Database(r.version,g);e(f)},ydn.db.con.IndexedDb.prototype.update_store_=function(e,t,o){this.logger.finest("Creating Object Store for "+o.getName()+" keyPath: "+o.getKeyPath());var r,n=e.objectStoreNames,i=function(){var t={autoIncrement:!!o.isAutoIncrement()};return goog.isDefAndNotNull(o.getKeyPath())&&(t.keyPath=o.getKeyPath()),e.createObjectStore(o.getName(),t)};if(n.contains(o.getName())){r=t.objectStore(o.getName());var s=o.getKeyPath()||"",a=r.keyPath||"";if(ydn.db.schema.Index.compareKeyPath(s,a))e.deleteObjectStore(o.getName()),this.logger.warning("store: "+o.getName()+" deleted due to keyPath change."),r=i();else if(goog.isBoolean(r.autoIncrement)&&goog.isBoolean(o.isAutoIncrement())&&r.autoIncrement!=o.isAutoIncrement())e.deleteObjectStore(o.getName()),this.logger.warning("store: "+o.getName()+" deleted due to autoIncrement change."),r=i();else{for(var g=r.indexNames,d=0,u=0,l=0,c=0;c<o.countIndex();c++){var h=o.index(c),p=!1;if(g.contains(h.getName())){var f=r.index(h.getName()),y=goog.isDefAndNotNull(f.unique)&&goog.isDefAndNotNull(h.unique)&&f.unique!=h.unique,b=goog.isDefAndNotNull(f.multiEntry)&&goog.isDefAndNotNull(h.multiEntry)&&f.multiEntry!=h.multiEntry,m=goog.isDefAndNotNull(f.keyPath)&&goog.isDefAndNotNull(h.keyPath)&&!!ydn.db.schema.Index.compareKeyPath(f.keyPath,h.keyPath);(y||b||m)&&(r.deleteIndex(h.getName()),p=!0,d--,l++)}else h.getType()!=ydn.db.schema.DataType.BLOB&&(p=!0);if(p){if(h.unique||h.multiEntry){var v={unique:h.unique,multiEntry:h.multiEntry};r.createIndex(h.getName(),h.keyPath,v)}else r.createIndex(h.getName(),h.keyPath);d++}}for(var c=0;c<g.length;c++)o.hasIndex(g[c])||(r.deleteIndex(g[c]),u++);this.logger.finest("Updated store: "+r.name+", "+d+" index created, "+u+" index deleted, "+l+" modified.")}}else{r=i();for(var c=0;c<o.countIndex();c++){var h=o.index(c);if(h.getType()!=ydn.db.schema.DataType.BLOB)if(this.logger.finest("Creating index: "+h),h.unique||h.multiEntry){var v={unique:h.unique,multiEntry:h.multiEntry};r.createIndex(h.getName(),h.keyPath,v)}else r.createIndex(h.getName(),h.keyPath);else this.logger.info("Index "+h+" of blob data type ignored.")}this.logger.finest("Created store: "+r)}},ydn.db.con.IndexedDb.prototype.doTransaction=function(e,t,o,r){var n=this.idx_db_;if(!t){t=[];for(var i=n.objectStoreNames.length-1;i>=0;i--)t[i]=n.objectStoreNames[i]}if(0==t.length)return e(null),void 0;var s=n.transaction(t,o);s.oncomplete=function(e){r(ydn.db.base.TxEventTypes.COMPLETE,e)},s.onabort=function(e){r(ydn.db.base.TxEventTypes.ABORT,e)},e(s),e=null},ydn.db.con.IndexedDb.prototype.close=function(){this.logger.finest(this+" closing connection"),this.idx_db_.close()},goog.DEBUG&&(ydn.db.con.IndexedDb.prototype.toString=function(){var e=this.idx_db_?this.idx_db_.name+":"+this.idx_db_.version:"";return"IndexedDB:"+e},ydn.db.con.IndexedDb.deleteAllDatabases=function(){var e=goog.global.indexedDB.webkitGetDatabaseNames();e.onsuccess=function(e){for(var t=e.target.result,o=0;o<t.length;o++)window.console.info("deleting "+t[o]),ydn.db.base.indexedDb.deleteDatabase(t[o])}}),ydn.db.con.IndexedDb.deleteDatabase=function(e,t){if(!ydn.db.base.indexedDb||t&&t!=ydn.db.base.Mechanisms.IDB)return null;var o=ydn.db.base.indexedDb.deleteDatabase(e),r=new ydn.db.Request(ydn.db.Request.Method.VERSION_CHANGE);return o.onblocked=function(e){r.notify(e)},o.onerror=function(e){r.errback(e)},o.onsuccess=function(e){r.callback(e)},r},ydn.db.databaseDeletors.push(ydn.db.con.IndexedDb.deleteDatabase),goog.provide("ydn.db.con.SimpleStorage"),goog.require("goog.asserts"),goog.require("goog.async.Deferred"),goog.require("ydn.db.Key"),goog.require("ydn.db.VersionError"),goog.require("ydn.db.con.IDatabase"),goog.require("ydn.db.con.simple"),goog.require("ydn.db.con.simple.IStorageProvider"),goog.require("ydn.db.con.simple.Store"),goog.require("ydn.db.con.simple.TxStorage"),goog.require("ydn.db.req.InMemoryStorage"),goog.require("ydn.debug.error.InternalError"),ydn.db.con.SimpleStorage=function(e){goog.base(this,e),this.version_=0/0},goog.inherits(ydn.db.con.SimpleStorage,ydn.db.con.SimpleStorageService),ydn.db.con.SimpleStorage.prototype.logger=goog.debug.Logger.getLogger("ydn.db.con.SimpleStorage"),ydn.db.con.SimpleStorage.prototype.version_,ydn.db.con.SimpleStorage.isSupported=function(){return!0},ydn.db.con.SimpleStorage.DEBUG=!1,ydn.db.con.SimpleStorage.prototype.version_,ydn.db.con.SimpleStorage.prototype.getVersion=function(){return this.version_},ydn.db.con.SimpleStorage.prototype.connect=function(e,t){var o=this,r=new goog.async.Deferred,n=function(e,t){setTimeout(function(){t?(o.logger.finer(o+" opening fail"),r.errback(t)):(o.logger.finer(o+" version "+o.getVersion()+" open"),r.callback(e))},10)};this.storage_=this.provider_.connectDb(e),this.dbname=e,this.schema=t;var i=ydn.db.con.simple.makeKey(this.dbname);this.version_=0/0;var s=ydn.json.parse(this.storage_.getItem(i));if(goog.isDef(s.version)&&!goog.isNumber(s.version)&&(s.version=0/0),s){var a=new ydn.db.schema.Database(s),g=this.schema.difference(a,!1,!1);if(g)if(!this.schema.isAutoVersion()&&!isNaN(a.getVersion())&&this.schema.getVersion()>a.getVersion()){var d=goog.DEBUG?"existing version "+a.getVersion()+" is larger than "+this.schema.getVersion():"";n(0/0,new ydn.db.VersionError(d))}else{var u=this.schema.getVersion();this.version_=goog.isDef(u)?u:a.getVersion()+1;for(var l=0;l<this.schema.count();l++)var c=this.schema.store(l);if(this.schema instanceof ydn.db.schema.EditableDatabase)for(var l=0;l<a.count();l++){var c=a.store(l);goog.asserts.assert(!goog.isNull(c),"store at "+l+" is null"),this.schema.addStore(c)}var h=this.schema.toJSON();h.version=this.version_||0/0,this.storage_.setItem(i,ydn.json.stringify(h)),n(a.getVersion()||0/0)}else{for(var l=0;l<this.schema.count();l++)var c=this.schema.store(l);this.version_=a.getVersion()||0/0,n(this.version_)}}else{var p=t.toJSON();this.version_=1;var f=0/0;p.version=this.version_,this.storage_.setItem(i,ydn.json.stringify(p)),n(f)}return r},ydn.db.con.SimpleStorage.prototype.isReady=function(){return!!this.dbname},ydn.db.con.SimpleStorage.prototype.getDbInstance=function(){return this.storage_||null},ydn.db.con.SimpleStorage.prototype.onFail=function(){},ydn.db.con.SimpleStorage.prototype.onError=function(){},ydn.db.con.SimpleStorage.prototype.onVersionChange=function(){},ydn.db.con.SimpleStorage.prototype.getType=function(){return"memory"},ydn.db.con.SimpleStorage.prototype.close=function(){},ydn.db.con.SimpleStorage.prototype.doTransaction=function(e,t,o,r){var n=new ydn.db.con.simple.TxStorage(this,function(e,t){r(e,t)});e(n)},goog.DEBUG&&(ydn.db.con.SimpleStorage.prototype.toString=function(){var e=this.dbname+":"+this.version_;return"SimpleStorage:"+this.getType()+":"+e}),goog.provide("ydn.db.con.LocalStorage"),goog.provide("ydn.db.con.SessionStorage"),goog.require("ydn.db.con.SimpleStorage"),ydn.db.con.LocalStorage=function(){goog.base(this,this)},goog.inherits(ydn.db.con.LocalStorage,ydn.db.con.SimpleStorage),ydn.db.con.LocalStorage.prototype.connectDb=function(){return goog.asserts.assertObject(window.localStorage),window.localStorage},ydn.db.con.LocalStorage.isSupported=function(){return!!window.localStorage},ydn.db.con.LocalStorage.prototype.getType=function(){return ydn.db.base.Mechanisms.LOCAL_STORAGE},ydn.db.con.LocalStorage.deleteDatabase=function(e,t){if(!t||t==ydn.db.base.Mechanisms.LOCAL_STORAGE){var o=new ydn.db.con.LocalStorage,r=new ydn.db.schema.EditableDatabase;o.connect(e,r),o.getSchema(function(e){for(var t=0;t<e.stores.length;t++){var r=o.getSimpleStore(e.stores[t].getName());r.clear()}})}},ydn.db.databaseDeletors.push(ydn.db.con.LocalStorage.deleteDatabase),ydn.db.con.SessionStorage=function(){goog.base(this,this)},goog.inherits(ydn.db.con.SessionStorage,ydn.db.con.SimpleStorage),ydn.db.con.SessionStorage.prototype.connectDb=function(){return goog.asserts.assertObject(window.sessionStorage),window.sessionStorage},ydn.db.con.SessionStorage.isSupported=function(){return!!window.sessionStorage},ydn.db.con.SessionStorage.prototype.getType=function(){return ydn.db.base.Mechanisms.SESSION_STORAGE},ydn.db.con.SessionStorage.deleteDatabase=function(e,t){if(!t||t==ydn.db.base.Mechanisms.SESSION_STORAGE){var o=new ydn.db.con.SessionStorage,r=new ydn.db.schema.EditableDatabase;o.connect(e,r),o.getSchema(function(e){for(var t=0;t<e.stores.length;t++){var r=o.getSimpleStore(e.stores[t].getName());r.clear()}})}},ydn.db.databaseDeletors.push(ydn.db.con.SessionStorage.deleteDatabase),goog.provide("ydn.db.con.WebSql"),goog.require("goog.async.Deferred"),goog.require("goog.debug.Logger"),goog.require("goog.functions"),goog.require("ydn.db.SecurityError"),goog.require("ydn.db.base"),goog.require("ydn.db.con.IDatabase"),goog.require("ydn.debug.error.NotImplementedException"),goog.require("ydn.json"),goog.require("ydn.string"),ydn.db.con.WebSql=function(e){this.size_=goog.isDef(e)?e:4194304},ydn.db.con.WebSql.prototype.connect=function(e,t){var o=e,r=this,n=0/0,i=new goog.async.Deferred,s=function(e,t){goog.isDef(t)?(r.sql_db_=null,i.errback(t)):(r.sql_db_=e,i.callback(parseFloat(n)))},a=function(t,o,n){var i=n?"changing version":"setting version",a=t.version?parseInt(t.version,10):0,g=o.isAutoVersion()?n?isNaN(a)?1:a+1:a:o.version;r.logger.fine(e+": "+i+" from "+t.version+" to "+g);var d=!1,u=0,l=function(e){r.getSchema(function(t){d=!0;for(var n=0;n<o.count();n++){var i=function(e){e&&u++},s=t.getStore(o.store(n).getName()),a=s?s.hintForWebSql(o.store(n)):null;r.update_store_with_info_(e,o.store(n),i,a)}for(var g=0;g<t.count();g++){var l=t.store(g);if(!o.hasStore(l.getName()))if(o instanceof ydn.db.schema.EditableDatabase){var c=o;c.addStore(l)}else{var h="DROP TABLE "+l.getQuotedName();r.logger.finer(h),e.executeSql(h,[],function(){},function(e,t){throw t})}}},e,t)},c=function(){u==o.stores.length;if(d){var n=".";u!=o.stores.length&&(n=" but unexpected stores exists."),r.logger.finest(e+":"+t.version+" ready"+n),s(t)}else r.logger.warning(e+": "+i+" voided.")},h=function(o){throw r.logger.severe("SQLError "+o+" "+o.code+"("+o.message+") while changing version from "+t.version+" to "+g+" on "+e),ydn.db.con.WebSql.DEBUG&&window.console.log(o),o};t.changeVersion(t.version,g+"",l,h,c)},g=null;try{{t.isAutoVersion()?"":t.version+""}g=goog.global.openDatabase(e,"",o,this.size_)}catch(d){if("SECURITY_ERR"!=d.name)throw d;this.logger.warning("SECURITY_ERR for opening "+e),g=null,this.last_error_=new ydn.db.SecurityError(d)}if(g){n=g.version;var u="database "+e+(0==g.version.length?"":" version "+g.version);goog.isDefAndNotNull(t.version)&&t.version==g.version?(r.logger.fine("Existing "+u+" opened as requested."),s(g)):this.getSchema(function(e){var o=t.difference(e,!0,!1);o?0==g.version.length?(r.logger.fine("New "+u+" created."),a(g,t,!0)):t.isAutoVersion()?(r.logger.fine("Existing "+u+" opened and schema change for "+o),a(g,t,!0)):(r.logger.fine("Existing "+u+" opened and  schema change to version "+t.version+" for "+o),a(g,t,!0)):(r.logger.fine("Existing "+u+" with same schema opened."),s(g))},null,g)}else s(null,this.last_error_);return i},ydn.db.con.WebSql.prototype.getType=function(){return ydn.db.base.Mechanisms.WEBSQL},ydn.db.con.WebSql.prototype.last_error_=null,ydn.db.con.WebSql.prototype.sql_db_=null,ydn.db.con.WebSql.prototype.getDbInstance=function(){return this.sql_db_||null},ydn.db.con.WebSql.isSupported=function(){return goog.isFunction(goog.global.openDatabase)},ydn.db.con.WebSql.DEBUG=!1,ydn.db.con.WebSql.prototype.logger=goog.debug.Logger.getLogger("ydn.db.con.WebSql"),ydn.db.con.WebSql.prototype.onFail=function(){},ydn.db.con.WebSql.prototype.onError=function(){},ydn.db.con.WebSql.prototype.prepareCreateTable_=function(e){var t=e.getSqlType(),o="CREATE TABLE IF NOT EXISTS ",r=o+e.getQuotedName()+" (",n=e.getSQLKeyColumnNameQuoted();r+=n+" "+t+" PRIMARY KEY ",e.autoIncrement&&(r+=" AUTOINCREMENT "),(!e.isFixed()||!e.usedInlineKey()&&0==e.countIndex())&&(r+=" ,"+ydn.db.base.DEFAULT_BLOB_COLUMN+" "+ydn.db.schema.DataType.BLOB);for(var i=[],s=", ",a=[n],g=0,d=e.countIndex();d>g;g++){var u=e.index(g),l="";if(u.isMultiEntry()){var c=ydn.db.base.PREFIX_MULTIENTRY+e.getName()+":"+u.getName(),h=u.isUnique()?" UNIQUE ":"",p=o+goog.string.quote(c)+" ("+n+" "+t+", "+u.getSQLIndexColumnNameQuoted()+" "+u.getSqlType()+h+")";i.push(p)}else{u.isUnique()&&(l=" UNIQUE ");var f=u.getKeyPath();if(u.type!=ydn.db.schema.DataType.BLOB&&goog.isString(f)){var y="CREATE "+l+" INDEX IF NOT EXISTS "+goog.string.quote(e.getName()+"-"+u.getName())+" ON "+e.getQuotedName()+" ("+goog.string.quote(f)+")";i.push(y)}var b=u.getSQLIndexColumnNameQuoted();-1==a.indexOf(b)&&(r+=s+b+" "+u.getSqlType()+l,a.push(b))}}return r+=")",i.unshift(r),i},ydn.db.con.WebSql.prototype.getVersion=function(){return this.sql_db_?parseFloat(this.sql_db_.version):void 0},ydn.db.con.WebSql.prototype.getSchema=function(e,t,o){var r=this;o=o||this.sql_db_;var n=o&&o.version?parseFloat(o.version):void 0;n=isNaN(n)?void 0:n;var i=[],s=function(t,o){if(o&&o.rows){for(var s=0;s<o.rows.length;s++){var a=o.rows.item(s);if("__WebKitDatabaseInfoTable__"!=a.name&&"sqlite_sequence"!=a.name&&"table"==a.type){var g=goog.object.get(a,"sql");r.logger.finest("Parsing table schema from SQL: "+g);for(var d,u=g.substr(g.indexOf("("),g.lastIndexOf(")")),l=ydn.string.split_comma_seperated(u),c=void 0,h=[],p=!1,f=!1,y=0;y<l.length;y++){var b=ydn.string.split_space_seperated(l[y]),m=goog.array.map(b,function(e){return e.toUpperCase()}),v=goog.string.stripQuotes(b[0],'"'),_=ydn.db.schema.Index.toType(m[1]);if(-1!=m.indexOf("PRIMARY")&&-1!=m.indexOf("KEY")){if(d=_,goog.isString(v)&&!goog.string.isEmpty(v)&&v!=ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME){var E=v.split(",");c=v,E.length>1&&(c=E,d=void 0)}-1!=m.indexOf("AUTOINCREMENT")&&(p=!0)}else if(v==ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME);else if(v==ydn.db.base.DEFAULT_BLOB_COLUMN)f=!0;else{var S="UNIQUE"==m[2];goog.string.startsWith(v,a.tbl_name+"-")&&(v=v.substr(a.tbl_name.length+1));var x=new ydn.db.schema.Index(v,_,S);h.push(x)}}if(goog.string.startsWith(a.name,ydn.db.base.PREFIX_MULTIENTRY)){var w=a.name.split(":");if(w.length>=3){var T=w[1],A=new ydn.db.schema.Index(w[2],_,S,!0),N=goog.array.findIndex(h,function(e){return e.getName()==w[2]});N>=0?h[N]=A:h.push(A);var D=goog.array.findIndex(i,function(e){return e.getName()===T});if(D>=0){var I=i[D];i[D]=new ydn.db.schema.Store(I.getName(),I.getKeyPath(),p,d,h,void 0,!f)}else i.push(new ydn.db.schema.Store(T,void 0,!1,void 0,[A]));r.logger.finest('multi entry index "'+A.getName()+'" found in '+T+(-1==D?"*":""))}else r.logger.warning('Invalid multiEntry store name "'+a.name+'"')}else{var q=goog.array.findIndex(i,function(e){return e.getName()===a.name});if(q>=0){var N=i[q].index(0);goog.asserts.assertInstanceof(N,ydn.db.schema.Index),h.push(N),i[q]=new ydn.db.schema.Store(a.name,c,p,d,h,void 0,!f)}else{var C=new ydn.db.schema.Store(a.name,c,p,d,h,void 0,!f);i.push(C)}}}}var R=new ydn.db.schema.Database(n,i);e(R)}},a=function(e,t){throw ydn.db.con.WebSql.DEBUG&&window.console.log([e,t]),t};if(!t){var g=function(e){throw r.logger.severe("opening tx: "+e.message),e};return o.readTransaction(function(t){r.getSchema(e,t,o)},g,s),void 0}var d="SELECT * FROM sqlite_master";t.executeSql(d,[],s,a)},ydn.db.con.WebSql.prototype.update_store_=function(e,t,o){var r=this;this.getSchema(function(n){var i=n.getStore(t.getName());r.update_store_with_info_(e,t,o,i)},e)},ydn.db.con.WebSql.prototype.update_store_with_info_=function(e,t,o,r){var n=this,i=0,s=function(r){var n=function(){i++,i==a.length&&(o(!0),o=null)},s=function(e,n){ydn.db.con.WebSql.DEBUG&&window.console.log([e,n]),i++,i==a.length&&(o(!1),o=null);var s=goog.DEBUG?"SQLError creating table: "+t.getName()+" "+n.message+' for executing "'+r:'"';throw new ydn.db.SQLError(n,s)};e.executeSql(r,[],n,s)},a=this.prepareCreateTable_(t),g="Create";if(r){var d=t.difference(r);if(0==d.length)return n.logger.finest("same table "+t.getName()+" exists."),o(!0),o=null,void 0;g="Modify",this.logger.warning("table: "+t.getName()+" has changed by "+d+" ALTER TABLE cannot run in WebSql, dropping old table."),a.unshift("DROP TABLE IF EXISTS "+goog.string.quote(t.getName()))}ydn.db.con.WebSql.DEBUG&&window.console.log([a,r]),n.logger.finest(g+" table: "+t.getName()+": "+a.join(";"));for(var u=0;u<a.length;u++)s(a[u])},ydn.db.con.WebSql.prototype.isReady=function(){return!!this.sql_db_},ydn.db.con.WebSql.prototype.close=function(){this.sql_db_=null},ydn.db.con.WebSql.prototype.doTransaction=function(e,t,o,r){var n=this,i=function(t){e(t)},s=function(){r(ydn.db.base.TxEventTypes.COMPLETE,{type:ydn.db.base.TxEventTypes.COMPLETE})},a=function(e){n.logger.finest(n+": Tx "+o+" request cause error."),r(ydn.db.base.TxEventTypes.ABORT,e)};if(goog.isNull(this.sql_db_)&&(e(null),r(ydn.db.base.TxEventTypes.ABORT,this.last_error_)),o==ydn.db.base.TransactionMode.READ_ONLY)this.sql_db_.readTransaction(i,a,s);else if(o==ydn.db.base.TransactionMode.VERSION_CHANGE){var g=this.sql_db_.version+1;this.sql_db_.changeVersion(this.sql_db_.version,g+"",i,a,s)}else this.sql_db_.transaction(i,a,s)},ydn.db.con.WebSql.deleteDatabase=function(e,t){if(!t||t==ydn.db.base.Mechanisms.WEBSQL){var o=new ydn.db.con.WebSql,r=new ydn.db.schema.EditableDatabase;o.logger.finer("deleting websql database: "+e);var n=o.connect(e,r),i=function(){o.logger.info("all tables in "+e+" deleted.")};n.addCallback(function(){o.doTransaction(function(t){var r=function(r,n){if(n&&n.rows){for(var i=n.rows.length,s=0,a=0;i>a;a++){var g=n.rows.item(a);"__WebKitDatabaseInfoTable__"!=g.name&&"sqlite_sequence"!=g.name&&(s++,o.logger.finest("deleting table: "+g.name),t.executeSql("DROP TABLE "+g.name))}o.logger.finer(s+' tables deleted from "'+e+'"')}},n=function(e,t){throw ydn.db.con.WebSql.DEBUG&&window.console.log([e,t]),t},i='SELECT * FROM sqlite_master WHERE type = "table"';t.executeSql(i,[],r,n)},[],ydn.db.base.TransactionMode.READ_WRITE,i)}),n.addErrback(function(){o.logger.warning("Connecting "+e+" failed.")})}},ydn.db.databaseDeletors.push(ydn.db.con.WebSql.deleteDatabase),ydn.db.con.WebSql.prototype.onVersionChange=function(){},goog.DEBUG&&(ydn.db.con.WebSql.prototype.toString=function(){var e=this.sql_db_?":"+this.sql_db_.version:"";return"WebSql:"+e}),goog.provide("ydn.db.tr.Storage.inject_db"),goog.require("ydn.db.con.IndexedDb"),goog.require("ydn.db.con.LocalStorage"),goog.require("ydn.db.con.SessionStorage"),goog.require("ydn.db.con.SimpleStorage"),goog.require("ydn.db.con.WebSql"),goog.require("ydn.db.tr.Storage"),ydn.db.tr.Storage.prototype.createDbInstance=function(e){return e==ydn.db.base.Mechanisms.IDB&&ydn.db.con.IndexedDb.isSupported()?new ydn.db.con.IndexedDb(this.size,this.connectionTimeout):e==ydn.db.base.Mechanisms.WEBSQL&&ydn.db.con.WebSql.isSupported()?new ydn.db.con.WebSql(this.size):e==ydn.db.base.Mechanisms.LOCAL_STORAGE&&ydn.db.con.LocalStorage.isSupported()?new ydn.db.con.LocalStorage:e==ydn.db.base.Mechanisms.SESSION_STORAGE&&ydn.db.con.SessionStorage.isSupported()?new ydn.db.con.SessionStorage:e==ydn.db.base.Mechanisms.MEMORY_STORAGE?new ydn.db.con.SimpleStorage:null},goog.provide("goog.debug.EntryPointMonitor"),goog.provide("goog.debug.entryPointRegistry"),goog.require("goog.asserts"),goog.debug.EntryPointMonitor=function(){},goog.debug.EntryPointMonitor.prototype.wrap,goog.debug.EntryPointMonitor.prototype.unwrap,goog.debug.entryPointRegistry.refList_=[],goog.debug.entryPointRegistry.monitors_=[],goog.debug.entryPointRegistry.monitorsMayExist_=!1,goog.debug.entryPointRegistry.register=function(e){if(goog.debug.entryPointRegistry.refList_[goog.debug.entryPointRegistry.refList_.length]=e,goog.debug.entryPointRegistry.monitorsMayExist_)for(var t=goog.debug.entryPointRegistry.monitors_,o=0;o<t.length;o++)e(goog.bind(t[o].wrap,t[o]))},goog.debug.entryPointRegistry.monitorAll=function(e){goog.debug.entryPointRegistry.monitorsMayExist_=!0;for(var t=goog.bind(e.wrap,e),o=0;o<goog.debug.entryPointRegistry.refList_.length;o++)goog.debug.entryPointRegistry.refList_[o](t);goog.debug.entryPointRegistry.monitors_.push(e)},goog.debug.entryPointRegistry.unmonitorAllIfPossible=function(e){var t=goog.debug.entryPointRegistry.monitors_;goog.asserts.assert(e==t[t.length-1],"Only the most recent monitor can be unwrapped.");for(var o=goog.bind(e.unwrap,e),r=0;r<goog.debug.entryPointRegistry.refList_.length;r++)goog.debug.entryPointRegistry.refList_[r](o);t.length--},goog.provide("goog.structs.SimplePool"),goog.require("goog.Disposable"),goog.structs.SimplePool=function(e,t){goog.Disposable.call(this),this.maxCount_=t,this.freeQueue_=[],this.createInitial_(e)},goog.inherits(goog.structs.SimplePool,goog.Disposable),goog.structs.SimplePool.prototype.createObjectFn_=null,goog.structs.SimplePool.prototype.disposeObjectFn_=null,goog.structs.SimplePool.prototype.setCreateObjectFn=function(e){this.createObjectFn_=e},goog.structs.SimplePool.prototype.setDisposeObjectFn=function(e){this.disposeObjectFn_=e},goog.structs.SimplePool.prototype.getObject=function(){return this.freeQueue_.length?this.freeQueue_.pop():this.createObject()},goog.structs.SimplePool.prototype.releaseObject=function(e){this.freeQueue_.length<this.maxCount_?this.freeQueue_.push(e):this.disposeObject(e)},goog.structs.SimplePool.prototype.createInitial_=function(e){if(e>this.maxCount_)throw Error("[goog.structs.SimplePool] Initial cannot be greater than max");for(var t=0;e>t;t++)this.freeQueue_.push(this.createObject())},goog.structs.SimplePool.prototype.createObject=function(){return this.createObjectFn_?this.createObjectFn_():{}},goog.structs.SimplePool.prototype.disposeObject=function(e){if(this.disposeObjectFn_)this.disposeObjectFn_(e);else if(goog.isObject(e))if(goog.isFunction(e.dispose))e.dispose();else for(var t in e)delete e[t]},goog.structs.SimplePool.prototype.disposeInternal=function(){goog.structs.SimplePool.superClass_.disposeInternal.call(this);for(var e=this.freeQueue_;e.length;)this.disposeObject(e.pop());delete this.freeQueue_},goog.provide("goog.debug.Trace"),goog.require("goog.array"),goog.require("goog.debug.Logger"),goog.require("goog.iter"),goog.require("goog.structs.Map"),goog.require("goog.structs.SimplePool"),goog.debug.Trace_=function(){this.events_=[],this.outstandingEvents_=new goog.structs.Map,this.startTime_=0,this.tracerOverheadStart_=0,this.tracerOverheadEnd_=0,this.tracerOverheadComment_=0,this.stats_=new goog.structs.Map,this.tracerCount_=0,this.commentCount_=0,this.nextId_=1,this.eventPool_=new goog.structs.SimplePool(0,4e3),this.eventPool_.createObject=function(){return new goog.debug.Trace_.Event_},this.statPool_=new goog.structs.SimplePool(0,50),this.statPool_.createObject=function(){return new goog.debug.Trace_.Stat_
};var e=this;this.idPool_=new goog.structs.SimplePool(0,2e3),this.idPool_.createObject=function(){return String(e.nextId_++)},this.idPool_.disposeObject=function(){},this.defaultThreshold_=3},goog.debug.Trace_.prototype.logger_=goog.debug.Logger.getLogger("goog.debug.Trace"),goog.debug.Trace_.prototype.MAX_TRACE_SIZE=1e3,goog.debug.Trace_.EventType={START:0,STOP:1,COMMENT:2},goog.debug.Trace_.Stat_=function(){this.count=0,this.time=0,this.varAlloc=0},goog.debug.Trace_.Stat_.prototype.type,goog.debug.Trace_.Stat_.prototype.toString=function(){var e=[];return e.push(this.type," ",this.count," (",Math.round(10*this.time)/10," ms)"),this.varAlloc&&e.push(" [VarAlloc = ",this.varAlloc,"]"),e.join("")},goog.debug.Trace_.Event_=function(){},goog.debug.Trace_.Event_.prototype.type,goog.debug.Trace_.Event_.prototype.toTraceString=function(e,t,o){var r=[];if(-1==t?r.push("    "):r.push(goog.debug.Trace_.longToPaddedString_(this.eventTime-t)),r.push(" ",goog.debug.Trace_.formatTime_(this.eventTime-e)),this.eventType==goog.debug.Trace_.EventType.START)r.push(" Start        ");else if(this.eventType==goog.debug.Trace_.EventType.STOP){r.push(" Done ");var n=this.stopTime-this.startTime;r.push(goog.debug.Trace_.longToPaddedString_(n)," ms ")}else r.push(" Comment      ");return r.push(o,this),this.totalVarAlloc>0&&r.push("[VarAlloc ",this.totalVarAlloc,"] "),r.join("")},goog.debug.Trace_.Event_.prototype.toString=function(){return null==this.type?this.comment:"["+this.type+"] "+this.comment},goog.debug.Trace_.prototype.setStartTime=function(e){this.startTime_=e},goog.debug.Trace_.prototype.initCurrentTrace=function(e){this.reset(e)},goog.debug.Trace_.prototype.clearCurrentTrace=function(){this.reset(0)},goog.debug.Trace_.prototype.reset=function(e){this.defaultThreshold_=e;for(var t=0;t<this.events_.length;t++){var o=this.eventPool_.id;o&&this.idPool_.releaseObject(o),this.eventPool_.releaseObject(this.events_[t])}this.events_.length=0,this.outstandingEvents_.clear(),this.startTime_=goog.debug.Trace_.now(),this.tracerOverheadStart_=0,this.tracerOverheadEnd_=0,this.tracerOverheadComment_=0,this.tracerCount_=0,this.commentCount_=0;for(var r=this.stats_.getKeys(),t=0;t<r.length;t++){var n=r[t],i=this.stats_.get(n);i.count=0,i.time=0,i.varAlloc=0,this.statPool_.releaseObject(i)}this.stats_.clear()},goog.debug.Trace_.prototype.startTracer=function(e,t){var o=goog.debug.Trace_.now(),r=this.getTotalVarAlloc(),n=this.outstandingEvents_.getCount();if(this.events_.length+n>this.MAX_TRACE_SIZE){if(this.logger_.warning("Giant thread trace. Clearing to avoid memory leak."),this.events_.length>this.MAX_TRACE_SIZE/2){for(var i=0;i<this.events_.length;i++){var s=this.events_[i];s.id&&this.idPool_.releaseObject(s.id),this.eventPool_.releaseObject(s)}this.events_.length=0}n>this.MAX_TRACE_SIZE/2&&this.outstandingEvents_.clear()}goog.debug.Logger.logToProfilers("Start : "+e);var s=this.eventPool_.getObject();s.totalVarAlloc=r,s.eventType=goog.debug.Trace_.EventType.START,s.id=Number(this.idPool_.getObject()),s.comment=e,s.type=t,this.events_.push(s),this.outstandingEvents_.set(String(s.id),s),this.tracerCount_++;var a=goog.debug.Trace_.now();return s.startTime=s.eventTime=a,this.tracerOverheadStart_+=a-o,s.id},goog.debug.Trace_.prototype.stopTracer=function(e,t){var o,r=goog.debug.Trace_.now();o=0===t?0:t?t:this.defaultThreshold_;var n=this.outstandingEvents_.get(String(e));if(null==n)return null;this.outstandingEvents_.remove(String(e));var i,s=r-n.startTime;if(o>s)for(var a=this.events_.length,g=a-1;g>=0;g--){var d=this.events_[g];if(d==n){this.events_.splice(g,1),this.idPool_.releaseObject(n.id),this.eventPool_.releaseObject(n);break}}else i=this.eventPool_.getObject(),i.eventType=goog.debug.Trace_.EventType.STOP,i.startTime=n.startTime,i.comment=n.comment,i.type=n.type,i.stopTime=i.eventTime=r,this.events_.push(i);var u=n.type,l=null;u&&(l=this.getStat_(u),l.count++,l.time+=s),i&&(goog.debug.Logger.logToProfilers("Stop : "+i.comment),i.totalVarAlloc=this.getTotalVarAlloc(),l&&(l.varAlloc+=i.totalVarAlloc-n.totalVarAlloc));var c=goog.debug.Trace_.now();return this.tracerOverheadEnd_+=c-r,s},goog.debug.Trace_.prototype.setGcTracer=function(e){this.gcTracer_=e},goog.debug.Trace_.prototype.getTotalVarAlloc=function(){var e=this.gcTracer_;return e&&e.isTracing()?e.totalVarAlloc:-1},goog.debug.Trace_.prototype.addComment=function(e,t,o){var r=goog.debug.Trace_.now(),n=o?o:r,i=this.eventPool_.getObject();if(i.eventType=goog.debug.Trace_.EventType.COMMENT,i.eventTime=n,i.type=t,i.comment=e,i.totalVarAlloc=this.getTotalVarAlloc(),this.commentCount_++,o){for(var s=this.events_.length,a=0;s>a;a++){var g=this.events_[a],d=g.eventTime;if(d>n){goog.array.insertAt(this.events_,i,a);break}}a==s&&this.events_.push(i)}else this.events_.push(i);var u=i.type;if(u){var l=this.getStat_(u);l.count++}this.tracerOverheadComment_+=goog.debug.Trace_.now()-r},goog.debug.Trace_.prototype.getStat_=function(e){var t=this.stats_.get(e);return t||(t=this.statPool_.getObject(),t.type=e,this.stats_.set(e,t)),t},goog.debug.Trace_.prototype.getFormattedTrace=function(){return this.toString()},goog.debug.Trace_.prototype.toString=function(){for(var e=[],t=-1,o=[],r=0;r<this.events_.length;r++){var n=this.events_[r];n.eventType==goog.debug.Trace_.EventType.STOP&&o.pop(),e.push(" ",n.toTraceString(this.startTime_,t,o.join(""))),t=n.eventTime,e.push("\n"),n.eventType==goog.debug.Trace_.EventType.START&&o.push("|  ")}if(0!=this.outstandingEvents_.getCount()){var i=goog.debug.Trace_.now();e.push(" Unstopped timers:\n"),goog.iter.forEach(this.outstandingEvents_,function(t){e.push("  ",t," (",i-t.startTime," ms, started at ",goog.debug.Trace_.formatTime_(t.startTime),")\n")})}for(var s=this.stats_.getKeys(),r=0;r<s.length;r++){var a=this.stats_.get(s[r]);a.count>1&&e.push(" TOTAL ",a,"\n")}return e.push("Total tracers created ",this.tracerCount_,"\n","Total comments created ",this.commentCount_,"\n","Overhead start: ",this.tracerOverheadStart_," ms\n","Overhead end: ",this.tracerOverheadEnd_," ms\n","Overhead comment: ",this.tracerOverheadComment_," ms\n"),e.join("")},goog.debug.Trace_.longToPaddedString_=function(e){e=Math.round(e);var t="";return 1e3>e&&(t=" "),100>e&&(t="  "),10>e&&(t="   "),t+e},goog.debug.Trace_.formatTime_=function(e){e=Math.round(e);var t=e/1e3%60,o=e%1e3;return String(100+t).substring(1,3)+"."+String(1e3+o).substring(1,4)},goog.debug.Trace_.now=function(){return goog.now()},goog.debug.Trace=new goog.debug.Trace_,goog.provide("goog.debug.ErrorHandler"),goog.provide("goog.debug.ErrorHandler.ProtectedFunctionError"),goog.require("goog.asserts"),goog.require("goog.debug"),goog.require("goog.debug.EntryPointMonitor"),goog.require("goog.debug.Trace"),goog.debug.ErrorHandler=function(e){goog.base(this),this.errorHandlerFn_=e,this.wrapErrors_=!0,this.prefixErrorMessages_=!1},goog.inherits(goog.debug.ErrorHandler,goog.Disposable),goog.debug.ErrorHandler.prototype.addTracersToProtectedFunctions_=!1,goog.debug.ErrorHandler.prototype.setAddTracersToProtectedFunctions=function(e){this.addTracersToProtectedFunctions_=e},goog.debug.ErrorHandler.prototype.wrap=function(e){return this.protectEntryPoint(goog.asserts.assertFunction(e))},goog.debug.ErrorHandler.prototype.unwrap=function(e){return goog.asserts.assertFunction(e),e[this.getFunctionIndex_(!1)]||e},goog.debug.ErrorHandler.prototype.getStackTraceHolder_=function(e){var t=[];return t.push("##PE_STACK_START##"),t.push(e.replace(/(\r\n|\r|\n)/g,"##STACK_BR##")),t.push("##PE_STACK_END##"),t.join("")},goog.debug.ErrorHandler.prototype.getFunctionIndex_=function(e){return(e?"__wrapper_":"__protected_")+goog.getUid(this)+"__"},goog.debug.ErrorHandler.prototype.protectEntryPoint=function(e){var t=this.getFunctionIndex_(!0);if(!e[t]){var o=e[t]=this.getProtectedFunction(e);o[this.getFunctionIndex_(!1)]=e}return e[t]},goog.debug.ErrorHandler.prototype.getProtectedFunction=function(e){var t=this,o=this.addTracersToProtectedFunctions_;if(o)var r=goog.debug.getStacktraceSimple(15);var n=function(){if(t.isDisposed())return e.apply(this,arguments);if(o)var n=goog.debug.Trace.startTracer("protectedEntryPoint: "+t.getStackTraceHolder_(r));try{return e.apply(this,arguments)}catch(i){if(t.errorHandlerFn_(i),!t.wrapErrors_)throw t.prefixErrorMessages_&&("object"==typeof i?i.message=goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX+i.message:i=goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX+i),goog.DEBUG&&i&&i.stack&&Error.captureStackTrace&&goog.global.console&&goog.global.console.error(i.message,i.stack),i;throw new goog.debug.ErrorHandler.ProtectedFunctionError(i)}finally{o&&goog.debug.Trace.stopTracer(n)}};return n[this.getFunctionIndex_(!1)]=e,n},goog.debug.ErrorHandler.prototype.protectWindowSetTimeout=function(){this.protectWindowFunctionsHelper_("setTimeout")},goog.debug.ErrorHandler.prototype.protectWindowSetInterval=function(){this.protectWindowFunctionsHelper_("setInterval")},goog.debug.ErrorHandler.prototype.protectWindowFunctionsHelper_=function(e){var t=goog.getObjectByName("window"),o=t[e],r=this;t[e]=function(e,t){return goog.isString(e)&&(e=goog.partial(goog.globalEval,e)),e=r.protectEntryPoint(e),o.call?o.call(this,e,t):o(e,t)},t[e][this.getFunctionIndex_(!1)]=o},goog.debug.ErrorHandler.prototype.setWrapErrors=function(e){this.wrapErrors_=e},goog.debug.ErrorHandler.prototype.setPrefixErrorMessages=function(e){this.prefixErrorMessages_=e},goog.debug.ErrorHandler.prototype.disposeInternal=function(){var e=goog.getObjectByName("window");e.setTimeout=this.unwrap(e.setTimeout),e.setInterval=this.unwrap(e.setInterval),goog.base(this,"disposeInternal")},goog.debug.ErrorHandler.ProtectedFunctionError=function(e){var t=goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX+(e&&e.message?String(e.message):String(e));goog.base(this,t),this.cause=e;var o=e&&e.stack;o&&goog.isString(o)&&(this.stack=o)},goog.inherits(goog.debug.ErrorHandler.ProtectedFunctionError,goog.debug.Error),goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX="Error in protected function: ",goog.provide("goog.events.BrowserFeature"),goog.require("goog.userAgent"),goog.events.BrowserFeature={HAS_W3C_BUTTON:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),HAS_W3C_EVENT_SUPPORT:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),SET_KEY_CODE_TO_PREVENT_DEFAULT:goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),HAS_NAVIGATOR_ONLINE_PROPERTY:!goog.userAgent.WEBKIT||goog.userAgent.isVersionOrHigher("528"),HAS_HTML5_NETWORK_EVENT_SUPPORT:goog.userAgent.GECKO&&goog.userAgent.isVersionOrHigher("1.9b")||goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("8")||goog.userAgent.OPERA&&goog.userAgent.isVersionOrHigher("9.5")||goog.userAgent.WEBKIT&&goog.userAgent.isVersionOrHigher("528"),HTML5_NETWORK_EVENTS_FIRE_ON_BODY:goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher("8")||goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),TOUCH_ENABLED:"ontouchstart"in goog.global||!!(goog.global.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!goog.global.navigator||!goog.global.navigator.msMaxTouchPoints)},goog.provide("goog.events.EventType"),goog.require("goog.userAgent"),goog.events.EventType={CLICK:"click",DBLCLICK:"dblclick",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEMOVE:"mousemove",SELECTSTART:"selectstart",KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup",BLUR:"blur",FOCUS:"focus",DEACTIVATE:"deactivate",FOCUSIN:goog.userAgent.IE?"focusin":"DOMFocusIn",FOCUSOUT:goog.userAgent.IE?"focusout":"DOMFocusOut",CHANGE:"change",SELECT:"select",SUBMIT:"submit",INPUT:"input",PROPERTYCHANGE:"propertychange",DRAGSTART:"dragstart",DRAG:"drag",DRAGENTER:"dragenter",DRAGOVER:"dragover",DRAGLEAVE:"dragleave",DROP:"drop",DRAGEND:"dragend",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",TOUCHCANCEL:"touchcancel",BEFOREUNLOAD:"beforeunload",CONTEXTMENU:"contextmenu",DOMCONTENTLOADED:"DOMContentLoaded",ERROR:"error",HELP:"help",LOAD:"load",LOSECAPTURE:"losecapture",READYSTATECHANGE:"readystatechange",RESIZE:"resize",SCROLL:"scroll",UNLOAD:"unload",HASHCHANGE:"hashchange",PAGEHIDE:"pagehide",PAGESHOW:"pageshow",POPSTATE:"popstate",COPY:"copy",PASTE:"paste",CUT:"cut",BEFORECOPY:"beforecopy",BEFORECUT:"beforecut",BEFOREPASTE:"beforepaste",ONLINE:"online",OFFLINE:"offline",MESSAGE:"message",CONNECT:"connect",TRANSITIONEND:goog.userAgent.WEBKIT?"webkitTransitionEnd":goog.userAgent.OPERA?"oTransitionEnd":"transitionend",MSGESTURECHANGE:"MSGestureChange",MSGESTUREEND:"MSGestureEnd",MSGESTUREHOLD:"MSGestureHold",MSGESTURESTART:"MSGestureStart",MSGESTURETAP:"MSGestureTap",MSGOTPOINTERCAPTURE:"MSGotPointerCapture",MSINERTIASTART:"MSInertiaStart",MSLOSTPOINTERCAPTURE:"MSLostPointerCapture",MSPOINTERCANCEL:"MSPointerCancel",MSPOINTERDOWN:"MSPointerDown",MSPOINTERMOVE:"MSPointerMove",MSPOINTEROVER:"MSPointerOver",MSPOINTEROUT:"MSPointerOut",MSPOINTERUP:"MSPointerUp",TEXTINPUT:"textinput",COMPOSITIONSTART:"compositionstart",COMPOSITIONUPDATE:"compositionupdate",COMPOSITIONEND:"compositionend"},goog.provide("goog.reflect"),goog.reflect.object=function(e,t){return t},goog.reflect.sinkValue=function(e){return goog.reflect.sinkValue[" "](e),e},goog.reflect.sinkValue[" "]=goog.nullFunction,goog.reflect.canAccessProperty=function(e,t){try{return goog.reflect.sinkValue(e[t]),!0}catch(o){}return!1},goog.provide("goog.events.BrowserEvent"),goog.provide("goog.events.BrowserEvent.MouseButton"),goog.require("goog.events.BrowserFeature"),goog.require("goog.events.Event"),goog.require("goog.events.EventType"),goog.require("goog.reflect"),goog.require("goog.userAgent"),goog.events.BrowserEvent=function(e,t){e&&this.init(e,t)},goog.inherits(goog.events.BrowserEvent,goog.events.Event),goog.events.BrowserEvent.MouseButton={LEFT:0,MIDDLE:1,RIGHT:2},goog.events.BrowserEvent.IEButtonMap=[1,4,2],goog.events.BrowserEvent.prototype.target=null,goog.events.BrowserEvent.prototype.currentTarget,goog.events.BrowserEvent.prototype.relatedTarget=null,goog.events.BrowserEvent.prototype.offsetX=0,goog.events.BrowserEvent.prototype.offsetY=0,goog.events.BrowserEvent.prototype.clientX=0,goog.events.BrowserEvent.prototype.clientY=0,goog.events.BrowserEvent.prototype.screenX=0,goog.events.BrowserEvent.prototype.screenY=0,goog.events.BrowserEvent.prototype.button=0,goog.events.BrowserEvent.prototype.keyCode=0,goog.events.BrowserEvent.prototype.charCode=0,goog.events.BrowserEvent.prototype.ctrlKey=!1,goog.events.BrowserEvent.prototype.altKey=!1,goog.events.BrowserEvent.prototype.shiftKey=!1,goog.events.BrowserEvent.prototype.metaKey=!1,goog.events.BrowserEvent.prototype.state,goog.events.BrowserEvent.prototype.platformModifierKey=!1,goog.events.BrowserEvent.prototype.event_=null,goog.events.BrowserEvent.prototype.init=function(e,t){var o=this.type=e.type;goog.events.Event.call(this,o),this.target=e.target||e.srcElement,this.currentTarget=t;var r=e.relatedTarget;r?goog.userAgent.GECKO&&(goog.reflect.canAccessProperty(r,"nodeName")||(r=null)):o==goog.events.EventType.MOUSEOVER?r=e.fromElement:o==goog.events.EventType.MOUSEOUT&&(r=e.toElement),this.relatedTarget=r,this.offsetX=goog.userAgent.WEBKIT||void 0!==e.offsetX?e.offsetX:e.layerX,this.offsetY=goog.userAgent.WEBKIT||void 0!==e.offsetY?e.offsetY:e.layerY,this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0,this.button=e.button,this.keyCode=e.keyCode||0,this.charCode=e.charCode||("keypress"==o?e.keyCode:0),this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.platformModifierKey=goog.userAgent.MAC?e.metaKey:e.ctrlKey,this.state=e.state,this.event_=e,e.defaultPrevented&&this.preventDefault(),delete this.propagationStopped_},goog.events.BrowserEvent.prototype.isButton=function(e){return goog.events.BrowserFeature.HAS_W3C_BUTTON?this.event_.button==e:"click"==this.type?e==goog.events.BrowserEvent.MouseButton.LEFT:!!(this.event_.button&goog.events.BrowserEvent.IEButtonMap[e])},goog.events.BrowserEvent.prototype.isMouseActionButton=function(){return this.isButton(goog.events.BrowserEvent.MouseButton.LEFT)&&!(goog.userAgent.WEBKIT&&goog.userAgent.MAC&&this.ctrlKey)},goog.events.BrowserEvent.prototype.stopPropagation=function(){goog.events.BrowserEvent.superClass_.stopPropagation.call(this),this.event_.stopPropagation?this.event_.stopPropagation():this.event_.cancelBubble=!0},goog.events.BrowserEvent.prototype.preventDefault=function(){goog.events.BrowserEvent.superClass_.preventDefault.call(this);var e=this.event_;if(e.preventDefault)e.preventDefault();else if(e.returnValue=!1,goog.events.BrowserFeature.SET_KEY_CODE_TO_PREVENT_DEFAULT)try{var t=112,o=123;(e.ctrlKey||e.keyCode>=t&&e.keyCode<=o)&&(e.keyCode=-1)}catch(r){}},goog.events.BrowserEvent.prototype.getBrowserEvent=function(){return this.event_},goog.events.BrowserEvent.prototype.disposeInternal=function(){},goog.provide("goog.events.Listenable"),goog.provide("goog.events.ListenableKey"),goog.events.Listenable=function(){},goog.events.Listenable.IMPLEMENTED_BY_PROP="closure_listenable_"+(1e6*Math.random()|0),goog.events.Listenable.addImplementation=function(e){e.prototype[goog.events.Listenable.IMPLEMENTED_BY_PROP]=!0},goog.events.Listenable.isImplementedBy=function(e){return!(!e||!e[goog.events.Listenable.IMPLEMENTED_BY_PROP])},goog.events.Listenable.prototype.listen,goog.events.Listenable.prototype.listenOnce,goog.events.Listenable.prototype.unlisten,goog.events.Listenable.prototype.unlistenByKey,goog.events.Listenable.prototype.dispatchEvent,goog.events.Listenable.prototype.removeAllListeners,goog.events.Listenable.prototype.fireListeners,goog.events.Listenable.prototype.getListeners,goog.events.Listenable.prototype.getListener,goog.events.Listenable.prototype.hasListener,goog.events.ListenableKey=function(){},goog.events.ListenableKey.counter_=0,goog.events.ListenableKey.reserveKey=function(){return++goog.events.ListenableKey.counter_},goog.events.ListenableKey.prototype.src,goog.events.ListenableKey.prototype.type,goog.events.ListenableKey.prototype.listener,goog.events.ListenableKey.prototype.capture,goog.events.ListenableKey.prototype.handler,goog.events.ListenableKey.prototype.key,goog.provide("goog.events.Listener"),goog.require("goog.events.ListenableKey"),goog.events.Listener=function(e,t,o,r,n,i){goog.events.Listener.ENABLE_MONITORING&&(this.creationStack=(new Error).stack),this.listener=e,this.proxy=t,this.src=o,this.type=r,this.capture=!!n,this.handler=i,this.key=goog.events.ListenableKey.reserveKey(),this.callOnce=!1,this.removed=!1},goog.define("goog.events.Listener.ENABLE_MONITORING",!1),goog.events.Listener.prototype.creationStack,goog.events.Listener.prototype.markAsRemoved=function(){this.removed=!0,this.listener=null,this.proxy=null,this.src=null,this.handler=null},goog.provide("goog.events"),goog.provide("goog.events.Key"),goog.provide("goog.events.ListenableType"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.debug.entryPointRegistry"),goog.require("goog.events.BrowserEvent"),goog.require("goog.events.BrowserFeature"),goog.require("goog.events.Listenable"),goog.require("goog.events.Listener"),goog.require("goog.object"),goog.events.Key,goog.events.ListenableType,goog.events.listeners_={},goog.events.listenerTree_={},goog.events.sources_={},goog.events.onString_="on",goog.events.onStringMap_={},goog.events.keySeparator_="_",goog.events.listen=function(e,t,o,r,n){if(goog.isArray(t)){for(var i=0;i<t.length;i++)goog.events.listen(e,t[i],o,r,n);return null}var s;return o=goog.events.wrapListener_(o),s=goog.events.Listenable.isImplementedBy(e)?e.listen(t,o,r,n):goog.events.listen_(e,t,o,!1,r,n)},goog.events.listen_=function(e,t,o,r,n,i){if(!t)throw Error("Invalid event type");var s=!!n,a=goog.events.listenerTree_;t in a||(a[t]={count_:0,remaining_:0}),a=a[t],s in a||(a[s]={count_:0,remaining_:0},a.count_++),a=a[s];var g,d,u=goog.getUid(e);if(a.remaining_++,a[u]){g=a[u];for(var l=0;l<g.length;l++)if(d=g[l],d.listener==o&&d.handler==i){if(d.removed)break;return r||(g[l].callOnce=!1),g[l]}}else g=a[u]=[],a.count_++;var c=goog.events.getProxy();d=new goog.events.Listener(o,c,e,t,s,i),d.callOnce=r,c.src=e,c.listener=d,g.push(d),goog.events.sources_[u]||(goog.events.sources_[u]=[]),goog.events.sources_[u].push(d),e.addEventListener?e.addEventListener(t,c,s):e.attachEvent(goog.events.getOnString_(t),c);var h=d.key;return goog.events.listeners_[h]=d,d},goog.events.getProxy=function(){var e=goog.events.handleBrowserEvent_,t=goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT?function(o){return e.call(t.src,t.listener,o)}:function(o){var r=e.call(t.src,t.listener,o);return r?void 0:r};return t},goog.events.listenOnce=function(e,t,o,r,n){if(goog.isArray(t)){for(var i=0;i<t.length;i++)goog.events.listenOnce(e,t[i],o,r,n);return null}var s;return o=goog.events.wrapListener_(o),s=goog.events.Listenable.isImplementedBy(e)?e.listenOnce(t,o,r,n):goog.events.listen_(e,t,o,!0,r,n)},goog.events.listenWithWrapper=function(e,t,o,r,n){t.listen(e,o,r,n)},goog.events.unlisten=function(e,t,o,r,n){if(goog.isArray(t)){for(var i=0;i<t.length;i++)goog.events.unlisten(e,t[i],o,r,n);return null}if(o=goog.events.wrapListener_(o),goog.events.Listenable.isImplementedBy(e))return e.unlisten(t,o,r,n);var s=!!r,a=goog.events.getListeners_(e,t,s);if(!a)return!1;for(var i=0;i<a.length;i++)if(a[i].listener==o&&a[i].capture==s&&a[i].handler==n)return goog.events.unlistenByKey(a[i]);return!1},goog.events.unlistenByKey=function(e){if(goog.isNumber(e))return!1;var t=e;if(!t)return!1;if(t.removed)return!1;var o=t.src;if(goog.events.Listenable.isImplementedBy(o))return o.unlistenByKey(t);var r=t.type,n=t.proxy,i=t.capture;o.removeEventListener?o.removeEventListener(r,n,i):o.detachEvent&&o.detachEvent(goog.events.getOnString_(r),n);var s=goog.getUid(o);if(goog.events.sources_[s]){var a=goog.events.sources_[s];goog.array.remove(a,t),0==a.length&&delete goog.events.sources_[s]}t.markAsRemoved();var g=goog.events.listenerTree_[r][i][s];return g&&(g.needsCleanup_=!0,goog.events.cleanUp_(r,i,s,g)),delete goog.events.listeners_[t.key],!0},goog.events.unlistenWithWrapper=function(e,t,o,r,n){t.unlisten(e,o,r,n)},goog.events.cleanUp=function(e){delete goog.events.listeners_[e.key]},goog.events.cleanUp_=function(e,t,o,r){if(!r.locked_&&r.needsCleanup_){for(var n=0,i=0;n<r.length;n++)r[n].removed||(n!=i&&(r[i]=r[n]),i++);r.length=i,r.needsCleanup_=!1,0==i&&(delete goog.events.listenerTree_[e][t][o],goog.events.listenerTree_[e][t].count_--,0==goog.events.listenerTree_[e][t].count_&&(delete goog.events.listenerTree_[e][t],goog.events.listenerTree_[e].count_--),0==goog.events.listenerTree_[e].count_&&delete goog.events.listenerTree_[e])}},goog.events.removeAll=function(e,t){var o=0,r=null==e,n=null==t;if(r)goog.object.forEach(goog.events.listeners_,function(e){goog.events.unlistenByKey(e),o++});else{if(e&&goog.events.Listenable.isImplementedBy(e))return e.removeAllListeners(t);var i=goog.getUid(e);if(goog.events.sources_[i])for(var s=goog.events.sources_[i],a=s.length-1;a>=0;a--){var g=s[a];(n||t==g.type)&&(goog.events.unlistenByKey(g),o++)}}return o},goog.events.removeAllNativeListeners=function(){var e=0;return goog.object.forEach(goog.events.listeners_,function(t){var o=t.src;goog.events.Listenable.isImplementedBy(o)||(goog.events.unlistenByKey(t),e++)}),e},goog.events.getListeners=function(e,t,o){return goog.events.Listenable.isImplementedBy(e)?e.getListeners(t,o):goog.events.getListeners_(e,t,o)||[]},goog.events.getListeners_=function(e,t,o){var r=goog.events.listenerTree_;if(t in r&&(r=r[t],o in r)){r=r[o];var n=goog.getUid(e);if(r[n])return r[n]}return null},goog.events.getListener=function(e,t,o,r,n){var i=!!r;if(o=goog.events.wrapListener_(o),goog.events.Listenable.isImplementedBy(e))return e.getListener(t,o,i,n);var s=goog.events.getListeners_(e,t,i);if(s)for(var a=0;a<s.length;a++)if(!s[a].removed&&s[a].listener==o&&s[a].capture==i&&s[a].handler==n)return s[a];return null},goog.events.hasListener=function(e,t,o){if(goog.events.Listenable.isImplementedBy(e))return e.hasListener(t,o);var r=goog.getUid(e),n=goog.events.sources_[r];if(n){var i=goog.isDef(t),s=goog.isDef(o);if(i&&s){var a=goog.events.listenerTree_[t];return!!a&&!!a[o]&&r in a[o]}return i||s?goog.array.some(n,function(e){return i&&e.type==t||s&&e.capture==o}):!0}return!1},goog.events.expose=function(e){var t=[];for(var o in e)e[o]&&e[o].id?t.push(o+" = "+e[o]+" ("+e[o].id+")"):t.push(o+" = "+e[o]);return t.join("\n")},goog.events.getOnString_=function(e){return e in goog.events.onStringMap_?goog.events.onStringMap_[e]:goog.events.onStringMap_[e]=goog.events.onString_+e},goog.events.fireListeners=function(e,t,o,r){if(goog.events.Listenable.isImplementedBy(e))return e.fireListeners(t,o,r);var n=goog.events.listenerTree_;return t in n&&(n=n[t],o in n)?goog.events.fireListeners_(n[o],e,t,o,r):!0},goog.events.fireListeners_=function(e,t,o,r,n){var i=1,s=goog.getUid(t);if(e[s]){var a=--e.remaining_,g=e[s];g.locked_?g.locked_++:g.locked_=1;try{for(var d=g.length,u=0;d>u;u++){var l=g[u];l&&!l.removed&&(i&=goog.events.fireListener(l,n)!==!1)}}finally{e.remaining_=Math.max(a,e.remaining_),g.locked_--,goog.events.cleanUp_(o,r,s,g)}}return Boolean(i)},goog.events.fireListener=function(e,t){var o=e.listener,r=e.handler||e.src;return e.callOnce&&goog.events.unlistenByKey(e),o.call(r,t)},goog.events.getTotalListenerCount=function(){return goog.object.getCount(goog.events.listeners_)},goog.events.dispatchEvent=function(e,t){return goog.asserts.assert(goog.events.Listenable.isImplementedBy(e),"Can not use goog.events.dispatchEvent with non-goog.events.Listenable instance."),e.dispatchEvent(t)},goog.events.protectBrowserEventEntryPoint=function(e){goog.events.handleBrowserEvent_=e.protectEntryPoint(goog.events.handleBrowserEvent_)},goog.events.handleBrowserEvent_=function(e,t){if(e.removed)return!0;var o=e.type,r=goog.events.listenerTree_;if(!(o in r))return!0;r=r[o];var n,i;if(!goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT){var s=t||goog.getObjectByName("window.event"),a=!0 in r,g=!1 in r;if(a){if(goog.events.isMarkedIeEvent_(s))return!0;goog.events.markIeEvent_(s)}var d=new goog.events.BrowserEvent;d.init(s,this),n=!0;try{if(a){for(var u=[],l=d.currentTarget;l;l=l.parentNode)u.push(l);i=r[!0],i.remaining_=i.count_;for(var c=u.length-1;!d.propagationStopped_&&c>=0&&i.remaining_;c--)d.currentTarget=u[c],n&=goog.events.fireListeners_(i,u[c],o,!0,d);if(g){i=r[!1],i.remaining_=i.count_;for(var c=0;!d.propagationStopped_&&c<u.length&&i.remaining_;c++)d.currentTarget=u[c],n&=goog.events.fireListeners_(i,u[c],o,!1,d)}}else n=goog.events.fireListener(e,d)}finally{u&&(u.length=0)}return n}var h=new goog.events.BrowserEvent(t,this);return n=goog.events.fireListener(e,h)},goog.events.markIeEvent_=function(e){var t=!1;if(0==e.keyCode)try{return e.keyCode=-1,void 0}catch(o){t=!0}(t||void 0==e.returnValue)&&(e.returnValue=!0)},goog.events.isMarkedIeEvent_=function(e){return e.keyCode<0||void 0!=e.returnValue},goog.events.uniqueIdCounter_=0,goog.events.getUniqueId=function(e){return e+"_"+goog.events.uniqueIdCounter_++},goog.events.LISTENER_WRAPPER_PROP_="__closure_events_fn_"+(1e9*Math.random()>>>0),goog.events.wrapListener_=function(e){return goog.asserts.assert(e,"Listener can not be null."),goog.isFunction(e)?e:(goog.asserts.assert(e.handleEvent,"An object listener must have handleEvent method."),e[goog.events.LISTENER_WRAPPER_PROP_]||(e[goog.events.LISTENER_WRAPPER_PROP_]=function(t){return e.handleEvent(t)}))},goog.debug.entryPointRegistry.register(function(e){goog.events.handleBrowserEvent_=e(goog.events.handleBrowserEvent_)}),goog.provide("goog.events.EventHandler"),goog.require("goog.Disposable"),goog.require("goog.events"),goog.require("goog.object"),goog.events.EventHandler=function(e){goog.Disposable.call(this),this.handler_=e,this.keys_={}},goog.inherits(goog.events.EventHandler,goog.Disposable),goog.events.EventHandler.typeArray_=[],goog.events.EventHandler.prototype.listen=function(e,t,o,r,n){goog.isArray(t)||(goog.events.EventHandler.typeArray_[0]=t,t=goog.events.EventHandler.typeArray_);for(var i=0;i<t.length;i++){var s=goog.events.listen(e,t[i],o||this,r||!1,n||this.handler_||this);if(goog.DEBUG&&!s)return this;var a=s.key;this.keys_[a]=s}return this},goog.events.EventHandler.prototype.listenOnce=function(e,t,o,r,n){if(goog.isArray(t))for(var i=0;i<t.length;i++)this.listenOnce(e,t[i],o,r,n);else{var s=goog.events.listenOnce(e,t,o||this,r,n||this.handler_||this),a=s.key;this.keys_[a]=s}return this},goog.events.EventHandler.prototype.listenWithWrapper=function(e,t,o,r,n){return t.listen(e,o,r,n||this.handler_||this,this),this},goog.events.EventHandler.prototype.getListenerCount=function(){var e=0;for(var t in this.keys_)Object.prototype.hasOwnProperty.call(this.keys_,t)&&e++;return e},goog.events.EventHandler.prototype.unlisten=function(e,t,o,r,n){if(goog.isArray(t))for(var i=0;i<t.length;i++)this.unlisten(e,t[i],o,r,n);else{var s=goog.events.getListener(e,t,o||this,r,n||this.handler_||this);s&&(goog.events.unlistenByKey(s),delete this.keys_[s.key])}return this},goog.events.EventHandler.prototype.unlistenWithWrapper=function(e,t,o,r,n){return t.unlisten(e,o,r,n||this.handler_||this,this),this},goog.events.EventHandler.prototype.removeAll=function(){goog.object.forEach(this.keys_,goog.events.unlistenByKey),this.keys_={}},goog.events.EventHandler.prototype.disposeInternal=function(){goog.events.EventHandler.superClass_.disposeInternal.call(this),this.removeAll()},goog.events.EventHandler.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},goog.provide("goog.events.EventTarget"),goog.require("goog.Disposable"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.events"),goog.require("goog.events.Event"),goog.require("goog.events.Listenable"),goog.require("goog.events.Listener"),goog.require("goog.object"),goog.events.EventTarget=function(){goog.Disposable.call(this),this.eventTargetListeners_={},this.actualEventTarget_=this},goog.inherits(goog.events.EventTarget,goog.Disposable),goog.events.Listenable.addImplementation(goog.events.EventTarget),goog.events.EventTarget.MAX_ANCESTORS_=1e3,goog.events.EventTarget.prototype.parentEventTarget_=null,goog.events.EventTarget.prototype.getParentEventTarget=function(){return this.parentEventTarget_},goog.events.EventTarget.prototype.setParentEventTarget=function(e){this.parentEventTarget_=e},goog.events.EventTarget.prototype.addEventListener=function(e,t,o,r){goog.events.listen(this,e,t,o,r)},goog.events.EventTarget.prototype.removeEventListener=function(e,t,o,r){goog.events.unlisten(this,e,t,o,r)},goog.events.EventTarget.prototype.dispatchEvent=function(e){this.assertInitialized_();var t,o=this.getParentEventTarget();if(o){t=[];for(var r=1;o;o=o.getParentEventTarget())t.push(o),goog.asserts.assert(++r<goog.events.EventTarget.MAX_ANCESTORS_,"infinite loop")}return goog.events.EventTarget.dispatchEventInternal_(this.actualEventTarget_,e,t)},goog.events.EventTarget.prototype.disposeInternal=function(){goog.events.EventTarget.superClass_.disposeInternal.call(this),this.removeAllListeners(),this.parentEventTarget_=null},goog.events.EventTarget.prototype.assertInitialized_=function(){goog.asserts.assert(this.eventTargetListeners_,"Event target is not initialized. Did you call superclass (goog.events.EventTarget) constructor?")},goog.events.EventTarget.prototype.listen=function(e,t,o,r){return this.listenInternal_(e,t,!1,o,r)},goog.events.EventTarget.prototype.listenOnce=function(e,t,o,r){return this.listenInternal_(e,t,!0,o,r)},goog.events.EventTarget.prototype.listenInternal_=function(e,t,o,r,n){this.assertInitialized_();var i,s=this.eventTargetListeners_[e]||(this.eventTargetListeners_[e]=[]),a=goog.events.EventTarget.findListenerIndex_(s,t,r,n);return a>-1?(i=s[a],o||(i.callOnce=!1),i):(i=new goog.events.Listener(t,null,this,e,!!r,n),i.callOnce=o,s.push(i),i)},goog.events.EventTarget.prototype.unlisten=function(e,t,o,r){if(!(e in this.eventTargetListeners_))return!1;var n=this.eventTargetListeners_[e],i=goog.events.EventTarget.findListenerIndex_(n,t,o,r);if(i>-1){var s=n[i];return goog.events.cleanUp(s),s.removed=!0,goog.array.removeAt(n,i)}return!1},goog.events.EventTarget.prototype.unlistenByKey=function(e){var t=e.type;if(!(t in this.eventTargetListeners_))return!1;var o=goog.array.remove(this.eventTargetListeners_[t],e);return o&&(goog.events.cleanUp(e),e.removed=!0),o},goog.events.EventTarget.prototype.removeAllListeners=function(e){var t=0;for(var o in this.eventTargetListeners_)if(!e||o==e){for(var r=this.eventTargetListeners_[o],n=0;n<r.length;n++)++t,goog.events.cleanUp(r[n]),r[n].removed=!0;
r.length=0}return t},goog.events.EventTarget.prototype.fireListeners=function(e,t,o){if(!(e in this.eventTargetListeners_))return!0;for(var r=!0,n=goog.array.clone(this.eventTargetListeners_[e]),i=0;i<n.length;++i){var s=n[i];if(s&&!s.removed&&s.capture==t){var a=s.listener,g=s.handler||s.src;s.callOnce&&this.unlistenByKey(s),r=a.call(g,o)!==!1&&r}}return r&&0!=o.returnValue_},goog.events.EventTarget.prototype.getListeners=function(e,t){var o=this.eventTargetListeners_[e],r=[];if(o)for(var n=0;n<o.length;++n){var i=o[n];i.capture==t&&r.push(i)}return r},goog.events.EventTarget.prototype.getListener=function(e,t,o,r){var n=this.eventTargetListeners_[e],i=-1;return n&&(i=goog.events.EventTarget.findListenerIndex_(n,t,o,r)),i>-1?n[i]:null},goog.events.EventTarget.prototype.hasListener=function(e,t){var o=goog.isDef(e),r=goog.isDef(t);return goog.object.some(this.eventTargetListeners_,function(n){for(var i=0;i<n.length;++i)if(!(o&&n[i].type!=e||r&&n[i].capture!=t))return!0;return!1})},goog.events.EventTarget.prototype.setTargetForTesting=function(e){this.actualEventTarget_=e},goog.events.EventTarget.dispatchEventInternal_=function(e,t,o){var r=t.type||t;if(goog.isString(t))t=new goog.events.Event(t,e);else if(t instanceof goog.events.Event)t.target=t.target||e;else{var n=t;t=new goog.events.Event(r,e),goog.object.extend(t,n)}var i,s=!0;if(o)for(var a=o.length-1;!t.propagationStopped_&&a>=0;a--)i=t.currentTarget=o[a],s=i.fireListeners(r,!0,t)&&s;if(t.propagationStopped_||(i=t.currentTarget=e,s=i.fireListeners(r,!0,t)&&s,t.propagationStopped_||(s=i.fireListeners(r,!1,t)&&s)),o)for(a=0;!t.propagationStopped_&&a<o.length;a++)i=t.currentTarget=o[a],s=i.fireListeners(r,!1,t)&&s;return s},goog.events.EventTarget.findListenerIndex_=function(e,t,o,r){for(var n=0;n<e.length;++n){var i=e[n];if(i.listener==t&&i.capture==!!o&&i.handler==r)return n}return-1},goog.provide("goog.events.EventWrapper"),goog.events.EventWrapper=function(){},goog.events.EventWrapper.prototype.listen=function(){},goog.events.EventWrapper.prototype.unlisten=function(){},goog.provide("ydn.db.tr.events"),goog.require("goog.debug.ErrorHandler"),goog.require("goog.events"),goog.require("goog.events.EventHandler"),goog.require("goog.events.EventTarget"),goog.require("goog.events.EventWrapper"),goog.require("ydn.db.tr.Storage"),ydn.db.tr.Storage.prototype.getEventTarget=function(){return this.event_target||(this.event_target=new goog.events.EventTarget),this.event_target},ydn.db.tr.Storage.prototype.addEventListener=function(e,t,o,r){if("ready"==e)goog.events.listenOnce(this.getEventTarget(),e,t,o,r);else{if(goog.DEBUG){var n=this.getEventTypes(),i=function(e){if(!goog.array.contains(n,e))throw new ydn.debug.error.ArgumentException('Invalid event type "'+e+'"')};if(goog.isArrayLike(e))for(var s=0;s<e.length;s++)i(e[s]);else i(e)}goog.events.listen(this.getEventTarget(),e,t,o,r)}},ydn.db.tr.Storage.prototype.removeEventListener=function(e,t,o,r){goog.events.unlisten(this.getEventTarget(),e,t,o,r)},ydn.db.tr.Storage.prototype.dispatchDbEvent=function(e){this.getEventTarget().dispatchEvent(e)},goog.provide("ydn.db.Storage"),goog.require("ydn.db.Query"),goog.require("ydn.db.core.Storage.inject_executor"),goog.require("ydn.db.sql.Storage"),goog.require("ydn.db.sql.Storage.inject"),goog.require("ydn.db.tr.Storage.inject_db"),goog.require("ydn.db.tr.events"),ydn.db.Storage=function(e,t,o){goog.base(this,e,t,o)},goog.inherits(ydn.db.Storage,ydn.db.sql.Storage),goog.provide("ydn.db.algo.NestedLoop"),goog.require("ydn.db.algo.AbstractSolver"),ydn.db.algo.NestedLoop=function(e,t){goog.base(this,e,t)},goog.inherits(ydn.db.algo.NestedLoop,ydn.db.algo.AbstractSolver),ydn.db.algo.NestedLoop.DEBUG=!1,ydn.db.algo.NestedLoop.prototype.current_loop=-1,ydn.db.algo.NestedLoop.prototype.begin=function(e){return this.current_loop=e.length-1,!1},ydn.db.algo.NestedLoop.prototype.solver=function(e,t){var o=[],r=!0,n=function(t){goog.isDef(e[t])?(r=!1,o[t]=!0):(o[t]=!1,t-1>=0&&n(t-1))};return n(e.length-1),ydn.db.algo.NestedLoop.DEBUG&&window.console.log([e,t,o]),r&&(o=[]),this.pusher(o,e,t)},goog.provide("ydn.db.algo.ZigzagMerge"),goog.require("ydn.db"),ydn.db.algo.ZigzagMerge=function(e,t){goog.base(this,e,t),this.is_duplex_output_=e instanceof ydn.db.Streamer&&!!e.getFieldName()},goog.inherits(ydn.db.algo.ZigzagMerge,ydn.db.algo.AbstractSolver),ydn.db.algo.ZigzagMerge.DEBUG=!1,ydn.db.algo.ZigzagMerge.prototype.logger=goog.debug.Logger.getLogger("ydn.db.algo.ZigzagMerge"),ydn.db.algo.ZigzagMerge.prototype.is_duplex_output_=!1,ydn.db.algo.ZigzagMerge.prototype.begin=function(e,t){var o=goog.base(this,"begin",e,t);if(this.is_duplex_output_){var r=e[0].getIndexName().split(", ");if(r.length>1){if(r[r.length-1]!=this.out.getFieldName())throw new ydn.error.InvalidOperationError("Output streamer projection field must be same as postfix field in the iterator")}else goog.DEBUG&&this.logger.warning("Unable to check correctness of output streamer.")}return o},ydn.db.algo.ZigzagMerge.prototype.solver=function(e,t){var o=[];if(0==e.length||!goog.isDefAndNotNull(e[0]))return[];var r=function(e){return e[e.length-1]},n=function(e){return e.slice(0,e.length-1)},i=function(e,t){var o=n(e);return o.push(t),o};if(!goog.isDefAndNotNull(e[0]))return ydn.db.algo.SortedMerge.DEBUG&&window.console.log("SortedMerge: done."),[];var s=!0;goog.asserts.assertArray(e[0]);for(var a=0,g=r(e[a]),d=[],u=1;u<e.length;u++){if(!goog.isDefAndNotNull(e[u]))return ydn.db.algo.ZigzagMerge.DEBUG&&window.console.log(this+": iterator "+u+" reach the end"),[];var l=r(e[u]),c=ydn.db.cmp(g,l);d[u]=c,this.is_reverse?-1==c?s=!1:1==c&&(s=!1,g=l,a=1):1==c?s=!1:-1==c&&(s=!1,g=l,a=1)}ydn.db.algo.ZigzagMerge.DEBUG&&window.console.log("ZigzagMerge: match: "+s+", highest_key: "+JSON.stringify(g)+", keys: "+JSON.stringify(e)+", cmps: "+JSON.stringify(d)+", advancement: "+JSON.stringify(o));var h=this.is_reverse?-1:1;if(s){for(var p=0;p<e.length;p++)goog.isDefAndNotNull(e[p])&&(o[p]=!0);return this.out&&(this.is_duplex_output_?this.out.push(t[0],g):this.out.push(t[0])),o}if(0==a)for(var p=1;p<e.length;p++)d[p]==h&&(o[p]=i(e[p],g));else for(var p=0;p<e.length;p++)p!=a&&goog.isDefAndNotNull(e[p])&&(goog.asserts.assertArray(e[p]),ydn.db.cmp(g,r(e[p]))===h&&(o[p]=i(e[p],g)));return{"continue":o}},goog.provide("ydn.db.algo.exports"),goog.require("ydn.db.algo.NestedLoop"),goog.require("ydn.db.algo.SortedMerge"),goog.require("ydn.db.algo.ZigzagMerge"),goog.exportSymbol("ydn.db.algo.NestedLoop",ydn.db.algo.NestedLoop),goog.exportSymbol("ydn.db.algo.ZigzagMerge",ydn.db.algo.ZigzagMerge),goog.exportSymbol("ydn.db.algo.SortedMerge",ydn.db.algo.SortedMerge),goog.provide("ydn.db.con.exports"),goog.require("ydn.base.exports"),goog.require("ydn.db"),goog.require("ydn.db.con.Storage"),goog.exportProperty(ydn.db.con.Storage.prototype,"close",ydn.db.con.Storage.prototype.close),goog.exportProperty(ydn.db.con.Storage.prototype,"getType",ydn.db.con.Storage.prototype.getType),goog.exportProperty(ydn.db.con.Storage.prototype,"getName",ydn.db.con.Storage.prototype.getName),goog.exportProperty(ydn.db.con.Storage.prototype,"getSchema",ydn.db.con.Storage.prototype.getSchema),goog.exportProperty(ydn.db.con.Storage.prototype,"onReady",ydn.db.con.Storage.prototype.onReady),goog.exportProperty(ydn.db.con.Storage.prototype,"setName",ydn.db.con.Storage.prototype.setName),goog.exportProperty(ydn.db.con.Storage.prototype,"transaction",ydn.db.con.Storage.prototype.transaction),goog.exportSymbol("ydn.db.version",ydn.db.version),goog.exportSymbol("ydn.db.cmp",ydn.db.cmp),goog.exportSymbol("ydn.db.deleteDatabase",ydn.db.deleteDatabase),goog.exportProperty(ydn.db.events.StorageEvent.prototype,"name",ydn.db.events.StorageEvent.prototype.name),goog.exportProperty(ydn.db.events.StorageEvent.prototype,"getVersion",ydn.db.events.StorageEvent.prototype.getVersion),goog.exportProperty(ydn.db.events.StorageEvent.prototype,"getOldVersion",ydn.db.events.StorageEvent.prototype.getOldVersion),goog.exportProperty(ydn.db.events.StorageEvent.prototype,"getOldSchema",ydn.db.events.StorageEvent.prototype.getOldSchema),goog.exportProperty(ydn.db.events.StorageErrorEvent.prototype,"getError",ydn.db.events.StorageErrorEvent.prototype.getError),goog.exportProperty(ydn.db.Request.prototype,"abort",ydn.db.Request.prototype.abort),goog.exportProperty(ydn.db.Request.prototype,"canAbort",ydn.db.Request.prototype.canAbort),goog.exportProperty(ydn.db.Request.prototype,"progress",ydn.db.Request.prototype.addProgback),goog.exportProperty(ydn.db.Request.prototype,"promise",ydn.db.Request.prototype.promise),goog.provide("ydn.db.core.exports"),goog.require("ydn.db.core.Storage"),goog.exportProperty(ydn.db.core.Storage.prototype,"scan",ydn.db.core.Storage.prototype.scan),goog.exportProperty(ydn.db.core.Storage.prototype,"map",ydn.db.core.Storage.prototype.map),goog.exportProperty(ydn.db.core.Storage.prototype,"reduce",ydn.db.core.Storage.prototype.reduce),goog.exportProperty(ydn.db.core.Storage.prototype,"open",ydn.db.core.Storage.prototype.open),goog.exportProperty(ydn.db.core.DbOperator.prototype,"scan",ydn.db.core.DbOperator.prototype.scan),goog.exportProperty(ydn.db.core.DbOperator.prototype,"map",ydn.db.core.DbOperator.prototype.map),goog.exportProperty(ydn.db.core.DbOperator.prototype,"reduce",ydn.db.core.DbOperator.prototype.reduce),goog.exportProperty(ydn.db.core.DbOperator.prototype,"open",ydn.db.core.DbOperator.prototype.open),goog.exportProperty(ydn.db.core.req.AbstractCursor.prototype,"getKey",ydn.db.core.req.AbstractCursor.prototype.getKey),goog.exportProperty(ydn.db.core.req.AbstractCursor.prototype,"getPrimaryKey",ydn.db.core.req.AbstractCursor.prototype.getPrimaryKey),goog.exportProperty(ydn.db.core.req.AbstractCursor.prototype,"getValue",ydn.db.core.req.AbstractCursor.prototype.getValue),goog.exportProperty(ydn.db.core.req.AbstractCursor.prototype,"update",ydn.db.core.req.AbstractCursor.prototype.update),goog.exportProperty(ydn.db.core.req.AbstractCursor.prototype,"clear",ydn.db.core.req.AbstractCursor.prototype.clear),goog.exportSymbol("ydn.db.Iterator",ydn.db.Iterator),goog.exportSymbol("ydn.db.KeyIterator",ydn.db.KeyIterator),goog.exportSymbol("ydn.db.ValueIterator",ydn.db.ValueIterator),goog.exportSymbol("ydn.db.IndexIterator",ydn.db.IndexIterator),goog.exportSymbol("ydn.db.IndexValueIterator",ydn.db.IndexValueIterator),goog.exportProperty(ydn.db.Iterator.prototype,"getState",ydn.db.Iterator.prototype.getState),goog.exportProperty(ydn.db.Iterator.prototype,"getKeyRange",ydn.db.Iterator.prototype.getKeyRange),goog.exportProperty(ydn.db.Iterator.prototype,"getIndexName",ydn.db.Iterator.prototype.getIndexName),goog.exportProperty(ydn.db.Iterator.prototype,"getStoreName",ydn.db.Iterator.prototype.getStoreName),goog.exportProperty(ydn.db.Iterator.prototype,"isReversed",ydn.db.Iterator.prototype.isReversed),goog.exportProperty(ydn.db.Iterator.prototype,"isUnique",ydn.db.Iterator.prototype.isUnique),goog.exportProperty(ydn.db.Iterator.prototype,"isKeyIterator",ydn.db.Iterator.prototype.isKeyIterator),goog.exportProperty(ydn.db.Iterator.prototype,"isIndexIterator",ydn.db.Iterator.prototype.isIndexIterator),goog.exportProperty(ydn.db.Iterator.prototype,"getPrimaryKey",ydn.db.Iterator.prototype.getPrimaryKey),goog.exportProperty(ydn.db.Iterator.prototype,"getKey",ydn.db.Iterator.prototype.getKey),goog.exportProperty(ydn.db.Iterator.prototype,"resume",ydn.db.Iterator.prototype.resume),goog.exportProperty(ydn.db.Iterator.prototype,"reset",ydn.db.Iterator.prototype.reset),goog.exportProperty(ydn.db.Iterator.prototype,"reverse",ydn.db.Iterator.prototype.reverse),goog.exportProperty(ydn.db.KeyIterator,"where",ydn.db.KeyIterator.where),goog.exportProperty(ydn.db.ValueIterator,"where",ydn.db.ValueIterator.where),goog.exportProperty(ydn.db.IndexIterator,"where",ydn.db.IndexIterator.where),goog.exportProperty(ydn.db.IndexValueIterator,"where",ydn.db.IndexValueIterator.where),goog.exportSymbol("ydn.db.Streamer",ydn.db.Streamer),goog.exportProperty(ydn.db.Streamer.prototype,"push",ydn.db.Streamer.prototype.push),goog.exportProperty(ydn.db.Streamer.prototype,"collect",ydn.db.Streamer.prototype.collect),goog.exportProperty(ydn.db.Streamer.prototype,"setSink",ydn.db.Streamer.prototype.setSink),goog.provide("ydn.db.tr.exports"),goog.require("ydn.db.tr.Storage"),goog.require("ydn.db.tr.DbOperator"),goog.exportProperty(ydn.db.tr.Storage.prototype,"branch",ydn.db.tr.Storage.prototype.branch),goog.exportProperty(ydn.db.tr.Storage.prototype,"getTxNo",ydn.db.tr.Storage.prototype.getTxNo),goog.exportProperty(ydn.db.tr.DbOperator.prototype,"getTxNo",ydn.db.tr.DbOperator.prototype.getTxNo),goog.exportProperty(ydn.db.tr.Storage.prototype,"run",ydn.db.tr.Storage.prototype.run),goog.exportProperty(ydn.db.tr.Storage.prototype,"spawn",ydn.db.tr.Storage.prototype.spawn),goog.provide("ydn.db.crud.exports"),goog.require("ydn.db.Key"),goog.require("ydn.db.KeyRange"),goog.require("ydn.db.crud.Storage"),goog.require("ydn.db.tr.exports"),goog.exportProperty(ydn.db.crud.Storage.prototype,"branch",ydn.db.crud.Storage.prototype.branch),goog.exportProperty(ydn.db.crud.Storage.prototype,"add",ydn.db.crud.Storage.prototype.add),goog.exportProperty(ydn.db.crud.Storage.prototype,"get",ydn.db.crud.Storage.prototype.get),goog.exportProperty(ydn.db.crud.Storage.prototype,"keys",ydn.db.crud.Storage.prototype.keys),goog.exportProperty(ydn.db.crud.Storage.prototype,"values",ydn.db.crud.Storage.prototype.values),goog.exportProperty(ydn.db.crud.Storage.prototype,"put",ydn.db.crud.Storage.prototype.put),goog.exportProperty(ydn.db.crud.Storage.prototype,"clear",ydn.db.crud.Storage.prototype.clear),goog.exportProperty(ydn.db.crud.Storage.prototype,"remove",ydn.db.crud.Storage.prototype.remove),goog.exportProperty(ydn.db.crud.Storage.prototype,"count",ydn.db.crud.Storage.prototype.count),goog.exportProperty(ydn.db.crud.DbOperator.prototype,"add",ydn.db.crud.DbOperator.prototype.add),goog.exportProperty(ydn.db.crud.DbOperator.prototype,"get",ydn.db.crud.DbOperator.prototype.get),goog.exportProperty(ydn.db.crud.DbOperator.prototype,"keys",ydn.db.crud.DbOperator.prototype.keys),goog.exportProperty(ydn.db.crud.DbOperator.prototype,"values",ydn.db.crud.DbOperator.prototype.values),goog.exportProperty(ydn.db.crud.DbOperator.prototype,"put",ydn.db.crud.DbOperator.prototype.put),goog.exportProperty(ydn.db.crud.DbOperator.prototype,"clear",ydn.db.crud.DbOperator.prototype.clear),goog.exportProperty(ydn.db.crud.DbOperator.prototype,"remove",ydn.db.crud.DbOperator.prototype.remove),goog.exportProperty(ydn.db.crud.DbOperator.prototype,"count",ydn.db.crud.DbOperator.prototype.count),goog.exportSymbol("ydn.db.Key",ydn.db.Key),goog.exportProperty(ydn.db.Key.prototype,"id",ydn.db.Key.prototype.getId),goog.exportProperty(ydn.db.Key.prototype,"parent",ydn.db.Key.prototype.getParent),goog.exportProperty(ydn.db.Key.prototype,"storeName",ydn.db.Key.prototype.getStoreName),goog.exportSymbol("ydn.db.KeyRange",ydn.db.KeyRange),goog.exportProperty(ydn.db.KeyRange,"upperBound",ydn.db.KeyRange.upperBound),goog.exportProperty(ydn.db.KeyRange,"lowerBound",ydn.db.KeyRange.lowerBound),goog.exportProperty(ydn.db.KeyRange,"bound",ydn.db.KeyRange.bound),goog.exportProperty(ydn.db.KeyRange,"only",ydn.db.KeyRange.only),goog.exportProperty(ydn.db.KeyRange,"starts",ydn.db.KeyRange.starts),goog.exportProperty(ydn.db.events.Event.prototype,"store_name",ydn.db.events.Event.prototype.store_name),goog.exportProperty(ydn.db.events.Event.prototype,"getStoreName",ydn.db.events.Event.prototype.getStoreName),goog.exportProperty(ydn.db.events.RecordEvent.prototype,"name",ydn.db.events.RecordEvent.prototype.name),goog.exportProperty(ydn.db.events.RecordEvent.prototype,"getKey",ydn.db.events.RecordEvent.prototype.getKey),goog.exportProperty(ydn.db.events.RecordEvent.prototype,"getValue",ydn.db.events.RecordEvent.prototype.getValue),goog.exportProperty(ydn.db.events.StoreEvent.prototype,"name",ydn.db.events.StoreEvent.prototype.name),goog.exportProperty(ydn.db.events.StoreEvent.prototype,"getKeys",ydn.db.events.StoreEvent.prototype.getKeys),goog.exportProperty(ydn.db.events.StoreEvent.prototype,"getValues",ydn.db.events.StoreEvent.prototype.getValues),goog.provide("ydn.db.sql.exports"),goog.require("ydn.db.sql.Storage"),goog.exportProperty(ydn.db.sql.Storage.prototype,"executeSql",ydn.db.sql.Storage.prototype.executeSql),goog.exportProperty(ydn.db.sql.DbOperator.prototype,"executeSql",ydn.db.sql.DbOperator.prototype.executeSql),goog.provide("ydn.db.tr.events.exports"),goog.require("ydn.db.tr.events"),goog.exportProperty(ydn.db.tr.Storage.prototype,"addEventListener",ydn.db.tr.Storage.prototype.addEventListener),goog.exportProperty(ydn.db.tr.Storage.prototype,"removeEventListener",ydn.db.tr.Storage.prototype.removeEventListener),goog.provide("goog.debug.RelativeTimeProvider"),goog.debug.RelativeTimeProvider=function(){this.relativeTimeStart_=goog.now()},goog.debug.RelativeTimeProvider.defaultInstance_=new goog.debug.RelativeTimeProvider,goog.debug.RelativeTimeProvider.prototype.set=function(e){this.relativeTimeStart_=e},goog.debug.RelativeTimeProvider.prototype.reset=function(){this.set(goog.now())},goog.debug.RelativeTimeProvider.prototype.get=function(){return this.relativeTimeStart_},goog.debug.RelativeTimeProvider.getDefaultInstance=function(){return goog.debug.RelativeTimeProvider.defaultInstance_},goog.provide("goog.debug.Formatter"),goog.provide("goog.debug.HtmlFormatter"),goog.provide("goog.debug.TextFormatter"),goog.require("goog.debug.RelativeTimeProvider"),goog.require("goog.string"),goog.debug.Formatter=function(e){this.prefix_=e||"",this.startTimeProvider_=goog.debug.RelativeTimeProvider.getDefaultInstance()},goog.debug.Formatter.prototype.showAbsoluteTime=!0,goog.debug.Formatter.prototype.showRelativeTime=!0,goog.debug.Formatter.prototype.showLoggerName=!0,goog.debug.Formatter.prototype.showExceptionText=!1,goog.debug.Formatter.prototype.showSeverityLevel=!1,goog.debug.Formatter.prototype.formatRecord=goog.abstractMethod,goog.debug.Formatter.prototype.setStartTimeProvider=function(e){this.startTimeProvider_=e},goog.debug.Formatter.prototype.getStartTimeProvider=function(){return this.startTimeProvider_},goog.debug.Formatter.prototype.resetRelativeTimeStart=function(){this.startTimeProvider_.reset()},goog.debug.Formatter.getDateTimeStamp_=function(e){var t=new Date(e.getMillis());return goog.debug.Formatter.getTwoDigitString_(t.getFullYear()-2e3)+goog.debug.Formatter.getTwoDigitString_(t.getMonth()+1)+goog.debug.Formatter.getTwoDigitString_(t.getDate())+" "+goog.debug.Formatter.getTwoDigitString_(t.getHours())+":"+goog.debug.Formatter.getTwoDigitString_(t.getMinutes())+":"+goog.debug.Formatter.getTwoDigitString_(t.getSeconds())+"."+goog.debug.Formatter.getTwoDigitString_(Math.floor(t.getMilliseconds()/10))},goog.debug.Formatter.getTwoDigitString_=function(e){return 10>e?"0"+e:String(e)},goog.debug.Formatter.getRelativeTime_=function(e,t){var o=e.getMillis()-t,r=o/1e3,n=r.toFixed(3),i=0;if(1>r)i=2;else for(;100>r;)i++,r*=10;for(;i-->0;)n=" "+n;return n},goog.debug.HtmlFormatter=function(e){goog.debug.Formatter.call(this,e)},goog.inherits(goog.debug.HtmlFormatter,goog.debug.Formatter),goog.debug.HtmlFormatter.prototype.showExceptionText=!0,goog.debug.HtmlFormatter.prototype.formatRecord=function(e){var t;switch(e.getLevel().value){case goog.debug.Logger.Level.SHOUT.value:t="dbg-sh";break;case goog.debug.Logger.Level.SEVERE.value:t="dbg-sev";break;case goog.debug.Logger.Level.WARNING.value:t="dbg-w";break;case goog.debug.Logger.Level.INFO.value:t="dbg-i";break;case goog.debug.Logger.Level.FINE.value:default:t="dbg-f"}var o=[];return o.push(this.prefix_," "),this.showAbsoluteTime&&o.push("[",goog.debug.Formatter.getDateTimeStamp_(e),"] "),this.showRelativeTime&&o.push("[",goog.string.whitespaceEscape(goog.debug.Formatter.getRelativeTime_(e,this.startTimeProvider_.get())),"s] "),this.showLoggerName&&o.push("[",goog.string.htmlEscape(e.getLoggerName()),"] "),this.showSeverityLevel&&o.push("[",goog.string.htmlEscape(e.getLevel().name),"] "),o.push('<span class="',t,'">',goog.string.newLineToBr(goog.string.whitespaceEscape(goog.string.htmlEscape(e.getMessage())))),this.showExceptionText&&e.getException()&&o.push("<br>",goog.string.newLineToBr(goog.string.whitespaceEscape(e.getExceptionText()||""))),o.push("</span><br>"),o.join("")},goog.debug.TextFormatter=function(e){goog.debug.Formatter.call(this,e)},goog.inherits(goog.debug.TextFormatter,goog.debug.Formatter),goog.debug.TextFormatter.prototype.formatRecord=function(e){var t=[];return t.push(this.prefix_," "),this.showAbsoluteTime&&t.push("[",goog.debug.Formatter.getDateTimeStamp_(e),"] "),this.showRelativeTime&&t.push("[",goog.debug.Formatter.getRelativeTime_(e,this.startTimeProvider_.get()),"s] "),this.showLoggerName&&t.push("[",e.getLoggerName(),"] "),this.showSeverityLevel&&t.push("[",e.getLevel().name,"] "),t.push(e.getMessage(),"\n"),this.showExceptionText&&e.getException()&&t.push(e.getExceptionText(),"\n"),t.join("")},goog.provide("goog.debug.Console"),goog.require("goog.debug.LogManager"),goog.require("goog.debug.Logger.Level"),goog.require("goog.debug.TextFormatter"),goog.debug.Console=function(){this.publishHandler_=goog.bind(this.addLogRecord,this),this.formatter_=new goog.debug.TextFormatter,this.formatter_.showAbsoluteTime=!1,this.formatter_.showExceptionText=!1,this.isCapturing_=!1,this.logBuffer_="",this.filteredLoggers_={}},goog.debug.Console.prototype.getFormatter=function(){return this.formatter_},goog.debug.Console.prototype.setCapturing=function(e){if(e!=this.isCapturing_){var t=goog.debug.LogManager.getRoot();e?t.addHandler(this.publishHandler_):(t.removeHandler(this.publishHandler_),this.logBuffer=""),this.isCapturing_=e}},goog.debug.Console.prototype.addLogRecord=function(e){if(!this.filteredLoggers_[e.getLoggerName()]){var t=this.formatter_.formatRecord(e),o=goog.debug.Console.console_;if(o)switch(e.getLevel()){case goog.debug.Logger.Level.SHOUT:goog.debug.Console.logToConsole_(o,"info",t);break;case goog.debug.Logger.Level.SEVERE:goog.debug.Console.logToConsole_(o,"error",t);break;case goog.debug.Logger.Level.WARNING:goog.debug.Console.logToConsole_(o,"warn",t);break;default:goog.debug.Console.logToConsole_(o,"debug",t)}else window.opera?window.opera.postError(t):this.logBuffer_+=t}},goog.debug.Console.prototype.addFilter=function(e){this.filteredLoggers_[e]=!0},goog.debug.Console.prototype.removeFilter=function(e){delete this.filteredLoggers_[e]},goog.debug.Console.instance=null,goog.debug.Console.console_=window.console,goog.debug.Console.setConsole=function(e){goog.debug.Console.console_=e},goog.debug.Console.autoInstall=function(){goog.debug.Console.instance||(goog.debug.Console.instance=new goog.debug.Console),-1!=window.location.href.indexOf("Debug=true")&&goog.debug.Console.instance.setCapturing(!0)},goog.debug.Console.show=function(){alert(goog.debug.Console.instance.logBuffer_)},goog.debug.Console.logToConsole_=function(e,t,o){e[t]?e[t](o):e.log(o)},goog.provide("goog.dom.BrowserFeature"),goog.require("goog.userAgent"),goog.dom.BrowserFeature={CAN_ADD_NAME_OR_TYPE_ATTRIBUTES:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),CAN_USE_CHILDREN_ATTRIBUTE:!goog.userAgent.GECKO&&!goog.userAgent.IE||goog.userAgent.IE&&goog.userAgent.isDocumentModeOrHigher(9)||goog.userAgent.GECKO&&goog.userAgent.isVersionOrHigher("1.9.1"),CAN_USE_INNER_TEXT:goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),CAN_USE_PARENT_ELEMENT_PROPERTY:goog.userAgent.IE||goog.userAgent.OPERA||goog.userAgent.WEBKIT,INNER_HTML_NEEDS_SCOPED_ELEMENT:goog.userAgent.IE},goog.provide("goog.dom.TagName"),goog.dom.TagName={A:"A",ABBR:"ABBR",ACRONYM:"ACRONYM",ADDRESS:"ADDRESS",APPLET:"APPLET",AREA:"AREA",ARTICLE:"ARTICLE",ASIDE:"ASIDE",AUDIO:"AUDIO",B:"B",BASE:"BASE",BASEFONT:"BASEFONT",BDI:"BDI",BDO:"BDO",BIG:"BIG",BLOCKQUOTE:"BLOCKQUOTE",BODY:"BODY",BR:"BR",BUTTON:"BUTTON",CANVAS:"CANVAS",CAPTION:"CAPTION",CENTER:"CENTER",CITE:"CITE",CODE:"CODE",COL:"COL",COLGROUP:"COLGROUP",COMMAND:"COMMAND",DATA:"DATA",DATALIST:"DATALIST",DD:"DD",DEL:"DEL",DETAILS:"DETAILS",DFN:"DFN",DIALOG:"DIALOG",DIR:"DIR",DIV:"DIV",DL:"DL",DT:"DT",EM:"EM",EMBED:"EMBED",FIELDSET:"FIELDSET",FIGCAPTION:"FIGCAPTION",FIGURE:"FIGURE",FONT:"FONT",FOOTER:"FOOTER",FORM:"FORM",FRAME:"FRAME",FRAMESET:"FRAMESET",H1:"H1",H2:"H2",H3:"H3",H4:"H4",H5:"H5",H6:"H6",HEAD:"HEAD",HEADER:"HEADER",HGROUP:"HGROUP",HR:"HR",HTML:"HTML",I:"I",IFRAME:"IFRAME",IMG:"IMG",INPUT:"INPUT",INS:"INS",ISINDEX:"ISINDEX",KBD:"KBD",KEYGEN:"KEYGEN",LABEL:"LABEL",LEGEND:"LEGEND",LI:"LI",LINK:"LINK",MAP:"MAP",MARK:"MARK",MATH:"MATH",MENU:"MENU",META:"META",METER:"METER",NAV:"NAV",NOFRAMES:"NOFRAMES",NOSCRIPT:"NOSCRIPT",OBJECT:"OBJECT",OL:"OL",OPTGROUP:"OPTGROUP",OPTION:"OPTION",OUTPUT:"OUTPUT",P:"P",PARAM:"PARAM",PRE:"PRE",PROGRESS:"PROGRESS",Q:"Q",RP:"RP",RT:"RT",RUBY:"RUBY",S:"S",SAMP:"SAMP",SCRIPT:"SCRIPT",SECTION:"SECTION",SELECT:"SELECT",SMALL:"SMALL",SOURCE:"SOURCE",SPAN:"SPAN",STRIKE:"STRIKE",STRONG:"STRONG",STYLE:"STYLE",SUB:"SUB",SUMMARY:"SUMMARY",SUP:"SUP",SVG:"SVG",TABLE:"TABLE",TBODY:"TBODY",TD:"TD",TEXTAREA:"TEXTAREA",TFOOT:"TFOOT",TH:"TH",THEAD:"THEAD",TIME:"TIME",TITLE:"TITLE",TR:"TR",TRACK:"TRACK",TT:"TT",U:"U",UL:"UL",VAR:"VAR",VIDEO:"VIDEO",WBR:"WBR"},goog.provide("goog.dom.classes"),goog.require("goog.array"),goog.dom.classes.set=function(e,t){e.className=t},goog.dom.classes.get=function(e){var t=e.className;return goog.isString(t)&&t.match(/\S+/g)||[]},goog.dom.classes.add=function(e){var t=goog.dom.classes.get(e),o=goog.array.slice(arguments,1),r=t.length+o.length;return goog.dom.classes.add_(t,o),goog.dom.classes.set(e,t.join(" ")),t.length==r},goog.dom.classes.remove=function(e){var t=goog.dom.classes.get(e),o=goog.array.slice(arguments,1),r=goog.dom.classes.getDifference_(t,o);return goog.dom.classes.set(e,r.join(" ")),r.length==t.length-o.length},goog.dom.classes.add_=function(e,t){for(var o=0;o<t.length;o++)goog.array.contains(e,t[o])||e.push(t[o])},goog.dom.classes.getDifference_=function(e,t){return goog.array.filter(e,function(e){return!goog.array.contains(t,e)})},goog.dom.classes.swap=function(e,t,o){for(var r=goog.dom.classes.get(e),n=!1,i=0;i<r.length;i++)r[i]==t&&(goog.array.splice(r,i--,1),n=!0);return n&&(r.push(o),goog.dom.classes.set(e,r.join(" "))),n},goog.dom.classes.addRemove=function(e,t,o){var r=goog.dom.classes.get(e);goog.isString(t)?goog.array.remove(r,t):goog.isArray(t)&&(r=goog.dom.classes.getDifference_(r,t)),goog.isString(o)&&!goog.array.contains(r,o)?r.push(o):goog.isArray(o)&&goog.dom.classes.add_(r,o),goog.dom.classes.set(e,r.join(" "))},goog.dom.classes.has=function(e,t){return goog.array.contains(goog.dom.classes.get(e),t)},goog.dom.classes.enable=function(e,t,o){o?goog.dom.classes.add(e,t):goog.dom.classes.remove(e,t)},goog.dom.classes.toggle=function(e,t){var o=!goog.dom.classes.has(e,t);return goog.dom.classes.enable(e,t,o),o},goog.provide("goog.math"),goog.require("goog.array"),goog.require("goog.asserts"),goog.math.randomInt=function(e){return Math.floor(Math.random()*e)},goog.math.uniformRandom=function(e,t){return e+Math.random()*(t-e)},goog.math.clamp=function(e,t,o){return Math.min(Math.max(e,t),o)},goog.math.modulo=function(e,t){var o=e%t;return 0>o*t?o+t:o},goog.math.lerp=function(e,t,o){return e+o*(t-e)},goog.math.nearlyEquals=function(e,t,o){return Math.abs(e-t)<=(o||1e-6)},goog.math.standardAngle=function(e){return goog.math.modulo(e,360)},goog.math.toRadians=function(e){return e*Math.PI/180},goog.math.toDegrees=function(e){return 180*e/Math.PI},goog.math.angleDx=function(e,t){return t*Math.cos(goog.math.toRadians(e))},goog.math.angleDy=function(e,t){return t*Math.sin(goog.math.toRadians(e))},goog.math.angle=function(e,t,o,r){return goog.math.standardAngle(goog.math.toDegrees(Math.atan2(r-t,o-e)))},goog.math.angleDifference=function(e,t){var o=goog.math.standardAngle(t)-goog.math.standardAngle(e);return o>180?o-=360:-180>=o&&(o=360+o),o},goog.math.sign=function(e){return 0==e?0:0>e?-1:1},goog.math.longestCommonSubsequence=function(e,t,o,r){for(var n=o||function(e,t){return e==t},i=r||function(t){return e[t]},s=e.length,a=t.length,g=[],d=0;s+1>d;d++)g[d]=[],g[d][0]=0;for(var u=0;a+1>u;u++)g[0][u]=0;for(d=1;s>=d;d++)for(u=1;s>=u;u++)g[d][u]=n(e[d-1],t[u-1])?g[d-1][u-1]+1:Math.max(g[d-1][u],g[d][u-1]);for(var l=[],d=s,u=a;d>0&&u>0;)n(e[d-1],t[u-1])?(l.unshift(i(d-1,u-1)),d--,u--):g[d-1][u]>g[d][u-1]?d--:u--;return l},goog.math.sum=function(){return goog.array.reduce(arguments,function(e,t){return e+t},0)},goog.math.average=function(){return goog.math.sum.apply(null,arguments)/arguments.length},goog.math.standardDeviation=function(){var e=arguments.length;if(2>e)return 0;var t=goog.math.average.apply(null,arguments),o=goog.math.sum.apply(null,goog.array.map(arguments,function(e){return Math.pow(e-t,2)}))/(e-1);return Math.sqrt(o)},goog.math.isInt=function(e){return isFinite(e)&&e%1==0},goog.math.isFiniteNumber=function(e){return isFinite(e)&&!isNaN(e)},goog.math.safeFloor=function(e,t){return goog.asserts.assert(!goog.isDef(t)||t>0),Math.floor(e+(t||2e-15))},goog.math.safeCeil=function(e,t){return goog.asserts.assert(!goog.isDef(t)||t>0),Math.ceil(e-(t||2e-15))},goog.provide("goog.math.Coordinate"),goog.require("goog.math"),goog.math.Coordinate=function(e,t){this.x=goog.isDef(e)?e:0,this.y=goog.isDef(t)?t:0},goog.math.Coordinate.prototype.clone=function(){return new goog.math.Coordinate(this.x,this.y)},goog.DEBUG&&(goog.math.Coordinate.prototype.toString=function(){return"("+this.x+", "+this.y+")"}),goog.math.Coordinate.equals=function(e,t){return e==t?!0:e&&t?e.x==t.x&&e.y==t.y:!1},goog.math.Coordinate.distance=function(e,t){var o=e.x-t.x,r=e.y-t.y;return Math.sqrt(o*o+r*r)},goog.math.Coordinate.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},goog.math.Coordinate.azimuth=function(e){return goog.math.angle(0,0,e.x,e.y)},goog.math.Coordinate.squaredDistance=function(e,t){var o=e.x-t.x,r=e.y-t.y;return o*o+r*r},goog.math.Coordinate.difference=function(e,t){return new goog.math.Coordinate(e.x-t.x,e.y-t.y)},goog.math.Coordinate.sum=function(e,t){return new goog.math.Coordinate(e.x+t.x,e.y+t.y)},goog.math.Coordinate.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},goog.math.Coordinate.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},goog.math.Coordinate.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},goog.math.Coordinate.prototype.translate=function(e,t){return e instanceof goog.math.Coordinate?(this.x+=e.x,this.y+=e.y):(this.x+=e,goog.isNumber(t)&&(this.y+=t)),this},goog.math.Coordinate.prototype.scale=function(e,t){var o=goog.isNumber(t)?t:e;return this.x*=e,this.y*=o,this},goog.provide("goog.math.Size"),goog.math.Size=function(e,t){this.width=e,this.height=t},goog.math.Size.equals=function(e,t){return e==t?!0:e&&t?e.width==t.width&&e.height==t.height:!1},goog.math.Size.prototype.clone=function(){return new goog.math.Size(this.width,this.height)},goog.DEBUG&&(goog.math.Size.prototype.toString=function(){return"("+this.width+" x "+this.height+")"}),goog.math.Size.prototype.getLongest=function(){return Math.max(this.width,this.height)},goog.math.Size.prototype.getShortest=function(){return Math.min(this.width,this.height)},goog.math.Size.prototype.area=function(){return this.width*this.height},goog.math.Size.prototype.perimeter=function(){return 2*(this.width+this.height)},goog.math.Size.prototype.aspectRatio=function(){return this.width/this.height},goog.math.Size.prototype.isEmpty=function(){return!this.area()},goog.math.Size.prototype.ceil=function(){return this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this},goog.math.Size.prototype.fitsInside=function(e){return this.width<=e.width&&this.height<=e.height},goog.math.Size.prototype.floor=function(){return this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},goog.math.Size.prototype.round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},goog.math.Size.prototype.scale=function(e,t){var o=goog.isNumber(t)?t:e;return this.width*=e,this.height*=o,this},goog.math.Size.prototype.scaleToFit=function(e){var t=this.aspectRatio()>e.aspectRatio()?e.width/this.width:e.height/this.height;return this.scale(t)},goog.provide("goog.dom"),goog.provide("goog.dom.Appendable"),goog.provide("goog.dom.DomHelper"),goog.provide("goog.dom.NodeType"),goog.require("goog.array"),goog.require("goog.dom.BrowserFeature"),goog.require("goog.dom.TagName"),goog.require("goog.dom.classes"),goog.require("goog.math.Coordinate"),goog.require("goog.math.Size"),goog.require("goog.object"),goog.require("goog.string"),goog.require("goog.userAgent"),goog.define("goog.dom.ASSUME_QUIRKS_MODE",!1),goog.define("goog.dom.ASSUME_STANDARDS_MODE",!1),goog.dom.COMPAT_MODE_KNOWN_=goog.dom.ASSUME_QUIRKS_MODE||goog.dom.ASSUME_STANDARDS_MODE,goog.dom.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},goog.dom.getDomHelper=function(e){return e?new goog.dom.DomHelper(goog.dom.getOwnerDocument(e)):goog.dom.defaultDomHelper_||(goog.dom.defaultDomHelper_=new goog.dom.DomHelper)
},goog.dom.defaultDomHelper_,goog.dom.getDocument=function(){return document},goog.dom.getElement=function(e){return goog.isString(e)?document.getElementById(e):e},goog.dom.$=goog.dom.getElement,goog.dom.getElementsByTagNameAndClass=function(e,t,o){return goog.dom.getElementsByTagNameAndClass_(document,e,t,o)},goog.dom.getElementsByClass=function(e,t){var o=t||document;return goog.dom.canUseQuerySelector_(o)?o.querySelectorAll("."+e):o.getElementsByClassName?o.getElementsByClassName(e):goog.dom.getElementsByTagNameAndClass_(document,"*",e,t)},goog.dom.getElementByClass=function(e,t){var o=t||document,r=null;return r=goog.dom.canUseQuerySelector_(o)?o.querySelector("."+e):goog.dom.getElementsByClass(e,t)[0],r||null},goog.dom.canUseQuerySelector_=function(e){return!(!e.querySelectorAll||!e.querySelector)},goog.dom.getElementsByTagNameAndClass_=function(e,t,o,r){var n=r||e,i=t&&"*"!=t?t.toUpperCase():"";if(goog.dom.canUseQuerySelector_(n)&&(i||o)){var s=i+(o?"."+o:"");return n.querySelectorAll(s)}if(o&&n.getElementsByClassName){var a=n.getElementsByClassName(o);if(i){for(var g,d={},u=0,l=0;g=a[l];l++)i==g.nodeName&&(d[u++]=g);return d.length=u,d}return a}var a=n.getElementsByTagName(i||"*");if(o){for(var g,d={},u=0,l=0;g=a[l];l++){var c=g.className;"function"==typeof c.split&&goog.array.contains(c.split(/\s+/),o)&&(d[u++]=g)}return d.length=u,d}return a},goog.dom.$$=goog.dom.getElementsByTagNameAndClass,goog.dom.setProperties=function(e,t){goog.object.forEach(t,function(t,o){"style"==o?e.style.cssText=t:"class"==o?e.className=t:"for"==o?e.htmlFor=t:o in goog.dom.DIRECT_ATTRIBUTE_MAP_?e.setAttribute(goog.dom.DIRECT_ATTRIBUTE_MAP_[o],t):goog.string.startsWith(o,"aria-")||goog.string.startsWith(o,"data-")?e.setAttribute(o,t):e[o]=t})},goog.dom.DIRECT_ATTRIBUTE_MAP_={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"},goog.dom.getViewportSize=function(e){return goog.dom.getViewportSize_(e||window)},goog.dom.getViewportSize_=function(e){var t=e.document,o=goog.dom.isCss1CompatMode_(t)?t.documentElement:t.body;return new goog.math.Size(o.clientWidth,o.clientHeight)},goog.dom.getDocumentHeight=function(){return goog.dom.getDocumentHeight_(window)},goog.dom.getDocumentHeight_=function(e){var t=e.document,o=0;if(t){var r=goog.dom.getViewportSize_(e).height,n=t.body,i=t.documentElement;if(goog.dom.isCss1CompatMode_(t)&&i.scrollHeight)o=i.scrollHeight!=r?i.scrollHeight:i.offsetHeight;else{var s=i.scrollHeight,a=i.offsetHeight;i.clientHeight!=a&&(s=n.scrollHeight,a=n.offsetHeight),o=s>r?s>a?s:a:a>s?s:a}}return o},goog.dom.getPageScroll=function(e){var t=e||goog.global||window;return goog.dom.getDomHelper(t.document).getDocumentScroll()},goog.dom.getDocumentScroll=function(){return goog.dom.getDocumentScroll_(document)},goog.dom.getDocumentScroll_=function(e){var t=goog.dom.getDocumentScrollElement_(e),o=goog.dom.getWindow_(e);return goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("10")&&o.pageYOffset!=t.scrollTop?new goog.math.Coordinate(t.scrollLeft,t.scrollTop):new goog.math.Coordinate(o.pageXOffset||t.scrollLeft,o.pageYOffset||t.scrollTop)},goog.dom.getDocumentScrollElement=function(){return goog.dom.getDocumentScrollElement_(document)},goog.dom.getDocumentScrollElement_=function(e){return!goog.userAgent.WEBKIT&&goog.dom.isCss1CompatMode_(e)?e.documentElement:e.body},goog.dom.getWindow=function(e){return e?goog.dom.getWindow_(e):window},goog.dom.getWindow_=function(e){return e.parentWindow||e.defaultView},goog.dom.createDom=function(){return goog.dom.createDom_(document,arguments)},goog.dom.createDom_=function(e,t){var o=t[0],r=t[1];if(!goog.dom.BrowserFeature.CAN_ADD_NAME_OR_TYPE_ATTRIBUTES&&r&&(r.name||r.type)){var n=["<",o];if(r.name&&n.push(' name="',goog.string.htmlEscape(r.name),'"'),r.type){n.push(' type="',goog.string.htmlEscape(r.type),'"');var i={};goog.object.extend(i,r),delete i.type,r=i}n.push(">"),o=n.join("")}var s=e.createElement(o);return r&&(goog.isString(r)?s.className=r:goog.isArray(r)?goog.dom.classes.add.apply(null,[s].concat(r)):goog.dom.setProperties(s,r)),t.length>2&&goog.dom.append_(e,s,t,2),s},goog.dom.append_=function(e,t,o,r){function n(o){o&&t.appendChild(goog.isString(o)?e.createTextNode(o):o)}for(var i=r;i<o.length;i++){var s=o[i];goog.isArrayLike(s)&&!goog.dom.isNodeLike(s)?goog.array.forEach(goog.dom.isNodeList(s)?goog.array.toArray(s):s,n):n(s)}},goog.dom.$dom=goog.dom.createDom,goog.dom.createElement=function(e){return document.createElement(e)},goog.dom.createTextNode=function(e){return document.createTextNode(String(e))},goog.dom.createTable=function(e,t,o){return goog.dom.createTable_(document,e,t,!!o)},goog.dom.createTable_=function(e,t,o,r){for(var n=["<tr>"],i=0;o>i;i++)n.push(r?"<td>&nbsp;</td>":"<td></td>");n.push("</tr>"),n=n.join("");var s=["<table>"];for(i=0;t>i;i++)s.push(n);s.push("</table>");var a=e.createElement(goog.dom.TagName.DIV);return a.innerHTML=s.join(""),a.removeChild(a.firstChild)},goog.dom.htmlToDocumentFragment=function(e){return goog.dom.htmlToDocumentFragment_(document,e)},goog.dom.htmlToDocumentFragment_=function(e,t){var o=e.createElement("div");if(goog.dom.BrowserFeature.INNER_HTML_NEEDS_SCOPED_ELEMENT?(o.innerHTML="<br>"+t,o.removeChild(o.firstChild)):o.innerHTML=t,1==o.childNodes.length)return o.removeChild(o.firstChild);for(var r=e.createDocumentFragment();o.firstChild;)r.appendChild(o.firstChild);return r},goog.dom.getCompatMode=function(){return goog.dom.isCss1CompatMode()?"CSS1Compat":"BackCompat"},goog.dom.isCss1CompatMode=function(){return goog.dom.isCss1CompatMode_(document)},goog.dom.isCss1CompatMode_=function(e){return goog.dom.COMPAT_MODE_KNOWN_?goog.dom.ASSUME_STANDARDS_MODE:"CSS1Compat"==e.compatMode},goog.dom.canHaveChildren=function(e){if(e.nodeType!=goog.dom.NodeType.ELEMENT)return!1;switch(e.tagName){case goog.dom.TagName.APPLET:case goog.dom.TagName.AREA:case goog.dom.TagName.BASE:case goog.dom.TagName.BR:case goog.dom.TagName.COL:case goog.dom.TagName.COMMAND:case goog.dom.TagName.EMBED:case goog.dom.TagName.FRAME:case goog.dom.TagName.HR:case goog.dom.TagName.IMG:case goog.dom.TagName.INPUT:case goog.dom.TagName.IFRAME:case goog.dom.TagName.ISINDEX:case goog.dom.TagName.KEYGEN:case goog.dom.TagName.LINK:case goog.dom.TagName.NOFRAMES:case goog.dom.TagName.NOSCRIPT:case goog.dom.TagName.META:case goog.dom.TagName.OBJECT:case goog.dom.TagName.PARAM:case goog.dom.TagName.SCRIPT:case goog.dom.TagName.SOURCE:case goog.dom.TagName.STYLE:case goog.dom.TagName.TRACK:case goog.dom.TagName.WBR:return!1}return!0},goog.dom.appendChild=function(e,t){e.appendChild(t)},goog.dom.append=function(e){goog.dom.append_(goog.dom.getOwnerDocument(e),e,arguments,1)},goog.dom.removeChildren=function(e){for(var t;t=e.firstChild;)e.removeChild(t)},goog.dom.insertSiblingBefore=function(e,t){t.parentNode&&t.parentNode.insertBefore(e,t)},goog.dom.insertSiblingAfter=function(e,t){t.parentNode&&t.parentNode.insertBefore(e,t.nextSibling)},goog.dom.insertChildAt=function(e,t,o){e.insertBefore(t,e.childNodes[o]||null)},goog.dom.removeNode=function(e){return e&&e.parentNode?e.parentNode.removeChild(e):null},goog.dom.replaceNode=function(e,t){var o=t.parentNode;o&&o.replaceChild(e,t)},goog.dom.flattenElement=function(e){var t,o=e.parentNode;if(o&&o.nodeType!=goog.dom.NodeType.DOCUMENT_FRAGMENT){if(e.removeNode)return e.removeNode(!1);for(;t=e.firstChild;)o.insertBefore(t,e);return goog.dom.removeNode(e)}},goog.dom.getChildren=function(e){return goog.dom.BrowserFeature.CAN_USE_CHILDREN_ATTRIBUTE&&void 0!=e.children?e.children:goog.array.filter(e.childNodes,function(e){return e.nodeType==goog.dom.NodeType.ELEMENT})},goog.dom.getFirstElementChild=function(e){return void 0!=e.firstElementChild?e.firstElementChild:goog.dom.getNextElementNode_(e.firstChild,!0)},goog.dom.getLastElementChild=function(e){return void 0!=e.lastElementChild?e.lastElementChild:goog.dom.getNextElementNode_(e.lastChild,!1)},goog.dom.getNextElementSibling=function(e){return void 0!=e.nextElementSibling?e.nextElementSibling:goog.dom.getNextElementNode_(e.nextSibling,!0)},goog.dom.getPreviousElementSibling=function(e){return void 0!=e.previousElementSibling?e.previousElementSibling:goog.dom.getNextElementNode_(e.previousSibling,!1)},goog.dom.getNextElementNode_=function(e,t){for(;e&&e.nodeType!=goog.dom.NodeType.ELEMENT;)e=t?e.nextSibling:e.previousSibling;return e},goog.dom.getNextNode=function(e){if(!e)return null;if(e.firstChild)return e.firstChild;for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null},goog.dom.getPreviousNode=function(e){if(!e)return null;if(!e.previousSibling)return e.parentNode;for(e=e.previousSibling;e&&e.lastChild;)e=e.lastChild;return e},goog.dom.isNodeLike=function(e){return goog.isObject(e)&&e.nodeType>0},goog.dom.isElement=function(e){return goog.isObject(e)&&e.nodeType==goog.dom.NodeType.ELEMENT},goog.dom.isWindow=function(e){return goog.isObject(e)&&e.window==e},goog.dom.getParentElement=function(e){if(goog.dom.BrowserFeature.CAN_USE_PARENT_ELEMENT_PROPERTY){var t=goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("9")&&!goog.userAgent.isVersionOrHigher("10");if(!(t&&goog.global.SVGElement&&e instanceof goog.global.SVGElement))return e.parentElement}var o=e.parentNode;return goog.dom.isElement(o)?o:null},goog.dom.contains=function(e,t){if(e.contains&&t.nodeType==goog.dom.NodeType.ELEMENT)return e==t||e.contains(t);if("undefined"!=typeof e.compareDocumentPosition)return e==t||Boolean(16&e.compareDocumentPosition(t));for(;t&&e!=t;)t=t.parentNode;return t==e},goog.dom.compareNodeOrder=function(e,t){if(e==t)return 0;if(e.compareDocumentPosition)return 2&e.compareDocumentPosition(t)?1:-1;if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)){if(e.nodeType==goog.dom.NodeType.DOCUMENT)return-1;if(t.nodeType==goog.dom.NodeType.DOCUMENT)return 1}if("sourceIndex"in e||e.parentNode&&"sourceIndex"in e.parentNode){var o=e.nodeType==goog.dom.NodeType.ELEMENT,r=t.nodeType==goog.dom.NodeType.ELEMENT;if(o&&r)return e.sourceIndex-t.sourceIndex;var n=e.parentNode,i=t.parentNode;return n==i?goog.dom.compareSiblingOrder_(e,t):!o&&goog.dom.contains(n,t)?-1*goog.dom.compareParentsDescendantNodeIe_(e,t):!r&&goog.dom.contains(i,e)?goog.dom.compareParentsDescendantNodeIe_(t,e):(o?e.sourceIndex:n.sourceIndex)-(r?t.sourceIndex:i.sourceIndex)}var s,a,g=goog.dom.getOwnerDocument(e);return s=g.createRange(),s.selectNode(e),s.collapse(!0),a=g.createRange(),a.selectNode(t),a.collapse(!0),s.compareBoundaryPoints(goog.global.Range.START_TO_END,a)},goog.dom.compareParentsDescendantNodeIe_=function(e,t){var o=e.parentNode;if(o==t)return-1;for(var r=t;r.parentNode!=o;)r=r.parentNode;return goog.dom.compareSiblingOrder_(r,e)},goog.dom.compareSiblingOrder_=function(e,t){for(var o=t;o=o.previousSibling;)if(o==e)return-1;return 1},goog.dom.findCommonAncestor=function(){var e,t=arguments.length;if(!t)return null;if(1==t)return arguments[0];var o=[],r=1/0;for(e=0;t>e;e++){for(var n=[],i=arguments[e];i;)n.unshift(i),i=i.parentNode;o.push(n),r=Math.min(r,n.length)}var s=null;for(e=0;r>e;e++){for(var a=o[0][e],g=1;t>g;g++)if(a!=o[g][e])return s;s=a}return s},goog.dom.getOwnerDocument=function(e){return e.nodeType==goog.dom.NodeType.DOCUMENT?e:e.ownerDocument||e.document},goog.dom.getFrameContentDocument=function(e){var t=e.contentDocument||e.contentWindow.document;return t},goog.dom.getFrameContentWindow=function(e){return e.contentWindow||goog.dom.getWindow_(goog.dom.getFrameContentDocument(e))},goog.dom.setTextContent=function(e,t){if("textContent"in e)e.textContent=t;else if(e.firstChild&&e.firstChild.nodeType==goog.dom.NodeType.TEXT){for(;e.lastChild!=e.firstChild;)e.removeChild(e.lastChild);e.firstChild.data=t}else{goog.dom.removeChildren(e);var o=goog.dom.getOwnerDocument(e);e.appendChild(o.createTextNode(String(t)))}},goog.dom.getOuterHtml=function(e){if("outerHTML"in e)return e.outerHTML;var t=goog.dom.getOwnerDocument(e),o=t.createElement("div");return o.appendChild(e.cloneNode(!0)),o.innerHTML},goog.dom.findNode=function(e,t){var o=[],r=goog.dom.findNodes_(e,t,o,!0);return r?o[0]:void 0},goog.dom.findNodes=function(e,t){var o=[];return goog.dom.findNodes_(e,t,o,!1),o},goog.dom.findNodes_=function(e,t,o,r){if(null!=e)for(var n=e.firstChild;n;){if(t(n)&&(o.push(n),r))return!0;if(goog.dom.findNodes_(n,t,o,r))return!0;n=n.nextSibling}return!1},goog.dom.TAGS_TO_IGNORE_={SCRIPT:1,STYLE:1,HEAD:1,IFRAME:1,OBJECT:1},goog.dom.PREDEFINED_TAG_VALUES_={IMG:" ",BR:"\n"},goog.dom.isFocusableTabIndex=function(e){var t=e.getAttributeNode("tabindex");if(t&&t.specified){var o=e.tabIndex;return goog.isNumber(o)&&o>=0&&32768>o}return!1},goog.dom.setFocusableTabIndex=function(e,t){t?e.tabIndex=0:(e.tabIndex=-1,e.removeAttribute("tabIndex"))},goog.dom.getTextContent=function(e){var t;if(goog.dom.BrowserFeature.CAN_USE_INNER_TEXT&&"innerText"in e)t=goog.string.canonicalizeNewlines(e.innerText);else{var o=[];goog.dom.getTextContent_(e,o,!0),t=o.join("")}return t=t.replace(/ \xAD /g," ").replace(/\xAD/g,""),t=t.replace(/\u200B/g,""),goog.dom.BrowserFeature.CAN_USE_INNER_TEXT||(t=t.replace(/ +/g," "))," "!=t&&(t=t.replace(/^\s*/,"")),t},goog.dom.getRawTextContent=function(e){var t=[];return goog.dom.getTextContent_(e,t,!1),t.join("")},goog.dom.getTextContent_=function(e,t,o){if(e.nodeName in goog.dom.TAGS_TO_IGNORE_);else if(e.nodeType==goog.dom.NodeType.TEXT)o?t.push(String(e.nodeValue).replace(/(\r\n|\r|\n)/g,"")):t.push(e.nodeValue);else if(e.nodeName in goog.dom.PREDEFINED_TAG_VALUES_)t.push(goog.dom.PREDEFINED_TAG_VALUES_[e.nodeName]);else for(var r=e.firstChild;r;)goog.dom.getTextContent_(r,t,o),r=r.nextSibling},goog.dom.getNodeTextLength=function(e){return goog.dom.getTextContent(e).length},goog.dom.getNodeTextOffset=function(e,t){for(var o=t||goog.dom.getOwnerDocument(e).body,r=[];e&&e!=o;){for(var n=e;n=n.previousSibling;)r.unshift(goog.dom.getTextContent(n));e=e.parentNode}return goog.string.trimLeft(r.join("")).replace(/ +/g," ").length},goog.dom.getNodeAtOffset=function(e,t,o){for(var r=[e],n=0,i=null;r.length>0&&t>n;)if(i=r.pop(),i.nodeName in goog.dom.TAGS_TO_IGNORE_);else if(i.nodeType==goog.dom.NodeType.TEXT){var s=i.nodeValue.replace(/(\r\n|\r|\n)/g,"").replace(/ +/g," ");n+=s.length}else if(i.nodeName in goog.dom.PREDEFINED_TAG_VALUES_)n+=goog.dom.PREDEFINED_TAG_VALUES_[i.nodeName].length;else for(var a=i.childNodes.length-1;a>=0;a--)r.push(i.childNodes[a]);return goog.isObject(o)&&(o.remainder=i?i.nodeValue.length+t-n-1:0,o.node=i),i},goog.dom.isNodeList=function(e){if(e&&"number"==typeof e.length){if(goog.isObject(e))return"function"==typeof e.item||"string"==typeof e.item;if(goog.isFunction(e))return"function"==typeof e.item}return!1},goog.dom.getAncestorByTagNameAndClass=function(e,t,o){if(!t&&!o)return null;var r=t?t.toUpperCase():null;return goog.dom.getAncestor(e,function(e){return!(r&&e.nodeName!=r||o&&!goog.dom.classes.has(e,o))},!0)},goog.dom.getAncestorByClass=function(e,t){return goog.dom.getAncestorByTagNameAndClass(e,null,t)},goog.dom.getAncestor=function(e,t,o,r){o||(e=e.parentNode);for(var n=null==r,i=0;e&&(n||r>=i);){if(t(e))return e;e=e.parentNode,i++}return null},goog.dom.getActiveElement=function(e){try{return e&&e.activeElement}catch(t){}return null},goog.dom.DomHelper=function(e){this.document_=e||goog.global.document||document},goog.dom.DomHelper.prototype.getDomHelper=goog.dom.getDomHelper,goog.dom.DomHelper.prototype.setDocument=function(e){this.document_=e},goog.dom.DomHelper.prototype.getDocument=function(){return this.document_},goog.dom.DomHelper.prototype.getElement=function(e){return goog.isString(e)?this.document_.getElementById(e):e},goog.dom.DomHelper.prototype.$=goog.dom.DomHelper.prototype.getElement,goog.dom.DomHelper.prototype.getElementsByTagNameAndClass=function(e,t,o){return goog.dom.getElementsByTagNameAndClass_(this.document_,e,t,o)},goog.dom.DomHelper.prototype.getElementsByClass=function(e,t){var o=t||this.document_;return goog.dom.getElementsByClass(e,o)},goog.dom.DomHelper.prototype.getElementByClass=function(e,t){var o=t||this.document_;return goog.dom.getElementByClass(e,o)},goog.dom.DomHelper.prototype.$$=goog.dom.DomHelper.prototype.getElementsByTagNameAndClass,goog.dom.DomHelper.prototype.setProperties=goog.dom.setProperties,goog.dom.DomHelper.prototype.getViewportSize=function(e){return goog.dom.getViewportSize(e||this.getWindow())},goog.dom.DomHelper.prototype.getDocumentHeight=function(){return goog.dom.getDocumentHeight_(this.getWindow())},goog.dom.Appendable,goog.dom.DomHelper.prototype.createDom=function(){return goog.dom.createDom_(this.document_,arguments)},goog.dom.DomHelper.prototype.$dom=goog.dom.DomHelper.prototype.createDom,goog.dom.DomHelper.prototype.createElement=function(e){return this.document_.createElement(e)},goog.dom.DomHelper.prototype.createTextNode=function(e){return this.document_.createTextNode(String(e))},goog.dom.DomHelper.prototype.createTable=function(e,t,o){return goog.dom.createTable_(this.document_,e,t,!!o)},goog.dom.DomHelper.prototype.htmlToDocumentFragment=function(e){return goog.dom.htmlToDocumentFragment_(this.document_,e)},goog.dom.DomHelper.prototype.getCompatMode=function(){return this.isCss1CompatMode()?"CSS1Compat":"BackCompat"},goog.dom.DomHelper.prototype.isCss1CompatMode=function(){return goog.dom.isCss1CompatMode_(this.document_)},goog.dom.DomHelper.prototype.getWindow=function(){return goog.dom.getWindow_(this.document_)},goog.dom.DomHelper.prototype.getDocumentScrollElement=function(){return goog.dom.getDocumentScrollElement_(this.document_)},goog.dom.DomHelper.prototype.getDocumentScroll=function(){return goog.dom.getDocumentScroll_(this.document_)},goog.dom.DomHelper.prototype.getActiveElement=function(e){return goog.dom.getActiveElement(e||this.document_)},goog.dom.DomHelper.prototype.appendChild=goog.dom.appendChild,goog.dom.DomHelper.prototype.append=goog.dom.append,goog.dom.DomHelper.prototype.canHaveChildren=goog.dom.canHaveChildren,goog.dom.DomHelper.prototype.removeChildren=goog.dom.removeChildren,goog.dom.DomHelper.prototype.insertSiblingBefore=goog.dom.insertSiblingBefore,goog.dom.DomHelper.prototype.insertSiblingAfter=goog.dom.insertSiblingAfter,goog.dom.DomHelper.prototype.insertChildAt=goog.dom.insertChildAt,goog.dom.DomHelper.prototype.removeNode=goog.dom.removeNode,goog.dom.DomHelper.prototype.replaceNode=goog.dom.replaceNode,goog.dom.DomHelper.prototype.flattenElement=goog.dom.flattenElement,goog.dom.DomHelper.prototype.getChildren=goog.dom.getChildren,goog.dom.DomHelper.prototype.getFirstElementChild=goog.dom.getFirstElementChild,goog.dom.DomHelper.prototype.getLastElementChild=goog.dom.getLastElementChild,goog.dom.DomHelper.prototype.getNextElementSibling=goog.dom.getNextElementSibling,goog.dom.DomHelper.prototype.getPreviousElementSibling=goog.dom.getPreviousElementSibling,goog.dom.DomHelper.prototype.getNextNode=goog.dom.getNextNode,goog.dom.DomHelper.prototype.getPreviousNode=goog.dom.getPreviousNode,goog.dom.DomHelper.prototype.isNodeLike=goog.dom.isNodeLike,goog.dom.DomHelper.prototype.isElement=goog.dom.isElement,goog.dom.DomHelper.prototype.isWindow=goog.dom.isWindow,goog.dom.DomHelper.prototype.getParentElement=goog.dom.getParentElement,goog.dom.DomHelper.prototype.contains=goog.dom.contains,goog.dom.DomHelper.prototype.compareNodeOrder=goog.dom.compareNodeOrder,goog.dom.DomHelper.prototype.findCommonAncestor=goog.dom.findCommonAncestor,goog.dom.DomHelper.prototype.getOwnerDocument=goog.dom.getOwnerDocument,goog.dom.DomHelper.prototype.getFrameContentDocument=goog.dom.getFrameContentDocument,goog.dom.DomHelper.prototype.getFrameContentWindow=goog.dom.getFrameContentWindow,goog.dom.DomHelper.prototype.setTextContent=goog.dom.setTextContent,goog.dom.DomHelper.prototype.getOuterHtml=goog.dom.getOuterHtml,goog.dom.DomHelper.prototype.findNode=goog.dom.findNode,goog.dom.DomHelper.prototype.findNodes=goog.dom.findNodes,goog.dom.DomHelper.prototype.isFocusableTabIndex=goog.dom.isFocusableTabIndex,goog.dom.DomHelper.prototype.setFocusableTabIndex=goog.dom.setFocusableTabIndex,goog.dom.DomHelper.prototype.getTextContent=goog.dom.getTextContent,goog.dom.DomHelper.prototype.getNodeTextLength=goog.dom.getNodeTextLength,goog.dom.DomHelper.prototype.getNodeTextOffset=goog.dom.getNodeTextOffset,goog.dom.DomHelper.prototype.getNodeAtOffset=goog.dom.getNodeAtOffset,goog.dom.DomHelper.prototype.isNodeList=goog.dom.isNodeList,goog.dom.DomHelper.prototype.getAncestorByTagNameAndClass=goog.dom.getAncestorByTagNameAndClass,goog.dom.DomHelper.prototype.getAncestorByClass=goog.dom.getAncestorByClass,goog.dom.DomHelper.prototype.getAncestor=goog.dom.getAncestor,goog.provide("goog.dom.vendor"),goog.require("goog.userAgent"),goog.dom.vendor.getVendorJsPrefix=function(){return goog.userAgent.WEBKIT?"Webkit":goog.userAgent.GECKO?"Moz":goog.userAgent.IE?"ms":goog.userAgent.OPERA?"O":null},goog.dom.vendor.getVendorPrefix=function(){return goog.userAgent.WEBKIT?"-webkit":goog.userAgent.GECKO?"-moz":goog.userAgent.IE?"-ms":goog.userAgent.OPERA?"-o":null},goog.provide("goog.math.Box"),goog.require("goog.math.Coordinate"),goog.math.Box=function(e,t,o,r){this.top=e,this.right=t,this.bottom=o,this.left=r},goog.math.Box.boundingBox=function(){for(var e=new goog.math.Box(arguments[0].y,arguments[0].x,arguments[0].y,arguments[0].x),t=1;t<arguments.length;t++){var o=arguments[t];e.top=Math.min(e.top,o.y),e.right=Math.max(e.right,o.x),e.bottom=Math.max(e.bottom,o.y),e.left=Math.min(e.left,o.x)}return e},goog.math.Box.prototype.clone=function(){return new goog.math.Box(this.top,this.right,this.bottom,this.left)},goog.DEBUG&&(goog.math.Box.prototype.toString=function(){return"("+this.top+"t, "+this.right+"r, "+this.bottom+"b, "+this.left+"l)"}),goog.math.Box.prototype.contains=function(e){return goog.math.Box.contains(this,e)},goog.math.Box.prototype.expand=function(e,t,o,r){return goog.isObject(e)?(this.top-=e.top,this.right+=e.right,this.bottom+=e.bottom,this.left-=e.left):(this.top-=e,this.right+=t,this.bottom+=o,this.left-=r),this},goog.math.Box.prototype.expandToInclude=function(e){this.left=Math.min(this.left,e.left),this.top=Math.min(this.top,e.top),this.right=Math.max(this.right,e.right),this.bottom=Math.max(this.bottom,e.bottom)},goog.math.Box.equals=function(e,t){return e==t?!0:e&&t?e.top==t.top&&e.right==t.right&&e.bottom==t.bottom&&e.left==t.left:!1},goog.math.Box.contains=function(e,t){return e&&t?t instanceof goog.math.Box?t.left>=e.left&&t.right<=e.right&&t.top>=e.top&&t.bottom<=e.bottom:t.x>=e.left&&t.x<=e.right&&t.y>=e.top&&t.y<=e.bottom:!1},goog.math.Box.relativePositionX=function(e,t){return t.x<e.left?t.x-e.left:t.x>e.right?t.x-e.right:0},goog.math.Box.relativePositionY=function(e,t){return t.y<e.top?t.y-e.top:t.y>e.bottom?t.y-e.bottom:0},goog.math.Box.distance=function(e,t){var o=goog.math.Box.relativePositionX(e,t),r=goog.math.Box.relativePositionY(e,t);return Math.sqrt(o*o+r*r)},goog.math.Box.intersects=function(e,t){return e.left<=t.right&&t.left<=e.right&&e.top<=t.bottom&&t.top<=e.bottom},goog.math.Box.intersectsWithPadding=function(e,t,o){return e.left<=t.right+o&&t.left<=e.right+o&&e.top<=t.bottom+o&&t.top<=e.bottom+o},goog.math.Box.prototype.ceil=function(){return this.top=Math.ceil(this.top),this.right=Math.ceil(this.right),this.bottom=Math.ceil(this.bottom),this.left=Math.ceil(this.left),this},goog.math.Box.prototype.floor=function(){return this.top=Math.floor(this.top),this.right=Math.floor(this.right),this.bottom=Math.floor(this.bottom),this.left=Math.floor(this.left),this},goog.math.Box.prototype.round=function(){return this.top=Math.round(this.top),this.right=Math.round(this.right),this.bottom=Math.round(this.bottom),this.left=Math.round(this.left),this},goog.math.Box.prototype.translate=function(e,t){return e instanceof goog.math.Coordinate?(this.left+=e.x,this.right+=e.x,this.top+=e.y,this.bottom+=e.y):(this.left+=e,this.right+=e,goog.isNumber(t)&&(this.top+=t,this.bottom+=t)),this},goog.math.Box.prototype.scale=function(e,t){var o=goog.isNumber(t)?t:e;return this.left*=e,this.right*=e,this.top*=o,this.bottom*=o,this},goog.provide("goog.math.Rect"),goog.require("goog.math.Box"),goog.require("goog.math.Coordinate"),goog.require("goog.math.Size"),goog.math.Rect=function(e,t,o,r){this.left=e,this.top=t,this.width=o,this.height=r},goog.math.Rect.prototype.clone=function(){return new goog.math.Rect(this.left,this.top,this.width,this.height)},goog.math.Rect.prototype.toBox=function(){var e=this.left+this.width,t=this.top+this.height;return new goog.math.Box(this.top,e,t,this.left)},goog.math.Rect.createFromBox=function(e){return new goog.math.Rect(e.left,e.top,e.right-e.left,e.bottom-e.top)},goog.DEBUG&&(goog.math.Rect.prototype.toString=function(){return"("+this.left+", "+this.top+" - "+this.width+"w x "+this.height+"h)"}),goog.math.Rect.equals=function(e,t){return e==t?!0:e&&t?e.left==t.left&&e.width==t.width&&e.top==t.top&&e.height==t.height:!1},goog.math.Rect.prototype.intersection=function(e){var t=Math.max(this.left,e.left),o=Math.min(this.left+this.width,e.left+e.width);if(o>=t){var r=Math.max(this.top,e.top),n=Math.min(this.top+this.height,e.top+e.height);if(n>=r)return this.left=t,this.top=r,this.width=o-t,this.height=n-r,!0}return!1},goog.math.Rect.intersection=function(e,t){var o=Math.max(e.left,t.left),r=Math.min(e.left+e.width,t.left+t.width);if(r>=o){var n=Math.max(e.top,t.top),i=Math.min(e.top+e.height,t.top+t.height);if(i>=n)return new goog.math.Rect(o,n,r-o,i-n)}return null},goog.math.Rect.intersects=function(e,t){return e.left<=t.left+t.width&&t.left<=e.left+e.width&&e.top<=t.top+t.height&&t.top<=e.top+e.height},goog.math.Rect.prototype.intersects=function(e){return goog.math.Rect.intersects(this,e)},goog.math.Rect.difference=function(e,t){var o=goog.math.Rect.intersection(e,t);if(!o||!o.height||!o.width)return[e.clone()];var r=[],n=e.top,i=e.height,s=e.left+e.width,a=e.top+e.height,g=t.left+t.width,d=t.top+t.height;return t.top>e.top&&(r.push(new goog.math.Rect(e.left,e.top,e.width,t.top-e.top)),n=t.top,i-=t.top-e.top),a>d&&(r.push(new goog.math.Rect(e.left,d,e.width,a-d)),i=d-n),t.left>e.left&&r.push(new goog.math.Rect(e.left,n,t.left-e.left,i)),s>g&&r.push(new goog.math.Rect(g,n,s-g,i)),r},goog.math.Rect.prototype.difference=function(e){return goog.math.Rect.difference(this,e)},goog.math.Rect.prototype.boundingRect=function(e){var t=Math.max(this.left+this.width,e.left+e.width),o=Math.max(this.top+this.height,e.top+e.height);this.left=Math.min(this.left,e.left),this.top=Math.min(this.top,e.top),this.width=t-this.left,this.height=o-this.top},goog.math.Rect.boundingRect=function(e,t){if(!e||!t)return null;var o=e.clone();return o.boundingRect(t),o},goog.math.Rect.prototype.contains=function(e){return e instanceof goog.math.Rect?this.left<=e.left&&this.left+this.width>=e.left+e.width&&this.top<=e.top&&this.top+this.height>=e.top+e.height:e.x>=this.left&&e.x<=this.left+this.width&&e.y>=this.top&&e.y<=this.top+this.height},goog.math.Rect.prototype.squaredDistance=function(e){var t=e.x<this.left?this.left-e.x:Math.max(e.x-(this.left+this.width),0),o=e.y<this.top?this.top-e.y:Math.max(e.y-(this.top+this.height),0);return t*t+o*o},goog.math.Rect.prototype.distance=function(e){return Math.sqrt(this.squaredDistance(e))},goog.math.Rect.prototype.getSize=function(){return new goog.math.Size(this.width,this.height)},goog.math.Rect.prototype.getTopLeft=function(){return new goog.math.Coordinate(this.left,this.top)},goog.math.Rect.prototype.getCenter=function(){return new goog.math.Coordinate(this.left+this.width/2,this.top+this.height/2)},goog.math.Rect.prototype.getBottomRight=function(){return new goog.math.Coordinate(this.left+this.width,this.top+this.height)},goog.math.Rect.prototype.ceil=function(){return this.left=Math.ceil(this.left),this.top=Math.ceil(this.top),this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this},goog.math.Rect.prototype.floor=function(){return this.left=Math.floor(this.left),this.top=Math.floor(this.top),this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},goog.math.Rect.prototype.round=function(){return this.left=Math.round(this.left),this.top=Math.round(this.top),this.width=Math.round(this.width),this.height=Math.round(this.height),this},goog.math.Rect.prototype.translate=function(e,t){return e instanceof goog.math.Coordinate?(this.left+=e.x,this.top+=e.y):(this.left+=e,goog.isNumber(t)&&(this.top+=t)),this},goog.math.Rect.prototype.scale=function(e,t){var o=goog.isNumber(t)?t:e;return this.left*=e,this.width*=e,this.top*=o,this.height*=o,this},goog.provide("goog.style"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.dom"),goog.require("goog.dom.NodeType"),goog.require("goog.dom.vendor"),goog.require("goog.math.Box"),goog.require("goog.math.Coordinate"),goog.require("goog.math.Rect"),goog.require("goog.math.Size"),goog.require("goog.object"),goog.require("goog.string"),goog.require("goog.userAgent"),goog.define("goog.style.GET_BOUNDING_CLIENT_RECT_ALWAYS_EXISTS",!1),goog.style.setStyle=function(e,t,o){goog.isString(t)?goog.style.setStyle_(e,o,t):goog.object.forEach(t,goog.partial(goog.style.setStyle_,e))},goog.style.setStyle_=function(e,t,o){var r=goog.style.getVendorJsStyleName_(e,o);r&&(e.style[r]=t)},goog.style.getVendorJsStyleName_=function(e,t){var o=goog.string.toCamelCase(t);if(void 0===e.style[o]){var r=goog.dom.vendor.getVendorJsPrefix()+goog.string.toTitleCase(t);if(void 0!==e.style[r])return r}return o},goog.style.getVendorStyleName_=function(e,t){var o=goog.string.toCamelCase(t);if(void 0===e.style[o]){var r=goog.dom.vendor.getVendorJsPrefix()+goog.string.toTitleCase(t);if(void 0!==e.style[r])return goog.dom.vendor.getVendorPrefix()+"-"+t}return t},goog.style.getStyle=function(e,t){var o=e.style[goog.string.toCamelCase(t)];return"undefined"!=typeof o?o:e.style[goog.style.getVendorJsStyleName_(e,t)]||""},goog.style.getComputedStyle=function(e,t){var o=goog.dom.getOwnerDocument(e);if(o.defaultView&&o.defaultView.getComputedStyle){var r=o.defaultView.getComputedStyle(e,null);if(r)return r[t]||r.getPropertyValue(t)||""}return""},goog.style.getCascadedStyle=function(e,t){return e.currentStyle?e.currentStyle[t]:null},goog.style.getStyle_=function(e,t){return goog.style.getComputedStyle(e,t)||goog.style.getCascadedStyle(e,t)||e.style&&e.style[t]},goog.style.getComputedPosition=function(e){return goog.style.getStyle_(e,"position")},goog.style.getBackgroundColor=function(e){return goog.style.getStyle_(e,"backgroundColor")},goog.style.getComputedOverflowX=function(e){return goog.style.getStyle_(e,"overflowX")},goog.style.getComputedOverflowY=function(e){return goog.style.getStyle_(e,"overflowY")},goog.style.getComputedZIndex=function(e){return goog.style.getStyle_(e,"zIndex")},goog.style.getComputedTextAlign=function(e){return goog.style.getStyle_(e,"textAlign")},goog.style.getComputedCursor=function(e){return goog.style.getStyle_(e,"cursor")},goog.style.setPosition=function(e,t,o){var r,n,i=goog.userAgent.GECKO&&(goog.userAgent.MAC||goog.userAgent.X11)&&goog.userAgent.isVersionOrHigher("1.9");t instanceof goog.math.Coordinate?(r=t.x,n=t.y):(r=t,n=o),e.style.left=goog.style.getPixelStyleValue_(r,i),e.style.top=goog.style.getPixelStyleValue_(n,i)},goog.style.getPosition=function(e){return new goog.math.Coordinate(e.offsetLeft,e.offsetTop)},goog.style.getClientViewportElement=function(e){var t;return t=e?goog.dom.getOwnerDocument(e):goog.dom.getDocument(),!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9)||goog.dom.getDomHelper(t).isCss1CompatMode()?t.documentElement:t.body},goog.style.getViewportPageOffset=function(e){var t=e.body,o=e.documentElement,r=t.scrollLeft||o.scrollLeft,n=t.scrollTop||o.scrollTop;return new goog.math.Coordinate(r,n)},goog.style.getBoundingClientRect_=function(e){var t=e.getBoundingClientRect();if(goog.userAgent.IE){var o=e.ownerDocument;t.left-=o.documentElement.clientLeft+o.body.clientLeft,t.top-=o.documentElement.clientTop+o.body.clientTop}return t},goog.style.getOffsetParent=function(e){if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(8))return e.offsetParent;for(var t=goog.dom.getOwnerDocument(e),o=goog.style.getStyle_(e,"position"),r="fixed"==o||"absolute"==o,n=e.parentNode;n&&n!=t;n=n.parentNode)if(o=goog.style.getStyle_(n,"position"),r=r&&"static"==o&&n!=t.documentElement&&n!=t.body,!r&&(n.scrollWidth>n.clientWidth||n.scrollHeight>n.clientHeight||"fixed"==o||"absolute"==o||"relative"==o))return n;return null},goog.style.getVisibleRectForElement=function(e){for(var t=new goog.math.Box(0,1/0,1/0,0),o=goog.dom.getDomHelper(e),r=o.getDocument().body,n=o.getDocument().documentElement,i=o.getDocumentScrollElement(),s=e;s=goog.style.getOffsetParent(s);)if(!(goog.userAgent.IE&&0==s.clientWidth||goog.userAgent.WEBKIT&&0==s.clientHeight&&s==r||s==r||s==n||"visible"==goog.style.getStyle_(s,"overflow"))){var a=goog.style.getPageOffset(s),g=goog.style.getClientLeftTop(s);
a.x+=g.x,a.y+=g.y,t.top=Math.max(t.top,a.y),t.right=Math.min(t.right,a.x+s.clientWidth),t.bottom=Math.min(t.bottom,a.y+s.clientHeight),t.left=Math.max(t.left,a.x)}var d=i.scrollLeft,u=i.scrollTop;t.left=Math.max(t.left,d),t.top=Math.max(t.top,u);var l=o.getViewportSize();return t.right=Math.min(t.right,d+l.width),t.bottom=Math.min(t.bottom,u+l.height),t.top>=0&&t.left>=0&&t.bottom>t.top&&t.right>t.left?t:null},goog.style.getContainerOffsetToScrollInto=function(e,t,o){var r=goog.style.getPageOffset(e),n=goog.style.getPageOffset(t),i=goog.style.getBorderBox(t),s=r.x-n.x-i.left,a=r.y-n.y-i.top,g=t.clientWidth-e.offsetWidth,d=t.clientHeight-e.offsetHeight,u=t.scrollLeft,l=t.scrollTop;return o?(u+=s-g/2,l+=a-d/2):(u+=Math.min(s,Math.max(s-g,0)),l+=Math.min(a,Math.max(a-d,0))),new goog.math.Coordinate(u,l)},goog.style.scrollIntoContainerView=function(e,t,o){var r=goog.style.getContainerOffsetToScrollInto(e,t,o);t.scrollLeft=r.x,t.scrollTop=r.y},goog.style.getClientLeftTop=function(e){if(goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher("1.9")){var t=parseFloat(goog.style.getComputedStyle(e,"borderLeftWidth"));if(goog.style.isRightToLeft(e)){var o=e.offsetWidth-e.clientWidth-t-parseFloat(goog.style.getComputedStyle(e,"borderRightWidth"));t+=o}return new goog.math.Coordinate(t,parseFloat(goog.style.getComputedStyle(e,"borderTopWidth")))}return new goog.math.Coordinate(e.clientLeft,e.clientTop)},goog.style.getPageOffset=function(e){var t,o=goog.dom.getOwnerDocument(e),r=goog.style.getStyle_(e,"position");goog.asserts.assertObject(e,"Parameter is required");var n=!goog.style.GET_BOUNDING_CLIENT_RECT_ALWAYS_EXISTS&&goog.userAgent.GECKO&&o.getBoxObjectFor&&!e.getBoundingClientRect&&"absolute"==r&&(t=o.getBoxObjectFor(e))&&(t.screenX<0||t.screenY<0),i=new goog.math.Coordinate(0,0),s=goog.style.getClientViewportElement(o);if(e==s)return i;if(goog.style.GET_BOUNDING_CLIENT_RECT_ALWAYS_EXISTS||e.getBoundingClientRect){t=goog.style.getBoundingClientRect_(e);var a=goog.dom.getDomHelper(o).getDocumentScroll();i.x=t.left+a.x,i.y=t.top+a.y}else if(o.getBoxObjectFor&&!n){t=o.getBoxObjectFor(e);var g=o.getBoxObjectFor(s);i.x=t.screenX-g.screenX,i.y=t.screenY-g.screenY}else{var d=e;do{if(i.x+=d.offsetLeft,i.y+=d.offsetTop,d!=e&&(i.x+=d.clientLeft||0,i.y+=d.clientTop||0),goog.userAgent.WEBKIT&&"fixed"==goog.style.getComputedPosition(d)){i.x+=o.body.scrollLeft,i.y+=o.body.scrollTop;break}d=d.offsetParent}while(d&&d!=e);for((goog.userAgent.OPERA||goog.userAgent.WEBKIT&&"absolute"==r)&&(i.y-=o.body.offsetTop),d=e;(d=goog.style.getOffsetParent(d))&&d!=o.body&&d!=s;)i.x-=d.scrollLeft,goog.userAgent.OPERA&&"TR"==d.tagName||(i.y-=d.scrollTop)}return i},goog.style.getPageOffsetLeft=function(e){return goog.style.getPageOffset(e).x},goog.style.getPageOffsetTop=function(e){return goog.style.getPageOffset(e).y},goog.style.getFramedPageOffset=function(e,t){var o=new goog.math.Coordinate(0,0),r=goog.dom.getWindow(goog.dom.getOwnerDocument(e)),n=e;do{var i=r==t?goog.style.getPageOffset(n):goog.style.getClientPositionForElement_(goog.asserts.assert(n));o.x+=i.x,o.y+=i.y}while(r&&r!=t&&(n=r.frameElement)&&(r=r.parent));return o},goog.style.translateRectForAnotherFrame=function(e,t,o){if(t.getDocument()!=o.getDocument()){var r=t.getDocument().body,n=goog.style.getFramedPageOffset(r,o.getWindow());n=goog.math.Coordinate.difference(n,goog.style.getPageOffset(r)),goog.userAgent.IE&&!t.isCss1CompatMode()&&(n=goog.math.Coordinate.difference(n,t.getDocumentScroll())),e.left+=n.x,e.top+=n.y}},goog.style.getRelativePosition=function(e,t){var o=goog.style.getClientPosition(e),r=goog.style.getClientPosition(t);return new goog.math.Coordinate(o.x-r.x,o.y-r.y)},goog.style.getClientPositionForElement_=function(e){var t;if(goog.style.GET_BOUNDING_CLIENT_RECT_ALWAYS_EXISTS||e.getBoundingClientRect){var o=goog.style.getBoundingClientRect_(e);t=new goog.math.Coordinate(o.left,o.top)}else{var r=goog.dom.getDomHelper(e).getDocumentScroll(),n=goog.style.getPageOffset(e);t=new goog.math.Coordinate(n.x-r.x,n.y-r.y)}return goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher(12)?goog.math.Coordinate.sum(t,goog.style.getCssTranslation(e)):t},goog.style.getClientPosition=function(e){if(goog.asserts.assert(e),e.nodeType==goog.dom.NodeType.ELEMENT)return goog.style.getClientPositionForElement_(e);var t=goog.isFunction(e.getBrowserEvent),o=e;return e.targetTouches?o=e.targetTouches[0]:t&&e.getBrowserEvent().targetTouches&&(o=e.getBrowserEvent().targetTouches[0]),new goog.math.Coordinate(o.clientX,o.clientY)},goog.style.setPageOffset=function(e,t,o){var r=goog.style.getPageOffset(e);t instanceof goog.math.Coordinate&&(o=t.y,t=t.x);var n=t-r.x,i=o-r.y;goog.style.setPosition(e,e.offsetLeft+n,e.offsetTop+i)},goog.style.setSize=function(e,t,o){var r;if(t instanceof goog.math.Size)r=t.height,t=t.width;else{if(void 0==o)throw Error("missing height argument");r=o}goog.style.setWidth(e,t),goog.style.setHeight(e,r)},goog.style.getPixelStyleValue_=function(e,t){return"number"==typeof e&&(e=(t?Math.round(e):e)+"px"),e},goog.style.setHeight=function(e,t){e.style.height=goog.style.getPixelStyleValue_(t,!0)},goog.style.setWidth=function(e,t){e.style.width=goog.style.getPixelStyleValue_(t,!0)},goog.style.getSize=function(e){if("none"!=goog.style.getStyle_(e,"display"))return goog.style.getSizeWithDisplay_(e);var t=e.style,o=t.display,r=t.visibility,n=t.position;t.visibility="hidden",t.position="absolute",t.display="inline";var i=goog.style.getSizeWithDisplay_(e);return t.display=o,t.position=n,t.visibility=r,i},goog.style.getSizeWithDisplay_=function(e){var t=e.offsetWidth,o=e.offsetHeight,r=goog.userAgent.WEBKIT&&!t&&!o;if((!goog.isDef(t)||r)&&e.getBoundingClientRect){var n=goog.style.getBoundingClientRect_(e);return new goog.math.Size(n.right-n.left,n.bottom-n.top)}return new goog.math.Size(t,o)},goog.style.getBounds=function(e){var t=goog.style.getPageOffset(e),o=goog.style.getSize(e);return new goog.math.Rect(t.x,t.y,o.width,o.height)},goog.style.toCamelCase=function(e){return goog.string.toCamelCase(String(e))},goog.style.toSelectorCase=function(e){return goog.string.toSelectorCase(e)},goog.style.getOpacity=function(e){var t=e.style,o="";if("opacity"in t)o=t.opacity;else if("MozOpacity"in t)o=t.MozOpacity;else if("filter"in t){var r=t.filter.match(/alpha\(opacity=([\d.]+)\)/);r&&(o=String(r[1]/100))}return""==o?o:Number(o)},goog.style.setOpacity=function(e,t){var o=e.style;"opacity"in o?o.opacity=t:"MozOpacity"in o?o.MozOpacity=t:"filter"in o&&(o.filter=""===t?"":"alpha(opacity="+100*t+")")},goog.style.setTransparentBackgroundImage=function(e,t){var o=e.style;goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("8")?o.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+t+'", sizingMethod="crop")':(o.backgroundImage="url("+t+")",o.backgroundPosition="top left",o.backgroundRepeat="no-repeat")},goog.style.clearTransparentBackgroundImage=function(e){var t=e.style;"filter"in t?t.filter="":t.backgroundImage="none"},goog.style.showElement=function(e,t){goog.style.setElementShown(e,t)},goog.style.setElementShown=function(e,t){e.style.display=t?"":"none"},goog.style.isElementShown=function(e){return"none"!=e.style.display},goog.style.installStyles=function(e,t){var o=goog.dom.getDomHelper(t),r=null;if(goog.userAgent.IE)r=o.getDocument().createStyleSheet(),goog.style.setStyles(r,e);else{var n=o.getElementsByTagNameAndClass("head")[0];if(!n){var i=o.getElementsByTagNameAndClass("body")[0];n=o.createDom("head"),i.parentNode.insertBefore(n,i)}r=o.createDom("style"),goog.style.setStyles(r,e),o.appendChild(n,r)}return r},goog.style.uninstallStyles=function(e){var t=e.ownerNode||e.owningElement||e;goog.dom.removeNode(t)},goog.style.setStyles=function(e,t){goog.userAgent.IE?e.cssText=t:e.innerHTML=t},goog.style.setPreWrap=function(e){var t=e.style;goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("8")?(t.whiteSpace="pre",t.wordWrap="break-word"):t.whiteSpace=goog.userAgent.GECKO?"-moz-pre-wrap":"pre-wrap"},goog.style.setInlineBlock=function(e){var t=e.style;t.position="relative",goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("8")?(t.zoom="1",t.display="inline"):t.display=goog.userAgent.GECKO?goog.userAgent.isVersionOrHigher("1.9a")?"inline-block":"-moz-inline-box":"inline-block"},goog.style.isRightToLeft=function(e){return"rtl"==goog.style.getStyle_(e,"direction")},goog.style.unselectableStyle_=goog.userAgent.GECKO?"MozUserSelect":goog.userAgent.WEBKIT?"WebkitUserSelect":null,goog.style.isUnselectable=function(e){return goog.style.unselectableStyle_?"none"==e.style[goog.style.unselectableStyle_].toLowerCase():goog.userAgent.IE||goog.userAgent.OPERA?"on"==e.getAttribute("unselectable"):!1},goog.style.setUnselectable=function(e,t,o){var r=o?null:e.getElementsByTagName("*"),n=goog.style.unselectableStyle_;if(n){var i=t?"none":"";if(e.style[n]=i,r)for(var s,a=0;s=r[a];a++)s.style[n]=i}else if(goog.userAgent.IE||goog.userAgent.OPERA){var i=t?"on":"";if(e.setAttribute("unselectable",i),r)for(var s,a=0;s=r[a];a++)s.setAttribute("unselectable",i)}},goog.style.getBorderBoxSize=function(e){return new goog.math.Size(e.offsetWidth,e.offsetHeight)},goog.style.setBorderBoxSize=function(e,t){var o=goog.dom.getOwnerDocument(e),r=goog.dom.getDomHelper(o).isCss1CompatMode();if(!goog.userAgent.IE||r&&goog.userAgent.isVersionOrHigher("8"))goog.style.setBoxSizingSize_(e,t,"border-box");else{var n=e.style;if(r){var i=goog.style.getPaddingBox(e),s=goog.style.getBorderBox(e);n.pixelWidth=t.width-s.left-i.left-i.right-s.right,n.pixelHeight=t.height-s.top-i.top-i.bottom-s.bottom}else n.pixelWidth=t.width,n.pixelHeight=t.height}},goog.style.getContentBoxSize=function(e){var t=goog.dom.getOwnerDocument(e),o=goog.userAgent.IE&&e.currentStyle;if(o&&goog.dom.getDomHelper(t).isCss1CompatMode()&&"auto"!=o.width&&"auto"!=o.height&&!o.boxSizing){var r=goog.style.getIePixelValue_(e,o.width,"width","pixelWidth"),n=goog.style.getIePixelValue_(e,o.height,"height","pixelHeight");return new goog.math.Size(r,n)}var i=goog.style.getBorderBoxSize(e),s=goog.style.getPaddingBox(e),a=goog.style.getBorderBox(e);return new goog.math.Size(i.width-a.left-s.left-s.right-a.right,i.height-a.top-s.top-s.bottom-a.bottom)},goog.style.setContentBoxSize=function(e,t){var o=goog.dom.getOwnerDocument(e),r=goog.dom.getDomHelper(o).isCss1CompatMode();if(!goog.userAgent.IE||r&&goog.userAgent.isVersionOrHigher("8"))goog.style.setBoxSizingSize_(e,t,"content-box");else{var n=e.style;if(r)n.pixelWidth=t.width,n.pixelHeight=t.height;else{var i=goog.style.getPaddingBox(e),s=goog.style.getBorderBox(e);n.pixelWidth=t.width+s.left+i.left+i.right+s.right,n.pixelHeight=t.height+s.top+i.top+i.bottom+s.bottom}}},goog.style.setBoxSizingSize_=function(e,t,o){var r=e.style;goog.userAgent.GECKO?r.MozBoxSizing=o:goog.userAgent.WEBKIT?r.WebkitBoxSizing=o:r.boxSizing=o,r.width=Math.max(t.width,0)+"px",r.height=Math.max(t.height,0)+"px"},goog.style.getIePixelValue_=function(e,t,o,r){if(/^\d+px?$/.test(t))return parseInt(t,10);var n=e.style[o],i=e.runtimeStyle[o];e.runtimeStyle[o]=e.currentStyle[o],e.style[o]=t;var s=e.style[r];return e.style[o]=n,e.runtimeStyle[o]=i,s},goog.style.getIePixelDistance_=function(e,t){var o=goog.style.getCascadedStyle(e,t);return o?goog.style.getIePixelValue_(e,o,"left","pixelLeft"):0},goog.style.getBox_=function(e,t){if(goog.userAgent.IE){var o=goog.style.getIePixelDistance_(e,t+"Left"),r=goog.style.getIePixelDistance_(e,t+"Right"),n=goog.style.getIePixelDistance_(e,t+"Top"),i=goog.style.getIePixelDistance_(e,t+"Bottom");return new goog.math.Box(n,r,i,o)}var o=goog.style.getComputedStyle(e,t+"Left"),r=goog.style.getComputedStyle(e,t+"Right"),n=goog.style.getComputedStyle(e,t+"Top"),i=goog.style.getComputedStyle(e,t+"Bottom");return new goog.math.Box(parseFloat(n),parseFloat(r),parseFloat(i),parseFloat(o))},goog.style.getPaddingBox=function(e){return goog.style.getBox_(e,"padding")},goog.style.getMarginBox=function(e){return goog.style.getBox_(e,"margin")},goog.style.ieBorderWidthKeywords_={thin:2,medium:4,thick:6},goog.style.getIePixelBorder_=function(e,t){if("none"==goog.style.getCascadedStyle(e,t+"Style"))return 0;var o=goog.style.getCascadedStyle(e,t+"Width");return o in goog.style.ieBorderWidthKeywords_?goog.style.ieBorderWidthKeywords_[o]:goog.style.getIePixelValue_(e,o,"left","pixelLeft")},goog.style.getBorderBox=function(e){if(goog.userAgent.IE){var t=goog.style.getIePixelBorder_(e,"borderLeft"),o=goog.style.getIePixelBorder_(e,"borderRight"),r=goog.style.getIePixelBorder_(e,"borderTop"),n=goog.style.getIePixelBorder_(e,"borderBottom");return new goog.math.Box(r,o,n,t)}var t=goog.style.getComputedStyle(e,"borderLeftWidth"),o=goog.style.getComputedStyle(e,"borderRightWidth"),r=goog.style.getComputedStyle(e,"borderTopWidth"),n=goog.style.getComputedStyle(e,"borderBottomWidth");return new goog.math.Box(parseFloat(r),parseFloat(o),parseFloat(n),parseFloat(t))},goog.style.getFontFamily=function(e){var t=goog.dom.getOwnerDocument(e),o="";if(t.body.createTextRange){var r=t.body.createTextRange();r.moveToElementText(e);try{o=r.queryCommandValue("FontName")}catch(n){o=""}}o||(o=goog.style.getStyle_(e,"fontFamily"));var i=o.split(",");return i.length>1&&(o=i[0]),goog.string.stripQuotes(o,"\"'")},goog.style.lengthUnitRegex_=/[^\d]+$/,goog.style.getLengthUnits=function(e){var t=e.match(goog.style.lengthUnitRegex_);return t&&t[0]||null},goog.style.ABSOLUTE_CSS_LENGTH_UNITS_={cm:1,"in":1,mm:1,pc:1,pt:1},goog.style.CONVERTIBLE_RELATIVE_CSS_UNITS_={em:1,ex:1},goog.style.getFontSize=function(e){var t=goog.style.getStyle_(e,"fontSize"),o=goog.style.getLengthUnits(t);if(t&&"px"==o)return parseInt(t,10);if(goog.userAgent.IE){if(o in goog.style.ABSOLUTE_CSS_LENGTH_UNITS_)return goog.style.getIePixelValue_(e,t,"left","pixelLeft");if(e.parentNode&&e.parentNode.nodeType==goog.dom.NodeType.ELEMENT&&o in goog.style.CONVERTIBLE_RELATIVE_CSS_UNITS_){var r=e.parentNode,n=goog.style.getStyle_(r,"fontSize");return goog.style.getIePixelValue_(r,t==n?"1em":t,"left","pixelLeft")}}var i=goog.dom.createDom("span",{style:"visibility:hidden;position:absolute;line-height:0;padding:0;margin:0;border:0;height:1em;"});return goog.dom.appendChild(e,i),t=i.offsetHeight,goog.dom.removeNode(i),t},goog.style.parseStyleAttribute=function(e){var t={};return goog.array.forEach(e.split(/\s*;\s*/),function(e){var o=e.split(/\s*:\s*/);2==o.length&&(t[goog.string.toCamelCase(o[0].toLowerCase())]=o[1])}),t},goog.style.toStyleAttribute=function(e){var t=[];return goog.object.forEach(e,function(e,o){t.push(goog.string.toSelectorCase(o),":",e,";")}),t.join("")},goog.style.setFloat=function(e,t){e.style[goog.userAgent.IE?"styleFloat":"cssFloat"]=t},goog.style.getFloat=function(e){return e.style[goog.userAgent.IE?"styleFloat":"cssFloat"]||""},goog.style.getScrollbarWidth=function(e){var t=goog.dom.createElement("div");e&&(t.className=e),t.style.cssText="overflow:auto;position:absolute;top:0;width:100px;height:100px";var o=goog.dom.createElement("div");goog.style.setSize(o,"200px","200px"),t.appendChild(o),goog.dom.appendChild(goog.dom.getDocument().body,t);var r=t.offsetWidth-t.clientWidth;return goog.dom.removeNode(t),r},goog.style.MATRIX_TRANSLATION_REGEX_=new RegExp("matrix\\([0-9\\.\\-]+, [0-9\\.\\-]+, [0-9\\.\\-]+, [0-9\\.\\-]+, ([0-9\\.\\-]+)p?x?, ([0-9\\.\\-]+)p?x?\\)"),goog.style.getCssTranslation=function(e){var t;goog.userAgent.IE?t="-ms-transform":goog.userAgent.WEBKIT?t="-webkit-transform":goog.userAgent.OPERA?t="-o-transform":goog.userAgent.GECKO&&(t="-moz-transform");var o;if(t&&(o=goog.style.getStyle_(e,t)),o||(o=goog.style.getStyle_(e,"transform")),!o)return new goog.math.Coordinate(0,0);var r=o.match(goog.style.MATRIX_TRANSLATION_REGEX_);return r?new goog.math.Coordinate(parseFloat(r[1]),parseFloat(r[2])):new goog.math.Coordinate(0,0)},goog.provide("goog.debug.DivConsole"),goog.require("goog.debug.HtmlFormatter"),goog.require("goog.debug.LogManager"),goog.require("goog.style"),goog.debug.DivConsole=function(e){this.publishHandler_=goog.bind(this.addLogRecord,this),this.formatter_=new goog.debug.HtmlFormatter,this.formatter_.showAbsoluteTime=!1,this.isCapturing_=!1,this.element_=e,this.elementOwnerDocument_=this.element_.ownerDocument||this.element_.document,this.installStyles()},goog.debug.DivConsole.prototype.installStyles=function(){goog.style.installStyles(".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}",this.element_),this.element_.className+=" logdiv"},goog.debug.DivConsole.prototype.setCapturing=function(e){if(e!=this.isCapturing_){var t=goog.debug.LogManager.getRoot();e?t.addHandler(this.publishHandler_):(t.removeHandler(this.publishHandler_),this.logBuffer=""),this.isCapturing_=e}},goog.debug.DivConsole.prototype.addLogRecord=function(e){var t=this.element_.scrollHeight-this.element_.scrollTop-this.element_.clientHeight<=100,o=this.elementOwnerDocument_.createElement("div");o.className="logmsg",o.innerHTML=this.formatter_.formatRecord(e),this.element_.appendChild(o),t&&(this.element_.scrollTop=this.element_.scrollHeight)},goog.debug.DivConsole.prototype.getFormatter=function(){return this.formatter_},goog.debug.DivConsole.prototype.setFormatter=function(e){this.formatter_=e},goog.debug.DivConsole.prototype.addSeparator=function(){var e=this.elementOwnerDocument_.createElement("div");e.className="logmsg logsep",this.element_.appendChild(e)},goog.debug.DivConsole.prototype.clear=function(){this.element_.innerHTML=""},goog.provide("ydn.debug"),goog.require("goog.debug.Console"),goog.require("goog.debug.DivConsole"),goog.require("goog.debug.LogManager"),goog.require("goog.debug.Logger"),goog.require("goog.events.BrowserEvent"),ydn.debug.logger_console=null,ydn.debug.logger_div=null,ydn.debug.logger=goog.debug.Logger.getLogger("ydn.debug"),ydn.debug.log=function(e,t,o){e=e||"ydn";var r=goog.isNumber(t)?new goog.debug.Logger.Level("log",t):goog.isString(t)?goog.debug.Logger.Level.getPredefinedLevel(t.toUpperCase()):goog.debug.Logger.Level.FINE;goog.debug.Logger.getLogger(e).setLevel(r),goog.isDef(o)?ydn.debug.logger_div||(ydn.debug.logger_div=new goog.debug.DivConsole(o),ydn.debug.logger_div.setCapturing(!0),goog.debug.LogManager.getRoot().setLevel(goog.debug.Logger.Level.WARNING)):ydn.debug.logger_console||ydn.debug.logger_div||(ydn.debug.logger_console=new goog.debug.Console,ydn.debug.logger_console.setCapturing(!0),goog.debug.LogManager.getRoot().setLevel(goog.debug.Logger.Level.WARNING))},goog.provide("ydn.debug.exports"),goog.require("ydn.debug"),goog.exportSymbol("ydn.debug.log",ydn.debug.log),goog.provide("ydn.db.Storage.main_entry"),goog.require("ydn.base.exports"),goog.require("ydn.db.Storage"),goog.require("ydn.db.algo.exports"),goog.require("ydn.db.con.exports"),goog.require("ydn.db.core.exports"),goog.require("ydn.db.crud.exports"),goog.require("ydn.db.sql.exports"),goog.require("ydn.db.tr.events.exports"),goog.require("ydn.debug.exports"),goog.exportSymbol("ydn.db.Storage",ydn.db.Storage),ydn.json.POLY_FILL=!0,function(){this.SeedsStore=function(){function e(e){null==e&&(e="seeds"),this.initDb(e)}return e.prototype.delegates=[],e.prototype.initDb=function(e){var t,o;return o={name:"pod",keyPath:"name",type:"TEXT",indexes:[{keyPath:"stars"},{keyPath:"pushed_at"},{keyPath:"category"}]},t={name:"category",keyPath:"name",type:"TEXT",indexes:[]},this.db=new ydn.db.Storage(e,{stores:[o,t]})},e.prototype.clear=function(){return this.db.clear()},e.prototype.findPods=function(e,t,o,r){return null==t&&(t=!0),null==o&&(o=0),null==r&&(r=50),logger.verbose("PodsStore#readPage"),"name"===e?(logger.verbose("sortBy=name"),this.db.values("pod",null,r,o,!t)):(logger.verbose("sortBy="+e),this.db.values("pod",e,null,r,o,!t))},e.prototype.findPodsByCategory=function(e,t,o,r,n){var i;return null==o&&(o=!0),null==r&&(r=0),null==n&&(n=50),logger.verbose("PodsStore#readCategory"),i=ydn.db.KeyRange.only(e),this.db.values("pod","category",i).then(function(e){var i,s,a,g,d;for(d=new ObjectSorter,d.sortBy=t,i=d.sort(e),o&&i.reverse(),g=[],s=r;r+n>s&&s<i.length;)a=i[s],g.push(a),s++;return g})},e.prototype.findPod=function(e){var t;return t=ydn.db.KeyRange.only(e),this.db.values("pod",t)},e.prototype.countPods=function(){return this.db.count("pod")},e.prototype.updatePods=function(e){return this.db.put("pod",e)},e.prototype.findCategories=function(){var e;return e=new ydn.db.ValueIterator("category"),this.db.values(e,1e3)},e.prototype.findCategory=function(e){var t;return t=ydn.db.KeyRange.only(e),this.db.values("category",t)},e.prototype.updateCategories=function(e){return this.db.clear("category"),this.db.put("category",e)},e}()}.call(this),function(){this.SeedsWorkerClient=function(){function e(e){this.worker=e,this.worker.onmessage=function(e){return function(t){var o;return o=t.data.command,"didLoad"===o?(e.progress=t.data.progress,e.didLoad(t.data.id,t.data.pods)):"didLoadAll"===o?e.didLoadAll():"ready"===o?e.worker.postMessage({command:"init"}):"didInitCategories"===o?e.didLoadCategories(t.data.index):"didInitPodsLoader"===o?e.loadPods():void 0}}(this)}return e.prototype.delegates=[],e.prototype.didLoadCategories=function(e){return this.delegate&&this.delegate.didLoadCategories?this.delegate.didLoadCategories(e):void 0},e.prototype.loadPods=function(){return this.progress=0,this.worker.postMessage({command:"reload"})},e.prototype.didLoad=function(e,t){return this.delegate&&this.delegate.didLoad?this.delegate.didLoad(e,t):void 0},e.prototype.didLoadAll=function(){return this.delegate&&this.delegate.didLoadAll?this.delegate.didLoadAll():void 0},e}()}.call(this),function(){this.logger=new Logger("app","info")}.call(this);